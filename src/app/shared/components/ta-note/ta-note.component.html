<div
    class="all_note_holder"
    [class.closed_main_holder]="!openedAll && noteOpened"
    [class.opened_main_all_holder]="openedAll"
    #t2="ngbPopover"
    [ngbPopover]="note_popover"
    [autoClose]="'outside'"
    [container]="'body'"
    [placement]="'left-top'"
    popoverClass="my-note-popover"
    triggers="manual"
    (click)="openedAll ? toggleNote(_note, t2) : ''"
>
    <div
        class="note_button_hold"
        *ngIf="!openedAll && (noteOpened || (!noteOpened && !savingNote))"
        [ngClass]="{
            'note-normal-icon': !openedAll,
            'note-note-empty': !_note && !openedAll,
            'note-all-expanded': noteOpened
        }"
        [tooltipBackground]="'#6C6C6C'"
        ngbTooltip
        [mainTooltip]="_note && noteOpened ? 'Edit Note' : 'View Note'"
        position="bottom"
    >
        <svg-icon
            #t2="ngbPopover"
            [ngbPopover]="note_popover"
            [autoClose]="'outside'"
            class="note-btn"
            [container]="'body'"
            [placement]="'left-top'"
            [animation]="false"
            popoverClass="my-note-popover"
            triggers="manual"
            (click)="toggleNote(_note, t2)"
            (hidden)="popoverClosed()"
            src="assets/svg/truckassist-table/note/{{ noteIcon }}"
        >
        </svg-icon>
    </div>
    <div class="spinner" *ngIf="!openedAll && !noteOpened && savingNote">
        <app-ta-spinner [size]="'small'" [color]="'blueDark'"></app-ta-spinner>
    </div>
    <div
        *ngIf="openedAll"
        [innerHTML]="_note | safeHtml"
        class="note_inner_text"
    ></div>
</div>

<ng-template #note_popover let-data="data">
    <div
        class="kendo-editor-note-wrapper"
        [class.opened_all_hold]="openedAll"
        [class.closed_note_hold]="!openedAll && noteOpened"
        [class.dispatch]="isDispatch"
    >
        <div
            [class.expanded]="isExpanded"
            class="k-widget k-editor custom_editor"
            [ngStyle]="{
                width: parentWidth ? _parentWidth + 'px' : _noteWidth + 'px'
            }"
        >
            <div
                (blur)="prepareForTextRange()"
                (focus)="checkFocus($event)"
                (input)="valueChange($event.target.innerHTML)"
                @noteLongAnimation
                [@.disabled]="openedAll || parking || noteOpened"
                [class.not_expanded]="!isExpanded"
                [class.parking_text_hold]="parking"
                [class.opened_all_editor]="openedAll"
                [innerHTML]="_note | safeHtml"
                class="editor"
                (keydown)="maxLimitForContenteditableDiv($event, 250)"
                contenteditable="true"
                spellcheck="false"
                id="main_editor"
                (paste)="onPaste($event)"
            ></div>
            <div class="container_separate" *ngIf="isExpanded">
                <div
                    class="container_separate_inner"
                ></div>
            </div>
            <div class="spinner" *ngIf="savingNote && isExpanded">
                <app-ta-spinner
                    [size]="'small'"
                    [color]="'blueDark'"
                ></app-ta-spinner>
            </div>
            <div
                class="note_container"
                (click)="preventMouseDown($event)"
                *ngIf="isExpanded"
            >
                <app-ta-note-container
                    #noteContainer
                    [isExpanded]="isExpanded"
                    [range]="range"
                    [selectionTaken]="selectionTaken"
                    [value]="value"
                    [parking]="parking"
                    [popoverNote]="true"
                    [selectedEditor]="main_editor?.nativeElement"
                    [type]="'dark'"
                ></app-ta-note-container>
            </div>
        </div>
    </div>
</ng-template>
