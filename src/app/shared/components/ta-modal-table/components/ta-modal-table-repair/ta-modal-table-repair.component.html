<form [formGroup]="modalTableForm" class="table-body">
    <div
        class="d-flex flex-column repair-bill-table-container"
        [ngClass]="{
            'repair-order-table-container': isRepairOrderTable,
            'fuel-table': isFuelTable
        }"
    >
        <ng-container
            formArrayName="repairBillTableItems"
            *ngFor="
                let repairBillItemRow of formArray.controls;
                let i = index;
                trackBy: '' | trackByProperty
            "
        >
            <div
                class="align-items-center table-item"
                [ngClass]="{ valid: repairBillItemRow.valid }"
                [formGroupName]="i"
            >
                <div
                    class="d-flex justify-content-center align-items-center table-item-number"
                >
                    <p class="m-0 ta-font-medium">{{ i + 1 }}</p>

                    <svg-icon
                        class="delete-icon"
                        [src]="svgRoutes.deleteIcon"
                        [svgStyle]="{
                            'width.px': 18,
                            'height.px': 18
                        }"
                        (click)="emitDeleteFormArrayRowClick(i)"
                    ></svg-icon>
                </div>

                <ng-container *ngIf="!isFuelTable; else showItemsDropdown">
                    <app-ta-input
                        formControlName="description"
                        [inputConfig]="{
                        name: 'description',
                        type: 'text',
                        label: 'Description',
                        placeholderInsteadOfLabel: true,
                        minLength: 5,
                        maxLength: 64,
                        textTransform: 'lowercase',
                        hideErrorMessage: true,
                        hideRequiredCheck: true,
                        isRequired: true,
                        isInputBackgroundRemoved:
                            repairBillItemRow.valid && !isInputHoverRows[i][0],
                        isBlueText:
                            repairBillItemRow.valid &&
                            !isInputHoverRows[i][0] &&
                            selectedTruckTrailerRepairPm[i],
                        blackInput:
                            formArray.at(i).get('description').value &&
                            !isInputHoverRows[i][0],
                    }"
                        (mouseenter)="emitOnInputHover(true, i, 0)"
                        (mouseleave)="emitOnInputHover(false, i, 0)"
                    ></app-ta-input>
                    <div
                        class="pm-dropdown-container"
                        [ngClass]="{
                            'hidden-pm-dropdown':
                                !truckTrailerRepairPmOptions?.truckPmDropdownList &&
                                !truckTrailerRepairPmOptions?.trailerPmDropdownList
                        }"
                    >
                        <app-ta-input-dropdown
                            formControlName="pm"
                            [template]="'svgtext-template'"
                            [inputConfig]="{
                                name: 'pm',
                                type: 'text',
                                label: '',
                                placeholderInsteadOfLabel: true,
                                hideErrorMessage: true,
                                hideRequiredCheck: true,
                                hideClear: true,
                                isDropdown: true,
                                isIconInput: true,
                                isValidIcon: selectedTruckTrailerRepairPm[i],
                                inputIcon:
                                    selectedTruckTrailerRepairPm[i]?.logoName ||
                                    'ic_custom_pm.svg',
                                dropdownWidthClass: 'w-col-200'
                            }"
                            [canAddNew]="
                                truckTrailerRepairPmOptions?.truckPmDropdownList &&
                                truckTrailerRepairPmOptions?.trailerPmDropdownList
                            "
                            [activeItem]="selectedTruckTrailerRepairPm[i]"
                            [options]="
                                truckTrailerRepairPmOptions?.truckPmDropdownList ||
                                truckTrailerRepairPmOptions?.trailerPmDropdownList
                            "
                            (selectedItem)="emitOnSelectDropdown($event, i)"
                        ></app-ta-input-dropdown>
                    </div>
                </ng-container>

                <ng-template #showItemsDropdown>
                    <app-ca-input-dropdown
                        formControlName="itemfuel"
                        [inputConfig]="{
                        name: 'Input Dropdown',
                        type: 'text',
                        label: 'Item',
                        isDropdown: true,
                        placeholderInsteadOfLabel: true,
                        blackInput: true,
                        isRequired: true,
                        textTransform: 'capitalize',
                        dropdownWidthClass: 'w-col-182',
                        customClass: 'w-col-182',
                    }"
                        [options]="fuelItemsDropdown"
                        [activeItem]="activeFuelItem[i]"
                        (selectedItem)="emitOnSelectDropdown($event, i)"
                    ></app-ca-input-dropdown>
                </ng-template>

                <app-ta-input
                    [formControlName]="!isFuelTable ? 'quantity' : 'qty'"
                    [inputConfig]="{
                        name: 'qty',
                        type: 'text',
                        label: 'Qty',
                        placeholderInsteadOfLabel: true,
                        minLength: 5,
                        maxLength: 64,
                        isRequired: true,
                        hideErrorMessage: true,
                        hideRequiredCheck: true,
                        isInputBackgroundRemoved:
                            repairBillItemRow.valid && !isInputHoverRows[i][1],
                        isBlueText:
                            repairBillItemRow.valid &&
                            !isInputHoverRows[i][1] &&
                            selectedTruckTrailerRepairPm[i],
                        blackInput:
                            formArray.at(i).get('quantity').value &&
                            !isInputHoverRows[i][1]
                    }"
                    (mouseenter)="emitOnInputHover(true, i, 1)"
                    (mouseleave)="emitOnInputHover(false, i, 1)"
                ></app-ta-input>

                <ng-container *ngIf="!isRepairOrderTable">
                    <app-ta-input
                        formControlName="price"
                        [inputConfig]="{
                            name: 'price',
                            type: 'text',
                            label: 'Price',
                            placeholderInsteadOfLabel: true,
                            priceSeparatorLimitation: 6,
                            minLength: 5,
                            maxLength: 64,
                            isRequired: true,
                            hideErrorMessage: true,
                            hideRequiredCheck: true,
                            priceSeparator: true,
                            priceSeparatorLimitation: 6,
                            isInputBackgroundRemoved:
                                repairBillItemRow.valid &&
                                !isInputHoverRows[i][2],
                            isBlueText:
                                repairBillItemRow.valid &&
                                !isInputHoverRows[i][2] &&
                                selectedTruckTrailerRepairPm[i],
                            blackInput:
                                formArray.at(i).get('price').value &&
                                !isInputHoverRows[i][2]
                        }"
                        (mouseenter)="emitOnInputHover(true, i, 2)"
                        (mouseleave)="emitOnInputHover(false, i, 2)"
                    ></app-ta-input>

                    <div
                        class="subtotal d-flex justify-content-end"
                        [ngClass]="{
                            valid: selectedTruckTrailerRepairPm[i]
                        }"
                    >
                        <p class="m-0 ta-font-semi-bold">
                            {{ subTotals[i]?.subtotal ?? 0 | currency }}
                        </p>
                    </div>
                </ng-container>
            </div>
        </ng-container>
    </div>
</form>
