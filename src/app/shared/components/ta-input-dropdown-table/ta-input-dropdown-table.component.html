<!------------------------------------------------- OWNER FLEET DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'owner'">
    <div
        [ngbPopover]="dropdownOwnerFleet"
        #ownerDropdown="ngbPopover"
        [autoClose]="'outside'"
        class="table-dropdown-container owner"
        [placement]="['bottom-left']"
        popoverClass="table-dropdown-popover owner"
        triggers="manual"
        (click)="toggleDropdownOwnerFleet(ownerDropdown, filteredData)"
        [ngClass]="ownerDropdown.isOpen() ? 'owner-dropdown-opened' : ''"
    >
        <div class="fleet-holder d-flex">
            <div
                class="ta-font-semi-bold d-flex fleet align-items-center owner-holder"
            >
                <svg-icon
                    class="d-flex justify-content-center svg-holder"
                    [src]="'assets/svg/common/dropdown-truck.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.truckCount
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.truckCount
                    }"
                >
                    {{ filteredData.truckCount }}
                </span>
            </div>

            <div
                class="ta-font-semi-bold d-flex fleet align-items-center owner-holder"
            >
                <svg-icon
                    class="d-flex justify-content-center svg-holder"
                    [src]="'assets/svg/common/dropdown-trailer.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.trailerCount
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.trailerCount
                    }"
                >
                    {{ filteredData.trailerCount }}
                </span>
            </div>
        </div>
    </div>
</ng-container>

<!------------------------------------------------- COMMENTS DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'comment'">
    <div
        class="comment-button overflow-unset"
        [ngClass]="commentsDropdown.isOpen() ? 'comments-dropdown-opened' : ''"
        [ngbTooltip]="!dropdownComments"
        [mainTooltip]="'Comment'"
        tooltipBackground="#424242"
        position="bottom"
    >
        <div
            [ngbPopover]="dropdownComments"
            #commentsDropdown="ngbPopover"
            [autoClose]="'outside'"
            [placement]="'bottom-right'"
            popoverClass="table-dropdown-popover"
            triggers="manual"
            class="comments-popover d-flex align-items-center justify-content-center"
            (click)="toggleDropdownComments(commentsDropdown, filteredData)"
        >
            <span class="comment-number ta-font-semi-bold">{{
                _data?.comments?.length
            }}</span>
            <svg-icon
                [src]="svg"
                [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
            ></svg-icon>

            <!-- Show notification if there is new comment -->
            <ng-container *ngIf="_data?.commentsCount > 0">
                <svg-icon
                    class="notification"
                    [src]="'assets/svg/applicant/notification-light.svg'"
                ></svg-icon>
            </ng-container>
        </div>
    </div>
</ng-container>

<!------------------------------------------------- CONTACTS DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'contacts'">
    <div
        class="d-flex align-items-center contacts-button"
        [ngClass]="contactsDropdown.isOpen() ? 'contacts-dropdown-opened' : ''"
    >
        <div
            [ngbPopover]="dropdownContacts"
            #contactsDropdown="ngbPopover"
            [autoClose]="'outside'"
            [placement]="['bottom-left', 'bottom-right']"
            popoverClass="table-dropdown-popover"
            triggers="manual"
            class="table-dropdown-container contacts-button-container"
            (click)="toggleDropdownContacts(contactsDropdown, filteredData)"
        >
            <div
                class="d-flex align-items-center justify-content-between fleet-holder"
            >
                <div class="d-flex fleet align-items-center">
                    <svg-icon
                        class="svg-holder"
                        [src]="
                            'assets/svg/truckassist-table/constacts/shared.svg'
                        "
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                    ></svg-icon>

                    <span class="ta-font-semi-bold contact-number">{{
                        contactsData?.departmentsCount
                    }}</span>
                </div>

                <div class="d-flex fleet align-items-center">
                    <svg-icon
                        class="svg-holder"
                        [src]="
                            'assets/svg/truckassist-table/constacts/people.svg'
                        "
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                    ></svg-icon>

                    <span class="ta-font-semi-bold contact-number">{{
                        contactsData?.contactsCount
                    }}</span>
                </div>
            </div>
        </div>
    </div>
</ng-container>

<!------------------------------------------------- RATING DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'rating-shipper'">
    <div
        [ngbPopover]="ratingShipper"
        #shipperRating="ngbPopover"
        [autoClose]="'outside'"
        class="table-dropdown-container"
        [placement]="['bottom-left']"
        popoverClass="table-dropdown-popover"
        triggers="manual"
        (click)="toggleDropdownRating(shipperRating, filteredData)"
        [ngClass]="
            shipperRating.isOpen()
                ? 'owner-dropdown-opened rating-dropdown-opened'
                : ''
        "
    >
        <div class="fleet-holder gap-big d-flex">
            <!-- like -->
            <div class="ta-font-semi-bold d-flex fleet align-items-center">
                <svg-icon
                    class="d-flex justify-content-center svg-holder"
                    [src]="'assets/svg/common/ic_like.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.total.totalLikes,
                        'user-liked': filteredData.total.liked
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.total.totalLikes
                    }"
                >
                    {{ filteredData.total.totalLikes }}
                </span>
            </div>

            <!-- dislike -->
            <div class="ta-font-semi-bold d-flex fleet align-items-center">
                <svg-icon
                    class="d-flex justify-content-center svg-holder"
                    [src]="'assets/svg/common/ic_dislike.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.total.totalDislikes,
                        'user-disliked': filteredData.total.disliked
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.total.totalDislikes
                    }"
                >
                    {{ filteredData.total.totalDislikes }}
                </span>
            </div>

            <div class="ta-font-semi-bold d-flex fleet align-items-center">
                <svg-icon
                    class="d-flex justify-content-center svg-holder align-items-center"
                    [src]="'assets/svg/common/review-pen.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.total.totalComments
                    }"
                    [svgStyle]="{
                        'width.px': 14,
                        'height.px': 14
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.total.totalComments
                    }"
                >
                    {{ filteredData.total.totalComments }}
                </span>
            </div>
        </div>
    </div>
</ng-container>

<!------------------------------------------------- OWNER FLEET DROPDOWN ----------------------------------------------------------------->
<ng-template #dropdownOwnerFleet let-ownerFleet="data">
    <div class="table-list-dropdown">
        <div class="table-inner">
            <!-- Head of dropdown -->
            <div class="description-titles d-flex justify-content-between">
                <div class="d-flex align-items-center gap">
                    <p
                        class="dropdown-left m-0 ta-font-extra-bold d-flex align-items-center text-white"
                    >
                        FLEET
                    </p>

                    <span
                        class="total-number-fleet count d-flex align-items-center"
                    >
                        <span class="counter ta-font-extra-bold text-white">
                            {{
                                ownerFleet.truckCount + ownerFleet.trailerCount
                            }}
                        </span>
                    </span>
                </div>
            </div>

            <!-- Input Search -->
            <div class="input-holder">
                <input
                    placeholder="Search"
                    (keyup)="filterArrayOwner($event)"
                    class="input-search"
                    spellcheck="false"
                />
                <svg-icon
                    class="search-icon"
                    [src]="'assets/svg/common/ic_search.svg'"
                ></svg-icon>
            </div>

            <div
                class="scroll-input-drodpwon"
                [ngClass]="{ 'height-truck-colapsed': truckDropdown }"
            >
                <!-- Trucks Body-->
                <ng-container *ngIf="ownerFleet.truckCount > 0">
                    <div class="fleet-container d-flex flex-column">
                        <!-- Body Head -->
                        <div
                            class="d-flex align-items-center justify-content-between gap toogle-dropdown"
                            (click)="
                                toggleDropdownTruckTrailer(
                                    'Truck',
                                    !truckDropdown
                                )
                            "
                        >
                            <div class="d-flex align-items-center">
                                <span class="ta-font-bold muted body-item-title"
                                    >TRUCK</span
                                >
                                <span
                                    class="text-white count d-flex align-items-center"
                                >
                                    <span class="counter ta-font-bold">
                                        <ng-container
                                            *ngIf="filteredTruckCount"
                                        >
                                            {{ filteredTruckCount }} of
                                        </ng-container>

                                        {{ ownerFleet.truckCount }}
                                    </span>
                                </span>
                            </div>

                            <div
                                class="open-close-dropdown-icon"
                                [ngClass]="{ rotate: truckDropdown }"
                            >
                                <svg-icon
                                    [src]="
                                        'assets/svg/common/dropdown-arrow.svg'
                                    "
                                ></svg-icon>
                            </div>
                        </div>

                        <!-- Body Items -->
                        <div
                            class="items-holder"
                            [ngClass]="{ 'hide-dropdown-items': truckDropdown }"
                        >
                            <ng-container
                                *ngFor="
                                    let truck of ownerFleet.trucks;
                                    let i = id;
                                    trackBy: trackByIdentity
                                "
                            >
                                <div
                                    class="table-list-dropdown-content-container d-flex"
                                    (click)="
                                        goToDetailsPage(
                                            truck,
                                            '/list/truck/' +
                                                truck.id +
                                                '/details'
                                        )
                                    "
                                >
                                    <div
                                        class="dropdown-animate d-flex align-items-center"
                                    >
                                        <!-- Truck Svg -->
                                        <div class="type-icon">
                                            <svg-icon
                                                [src]="
                                                    'assets/svg/common/trucks/' +
                                                    truck?.truckType.logoName
                                                "
                                            ></svg-icon>
                                        </div>

                                        <div
                                            class="text-white"
                                            [innerHTML]="
                                                highlightPartOfTheTextString(
                                                    truck.truckNumber
                                                ) | safeHtml
                                            "
                                        ></div>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </ng-container>

                <!-- Separator -->
                <ng-container *ngIf="ownerFleet.trailerCount">
                    <div class="separator"></div>
                </ng-container>

                <!-- Trailer Body -->
                <ng-container *ngIf="ownerFleet.trailerCount">
                    <div class="fleet-container d-flex flex-column">
                        <!-- Body Head -->

                        <div
                            class="d-flex align-items-center justify-content-between gap toogle-dropdown"
                            (click)="
                                toggleDropdownTruckTrailer(
                                    'Trailer',
                                    !trailerDropdown
                                )
                            "
                        >
                            <div class="d-flex align-items-center">
                                <span class="ta-font-bold muted body-item-title"
                                    >TRAILER</span
                                >

                                <span
                                    class="text-white count d-flex align-items-center"
                                >
                                    <span class="counter ta-font-bold">
                                        <ng-container
                                            *ngIf="filteredTrailerCount"
                                        >
                                            {{ filteredTrailerCount }} of
                                        </ng-container>

                                        {{ ownerFleet.trailerCount }}
                                    </span>
                                </span>
                            </div>

                            <div
                                class="open-close-dropdown-icon"
                                [ngClass]="{ rotate: trailerDropdown }"
                            >
                                <svg-icon
                                    [src]="
                                        'assets/svg/common/dropdown-arrow.svg'
                                    "
                                ></svg-icon>
                            </div>
                        </div>

                        <!-- Body -->
                        <div
                            class="items-holder"
                            [ngClass]="{
                                'hide-dropdown-items': trailerDropdown
                            }"
                        >
                            <ng-container
                                *ngFor="
                                    let trailer of ownerFleet.trailers;
                                    let i = index
                                "
                            >
                                <div
                                    class="table-list-dropdown-content-container d-flex"
                                    (click)="
                                        goToDetailsPage(
                                            trailer,
                                            '/list/trailer/' +
                                                trailer.id +
                                                '/details'
                                        )
                                    "
                                >
                                    <div
                                        class="dropdown-animate d-flex align-items-center"
                                    >
                                        <!-- Trailer Svg -->
                                        <div class="type-icon">
                                            <svg-icon
                                                [src]="
                                                    'assets/svg/common/trailers/' +
                                                    trailer?.trailerType
                                                        .logoName
                                                "
                                            ></svg-icon>
                                        </div>

                                        <div
                                            class="text-white"
                                            [innerHTML]="
                                                highlightPartOfTheTextString(
                                                    trailer.trailerNumber
                                                ) | safeHtml
                                            "
                                        ></div>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>
</ng-template>

<!------------------------------------------------- COMMENTS DROPDOWN ----------------------------------------------------------------->
<ng-template #dropdownComments let-commmentsData="commentData">
    <div class="table-list-dropdown comments-width overflow-unset">
        <div class="table-inner">
            <!-- Head of dropdown -->

            <div class="description-titles d-flex justify-content-between">
                <div class="d-flex align-items-center gap">
                    <p
                        class="dropdown-left m-0 ta-font-extra-bold d-flex align-items-center text-white"
                    >
                        COMMENT
                    </p>

                    <span
                        class="total-number-fleet count d-flex align-items-center"
                    >
                        <span class="counter ta-font-extra-bold text-white">
                            {{ _data?.comments.length }}
                        </span>
                    </span>
                </div>

                <div class="filter-drodpown d-flex">
                    <span class="filter-date ta-font-medium">Date</span>

                    <svg-icon
                        class="svg-date"
                        [src]="'assets/svg/sort-by-descending.svg'"
                    ></svg-icon>
                </div>
            </div>

            <!-- Input Search -->
            <ng-container *ngIf="commmentsData.comments.length || showFilter">
                <div class="input-holder">
                    <input
                        [placeholder]="searchPlaceholder"
                        (keyup)="filterArrayCommentsRating($event, 'comments')"
                        class="input-search"
                        spellcheck="false"
                    />
                    <svg-icon
                        class="search-icon"
                        [src]="'assets/svg/common/ic_search.svg'"
                    ></svg-icon>
                </div>
            </ng-container>
            <!-- Add new comment button -->
            <app-ta-new-comment
                [commmentsData]="commmentsData"
            ></app-ta-new-comment>

            <!-- Display comments -->
            <div class="comments-holder">
                <ng-container
                    *ngIf="_data?.comments?.length; else noComments"
                >
                    <ng-container
                        *ngFor="
                            let comment of _data?.comments;
                            let i = id;
                            trackBy: trackByIdentity
                        "
                    >
                        <app-ta-comment
                            [commentCardsDataDropdown]="comment"
                            [commentHighlight]="lattersToHighlight"
                            [commentsCardId]="commmentsData.id"
                            (closeDropdown)="closeDropdownFromComment($event)"
                        ></app-ta-comment>
                    </ng-container>
                </ng-container>
                <ng-template #noComments>
                    <div class="no-comments-container">
                        <p>Subtle Illustration Empty State</p>
                    </div>
                </ng-template>
            </div>
        </div>
    </div>
</ng-template>

<!------------------------------------------------- CONTACTS DROPDOWN ----------------------------------------------------------------->
<ng-template #dropdownContacts let-contacts="contacts">
    <div class="table-list-dropdown comments-width contacts-dropdown-container">
        <div class="table-inner">
            <!-- Head of dropdown -->
            <div class="description-titles d-flex justify-content-between">
                <div class="d-flex align-items-center gap">
                    <p class="dropdown-left m-0 ta-font-bold text-white">
                        SHARED
                    </p>

                    <span
                        class="total-number-fleet count d-flex align-items-center"
                    >
                        <span class="counter ta-font-extra-bold text-white">
                            {{ contactsData?.contactsCount }}
                        </span>
                    </span>
                </div>

                <div class="filter-drodpown d-flex">
                    <span class="filter-date ta-font-medium">Name</span>

                    <svg-icon
                        class="svg-date"
                        [src]="'assets/svg/sort-by-descending.svg'"
                    ></svg-icon>
                </div>
            </div>

            <!-- Input Search -->
            <div class="input-holder mb-2">
                <input
                    placeholder="Search"
                    (keyup)="filterContacts($event)"
                    class="input-search"
                    spellcheck="false"
                />
                <svg-icon
                    class="search-icon"
                    [src]="'assets/svg/common/ic_search.svg'"
                ></svg-icon>
            </div>

            <div class="d-flex flex-column contact-items">
                <ng-container
                    *ngFor="
                        let department of contactsData.departments;
                        let i = index;
                        trackBy: trackByIdentity
                    "
                >
                    <app-ta-custom-card
                        [cardName]="department.name"
                        [isDropdownCard]="true"
                        [hasDivider]="false"
                        [hasCounter]="department.count"
                        [isCardOpen]="isContactCardOpenArray[i]"
                    >
                        <ng-container
                            *ngFor="
                                let contact of department.companyUsers;
                                let i = index;
                                trackBy: trackByIdentity
                            "
                        >
                            <div class="d-flex align-items-center contact-item">
                                <ng-container *ngIf="contact.avatar">
                                    <img
                                        class="contact-item-avatar-img"
                                        [src]="contact.avatar"
                                        alt="avatar"
                                    />
                                </ng-container>

                                <ng-container *ngIf="!contact.avatar">
                                    <div
                                        class="d-flex justify-content-center align-items-center contact-item-avatar-div-img"
                                        [ngStyle]="{
                                            background:
                                                contact.avatarColor.background
                                        }"
                                    >
                                        <p
                                            class="m-0 ta-font-bold"
                                            [ngStyle]="{
                                                color: contact.avatarColor.color
                                            }"
                                        >
                                            {{
                                                contact.fullName
                                                    .slice(0, 1)
                                                    .toUpperCase()
                                            }}
                                        </p>
                                    </div>
                                </ng-container>

                                <p class="m-0">{{ contact.fullName }}</p>
                            </div>
                        </ng-container>
                    </app-ta-custom-card>
                </ng-container>
            </div>
        </div>
    </div>
</ng-template>

<!------------------------------------------------- RATING DROPDOWN ----------------------------------------------------------------->
<ng-template #ratingShipper let-rating="rating">
    <div class="table-list-dropdown comments-width">
        <div class="table-inner">
            <!-- Title -->
            <div class="description-titles d-flex justify-content-between">
                <div class="d-flex align-items-center gap">
                    <p
                        class="dropdown-left m-0 ta-font-extra-bold d-flex align-items-center text-white"
                    >
                        RATING & REVIEW
                    </p>

                    <span
                        class="total-number-fleet count d-flex align-items-center"
                    >
                        <span class="counter ta-font-extra-bold text-white">
                            7
                        </span>
                    </span>
                </div>

                <div class="filter-drodpown d-flex">
                    <span class="filter-date ta-font-medium">Date</span>

                    <svg-icon
                        class="svg-date"
                        [src]="'assets/svg/sort-by-descending.svg'"
                    ></svg-icon>
                </div>
            </div>

            <!-- Input Search -->
            <div class="input-holder">
                <input
                    placeholder="Search"
                    (keyup)="filterArrayCommentsRating($event, 'rating')"
                    class="input-search"
                    spellcheck="false"
                />
                <svg-icon
                    class="search-icon"
                    [src]="'assets/svg/common/ic_search.svg'"
                ></svg-icon>
            </div>

            <!-- Tabs -->
            <app-ta-tab-switch
                [tabs]="tabs"
                (switchClicked)="onPrefferedLoadCheck($event)"
                [type]="'rating-review'"
            >
            </app-ta-tab-switch>

            <!-- Add new comment button -->
            <ng-container *ngIf="!loggedUserCommented">
                <app-ta-new-comment
                    [commmentsData]="rating"
                ></app-ta-new-comment>
            </ng-container>

            <!-- Body -->
            <div class="d-flex align-items-center">
                <div class="fleet-container d-flex flex-column">
                    <ng-container
                        *ngFor="
                            let review of rating.rating;
                            let i = id;
                            trackBy: trackByIdentity
                        "
                    >
                        <app-ta-comment
                            [commentCardsDataDropdown]="review"
                            [commentHighlight]="lattersToHighlight"
                            [commentsCardId]="review.id"
                            (closeDropdown)="closeDropdownFromComment($event)"
                        ></app-ta-comment>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>
</ng-template>
