<div class="telematic-map customer-map-container">
  <agm-map
    [latitude]="mapLatitude"
    [longitude]="mapLongitude"
    [restriction]="mapRestrictions"
    [streetViewControl]="false"
    [styles]="styles"
    [zoom]="mapZoom"
    [usePanning]="true"
    [keyboardShortcuts]="false"
    [zoomControl]="false"
    [clickableIcons]="false"
    (zoomChange)="zoomChange($event)"
    (mapReady)="getMapInstance($event)"
    (mouseover)="mapHover = true"
    (mouseleave)="mapHover = false"
  >
    <agm-marker
      *ngFor="let location of driverLocations; let i = index"
      [agmFitBounds]="true"
      [latitude]="location.latitude"
      [longitude]="location.longitude"
      [visible]="false"
    >
      <agm-snazzy-info-window
        [closeOnMapClick]="false"
        [closeWhenOthersOpen]="false"
        [isOpen]="true"
        [latitude]="location.latitude"
        [longitude]="location.longitude"
        [maxHeight]="32"
        [maxWidth]="26"
        [openOnMarkerClick]="false"
        placement="bottom"
        [showCloseButton]="false"
        [pointer]="false"
      >
        <ng-template>
          <div class="gps-marker-container marker-icon" [ngClass]="{ 'selected-marker': location.isFocused }" (click)="markerClick(i)">
            <svg [ngStyle]="{ 'transform': 'rotate('+location.heading+'deg)' }" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="34" height="45" viewBox="0 0 34 45">
              <defs>
                <linearGradient id="gradient1" x1="0.5" x2="0.5" y2="1" gradientUnits="objectBoundingBox">
                  <stop offset="0" stop-color="#536bc2" stop-opacity="0"/>
                  <stop offset="1" stop-color="#536bc2"/>
                </linearGradient>
                <filter id="Ellipse_7908" x="0" y="11" width="34" height="34" filterUnits="userSpaceOnUse">
                  <feOffset input="SourceAlpha"/>
                  <feGaussianBlur stdDeviation="2" result="blur"/>
                  <feFlood flood-opacity="0.149"/>
                  <feComposite operator="in" in2="blur"/>
                  <feComposite in="SourceGraphic"/>
                </filter>
              </defs>
              <g id="Group_97179" data-name="Group 97179" transform="translate(-7 19)">
                <path id="Path_39129" data-name="Path 39129" d="M0,0H18L14,28H4Z" transform="translate(15 -19)" fill="url(#gradient1)"/>
                <g transform="matrix(1, 0, 0, 1, 7, -19)" filter="url(#Ellipse_7908)">
                  <circle id="Ellipse_7908-2" data-name="Ellipse 7908" cx="11" cy="11" r="11" transform="translate(28 39) rotate(180)" fill="#fff"/>
                </g>
                <circle id="Ellipse_7909" data-name="Ellipse 7909" cx="8" cy="8" r="8" transform="translate(16 1)" fill="#536bc2"/>
                <path id="Path_33426" data-name="Path 33426" d="M4.726.208,1.816,5.981a.378.378,0,0,0,.55.483L4.638,4.92a.756.756,0,0,1,.85,0L7.762,6.465a.378.378,0,0,0,.55-.483L5.4.208a.378.378,0,0,0-.675,0" transform="translate(19 5)" fill="#fff"/>
              </g>
            </svg>
          </div>
          <div
            class="gps-marker-dropdown marker-dropdown"
            [ngClass]="{
              'show-marker-dropdown marker-dropdown-animation':
                location.isFocused
            }"
          >
            <app-map-marker-dropdown
              [title]="'Job Gaston'"
              [item]="location"
              [type]="'gps'"
            ></app-map-marker-dropdown>
          </div>
            
            <!-- <svg
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              width="56"
              height="56"
              viewBox="0 0 56 56"
            >
              <defs>
                <filter
                  id="Union_851"
                  x="0"
                  y="0"
                  width="56"
                  height="56"
                  filterUnits="userSpaceOnUse"
                >
                  <feOffset input="SourceAlpha" />
                  <feGaussianBlur stdDeviation="2" result="blur" />
                  <feFlood flood-opacity="0.149" />
                  <feComposite operator="in" in2="blur" />
                  <feComposite in="SourceGraphic" />
                </filter>
              </defs>
              <g
                id="Group_96982"
                data-name="Group 96982"
                transform="translate(-300 -490)"
              >
                <g
                  transform="matrix(1, 0, 0, 1, 300, 490)"
                  filter="url(#Union_851)"
                >
                  <path
                    id="Union_851-2"
                    data-name="Union 851"
                    d="M22,0A22,22,0,1,1,0,22,22,22,0,0,1,22,0Z"
                    transform="translate(6 6)"
                    fill="#fff"
                  />
                </g>
                <circle
                  id="Ellipse_7898"
                  data-name="Ellipse 7898"
                  cx="18"
                  cy="18"
                  r="18"
                  transform="translate(310 500)"
                  fill="#536bc2"
                />
                <g
                  id="Group_93423"
                  data-name="Group 93423"
                  transform="translate(3628 -10432.999)"
                >
                  <path
                    id="Path_33425"
                    data-name="Path 33425"
                    d="M18,9A9,9,0,1,1,9,0a9,9,0,0,1,9,9"
                    transform="translate(-3309 10942)"
                    fill="#fff"
                    opacity="0"
                  />
                  <path
                    id="Path_33426"
                    data-name="Path 33426"
                    d="M8.416.468,1.869,13.458a.85.85,0,0,0,1.237,1.086l5.112-3.475a1.7,1.7,0,0,1,1.912,0l5.117,3.476a.85.85,0,0,0,1.238-1.086L9.935.468a.851.851,0,0,0-1.519,0"
                    transform="translate(-3309.177 10942)"
                    fill="#fff"
                    [ngStyle]="{
                      'transform-origin': '16% 15%',
                      transform: location.transform
                    }"
                  />
                </g>
              </g>
            </svg> -->
        </ng-template>
      </agm-snazzy-info-window>
    </agm-marker>

    <agm-marker
      *ngFor="let destination of driverDestinations; let i = index"
      [agmFitBounds]="true"
      [latitude]="destination.latitude"
      [longitude]="destination.longitude"
      [visible]="false"
    >
      <agm-snazzy-info-window
        [closeOnMapClick]="false"
        [closeWhenOthersOpen]="false"
        [isOpen]="true"
        [latitude]="destination.latitude"
        [longitude]="destination.longitude"
        [maxHeight]="32"
        [maxWidth]="26"
        [openOnMarkerClick]="false"
        placement="bottom"
        [showCloseButton]="false"
        [pointer]="false"
      >
        <ng-template>
          <div class="marker-container marker-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              width="34"
              height="37"
              viewBox="0 0 34 37"
            >
              <defs>
                <filter
                  id="Path_33651"
                  x="0"
                  y="0"
                  width="34"
                  height="37"
                  filterUnits="userSpaceOnUse"
                >
                  <feOffset input="SourceAlpha" />
                  <feGaussianBlur stdDeviation="2" result="blur" />
                  <feFlood flood-opacity="0.149" />
                  <feComposite operator="in" in2="blur" />
                  <feComposite in="SourceGraphic" />
                </filter>
              </defs>
              <g
                id="Group_97190"
                data-name="Group 97190"
                transform="translate(-630 -2283.999)"
              >
                <g
                  id="Group_97186"
                  data-name="Group 97186"
                  transform="translate(-435 1620)"
                >
                  <circle
                    id="Ellipse_7452"
                    data-name="Ellipse 7452"
                    cx="4"
                    cy="4"
                    r="4"
                    transform="translate(1078 691)"
                    fill="#ef5350"
                  />
                  <circle
                    id="Ellipse_7453"
                    data-name="Ellipse 7453"
                    cx="2"
                    cy="2"
                    r="2"
                    transform="translate(1080 693)"
                    fill="#fff"
                  />
                </g>
                <g
                  transform="matrix(1, 0, 0, 1, 630, 2284)"
                  filter="url(#Path_33651)"
                >
                  <path
                    id="Path_33651-2"
                    data-name="Path 33651"
                    d="M22,10.974a10.97,10.97,0,0,1-4.852,9.1c-.024.018-.379.237-.519.329-3.367,2.14-4.718,3.585-5.262,4.4a.441.441,0,0,1-.609.124.457.457,0,0,1-.124-.124c-.544-.811-1.9-2.256-5.262-4.4-.153-.095-.494-.311-.519-.329A10.983,10.983,0,1,1,22,10.974"
                    transform="translate(6 6)"
                    fill="#fff"
                  />
                </g>
                <circle
                  id="Ellipse_6005"
                  data-name="Ellipse 6005"
                  cx="9"
                  cy="9"
                  r="9"
                  transform="translate(638 2292)"
                  fill="#ef5350"
                />
                <text
                  id="_2"
                  data-name="2"
                  transform="translate(647 2305)"
                  fill="#fff"
                  font-size="11"
                  font-family="Montserrat-Bold, Montserrat"
                  font-weight="700"
                  letter-spacing="0.04em"
                >
                  <tspan x="-3.245" y="0">2</tspan>
                </text>
              </g>
            </svg>
          </div>
        </ng-template>
      </agm-snazzy-info-window>
    </agm-marker>

    <!-- <div *ngFor="let route of driverDestinations; let i = index">
      <agm-direction
        [renderOptions]="{
          preserveViewport: true,
          polylineOptions: routeLineOptions,
          suppressMarkers: true
        }"
        [optimizeWaypoints]="false"
        [origin]="{ lat: driverLocations[i].latitude, lng: driverLocations[i].longitude }"
        [destination]="{
          lat: route.latitude,
          lng: route.longitude
        }"
        [visible]="!route.hidden"
      ></agm-direction>
    </div> -->
  </agm-map>

  <div class="gps-locations-list" *ngIf="driverLocations?.length">
    <div *ngFor="let location of driverLocations; let i = index" class="gps-list-row" (click)="markerClick(i)" [ngClass]="{ 'selected-row': location.isFocused }">
      <div class="row-info">Device ID: <span class="marker-bold-text">{{ location.deviceId }}</span></div>
      <div class="row-info">Speed: <span class="marker-bold-text">{{ location.speed }} mph</span></div>
    </div>
  </div>
</div>
