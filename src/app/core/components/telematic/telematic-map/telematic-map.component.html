<div class="telematic-map customer-map-container">
  <agm-map
    [latitude]="mapLatitude"
    [longitude]="mapLongitude"
    [restriction]="mapRestrictions"
    [streetViewControl]="false"
    [styles]="styles"
    [zoom]="mapZoom"
    [usePanning]="true"
    [keyboardShortcuts]="false"
    [zoomControl]="false"
    [clickableIcons]="false"
    (zoomChange)="zoomChange($event)"
    (mapReady)="getMapInstance($event)"
    (mouseover)="mapHover = true"
    (mouseleave)="mapHover = false"
  >
    <agm-marker
      *ngFor="let location of driverLocations; let i = index"
      [agmFitBounds]="true"
      [latitude]="location.lat"
      [longitude]="location.long"
      [visible]="false"
    >
      <agm-snazzy-info-window
        [closeOnMapClick]="false"
        [closeWhenOthersOpen]="false"
        [isOpen]="true"
        [latitude]="location.lat"
        [longitude]="location.long"
        [maxHeight]="32"
        [maxWidth]="26"
        [openOnMarkerClick]="false"
        placement="bottom"
        [showCloseButton]="false"
        [pointer]="false"
      >
        <ng-template>
          <div class="marker-container marker-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              width="56"
              height="56"
              viewBox="0 0 56 56"
            >
              <defs>
                <filter
                  id="Union_851"
                  x="0"
                  y="0"
                  width="56"
                  height="56"
                  filterUnits="userSpaceOnUse"
                >
                  <feOffset input="SourceAlpha" />
                  <feGaussianBlur stdDeviation="2" result="blur" />
                  <feFlood flood-opacity="0.149" />
                  <feComposite operator="in" in2="blur" />
                  <feComposite in="SourceGraphic" />
                </filter>
              </defs>
              <g
                id="Group_96982"
                data-name="Group 96982"
                transform="translate(-300 -490)"
              >
                <g
                  transform="matrix(1, 0, 0, 1, 300, 490)"
                  filter="url(#Union_851)"
                >
                  <path
                    id="Union_851-2"
                    data-name="Union 851"
                    d="M22,0A22,22,0,1,1,0,22,22,22,0,0,1,22,0Z"
                    transform="translate(6 6)"
                    fill="#fff"
                  />
                </g>
                <circle
                  id="Ellipse_7898"
                  data-name="Ellipse 7898"
                  cx="18"
                  cy="18"
                  r="18"
                  transform="translate(310 500)"
                  fill="#536bc2"
                />
                <g
                  id="Group_93423"
                  data-name="Group 93423"
                  transform="translate(10404.979 -4892.073) rotate(45)"
                >
                  <path
                    id="Path_33425"
                    data-name="Path 33425"
                    d="M18,9A9,9,0,1,1,9,0a9,9,0,0,1,9,9"
                    transform="translate(-3309 10942)"
                    fill="#fff"
                    opacity="0"
                  />
                  <path
                    id="Path_33426"
                    data-name="Path 33426"
                    d="M8.416.468,1.869,13.458a.85.85,0,0,0,1.237,1.086l5.112-3.475a1.7,1.7,0,0,1,1.912,0l5.117,3.476a.85.85,0,0,0,1.238-1.086L9.935.468a.851.851,0,0,0-1.519,0"
                    transform="translate(-3309.177 10942)"
                    fill="#fff"
                  />
                </g>
              </g>
            </svg>
          </div>
        </ng-template>
      </agm-snazzy-info-window>
    </agm-marker>

    <agm-marker
      *ngFor="let destination of driverDestinations; let i = index"
      [agmFitBounds]="true"
      [latitude]="destination.lat"
      [longitude]="destination.long"
      [visible]="false"
    >
      <agm-snazzy-info-window
        [closeOnMapClick]="false"
        [closeWhenOthersOpen]="false"
        [isOpen]="true"
        [latitude]="destination.lat"
        [longitude]="destination.long"
        [maxHeight]="32"
        [maxWidth]="26"
        [openOnMarkerClick]="false"
        placement="bottom"
        [showCloseButton]="false"
        [pointer]="false"
      >
        <ng-template>
          <div class="marker-container marker-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              width="34"
              height="37"
              viewBox="0 0 34 37"
            >
              <defs>
                <filter
                  id="Path_33651"
                  x="0"
                  y="0"
                  width="34"
                  height="37"
                  filterUnits="userSpaceOnUse"
                >
                  <feOffset input="SourceAlpha" />
                  <feGaussianBlur stdDeviation="2" result="blur" />
                  <feFlood flood-opacity="0.149" />
                  <feComposite operator="in" in2="blur" />
                  <feComposite in="SourceGraphic" />
                </filter>
              </defs>
              <g
                id="Group_97190"
                data-name="Group 97190"
                transform="translate(-630 -2283.999)"
              >
                <g
                  id="Group_97186"
                  data-name="Group 97186"
                  transform="translate(-435 1620)"
                >
                  <circle
                    id="Ellipse_7452"
                    data-name="Ellipse 7452"
                    cx="4"
                    cy="4"
                    r="4"
                    transform="translate(1078 691)"
                    fill="#ef5350"
                  />
                  <circle
                    id="Ellipse_7453"
                    data-name="Ellipse 7453"
                    cx="2"
                    cy="2"
                    r="2"
                    transform="translate(1080 693)"
                    fill="#fff"
                  />
                </g>
                <g
                  transform="matrix(1, 0, 0, 1, 630, 2284)"
                  filter="url(#Path_33651)"
                >
                  <path
                    id="Path_33651-2"
                    data-name="Path 33651"
                    d="M22,10.974a10.97,10.97,0,0,1-4.852,9.1c-.024.018-.379.237-.519.329-3.367,2.14-4.718,3.585-5.262,4.4a.441.441,0,0,1-.609.124.457.457,0,0,1-.124-.124c-.544-.811-1.9-2.256-5.262-4.4-.153-.095-.494-.311-.519-.329A10.983,10.983,0,1,1,22,10.974"
                    transform="translate(6 6)"
                    fill="#fff"
                  />
                </g>
                <circle
                  id="Ellipse_6005"
                  data-name="Ellipse 6005"
                  cx="9"
                  cy="9"
                  r="9"
                  transform="translate(638 2292)"
                  fill="#ef5350"
                />
                <text
                  id="_2"
                  data-name="2"
                  transform="translate(647 2305)"
                  fill="#fff"
                  font-size="11"
                  font-family="Montserrat-Bold, Montserrat"
                  font-weight="700"
                  letter-spacing="0.04em"
                >
                  <tspan x="-3.245" y="0">2</tspan>
                </text>
              </g>
            </svg>
          </div>
        </ng-template>
      </agm-snazzy-info-window>
    </agm-marker>

    <div *ngFor="let route of driverDestinations; let i = index">
      <agm-direction
        [renderOptions]="{
          preserveViewport: true,
          polylineOptions: routeLineOptions,
          suppressMarkers: true
        }"
        [optimizeWaypoints]="false"
        [origin]="{ lat: driverLocations[i].lat, lng: driverLocations[i].long }"
        [destination]="{
          lat: route.lat,
          lng: route.long
        }"
        [visible]="!route.hidden"
      ></agm-direction>
    </div>
  </agm-map>
</div>
