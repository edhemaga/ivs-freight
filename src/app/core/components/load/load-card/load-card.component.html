<div class="cards-container">
    <ng-container
        *ngFor="let card of viewData; let i = index; trackBy: trackCard"
    >
        <div class="custom-card">
            <div
                class="card-body d-flex justify-content-between"
                [ngClass]="{
                    'body-active': isCardFlipped.includes(i),
                    'body-checked': card.isSelected
                }"
            >
                <!-- Left side of the card -->

                <div class="card-body-left p-1">
                    <!-- Head of the card -->

                    <div class="card-header d-flex align-items-center">
                        <div class="checkbox-holder d-flex align-items-center">
                            <!-- Checkbox -->

                            <span
                                class="checkbox-tooltip"
                                type="button"
                                ngbTooltip
                                mainTooltip="{{
                                    isCheckboxCheckedArray.includes(i)
                                        ? 'Clear'
                                        : 'Select'
                                }}"
                                tooltipBackground="#424242"
                                position="bottom"
                                [ngClass]="{
                                    'rotate-svg': isCardFlipped.includes(i),
                                    'svg-position': !isCardFlipped.includes(i)
                                }"
                            >
                                <input
                                    class="table-checkbox"
                                    type="checkbox"
                                    id="checkbox{{ i }}"
                                    [checked]="card.isSelected"
                                    (change)="onCheckboxSelect(i, card)"
                                />
                                <label
                                    class="table-checkbox-label"
                                    for="checkbox{{ i }}"
                                ></label>
                            </span>
                        </div>

                        <!-- Card Title -->

                        <div class="name d-flex ta-font-bold">
                            <div class="d-flex title-load">
                                <svg-icon
                                    [src]="
                                        card?.type?.name === 'LTL'
                                            ? 'assets/svg/detail-cards/left-arrows.svg'
                                            : 'assets/svg/detail-cards/shuffle.svg'
                                    "
                                ></svg-icon>

                                <span
                                    class="title"
                                    (click)="
                                        goToDetailsPage(
                                            card,
                                            cardTitleLink + card.id + '/details'
                                        )
                                    "
                                >
                                    <ng-container *ngIf="cardTitle !== 'name'">
                                        INV-{{
                                            getValueByStringPath(
                                                card,
                                                cardTitle
                                            )
                                        }}
                                    </ng-container>

                                    <ng-container *ngIf="cardTitle === 'name'">
                                        {{
                                            getValueByStringPath(
                                                card,
                                                cardTitle
                                            )
                                        }}
                                    </ng-container>
                                </span>
                            </div>
                        </div>
                        <!-- Card Title End-->
                    </div>

                    <!-- Card body front -->
                    <div
                        class="flipped"
                        [ngClass]="{
                            'card-body-content': !isCardFlipped.includes(i)
                        }"
                    >
                        <ng-container
                            *ngFor="
                                let rowsFront of displayRowsFront;
                                trackBy: trackCard
                            "
                        >
                            <div class="one-row">
                                <div class="item-body">
                                    <div class="top-item-body">
                                        {{ rowsFront.title }}
                                    </div>
                                </div>

                                <div
                                    #parentElement
                                    class="bottom-item-body d-flex align-items-center"
                                    [ngClass]="{
                                        gap: rowsFront.title !== 'VIN No.',
                                        'line-height':
                                            rowsFront.title === 'Fleet'
                                    }"
                                >
                                    <!-- If Comodity is Hazardous-->
                                    <ng-container
                                        *ngIf="
                                            getValueByStringPath(
                                                card,
                                                rowsFront.endpoint
                                            ) === 'Hazardous'
                                        "
                                    >
                                        <svg-icon
                                            [src]="
                                                'assets/svg/common/load/ic_hazardous_triangle.svg'
                                            "
                                        >
                                        </svg-icon>
                                        <span>
                                            {{
                                                getValueByStringPath(
                                                    card,
                                                    rowsFront.endpoint
                                                )
                                            }}</span
                                        >
                                    </ng-container>

                                    <!-- If STATUS title this will be aplied in body -->

                                    <ng-container
                                        *ngIf="rowsFront.title === 'Status'"
                                    >
                                        <span
                                            class="ta-font-black status"
                                            [ngClass]="{
                                                assigned: checkLoadStatus(
                                                    card,
                                                    rowsFront.endpoint,
                                                    'Assigned'
                                                ),
                                                dispatched: checkLoadStatus(
                                                    card,
                                                    rowsFront.endpoint,
                                                    'Dispatched'
                                                ),
                                                loaded: checkLoadStatus(
                                                    card,
                                                    rowsFront.endpoint,
                                                    'Loaded'
                                                ),
                                                paid:
                                                    checkLoadStatus(
                                                        card,
                                                        rowsFront.endpoint,
                                                        'Short-paid'
                                                    ) ||
                                                    checkLoadStatus(
                                                        card,
                                                        rowsFront.endpoint,
                                                        'Unpaid'
                                                    ) ||
                                                    checkLoadStatus(
                                                        card,
                                                        rowsFront.endpoint,
                                                        'Paid'
                                                    ),
                                                tonu: checkLoadStatus(
                                                    card,
                                                    rowsFront.endpoint,
                                                    'Tonu'
                                                )
                                            }"
                                        >
                                            {{
                                                getValueByStringPath(
                                                    card,
                                                    rowsFront.endpoint
                                                ) | uppercase
                                            }}</span
                                        >
                                    </ng-container>

                                    <!-- If not STATUS title this will be in body -->

                                    <ng-container
                                        *ngIf="
                                            rowsFront.title !== 'Status' &&
                                            getValueByStringPath(
                                                card,
                                                rowsFront.endpoint
                                            ) !== 'Hazardous'
                                        "
                                    >
                                        <span
                                            class="d-flex justify-content-center align-items-center"
                                            [ngClass]="
                                                rowsFront.endpoint ===
                                                'loadPickup.count'
                                                    ? 'load-span pickup ta-font-bold'
                                                    : '' ||
                                                      rowsFront.endpoint ===
                                                          'loadDelivery.count'
                                                    ? 'load-span delivery ta-font-bold'
                                                    : ''
                                            "
                                        >
                                            {{
                                                getValueByStringPath(
                                                    card,
                                                    rowsFront.endpoint
                                                )
                                            }}
                                        </span>
                                    </ng-container>

                                    <!-- If there is seccond endpoint  -->

                                    <ng-container
                                        *ngIf="
                                            rowsFront.secondEndpoint &&
                                            getValueByStringPath(
                                                card,
                                                rowsFront.secondEndpoint
                                            ) !== '/'
                                        "
                                    >
                                        <!-- If phone extension exist -->
                                        <ng-container
                                            *ngIf="
                                                rowsFront.secondEndpoint ===
                                                'brokerContact.extensionPhone'
                                            "
                                        >
                                            <span class="muted">x</span>
                                            <span class="muted">
                                                {{
                                                    getValueByStringPath(
                                                        card,
                                                        rowsFront.secondEndpoint
                                                    )
                                                }}
                                            </span>
                                        </ng-container>

                                        <ng-container
                                            *ngIf="
                                                rowsFront.secondEndpoint !==
                                                    'brokerContact.extensionPhone' &&
                                                rowsFront.secondEndpoint !==
                                                    'adjustedRate'
                                            "
                                        >
                                            <span
                                                [ngClass]="{
                                                    'subtotal ta-font-medium':
                                                        rowsFront.secondEndpoint ===
                                                        'loadTotal.subTotal'
                                                }"
                                            >
                                                {{
                                                    getValueByStringPath(
                                                        card,
                                                        rowsFront.secondEndpoint
                                                    )
                                                }}
                                            </span>
                                        </ng-container>

                                        <!-- If it is adjustedrate -->

                                        <ng-container
                                            *ngIf="
                                                rowsFront.secondEndpoint ===
                                                'adjustedRate'
                                            "
                                        >
                                            <span>
                                                {{
                                                    getValueByStringPath(
                                                        card,
                                                        rowsFront.secondEndpoint
                                                    )
                                                }}
                                            </span>
                                        </ng-container>
                                    </ng-container>

                                    <!-- If there is third endpoint -->

                                    <ng-container
                                        *ngIf="rowsFront.thirdEndpoint"
                                    >
                                        <span class="muted">
                                            {{
                                                getValueByStringPath(
                                                    card,
                                                    rowsFront.thirdEndpoint
                                                )
                                            }}
                                        </span>
                                    </ng-container>
                                </div>
                            </div>
                        </ng-container>
                    </div>

                    <!-- Card body back -->
                    <div
                        class="flipped"
                        [ngClass]="{
                            'card-body-content': isCardFlipped.includes(i)
                        }"
                    >
                        <ng-container
                            *ngFor="
                                let rowsBack of displayRowsBack;
                                trackBy: trackCard
                            "
                        >
                            <div class="one-row">
                                <div class="item-body">
                                    <div class="top-item-body">
                                        {{ rowsBack.title }}
                                    </div>

                                    <div
                                        class="bottom-item-body d-flex align-items-center gap"
                                    >
                                        <ng-container
                                            *ngIf="
                                                rowsBack.endpoint ===
                                                    'loadPickup.count' ||
                                                rowsBack.endpoint ===
                                                    'loadDelivery.count'
                                            "
                                        >
                                            <span
                                                class="d-flex justify-content-center align-items-center mr-4"
                                                [ngClass]="
                                                    rowsBack.endpoint ===
                                                    'loadPickup.count'
                                                        ? 'load-span pickup ta-font-bold'
                                                        : '' ||
                                                          rowsBack.endpoint ===
                                                              'loadDelivery.count'
                                                        ? 'load-span delivery ta-font-bold'
                                                        : ''
                                                "
                                            >
                                                {{
                                                    getValueByStringPath(
                                                        card,
                                                        rowsBack.endpoint
                                                    )
                                                }}
                                            </span>

                                            <!-- If there is seccond endpoint  -->

                                            <ng-container
                                                *ngIf="rowsBack.secondEndpoint"
                                            >
                                                <span>
                                                    {{
                                                        getValueByStringPath(
                                                            card,
                                                            rowsBack.secondEndpoint
                                                        )
                                                    }}
                                                </span>
                                            </ng-container>

                                            <!-- If there is third endpoint -->

                                            <ng-container
                                                *ngIf="rowsBack.thirdEndpoint"
                                            >
                                                <span class="muted">
                                                    {{
                                                        getValueByStringPath(
                                                            card,
                                                            rowsBack.thirdEndpoint
                                                        )
                                                    }}
                                                </span>
                                            </ng-container>
                                        </ng-container>

                                        <ng-container
                                            *ngIf="
                                                rowsBack.endpoint !==
                                                    'loadPickup.count' &&
                                                rowsBack.endpoint !==
                                                    'loadDelivery.count'
                                            "
                                        >
                                            {{
                                                getValueByStringPath(
                                                    card,
                                                    rowsBack.endpoint
                                                )
                                            }}

                                            <!-- if miles add mi -->

                                            <ng-container
                                                *ngIf="
                                                    rowsBack.endpoint ===
                                                    'totalMiles'
                                                "
                                                ><span class="muted"
                                                    >mi</span
                                                ></ng-container
                                            >
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </div>

                <!-- Right side of the card -->
                <div class="card-body-right">
                    <div class="top-side">
                        <!-- Open dropdown element-->

                        <app-table-card-dropdown-actions
                            (bodyActions)="onTableBodyActions($event)"
                            [card]="card"
                        ></app-table-card-dropdown-actions>

                        <!-- Note element -->

                        <div
                            class="note-container right-side-svg d-flex align-items-center justify-content-center flex-column"
                        >
                            <app-ta-note
                                [note]="card.note"
                                [mainData]="card"
                                [entityId]="card.id"
                                [openedAll]="false"
                                [parking]="false"
                            >
                            </app-ta-note>
                        </div>

                        <!-- Comments element -->
                        <ng-container *ngIf="selectedTab !== 'template'">
                            <div class="right-side-svg">
                                <app-ta-input-dropdown-table
                                    [data]="card"
                                    [type]="'comment'"
                                    [searchPlaceholder]="'Find Title'"
                                    [svg]="
                                        'assets/svg/detail-cards/comment - count.svg'
                                    "
                                ></app-ta-input-dropdown-table>
                            </div>
                        </ng-container>

                        <!-- Expand element -->

                        <div
                            class="bottom-side d-flex justify-content-center"
                            (click)="flipCard(i)"
                        >
                            <span
                                class="expand-card"
                                type="button"
                                ngbTooltip
                                mainTooltip="Expand Card"
                                tooltipBackground="#424242"
                                position="bottom"
                                [ngClass]="{
                                    'rotate-svg': isCardFlipped.includes(i),
                                    'svg-position': !isCardFlipped.includes(i)
                                }"
                            >
                                <svg-icon
                                    [src]="'assets/svg/common/resize-arrow.svg'"
                                ></svg-icon>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</div>
