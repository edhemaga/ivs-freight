<div cdkDrag class="modal-container assing_load_table">
  <div cdkDragHandle class="modal-header">
    <h5 class="modal-title">Assign Load to #{{inputData.data.truckNumber}}</h5>
    <i
      (click)="closeModal()"
      class="fal fa-times cursor-pointer fs-24 icon-hover-primary"
    ></i>
  </div>
  <div class="modal-body p-0">
    <div class="card no-border-radius mb-0">
      <div class="card-body p-0">
        <div class="table-responsive">
          <app-no-empty-status *ngIf="!dispatchLoadsData.length" [isAssignLoads]="true"></app-no-empty-status>
          <table *ngIf="dispatchLoadsData.length" class="table table-hover mb-0">
            <thead>
            <tr class="text-nowrap no-hover">
              <th class="text-center">#</th>
              <th>Broker name</th>
              <th>Date</th>
              <th>Time</th>
              <th class="text-right refNmbr">Ref#</th>
              <th>Pickup</th>
              <th>Delivery</th>
              <th>Miles</th>
              <th class="text-center" style="width: auto !important;">Total rate</th>
            </tr>
            </thead>
            <tbody>
            <tr (click)="showMaps(load)" *ngFor="let load of dispatchLoadsData; let indx = index"
                [class.active]="selectedLoad == load.id"
                class="cursor-pointer">
              <td class="text-center">
                <div class="">{{indx + 1}}</div>
              </td>
              <td>{{load.brokerName}}</td>
              <td>{{load.pickupDateTime | date : 'MM/LL/yy'}}</td>
              <td>{{load.pickupDateTime | date : 'hh:mm aa'}}</td>
              <td class="text-right">
                <div class="refNmbr">{{load.brokerLoadNumber}}</div>
              </td>
              <td>
                <div class="d-flex">
                  <div *ngIf="load.pickupCount" class="load-count count_item">
                    <svg-icon *ngIf="load.pickupCount < 10"
                              src="assets/img/svg_numbers/svg_num_box_{{load.pickupCount}}.svg"></svg-icon>
                    <svg-icon *ngIf="load.pickupCount > 9" src="assets/img/svg_numbers/svg_num_over.svg"></svg-icon>
                  </div>
                  {{ load.pickupLocation.city}}, {{ load.pickupLocation.stateShortName}}
                </div>
              </td>
              <td>
                <div class="d-flex count_item delivery_items">
                  <div *ngIf="load.deliveryCount" class="load-count">
                    <svg-icon *ngIf="load.deliveryCount < 10"
                              src="assets/img/svg_numbers/svg_num_box_{{load.deliveryCount}}.svg"></svg-icon>
                    <svg-icon *ngIf="load.deliveryCount > 9" src="assets/img/svg_numbers/svg_num_over.svg"></svg-icon>
                  </div>
                  {{ load.deliveryLocation.city}}, {{ load.deliveryLocation.stateShortName}}
                </div>
              </td>
              <td>{{ load.mileage }}</td>
              <td class="text-center" style="width: auto !important;">{{ load.total | currency }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div
      *ngIf="selectedLoad"
      [@pickupAnimation]
      class="assign_load_map_holder">
      <agm-map
        (mapReady)="getMapInstance($event)"
        [clickableIcons]="false"
        [controlSize]="20"
        [restriction]="mapRestrictions"
        [streetViewControl]="false"
        [styles]="styles"
        [zoom]="1"
      >
        <agm-direction
          *ngFor="let dir of directionRoutes"
          [destination]="dir.destination"
          [optimizeWaypoints]="false"
          [origin]="dir.origin"
          [renderOptions]="dir.renderOptions"
          [waypoints]="dir.waypoints"
        ></agm-direction>
        <div *ngFor="let mark of waypointMarkers; let i = index">
          <agm-marker
            [agmFitBounds]="true"
            [latitude]="mark.lat"
            [longitude]="mark.lng"
            [visible]="false"
          >
            <agm-snazzy-info-window
              [closeOnMapClick]="false"
              [closeWhenOthersOpen]="false"
              [isOpen]="true"
              [latitude]="mark.lat"
              [longitude]="mark.lng"
              [maxHeight]="32"
              [maxWidth]="26"
              [openOnMarkerClick]="false"
              placement="bottom"
            >
              <ng-template class="marker-tool-tip">
                <svg
                  class="routing_marker"
                  height="32"
                  viewBox="0 0 32.999 48.234"
                  width="26"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g
                    data-name="Group 11810"
                    id="Group_11810"
                    transform="translate(-509.694 -364.016)"
                  >
                    <g data-name="Group 11809" id="Group_11809">
                      <path
                        [ngStyle]="{ fill: mapCollors[mark.type].bottom }"
                        d="M526.194,399.25a6.5,6.5,0,1,0,6.5,6.5A6.5,6.5,0,0,0,526.194,399.25Zm0,10a3.5,3.5,0,1,1,3.5-3.5A3.5,3.5,0,0,1,526.194,409.25Z"
                        data-name="Path 10542"
                        id="Path_10542"
                      />
                      <circle
                        cx="3.5"
                        cy="3.5"
                        data-name="Ellipse 1439"
                        fill="#fff"
                        id="Ellipse_1439"
                        r="3.5"
                        transform="translate(522.694 402.25)"
                      />
                    </g>
                    <g id="Locator">
                      <path
                        [ngStyle]="{ fill: mapCollors[mark.type].marker }"
                        d="M526.2,364.016a16.637,16.637,0,0,0-16.5,16.769,16.879,16.879,0,0,0,3.229,9.966c3,4.127,13.3,15.265,13.3,15.265s10.231-11.138,13.237-15.265a16.865,16.865,0,0,0,3.229-9.966A16.636,16.636,0,0,0,526.2,364.016Zm0,28.246a11.631,11.631,0,0,1,0-23.262h0a11.631,11.631,0,1,1,0,23.262Z"
                        data-name="Path 10543"
                        id="Path_10543"
                      />
                      <path
                        d="M526.2,369a11.631,11.631,0,1,1-11.631,11.631h0A11.631,11.631,0,0,1,526.194,369Z"
                        data-name="Path 2808"
                        fill="#fff"
                        id="Path_2808"
                      />
                    </g>
                    <text
                      [ngStyle]="{ fill: mapCollors[mark.type].marker }"
                      alignement-baseline="middle"
                      data-name="1"
                      font-family="Montserrat"
                      font-size="14"
                      font-weight="Bold"
                      id="_1"
                      startOffset="50%"
                      text-anchor="middle"
                      transform="translate(520.195 366.25)"
                    >
                      <tspan x="5.8" y="19">{{ mark.index }}</tspan>
                    </text>
                  </g>
                </svg>
              </ng-template>
            </agm-snazzy-info-window>
          </agm-marker>
        </div>
      </agm-map>
      <div class="mileage-container">
        <div *ngIf="legMilage.length > 0" class="mileage_table">
          <div class="total_item">Total: {{distance}} mi</div>
          <div class="mileage_table_head pr-2">
            <div class="milage_table_col"><span>#</span>Stops</div>
            <div class="milage_table_col">Leg</div>
            <div class="milage_table_col">Total</div>
          </div>
          <div class="mileage_table_body">
            <div
              *ngFor="let dataItem of legMilage; let rowIndex = index"
              [ngClass]="{'milage_table_row pr-2': true, 'active': activatedLoadMap == rowIndex, pickupRow: dataItem.type == 'pickup', deliveryRow: dataItem.type == 'delivery' }">
              <!-- Stops -->
              <div class="milage_table_col">
                        <span *ngIf="dataItem.startAddress !== null" class="pl-2 address_titles">
                            <span>{{rowIndex + 1}}</span>{{ dataItem.startAddress }}
                        </span>
                <span *ngIf="dataItem.endAddress !== null" class="pl-2 address_titles">
                            <span>{{rowIndex + 1}}</span>{{ dataItem.endAddress }}
                        </span>
              </div>
              <!-- Leg Miles -->
              <div class="milage_table_col">
                <span *ngIf="dataItem.distance !== null">{{ dataItem.distance }}</span>
              </div>
              <!-- Total Miles -->
              <div class="milage_table_col mileage_total_col">
                <span *ngIf="dataItem.mileageSumString !== null">{{ dataItem.mileageSumString }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button (click)="closeModal()" class="cancel-btn" type="button">Cancel</button>
    <button (click)="addLoad()" *ngIf="addButton" [disabled]="selectedLoad.length === 0" class="save-btn" type="button">
      Assign Load
    </button>
    <button *ngIf="!addButton" [disabled]="selectedLoad.length === 0" class="save-btn" type="button">
      Save Changes
    </button>
  </div>
</div>

