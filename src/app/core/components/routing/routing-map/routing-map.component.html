<div class="table-container">
    <div class="table-toolbar-container toolbar-absolute">
      <!-- <app-truckassist-table-toolbar
        (toolBarAction)="onToolBarAction($event)"
        [options]="tableOptions"
        [tableData]="tableData"
        [selectedTab]="selectedTab"
        [columns]="columns"
      ></app-truckassist-table-toolbar> -->
    </div>
    
    <div class="customer-map-container">
        <div class="route-card-container" cdkDropList (cdkDropListDropped)="drop($event, routes)">
            <div 
                class="route-info-card" 
                cdkDrag 
                *ngFor="let route of routes; let i = index;" 
                [ngClass]="{ 
                    'route-hidden': route.hidden, 
                    'expanded-card': route.expanded
                }">
                <div class="route-info-header">
                    <div 
                        cdkDragHandle
                        class="route-card-svg"
                        [tooltipBackground]="'#616161'"
                        ngbTooltip
                        [mainTooltip]="'Route Reorder'"
                        position="right"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18">
                            <g id="Drag" transform="translate(-935.139 -1357)" opacity="0.7">
                            <rect id="Rectangle_63459" data-name="Rectangle 63459" width="18" height="18" rx="2" transform="translate(935.139 1357)" fill="#f27b8e" opacity="0"/>
                            <path id="grip-vertical" d="M3,0H1A1,1,0,0,0,0,1V3A1,1,0,0,0,1,4H3A1,1,0,0,0,4,3V1A1,1,0,0,0,3,0ZM3,5H1A1,1,0,0,0,0,6V8A1,1,0,0,0,1,9H3A1,1,0,0,0,4,8V6A1,1,0,0,0,3,5Zm0,5H1a1,1,0,0,0-1,1v2a1,1,0,0,0,1,1H3a1,1,0,0,0,1-1V11A1,1,0,0,0,3,10ZM9,0H7A1,1,0,0,0,6,1V3A1,1,0,0,0,7,4H9a1,1,0,0,0,1-1V1A1,1,0,0,0,9,0ZM9,5H7A1,1,0,0,0,6,6V8A1,1,0,0,0,7,9H9a1,1,0,0,0,1-1V6A1,1,0,0,0,9,5Zm0,5H7a1,1,0,0,0-1,1v2a1,1,0,0,0,1,1H9a1,1,0,0,0,1-1V11A1,1,0,0,0,9,10Z" transform="translate(951.139 1361) rotate(90)" [ngStyle]="{ fill: routeColors[i] }" stroke="rgba(0,0,0,0)" stroke-width="1"/>
                            </g>
                        </svg>
                    </div>
                    <div 
                        class="marker-info-text marker-bold-text mg-left-8" 
                        [tooltipBackground]="'#616161'"
                        ngbTooltip
                        [mainTooltip]="route.hidden ? 'Show Route' : 'Hide Route'"
                        position="right"
                        [ngClass]="{ 'gray-text': route.hidden }"
                        (click)="showHideRoute(route)">
                        {{ route.name }}
                    </div>
                    <div class="route-type-text mg-left-12" *ngIf="!route.hidden">Practical</div>
                    <div class="route-type-text mg-left-12" *ngIf="route.hidden">7 Stops</div>
                    <div class="route-type-text mg-left-12" *ngIf="route.hidden">537 mi</div>
                    <!-- <div class="route-card-header-divider"></div>
                    <svg-icon
                        class="route-card-icon"
                        src="assets/svg/common/ic_time.svg"
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                    ></svg-icon>
                    <div class="route-card-header-divider"></div>
                    <svg-icon
                        class="route-card-icon"
                        src="assets/svg/common/ic_dollar.svg"
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                    ></svg-icon> -->
                </div>
                <div class="route-card-content" cdkDropList (cdkDropListDropped)="drop($event, route.stops)">
                    <div class="route-card-row">
                        <div class="route-row-number marker-like-text marker-bold-text" [ngStyle]="{ color: routeColors[i] }">1</div>
                        <div class="route-row-location marker-like-text" [ngClass]="{ 'full-address': route.startPoint.fullAddress }">{{ route.startPoint.fullAddress ? route.startPoint.fullAddress : route.startPoint.address }}</div>
                        <div class="route-row-leg marker-like-text marker-bold-text gray-text" *ngIf="!route.expanded">Leg</div>
                        <div class="route-row-leg shorter-leg-text marker-like-text marker-bold-text gray-text" *ngIf="route.expanded">Leg t</div>
                        <div class="route-row-leg marker-like-text marker-bold-text gray-text" *ngIf="route.expanded">Total t</div>
                        <div class="route-row-leg marker-like-text marker-bold-text gray-text" *ngIf="route.expanded">Leg mi</div>
                        <div class="route-row-total marker-like-text marker-bold-text gray-text" *ngIf="!route.expanded">Total</div>
                        <div class="route-row-total marker-like-text marker-bold-text gray-text" *ngIf="route.expanded">Total mi</div>
                    </div>
                    <div class="route-card-row" *ngFor="let stop of route.stops; let b = index;" cdkDrag>
                        <svg-icon
                            src="assets/svg/truckassist-table/dropdown/content/delete.svg"
                            class="delete-button"
                            [svgStyle]="{ 'width.px': 14, 'height.px': 14 }"
                            (click)="deleteRouteStop(route, b)"
                        ></svg-icon>
                        <div class="delete-stop-text">Delete</div>
                        <div class="route-row-number marker-like-text marker-bold-text" [ngStyle]="{ color: routeColors[i] }">{{ b + 2 }}</div>
                        <div class="route-row-location marker-like-text" [ngClass]="{ 'full-address': stop.fullAddress }">{{ stop.fullAddress ? stop.fullAddress : stop.address }}</div>
                        <div class="route-row-leg shorter-leg-text marker-like-text" *ngIf="route.expanded">{{ stop.time }}</div>
                        <div class="route-row-total marker-like-text marker-semibold-text" [ngStyle]="{ color: b == route.stops.length-1 ? routeColors[i] : '' }" *ngIf="route.expanded">{{ stop.totalTime }}</div>
                        <div class="route-row-leg marker-like-text">{{ stop.leg }}</div>
                        <div class="route-row-total marker-like-text marker-semibold-text" [ngStyle]="{ color: b == route.stops.length-1 ? routeColors[i] : '' }">{{ stop.total }}</div>
                    </div>
                    <!-- <div class="empty-miles"></div> -->
                    <div class="route-card-row m-0">
                        <div class="route-row-number marker-like-text marker-bold-text"></div>
                        <div class="route-row-location marker-like-text marker-bold-text gray-text">Add New Stop</div>
                    </div>
                </div>
                <div class="route-card-resize-button" (click)="resizeCard(route)">
                    <svg-icon
                        src="assets/svg/common/fill_arrow_down.svg"
                        class="map-list-resize-svg"
                        [ngClass]="{ 'rotate': route.expanded}"
                        [svgStyle]="{ 'width.px': 12, 'height.px': 12 }"
                    ></svg-icon>
                </div>
            </div>
        </div>

        <agm-map
            [latitude]="mapLatitude"
            [longitude]="mapLongitude"
            [restriction]="mapRestrictions"
            [streetViewControl]="false"
            [styles]="styles"
            [zoom]="mapZoom"
            [usePanning]="true"
            [keyboardShortcuts]="false"
            (mapClick)="mapClick($event)"
            (zoomChange)="zoomChange($event)"
            (mapReady)="getMapInstance($event)">

            <agm-direction
                [renderOptions]="{ polylineOptions: { strokeColor: routeColors[0], strokeWeight: 6 } }"
                [origin]="{ lat: 43.651018, lng: -79.656982 }"
                [destination]="{ lat: 38.150774, lng: -84.52006 }"
            ></agm-direction>
            <agm-direction
                [renderOptions]="{ polylineOptions: { strokeColor: '#fff', strokeWeight: 2 } }"
                [origin]="{ lat: 43.651018, lng: -79.656982 }"
                [destination]="{ lat: 38.150774, lng: -84.52006 }"
            ></agm-direction>
            <agm-direction
                [renderOptions]="{ polylineOptions: { strokeColor: routeColors[1], strokeWeight: 6 } }"
                [origin]="{ lat: 33.03676, lng: -97.279786 }"
                [destination]="{ lat: 33.300185, lng: -87.071286 }"
            ></agm-direction>
            <agm-direction
                [renderOptions]="{ polylineOptions: { strokeColor: routeColors[2], strokeWeight: 6 } }"
                [origin]="{ lat: 40.7066568, lng: -74.0115875 }"
                [destination]="{ lat: 34.638319, lng: -77.479674 }"
            ></agm-direction>
            <agm-direction
                [renderOptions]="{ polylineOptions: { strokeColor: routeColors[3], strokeWeight: 6 } }"
                [origin]="{ lat: 41.958733, lng: -87.869617 }"
                [destination]="{ lat: 34.674519, lng: -92.400126 }"
            ></agm-direction>
        </agm-map>
    </div>
  </div>