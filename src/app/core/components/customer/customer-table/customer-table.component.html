<div class="table-container">
    <div class="table-toolbar-container" [ngClass]="{ 'toolbar-absolute': tableOptions.toolbarActions.viewModeActive == 'Map' }">
      <app-truckassist-table-toolbar
        (toolBarAction)="onToolBarAction($event)"
        [options]="tableOptions"
        [tableData]="tableData"
        [selectedTab]="selectedTab"
        [columns]="columns"
      ></app-truckassist-table-toolbar>
    </div>
    <div class="table-list-container" *ngIf="tableOptions.toolbarActions.viewModeActive !== 'Map'">
      <app-truckassist-table-head
        [options]="tableOptions"
        [viewData]="viewData"
        [columns]="columns"
      ></app-truckassist-table-head>
  
      <app-truckassist-table-body
        [viewData]="viewData"
        [columns]="columns"
        [options]="tableOptions"
        [selectedTab]="selectedTab"
        (bodyActions)="onTableBodyActions($event)"
      ></app-truckassist-table-body>
    </div>
    
    <div class="customer-map-container" *ngIf="tableOptions.toolbarActions.viewModeActive == 'Map'">
      <app-map-list>
        <!-- <app-map-list-card
          [title]="latlong?.businessName"
          [isSelected]="latlong?.isSelected"
          [status]="latlong?.status"
          [item]="latlong"
          [address]="latlong.mainAddress"
        ></app-map-list-card> -->
        <div class="map-list-card-container" *ngFor="let latlong of viewData; let i = index;" [ngClass]="{ 'map-list-card-selected': latlong?.isSelected }" (click)="clickedMarker(i)">
          <div class="map-list-card-info">
            <div class="title-container">
              <div class="marker-info-text marker-bold-text uppercase" [ngClass]="{ 'permanently-closed-text': latlong?.status == 2 }">
                <span *ngIf="latlong?.status == 2">
                  <svg-icon
                    class="permanently-closed-svg"
                    src="assets/svg/common/ic_permanently_closed.svg"
                    [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                  ></svg-icon>
                </span>
                <span>{{ latlong?.businessName }}</span>
              </div>
              <div class="show-more" (click)="showMoreOptions($event)">
                <app-table-dropdown
                  [options]="tableOptions.actions"
                  [placement]="'bottom-left'"
                  [id]="latlong.id"
                  (dropDownActions)="onTableBodyActions($event)"
                >
                </app-table-dropdown>
              </div>
            </div>
            <div class="marker-rating-container mg-top-2">
              <span class="marker-rating">
                <svg-icon
                    class="marker-rating-svg"
                    src="assets/svg/common/ic_like.svg"
                    [svgStyle]="{ 'width.px': 14, 'height.px': 14 }"
                ></svg-icon>
                <span class="marker-like-text marker-bold-text">{{ latlong?.upRatingCount }}</span>
              </span>
              <span class="marker-rating">
                <svg-icon
                    class="marker-rating-svg"
                    src="assets/svg/common/ic_dislike.svg"
                    [svgStyle]="{ 'width.px': 14, 'height.px': 14 }"
                ></svg-icon>
                <span class="marker-like-text marker-bold-text">{{ latlong?.downRatingCount }}</span>
              </span>
            </div>
            <div class="map-list-card-address mg-top-2">
              <!-- <span class="marker-bold-text">127 mi - </span> -->
              <div *ngIf="latlong?.mainAddress">
                {{ latlong?.mainAddress.city }},
                {{ latlong?.mainAddress.state }}
                {{ latlong?.mainAddress.zipCode }},
                {{ latlong?.mainAddress.country }}
              </div>
              <div *ngIf="latlong?.address">
                {{ latlong?.address.city }},
                {{ latlong?.address.state }}
                {{ latlong?.address.zipCode }},
                {{ latlong?.address.country }}
              </div>
            </div>
          </div>
        </div>
      </app-map-list>

      <agm-map 
        [latitude]="41.860119"
        [longitude]="-87.660156"
        [restriction]="mapRestrictions"
        [streetViewControl]="false"
        [styles]="styles"
        [zoom]="1"
        (mapClick)="mapClick()">
          <agm-marker 
            *ngFor="let latlong of viewData; let i = index;" 
            (markerClick)="clickedMarker(i, $event)" 
            [label]="!latlong?.isSelected ? latlong?.businessName : ''" 
            [latitude]="latlong.latitude" 
            [longitude]="latlong.longitude"
            [agmFitBounds]="true" 
            [animation]="latlong?.markerAnimation ? latlong?.markerAnimation : 'DROP'" 
            [iconUrl]="{
              url: 
                latlong?.isSelected && latlong?.status == 2 ? 'assets/svg/common/ic_marker_closed_big.svg' :
                latlong?.status == 2 ? 'assets/svg/common/ic_marker_closed.svg' :
                latlong?.isSelected ? 'assets/svg/common/ic_marker_selected.svg' : 
                'assets/svg/common/ic_marker.svg'
            }">
            <agm-snazzy-info-window
              [closeOnMapClick]="false"
              [closeWhenOthersOpen]="true"
              [isOpen]="latlong?.isSelected"
              [latitude]="latlong.latitude"
              [longitude]="latlong.longitude"
              [maxHeight]="32"
              [maxWidth]="26"
              [openOnMarkerClick]="true"
              [pointer]="false"
              [showCloseButton]="false"
              placement="bottom"
            >
              <ng-template class="marker-tool-tip">
                <div class="marker-info-container-all">
                  <div class="title-container">
                    <div class="marker-business-name">{{ latlong?.businessName }}</div>
                    <div class="show-more">
                      <app-table-dropdown
                        [options]="tableOptions.actions"
                        [placement]="'bottom-left'"
                        [id]="latlong.id"
                        (dropDownActions)="onTableBodyActions($event)"
                      >
                      </app-table-dropdown>
                    </div>
                  </div>
                  <div class="marker-info-text marker-bold-text uppercase red-text mg-bottom-2 mg-top-4" *ngIf="latlong?.status == 2">
                    Permanently Closed
                  </div>
                  <div class="marker-distance-left" [ngClass]="{ 'mg-top-4': latlong?.status == 2 }">
                    <span class="marker-title">123.4 mi </span>
                    <span class="marker-info-text">away </span>
                    <span class="marker-time-left-text">
                      <span class="marker-bold-text">- 1 hour 27 minutes</span> est.
                    </span>
                  </div>
                  <div class="marker-rating-container mg-top-4">
                    <span class="marker-rating">
                      <svg-icon
                          class="marker-rating-svg"
                          src="assets/svg/common/ic_like.svg"
                          [svgStyle]="{ 'width.px': 14, 'height.px': 14 }"
                      ></svg-icon>
                      <span class="marker-like-text marker-bold-text">{{ latlong?.upRatingCount }}</span>
                    </span>
                    <span class="marker-rating">
                      <svg-icon
                          class="marker-rating-svg"
                          src="assets/svg/common/ic_dislike.svg"
                          [svgStyle]="{ 'width.px': 14, 'height.px': 14 }"
                      ></svg-icon>
                      <span class="marker-like-text marker-bold-text">{{ latlong?.downRatingCount }}</span>
                    </span>
                  </div>
                </div>
                <div class="marker-divider"></div>
                <div class="marker-info-container-all">
                  <div class="marker-info-container">
                    <svg-icon
                        class="marker-info-svg"
                        src="assets/svg/common/ic_phone.svg"
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                    ></svg-icon>
                    <span class="marker-info-text">{{ latlong?.phone }}</span>
                  </div>
                  <div class="marker-info-container" *ngIf="latlong.email">
                    <svg-icon
                        class="marker-info-svg"
                        src="assets/svg/common/ic_email.svg"
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                    ></svg-icon>
                    <span class="marker-info-text">{{ latlong?.email }}</span>
                  </div>
                  <div class="marker-info-container">
                    <div>
                      <svg-icon
                        class="marker-info-svg"
                        src="assets/svg/common/ic_address.svg"
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                      ></svg-icon>
                    </div>
                    <div class="marker-info-text">
                      <div *ngIf="latlong?.mainAddress">
                        <div *ngIf="latlong?.mainAddress.street">
                          {{ latlong?.mainAddress.streetNumber ? latlong?.mainAddress.streetNumber : '' }} 
                          {{ latlong?.mainAddress.street }}
                          {{ latlong?.mainAddress.addressUnit ? latlong?.mainAddress.addressUnit : '' }}
                        </div>
                        <div>
                          {{ latlong?.mainAddress.city }}, 
                          {{ latlong?.mainAddress.state }}
                          {{ latlong?.mainAddress.zipCode }},
                          {{ latlong?.mainAddress.country }}
                        </div>
                      </div>
                      <div *ngIf="latlong?.address">
                        <div *ngIf="latlong?.address.street">
                          {{ latlong?.address.streetNumber ? latlong?.address.streetNumber : '' }} 
                          {{ latlong?.address.street }}
                          {{ latlong?.address.addressUnit ? latlong?.address.addressUnit : '' }}
                        </div>
                        <div>
                          {{ latlong?.address.city }}, 
                          {{ latlong?.address.state }}<span *ngIf="latlong?.address.zipCode"> {{ latlong?.address.zipCode }}</span>,
                          {{ latlong?.address.country }}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="marker-expanded-view unopened" 
                [class.unopened]="latlong?.isExpanded === undefined"
                [@showHideDrop]="latlong?.isExpanded">
                  <div class="marker-divider"></div>
                  <div *ngIf="(latlong?.shippingFrom && latlong?.shippingTo) || (latlong?.receivingFrom && latlong?.receivingTo)">
                    <div class="marker-info-container-all">
                      <div class="marker-title">Available Hours</div>
                      <div class="marker-expanded-info-container">
                        <div class="marker-dual-info-container mg-bottom-8" *ngIf="latlong?.shippingFrom && latlong?.shippingTo">
                          <div class="marker-like-text marker-bold-text mg-bottom-4">Shipping</div>
                          <div class="marker-info-text">{{ latlong?.shippingFrom }} - {{ latlong?.shippingTo }}</div>
                        </div>
                        <div class="marker-dual-info-container mg-bottom-8" *ngIf="latlong?.receivingFrom && latlong?.receivingTo">
                          <div class="marker-like-text marker-bold-text mg-bottom-4">Receiving</div>
                          <div class="marker-info-text">{{ latlong?.receivingFrom }} - {{ latlong?.receivingTo }}</div>
                        </div>
                      </div>
                    </div>
                    <div class="marker-divider"></div>
                  </div>
                  <div class="marker-info-container-all">
                    <div class="marker-title"><span class="data-count">769</span>Load</div>
                    <div class="marker-expanded-info-container">
                      <div class="marker-dual-info-container mg-bottom-8">
                        <div class="marker-info-text mg-bottom-4"><span class="marker-bold-text">632</span> Picked Up</div>
                        <div class="marker-like-text">Avg. Loading <span class="marker-bold-text">22m 37s</span></div>
                      </div>
                      <div class="marker-dual-info-container mg-bottom-8">
                        <div class="marker-info-text mg-bottom-4"><span class="marker-bold-text">127</span> Delivered</div>
                        <div class="marker-like-text">Avg. Offloading <span class="marker-bold-text">19m 08s</span></div>
                      </div>
                    </div>
                  </div>
                  <div class="marker-divider"></div>
                  <div class="marker-info-container-all">
                    <div class="marker-expanded-info-container">
                      <div class="marker-dual-info-container mg-bottom-4">
                        <div class="marker-like-text marker-bold-text mg-bottom-4">Date Added</div>
                        <div class="marker-info-text">{{ latlong?.createdAt | formatDateP }}</div>
                      </div>
                      <div class="marker-dual-info-container mg-bottom-4">
                        <div class="marker-like-text marker-bold-text mg-bottom-4">{{ latlong?.status == 2 ? 'Perm. Closed' : 'Last Used' }}</div>
                        <div class="marker-info-text">137 days ago</div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="marker-container-expand" (click)="expandInfo(latlong)">
                  <svg-icon
                    src="assets/svg/common/resize-arrow.svg"
                    class="marker-expand-svg"
                    [ngClass]="{ 'rotate': latlong?.isExpanded}"
                    [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                  ></svg-icon>
                </div>
              </ng-template>
            </agm-snazzy-info-window>
          </agm-marker>      
      </agm-map>


      <!-- <agm-map
        (mapReady)="getMapInstance($event)"
        [clickableIcons]="false"
        [controlSize]="20"
        [restriction]="mapRestrictions"
        [streetViewControl]="false"
        [styles]="styles"
        [zoom]="2">
      </agm-map> -->

    </div>
  </div>