<div class="d-flex flex-column align-items-center step-container">
  <h1 class="m-0 step-title text-center ta-font-bold">Accident record</h1>

  <!-- TOP SECTION -->

  <div class="d-flex justify-content-center text-center top-section">
    <p
      class="m-0 ta-font-bold"
      [ngStyle]="{
        color: selectedMode === 'FEEDBACK_MODE' ? '#919191' : '#6C6C6C'
      }"
    >
      Please list all motor vehicle collisions in which you were involved<br />
      (both commercial and private vehicle) during the past 3 years prior to the
      application date.
    </p>
  </div>

  <!-- MID SECTION -->

  <div
    class="d-flex judtify-content-center text-center mid-section"
    [formGroup]="accidentForm"
  >
    <app-ta-checkbox
      formControlName="hasPastAccident"
      [name]="'hasPastAccident'"
      [label]="'No accidents for past 3 years'"
      [customClass]="
        selectedMode === 'FEEDBACK_MODE' ? 'applicant-feedback' : 'bold-12'
      "
    ></app-ta-checkbox>
  </div>

  <div
    class="d-flex flex-column form-section"
    *ngIf="!accidentForm.get('hasPastAccident').value"
  >
    <!-- CREATED ACCIDENT DATA -->

    <div
      class="d-flex flex-column justify-content-center accident-view-container"
      *ngIf="accidentArray.length"
      [formGroup]="accidentForm"
    >
      <div
        class="d-flex flex-column"
        *ngFor="
          let accident of accidentArray;
          let i = index;
          trackBy: trackByIdentity
        "
      >
        <div
          class="d-flex align-items-center title-container"
          *ngIf="
            (accidentArray.length > 1 && helperIndex !== 0 && i === 0) ||
            (helperIndex === 0 && i === 1) ||
            (i === helperIndex + 1 && selectedAccidentIndex > -1)
          "
        >
          <div class="d-flex align-items-center date-title-box">
            <p class="m-0 ta-font-bold">DATE <span>*</span></p>
          </div>
          <div class="d-flex align-items-center state-title-box">
            <p class="m-0 ta-font-bold">STATE <span>*</span></p>
          </div>
          <div class="d-flex align-items-center fatalities-title-box">
            <p class="m-0 ta-font-bold">FAT.</p>
          </div>
          <div class="d-flex align-items-center injuries-title-box">
            <p class="m-0 ta-font-bold">INJ.</p>
          </div>
          <div class="d-flex align-items-center hazmat-title-box">
            <p class="m-0 ta-font-bold">H. SPILL <span>*</span></p>
          </div>
          <div class="d-flex align-items-center description-title-box">
            <p class="m-0 ta-font-bold">DESCRIPTION <span>*</span></p>
          </div>
        </div>

        <div
          class="d-flex align-items-center accident-info-container line-container"
          *ngIf="!accident.isEditingAccident"
        >
          <div class="d-flex align-items-center info-btn-container">
            <div class="d-flex align-items-center date-box">
              <p class="m-0 ta-font-regular">
                {{ accident.accidentDate }}
              </p>
            </div>
            <div class="d-flex align-items-center state-box">
              <p class="m-0 ta-font-regular">
                {{ accident.accidentState }}
              </p>
            </div>
            <div class="d-flex align-items-center fatalities-box">
              <p class="m-0 ta-font-regular">
                {{ accident.fatalities }}
              </p>
            </div>
            <div class="d-flex align-items-center injuries-box">
              <p class="m-0 ta-font-regular">
                {{ accident.injuries }}
              </p>
            </div>
            <div class="d-flex align-items-center hazmat-box">
              <p class="m-0 ta-font-regular">
                {{ accident.hazmatSpill }}
              </p>
            </div>
            <div
              class="d-flex align-items-center description-box"
              [ngStyle]="{
                width: selectedMode === 'FEEDBACK_MODE' ? '190px' : '209px'
              }"
            >
              <p
                class="m-0 ta-font-regular d-inline-block text-truncate"
                style="max-width: 207px"
                ngbTooltip
                [mainTooltip]="accident.accidentDescription"
                tooltipBackground="#6C6C6C"
                position="bottom-left"
              >
                {{ accident.accidentDescription }}
              </p>
            </div>
            <div
              class="d-flex align-items-center btn-container"
              [ngClass]="{
                active: selectedMode === 'REVIEW_MODE'
              }"
            >
              <div
                ngbTooltip
                mainTooltip="Edit"
                tooltipBackground="#6C6C6C"
                position="top"
              >
                <svg-icon
                  class="edit-icon"
                  src="assets/svg/truckassist-table/dropdown/content/edit-hover.svg"
                  [svgStyle]="{
                    'width.px': 18,
                    'height.px': 18
                  }"
                  (click)="onEditAccident(i)"
                ></svg-icon>
              </div>

              <div
                ngbTooltip
                mainTooltip="Delete"
                tooltipBackground="#EF5350"
                position="top"
              >
                <svg-icon
                  class="delete-icon"
                  src="assets/svg/truckassist-table/dropdown/content/delete.svg"
                  [svgStyle]="{
                    'width.px': 18,
                    'height.px': 18
                  }"
                  (click)="onDeleteAccident(i)"
                ></svg-icon>
              </div>

              <div *ngIf="selectedMode === 'REVIEW_MODE'">
                <div
                  class="review-icon-box"
                  ngbTooltip
                  mainTooltip="Mark Incorrect"
                  tooltipBackground="#F44336"
                  position="top"
                >
                  <svg-icon
                    class="review-icon"
                    [ngClass]="{
                      active:
                        openAnnotationArray[i].displayAnnotationButton ||
                        openAnnotationArray[i].displayAnnotationTextArea
                    }"
                    src="assets/svg/ic_x.svg"
                    [svgStyle]="{
                      'width.px': 18,
                      'height.px': 18
                    }"
                    (click)="incorrectInput($event, 0, i, 'card')"
                  ></svg-icon>
                </div>
              </div>

              <div *ngIf="selectedMode === 'FEEDBACK_MODE'">
                <div
                  class="feedback-icon-box"
                  ngbTooltip
                  mainTooltip="Marked Incorrect"
                  tooltipBackground="#F44336"
                  position="top"
                >
                  <svg-icon
                    class="feedback-icon"
                    src="assets/svg/common/ic_danger.svg"
                    [svgStyle]="{
                      'width.px': 18,
                      'height.px': 18
                    }"
                  ></svg-icon>
                </div>
              </div>
            </div>
          </div>

          <!-- REVIEW AND FEEDBACK -->

          <div
            class="review-feedback-container"
            *ngIf="
              selectedMode === 'REVIEW_MODE' || selectedMode === 'FEEDBACK_MODE'
            "
          >
            <app-applicant-review-feedback
              [formControlName]="'cardReview' + (i + 1)"
              [displayAnnotationButton]="
                openAnnotationArray[i].displayAnnotationButton
              "
              [displayAnnotationTextArea]="
                openAnnotationArray[i].displayAnnotationTextArea
              "
              [lineIndex]="i"
              [isFeedback]="selectedMode === 'FEEDBACK_MODE'"
              [feedbackText]="'Check the number'"
              [cardsLength]="accidentArray.length"
              [cardsType]="'accidentRecord'"
              [cardIndex]="i"
              (annotationBtnClickEvent)="getAnnotationBtnClickValue($event)"
            ></app-applicant-review-feedback>
          </div>
        </div>

        <div
          class="d-flex flex-column accident-view-form"
          *ngIf="accident.isEditingAccident"
        >
          <app-step4-form
            [isEditing]="isEditing"
            [formValuesToPatch]="formValuesToPatch"
            (cancelFormEditingEmitter)="cancelAccidentEditing($event)"
            (formValuesEmitter)="getAccidentFormValues($event)"
            (saveFormEditingEmitter)="saveEditedAccident($event)"
          ></app-step4-form>
        </div>
      </div>
    </div>

    <!-- FORM SECTION -->

    <form *ngIf="!isEditing">
      <app-step4-form
        [isEditing]="isEditing"
        (formValuesEmitter)="getAccidentFormValues($event)"
      ></app-step4-form>
    </form>
  </div>
</div>

<!-- NEXT BTN -->

<div
  class="d-flex justify-content-center align-items-center next-btn-container"
>
  <app-applicant-next-back-btn [nextStep]="true"></app-applicant-next-back-btn>
</div>

<!-- BACK BTN -->

<div
  class="d-flex justify-content-center align-items-center back-btn-container"
>
  <app-applicant-next-back-btn [backStep]="true"> </app-applicant-next-back-btn>
</div>
