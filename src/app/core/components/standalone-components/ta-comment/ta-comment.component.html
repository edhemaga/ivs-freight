<ng-container *ngIf="!commentCardsDataDropdown">
    <div
        class="d-flex flex-column comment-container"
        [ngClass]="{ inactive: !isCommenting }"
    >
        <!-- Comment Header -->

        <div
            class="d-flex align-items-start justify-content-between comment-header"
        >
            <div class="d-flex align-items-center comment-header-left">
                <img
                    src="assets/svg/truckassist-table/user-avatar-no-profile.svg"
                    [src]="
                        commentAvatar ??
                        'assets/svg/truckassist-table/user-avatar-no-profile.svg'
                    "
                    alt="User Profile Image"
                />

                <p class="m-0 ta-font-semi-bold">
                    {{ commentData.companyUser.name }}
                </p>

                <ng-container *ngIf="!isCommenting">
                    <ng-container *ngIf="isMe">
                        <div class="me-container">
                            <span class="m-0 ta-font-bold">(Me)</span>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="commentDate">
                        <div class="date-container">
                            <span class="m-0 ta-font-medium">
                                • {{ commentDate }}
                            </span>
                        </div>
                    </ng-container>

                    <ng-container *ngIf="isEdited">
                        <div class="edited-container">
                            <span class="m-0 ta-font-medium">• Edited</span>
                        </div>
                    </ng-container>
                </ng-container>
            </div>

            <div
                class="d-flex align-items-center justify-content-center comment-header-right"
            >
                <ng-container *ngIf="isCommenting">
                    <svg-icon
                        class="confirm-icon"
                        [ngClass]="{
                            disabled: isDisabled
                        }"
                        src="assets/svg/ic_spec-confirm.svg"
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                        (click)="handleBtnActionClick('Confirm')"
                    ></svg-icon>

                    <svg-icon
                        class="cancel-icon"
                        src="assets/svg/ic_x.svg"
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                        (click)="handleBtnActionClick('Cancel')"
                    ></svg-icon>
                </ng-container>

                <ng-container *ngIf="!isCommenting">
                    <ng-container *ngIf="!isEditButtonDisabled">
                        <div
                            class="d-flex justify-content-center align-items-center edit-icon-container"
                        >
                            <svg-icon
                                class="icon"
                                src="assets/svg/truckassist-table/dropdown/content/edit-hover.svg"
                                [svgStyle]="{ 'width.px': 13, 'height.px': 13 }"
                                (click)="handleBtnActionClick('Edit')"
                            ></svg-icon>
                        </div>
                    </ng-container>

                    <div
                        class="d-flex justify-content-center align-items-center delete-icon-container"
                    >
                        <svg-icon
                            class="icon"
                            src="assets/svg/truckassist-table/dropdown/content/delete-hover-new.svg"
                            [svgStyle]="{ 'width.px': 11, 'height.px': 13 }"
                            (click)="handleBtnActionClick('Delete')"
                        ></svg-icon>
                    </div>
                </ng-container>
            </div>
        </div>

        <!-- Comment Body -->

        <div class="d-flex align-items-center comment-body">
            <div
                #commentInput
                class="comment-input"
                [ngClass]="{
                    'no-value': commentInput?.textContent === 'Write Comment...'
                }"
                [attr.contenteditable]="isCommenting"
                spellcheck="false"
                (focus)="handleCommentChange()"
                (input)="handleCommentChange()"
                (blur)="handleCommentBlur()"
                (paste)="onPaste($event)"
            ></div>
        </div>
    </div>
</ng-container>

<!-- Comments for cards -->

<ng-container *ngIf="commentCardsDataDropdown">
    <ng-container *ngIf="!editingCardComment">
        <div class="comments-dropdown hoverable">
            <div class="d-grid">
                <div class="d-flex align-items-center top-comment-body">
                    <ng-container
                        *ngIf="!commentCardsDataDropdown?.companyUser.avatar"
                    >
                        <div class="d-flex">
                            <span
                                class="user-image d-flex align-items-center justify-content-center ta-font-extra-bold"
                                [style]="{
                                    background:
                                        commentCardsDataDropdown.avatarColor
                                            ?.background,
                                    color: commentCardsDataDropdown.avatarColor
                                        ?.color
                                }"
                                >{{
                                    commentCardsDataDropdown?.textShortName
                                }}</span
                            >
                        </div>
                    </ng-container>

                    <div class="d-grid title-holder">
                        <div
                            class="d-flex justify-content-between title-svg-holder"
                        >
                            <div class="d-flex align-items-center creds-holder">
                                <ng-container
                                    *ngIf="
                                        checkIfLoggedUserCommented(
                                            commentCardsDataDropdown.companyUser
                                                .id
                                        )
                                    "
                                >
                                    <span
                                        class="text-white ta-font-semi-bold"
                                        (click)="
                                            toogleComment(
                                                commentCardsDataDropdown
                                            )
                                        "
                                        [innerHTML]="
                                            higlitsPartOfCommentSearchValue(
                                                abbreviateFullName(
                                                    commentCardsDataDropdown
                                                        .companyUser.fullName
                                                )
                                            ) | safeHtml
                                        "
                                    ></span>
                                </ng-container>

                                <ng-container
                                    *ngIf="
                                        !checkIfLoggedUserCommented(
                                            commentCardsDataDropdown.companyUser
                                                .id
                                        )
                                    "
                                >
                                    <span
                                        class="text-white ta-font-semi-bold"
                                        (click)="
                                            toogleComment(
                                                commentCardsDataDropdown
                                            )
                                        "
                                        [innerHTML]="
                                            higlitsPartOfCommentSearchValue(
                                                commentCardsDataDropdown
                                                    .companyUser.fullName
                                            ) | safeHtml
                                        "
                                    ></span>
                                </ng-container>

                                <!-- if owner of the card -->

                                <ng-container
                                    *ngIf="
                                        checkIfLoggedUserCommented(
                                            commentCardsDataDropdown.companyUser
                                                .id
                                        )
                                    "
                                >
                                    <span class="card-user-me ta-font-bold"
                                        >(Me)</span
                                    >
                                </ng-container>

                                <ng-container
                                    *ngIf="commentCardsDataDropdown.liked"
                                >
                                    <svg-icon
                                        class="like-icon"
                                        [src]="'assets/svg/common/ic_like.svg'"
                                        [svgStyle]="{
                                            'width.px': 13,
                                            'height.px': 13
                                        }"
                                    ></svg-icon>
                                </ng-container>

                                <ng-container
                                    *ngIf="commentCardsDataDropdown.disliked"
                                >
                                    <svg-icon
                                        class="dislike-icon"
                                        [src]="
                                            'assets/svg/common/ic_dislike.svg'
                                        "
                                        [svgStyle]="{
                                            'width.px': 13,
                                            'height.px': 13
                                        }"
                                    ></svg-icon>
                                </ng-container>
                            </div>

                            <div class="user-icons d-flex align-items-center">
                                <ng-container
                                    *ngIf="
                                        checkIfLoggedUserCommented(
                                            commentCardsDataDropdown.companyUser
                                                .id
                                        )
                                    "
                                >
                                    <span
                                        ngbTooltip
                                        mainTooltip="Edit"
                                        type="button"
                                        tooltipBackground="#CCCCCC"
                                        tooltipColor="#2F2F2F"
                                        customClass="mb-2"
                                        position="top"
                                        (click)="openEditComment(true)"
                                        class="edit-tooltip d-flex align-items-center justify-content-center"
                                    >
                                        <svg-icon
                                            class="edit-icon"
                                            [src]="
                                                'assets/svg/truckassist-table/dropdown/content/edit.svg'
                                            "
                                            [svgStyle]="{
                                                'width.px': 13,
                                                'height.px': 13
                                            }"
                                        ></svg-icon>
                                    </span>

                                    <span
                                        ngbTooltip
                                        mainTooltip="Delete"
                                        tooltipBackground="#CCCCCC"
                                        tooltipColor="#2F2F2F"
                                        customClass="mb-2"
                                        position="top"
                                        type="button"
                                        class="edit-tooltip d-flex align-items-center justify-content-center"
                                        (click)="
                                            deleteComment(
                                                commentCardsDataDropdown.id
                                            )
                                        "
                                    >
                                        <svg-icon
                                            class="delete-icon"
                                            [src]="
                                                'assets/svg/truckassist-table/dropdown/content/delete.svg'
                                            "
                                            [svgStyle]="{
                                                'width.px': 11,
                                                'height.px': 13
                                            }"
                                        ></svg-icon>
                                    </span>
                                </ng-container>

                                <ng-container
                                    *ngIf="
                                        commentCardsDataDropdown.commentContent
                                    "
                                >
                                    <span
                                        class="open-dropdown-icon d-flex align-items-center justify-content-center"
                                    >
                                        <ng-container
                                            *ngIf="
                                                commentCardsDataDropdown
                                                    .commentContent.length >= 42
                                            "
                                        >
                                            <svg-icon
                                                [src]="
                                                    'assets/svg/common/fill_arrow_down.svg'
                                                "
                                                [ngClass]="{
                                                    'rotate-svg':
                                                        commentCardsDataDropdown.isOpen,
                                                    'rotate-back':
                                                        !commentCardsDataDropdown.isOpen
                                                }"
                                                class="arrow-svg-icon"
                                                [svgStyle]="{
                                                    'width.px': 10,
                                                    'height.px': 10
                                                }"
                                            >
                                            </svg-icon>
                                        </ng-container>
                                    </span>
                                </ng-container>
                            </div>
                        </div>

                        <div class="d-flex">
                            <span
                                class="ta-font-medium muted-text"
                                (click)="
                                    toogleComment(commentCardsDataDropdown)
                                "
                                >{{
                                    transformDate(
                                        commentCardsDataDropdown.createdAt
                                    )
                                }}</span
                            >

                            <!-- if card is edited -->

                            <ng-container
                                *ngIf="commentCardsDataDropdown?.edited"
                            >
                                <span class="card-user-edited ta-font-medium"
                                    >• Edited</span
                                >
                            </ng-container>
                        </div>
                    </div>
                </div>
                <ng-container *ngIf="commentCardsDataDropdown.commentContent">
                    <span
                        class="text-white comment-text"
                        [ngClass]="{
                            'show-comment': commentCardsDataDropdown.isOpen
                        }"
                        [@dropdownAnimationComment]="
                            commentCardsDataDropdown.isOpen ? 'true' : 'false'
                        "
                        [innerHTML]="
                            higlitsPartOfCommentSearchValue(
                                commentCardsDataDropdown.commentContent
                            ) | safeHtml
                        "
                    ></span>
                </ng-container>
            </div>
        </div>
    </ng-container>

    <!-- Editing comment component -->
    <ng-container *ngIf="editingCardComment">
        <div class="comments-dropdown editable">
            <div class="d-grid">
                <div class="d-flex align-items-center top-comment-body">
                    <ng-container *ngIf="!commentCardsDataDropdown.userAvatar">
                        <div class="d-flex">
                            <span
                                class="user-image d-flex align-items-center justify-content-center ta-font-extra-bold"
                                [style]="{
                                    background:
                                        commentCardsDataDropdown?.avatarColor
                                            ?.background,
                                    color: commentCardsDataDropdown?.avatarColor
                                        ?.color
                                }"
                                >{{
                                    commentCardsDataDropdown.textShortName
                                }}</span
                            >
                        </div>
                    </ng-container>

                    <ng-template
                        *ngIf="commentCardsDataDropdown?.companyUser.avatar"
                    >
                        {{ commentCardsDataDropdown?.companyUser.avatar }}
                        <img
                            src="{{
                                'data:image/jpg;base64,' +
                                    commentCardsDataDropdown?.companyUser.avatar
                            }}"
                            alt=""
                        />
                    </ng-template>

                    <div class="d-grid title-holder">
                        <div
                            class="d-flex justify-content-between title-svg-holder"
                        >
                            <div class="d-flex">
                                <span class="title ta-font-semi-bold">{{
                                    commentCardsDataDropdown.companyUser
                                        .fullName
                                }}</span>
                            </div>

                            <span
                                class="title ta-font-semi-bold"
                                [innerHTML]="
                                    higlitsPartOfCommentSearchValue(
                                        commentCardsDataDropdown.fullName
                                    ) | safeHtml
                                "
                            ></span>

                            <!-- if card is edited -->

                            <ng-container
                                *ngIf="commentCardsDataDropdown.edited"
                            >
                                <span class="card-user-edited ta-font-medium"
                                    >• Edited</span
                                >
                            </ng-container>

                            <div class="user-icons d-flex">
                                <span
                                    ngbTooltip
                                    mainTooltip="Confirm"
                                    type="button"
                                    tooltipBackground="#CCCCCC"
                                    tooltipColor="#2F2F2F"
                                    customClass="mb-2"
                                    position="top"
                                    (click)="
                                        editComment(commentCardsDataDropdown.id)
                                    "
                                    class="confirm-tooltip d-flex align-items-center justify-content-center"
                                    [tooltipClass]="customClass"
                                >
                                    <svg-icon
                                        class="confirm-icon d-flex align-items-center justify-content-center"
                                        [src]="'assets/svg/applicant/check.svg'"
                                        [svgStyle]="{
                                            'width.px': 12,
                                            'height.px': 10
                                        }"
                                    ></svg-icon>
                                </span>

                                <span
                                    ngbTooltip
                                    mainTooltip="Cancel"
                                    tooltipBackground="#CCCCCC"
                                    tooltipColor="#2F2F2F"
                                    customClass="mb-2"
                                    position="top"
                                    type="button"
                                    (click)="openEditComment(false)"
                                    class="cancel-tooltip d-flex align-items-center justify-content-center"
                                >
                                    <svg-icon
                                        class="cancel-icon d-flex align-items-center justify-content-center"
                                        [src]="
                                            'assets/svg/applicant/invalid-review-x.svg'
                                        "
                                        [svgStyle]="{
                                            'width.px': 10,
                                            'height.px': 10
                                        }"
                                    ></svg-icon>
                                </span>
                            </div>
                        </div>

                        <span class="ta-font-medium muted-text"
                            >Edit Comment</span
                        >
                    </div>
                </div>

                <div
                    #editCommentEl
                    [contentEditable]="true"
                    spellcheck="false"
                    class="edit-textarea"
                    (paste)="onPaste($event)"
                ></div>
            </div>
        </div>
    </ng-container>
</ng-container>
