<!------------------------------------------------- OWNER FLEET DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'owner'">
    <div
        [ngbPopover]="dropdownOwnerFleet"
        #ownerDropdown="ngbPopover"
        [autoClose]="'outside'"
        class="table-dropdown-container"
        [placement]="['bottom-left']"
        popoverClass="table-dropdown-popover"
        triggers="manual"
        (click)="toggleDropdownOwnerFleet(ownerDropdown, filteredData)"
        [ngClass]="ownerDropdown.isOpen() ? 'owner-dropdown-opened' : ''"
    >
        <div class="fleet-holder d-flex">
            <div class="ta-font-semi-bold d-flex fleet align-items-center">
                <svg-icon
                    class="d-flex justify-content-center svg-holder"
                    [src]="'assets/svg/common/dropdown-truck.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.truckCount
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.truckCount
                    }"
                >
                    {{ filteredData.truckCount }}
                </span>
            </div>

            <div class="ta-font-semi-bold d-flex fleet align-items-center">
                <svg-icon
                    class="d-flex justify-content-center svg-holder"
                    [src]="'assets/svg/common/dropdown-trailer.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.trailerCount
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.trailerCount
                    }"
                >
                    {{ filteredData.trailerCount }}
                </span>
            </div>
        </div>
    </div>
</ng-container>

<!------------------------------------------------- COMMENTS DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'comment'">
    <div
        class="comment-button"
        [ngClass]="commentsDropdown.isOpen() ? 'comments-dropdown-opened' : ''"
    >
        <div
            [ngbPopover]="dropdownComments"
            #commentsDropdown="ngbPopover"
            [autoClose]="'outside'"
            [placement]="['bottom-left', 'bottom-right']"
            popoverClass="table-dropdown-popover"
            triggers="manual"
            class="comments-popover d-flex align-items-center justify-content-center"
            (click)="toggleDropdownComments(commentsDropdown, filteredData)"
        >
            <span class="comment-number ta-font-semi-bold">{{
                _data?.commentsCount
            }}</span>
            <svg-icon
                [src]="svg"
                [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
            ></svg-icon>

            <!-- Show notification if there is new comment -->
            <ng-container *ngIf="_data?.commentsCount > 0">
                <svg-icon
                    class="notification"
                    [src]="'assets/svg/applicant/notification-light.svg'"
                ></svg-icon>
            </ng-container>
        </div>
    </div>
</ng-container>

<!------------------------------------------------- CONTACTS DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'contacts'">
    <div class="comment-button">
        <div
            [ngbPopover]="dropdownContacts"
            #contactsDropdown="ngbPopover"
            [autoClose]="'outside'"
            [placement]="['bottom-left', 'bottom-right']"
            popoverClass="table-dropdown-popover"
            triggers="manual"
            class="table-dropdown-container"
            (click)="toggleDropdownContacts(contactsDropdown, filteredData)"
        >
            <div class="d-flex justify-content-between fleet-holder">
                <div class="ta-font-semi-bold d-flex fleet align-items-center">
                    <svg-icon
                        class="d-flex justify-content-center svg-holder"
                        [src]="
                            'assets/svg/truckassist-table/constacts/shared.svg'
                        "
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                    ></svg-icon>

                    <span class="d-flex justify-content-center">2</span>
                </div>

                <div class="ta-font-semi-bold d-flex fleet align-items-center">
                    <svg-icon
                        class="d-flex justify-content-center svg-holder"
                        [src]="
                            'assets/svg/truckassist-table/constacts/people.svg'
                        "
                        [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                    ></svg-icon>

                    <span class="d-flex justify-content-center">5</span>
                </div>
            </div>
        </div>
    </div>
</ng-container>

<!------------------------------------------------- RATING DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'rating-shipper'">
    <div
        [ngbPopover]="ratingShipper"
        #shipperRating="ngbPopover"
        [autoClose]="'outside'"
        class="table-dropdown-container"
        [placement]="['bottom-left']"
        popoverClass="table-dropdown-popover"
        triggers="manual"
        (click)="toggleDropdownRating(shipperRating, filteredData)"
        [ngClass]="
            shipperRating.isOpen()
                ? 'owner-dropdown-opened rating-dropdown-opened'
                : ''
        "
    >
        <div class="fleet-holder gap-big d-flex">
            <!-- like -->
            <div class="ta-font-semi-bold d-flex fleet align-items-center">
                <svg-icon
                    class="d-flex justify-content-center svg-holder"
                    [src]="'assets/svg/common/ic_like.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.total.totalLikes,
                        'user-liked': filteredData.total.liked
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.total.totalLikes
                    }"
                >
                    {{ filteredData.total.totalLikes }}
                </span>
            </div>

            <!-- dislike -->
            <div class="ta-font-semi-bold d-flex fleet align-items-center">
                <svg-icon
                    class="d-flex justify-content-center svg-holder"
                    [src]="'assets/svg/common/ic_dislike.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.total.totalDislikes,
                        'user-disliked': filteredData.total.disliked
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.total.totalDislikes
                    }"
                >
                    {{ filteredData.total.totalDislikes }}
                </span>
            </div>

            <div class="ta-font-semi-bold d-flex fleet align-items-center">
                <svg-icon
                    class="d-flex justify-content-center svg-holder align-items-center"
                    [src]="'assets/svg/common/review-pen.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.total.totalComments
                    }"
                    [svgStyle]="{
                        'width.px': 14,
                        'height.px': 14
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.total.totalComments
                    }"
                >
                    {{ filteredData.total.totalComments }}
                </span>
            </div>
        </div>
    </div>
</ng-container>

<!------------------------------------------------- OWNER FLEET DROPDOWN ----------------------------------------------------------------->
<ng-template #dropdownOwnerFleet let-ownerFleet="data">
    <div class="table-list-dropdown">
        <div class="table-inner">
            <!-- Head of dropdown -->
            <div class="description-titles d-flex justify-content-between">
                <div class="d-flex align-items-center gap">
                    <p
                        class="dropdown-left m-0 ta-font-extra-bold d-flex align-items-center text-white"
                    >
                        FLEET
                    </p>

                    <span
                        class="total-number-fleet count d-flex align-items-center"
                    >
                        <span class="counter ta-font-extra-bold text-white">
                            {{
                                ownerFleet.truckCount + ownerFleet.trailerCount
                            }}
                        </span>
                    </span>
                </div>
            </div>

            <!-- Input Search -->
            <div class="input-holder">
                <input
                    placeholder="Search"
                    (keyup)="filterArrayOwner($event)"
                    class="input-search"
                    spellcheck="false"
                />
                <svg-icon
                    class="search-icon"
                    [src]="'assets/svg/common/ic_search.svg'"
                ></svg-icon>
            </div>

            <div
                class="scroll-input-drodpwon"
                [ngClass]="{ 'height-truck-colapsed': truckDropdown }"
            >
                <!-- Trucks Body-->
                <ng-container *ngIf="ownerFleet.truckCount > 0">
                    <div class="fleet-container d-flex flex-column">
                        <!-- Body Head -->
                        <div
                            class="d-flex align-items-center justify-content-between gap toogle-dropdown"
                            (click)="
                                toggleDropdownTruckTrailer(
                                    'Truck',
                                    !truckDropdown
                                )
                            "
                        >
                            <div class="d-flex align-items-center">
                                <span class="ta-font-bold muted body-item-title"
                                    >TRUCK</span
                                >
                                <span
                                    class="text-white count d-flex align-items-center"
                                >
                                    <span class="counter ta-font-bold">
                                        <ng-container
                                            *ngIf="filteredTruckCount"
                                        >
                                            {{ filteredTruckCount }} of
                                        </ng-container>

                                        {{ ownerFleet.truckCount }}
                                    </span>
                                </span>
                            </div>

                            <div
                                class="open-close-dropdown-icon"
                                [ngClass]="{ rotate: truckDropdown }"
                            >
                                <svg-icon
                                    [src]="
                                        'assets/svg/common/dropdown-arrow.svg'
                                    "
                                ></svg-icon>
                            </div>
                        </div>

                        <!-- Body Items -->
                        <div
                            class="items-holder"
                            [ngClass]="{ 'hide-dropdown-items': truckDropdown }"
                        >
                            <ng-container
                                *ngFor="
                                    let truck of ownerFleet.trucks;
                                    let i = id;
                                    trackBy: trackByIdentity
                                "
                            >
                                <div
                                    class="table-list-dropdown-content-container d-flex"
                                    (click)="
                                        goToDetailsPage(
                                            truck,
                                            '/list/truck/' +
                                                truck.id +
                                                '/details'
                                        )
                                    "
                                >
                                    <div
                                        class="dropdown-animate d-flex align-items-center"
                                    >
                                        <!-- Truck Svg -->
                                        <div class="type-icon">
                                            <svg-icon
                                                [src]="
                                                    'assets/svg/common/trucks/' +
                                                    truck?.truckType.logoName
                                                "
                                            ></svg-icon>
                                        </div>

                                        <div
                                            class="text-white"
                                            [innerHTML]="
                                                highlightPartOfTheTextString(
                                                    truck.truckNumber
                                                ) | safeHtml
                                            "
                                        ></div>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </ng-container>

                <!-- Separator -->
                <ng-container *ngIf="ownerFleet.trailerCount">
                    <div class="separator"></div>
                </ng-container>

                <!-- Trailer Body -->
                <ng-container *ngIf="ownerFleet.trailerCount">
                    <div class="fleet-container d-flex flex-column">
                        <!-- Body Head -->

                        <div
                            class="d-flex align-items-center justify-content-between gap toogle-dropdown"
                            (click)="
                                toggleDropdownTruckTrailer(
                                    'Trailer',
                                    !trailerDropdown
                                )
                            "
                        >
                            <div class="d-flex align-items-center">
                                <span class="ta-font-bold muted body-item-title"
                                    >TRAILER</span
                                >

                                <span
                                    class="text-white count d-flex align-items-center"
                                >
                                    <span class="counter ta-font-bold">
                                        <ng-container
                                            *ngIf="filteredTrailerCount"
                                        >
                                            {{ filteredTrailerCount }} of
                                        </ng-container>

                                        {{ ownerFleet.trailerCount }}
                                    </span>
                                </span>
                            </div>

                            <div
                                class="open-close-dropdown-icon"
                                [ngClass]="{ rotate: trailerDropdown }"
                            >
                                <svg-icon
                                    [src]="
                                        'assets/svg/common/dropdown-arrow.svg'
                                    "
                                ></svg-icon>
                            </div>
                        </div>

                        <!-- Body -->
                        <div
                            class="items-holder"
                            [ngClass]="{
                                'hide-dropdown-items': trailerDropdown
                            }"
                        >
                            <ng-container
                                *ngFor="
                                    let trailer of ownerFleet.trailers;
                                    let i = index
                                "
                            >
                                <div
                                    class="table-list-dropdown-content-container d-flex"
                                    (click)="
                                        goToDetailsPage(
                                            trailer,
                                            '/list/trailer/' +
                                                trailer.id +
                                                '/details'
                                        )
                                    "
                                >
                                    <div
                                        class="dropdown-animate d-flex align-items-center"
                                    >
                                        <!-- Trailer Svg -->
                                        <div class="type-icon">
                                            <svg-icon
                                                [src]="
                                                    'assets/svg/common/trailers/' +
                                                    trailer?.trailerType
                                                        .logoName
                                                "
                                            ></svg-icon>
                                        </div>

                                        <div
                                            class="text-white"
                                            [innerHTML]="
                                                highlightPartOfTheTextString(
                                                    trailer.trailerNumber
                                                ) | safeHtml
                                            "
                                        ></div>
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>
</ng-template>

<!------------------------------------------------- COMMENTS DROPDOWN ----------------------------------------------------------------->
<ng-template #dropdownComments let-commmentsData="commentData">
    <div class="table-list-dropdown comments-width">
        <div class="table-inner">
            <!-- Head of dropdown -->

            <div class="description-titles d-flex justify-content-between">
                <div class="d-flex align-items-center gap">
                    <p
                        class="dropdown-left m-0 ta-font-extra-bold d-flex align-items-center text-white"
                    >
                        COMMENT
                    </p>

                    <span
                        class="total-number-fleet count d-flex align-items-center"
                    >
                        <span class="counter ta-font-extra-bold text-white">
                            {{ _data?.commentsCount }}
                        </span>
                    </span>
                </div>

                <div class="filter-drodpown d-flex">
                    <span class="filter-date ta-font-medium">Date</span>

                    <svg-icon
                        class="svg-date"
                        [src]="'assets/svg/sort-by-descending.svg'"
                    ></svg-icon>
                </div>
            </div>

            <!-- Input Search -->
            <div class="input-holder">
                <input
                    [placeholder]="searchPlaceholder"
                    (keyup)="filterArrayCommentsRating($event, 'comments')"
                    class="input-search"
                    spellcheck="false"
                />
                <svg-icon
                    class="search-icon"
                    [src]="'assets/svg/common/ic_search.svg'"
                ></svg-icon>
            </div>

            <!-- Add new comment button -->
            <app-ta-new-comment
                [commmentsData]="commmentsData"
            ></app-ta-new-comment>

            <!-- Display comments -->
            <div class="comments-holder">
                <ng-container
                    *ngFor="
                        let comment of commmentsData.comments;
                        let i = id;
                        trackBy: trackByIdentity
                    "
                >
                    <app-ta-comment
                        [commentCardsDataDropdown]="comment"
                        [commentHighlight]="lattersToHighlight"
                        [commentsCardId]="commmentsData.id"
                        (closeDropdown)="closeDropdownFromComment($event)"
                    ></app-ta-comment>
                </ng-container>
            </div>
        </div>
    </div>
</ng-template>

<!------------------------------------------------- CONTACTS DROPDOWN ----------------------------------------------------------------->
<ng-template #dropdownContacts let-contacts="contacts">
    <div class="table-list-dropdown comments-width">
        <div class="table-inner">
            <!-- Head of dropdown -->
            <div class="description-titles d-flex justify-content-between">
                <div class="d-flex align-items-center gap">
                    <p
                        class="dropdown-left m-0 ta-font-extra-bold d-flex align-items-center text-white"
                    >
                        SHARED
                    </p>

                    <span
                        class="total-number-fleet count d-flex align-items-center"
                    >
                        <span class="counter ta-font-extra-bold text-white">
                            7
                        </span>
                    </span>
                </div>

                <div class="filter-drodpown d-flex">
                    <span class="filter-date ta-font-medium">Name</span>

                    <svg-icon
                        class="svg-date"
                        [src]="'assets/svg/sort-by-descending.svg'"
                    ></svg-icon>
                </div>
            </div>

            <!-- Input Search -->
            <div class="input-holder">
                <input
                    placeholder="Search"
                    (keyup)="filterArrayOwner($event)"
                    class="input-search"
                    spellcheck="false"
                />
                <svg-icon
                    class="search-icon"
                    [src]="'assets/svg/common/ic_search.svg'"
                ></svg-icon>
            </div>

            <div class="d-flex align-items-center">
                <div class="fleet-container d-flex flex-column">
                    <div class="d-flex align-items-center">
                        <span class="ta-font-bold muted body-item-title">{{
                            contacts[0].name | uppercase
                        }}</span>

                        <span
                            class="text-white count d-flex align-items-center"
                        >
                            <span class="counter ta-font-bold">
                                {{ contacts[0].count }}
                            </span>
                        </span>
                    </div>

                    <div class="separator"></div>

                    <ng-container
                        *ngFor="
                            let contact of contacts[0].companyUsers;
                            let i = id;
                            trackBy: trackByIdentity
                        "
                    >
                        <span class="text-white shared-full-name">
                            {{ contact.fullName }}
                        </span>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<!------------------------------------------------- RATING DROPDOWN ----------------------------------------------------------------->
<ng-template #ratingShipper let-rating="rating">
    <div class="table-list-dropdown comments-width">
        <div class="table-inner">
            <!-- Title -->
            <div class="description-titles d-flex justify-content-between">
                <div class="d-flex align-items-center gap">
                    <p
                        class="dropdown-left m-0 ta-font-extra-bold d-flex align-items-center text-white"
                    >
                        RATING & REVIEW
                    </p>

                    <span
                        class="total-number-fleet count d-flex align-items-center"
                    >
                        <span class="counter ta-font-extra-bold text-white">
                            7
                        </span>
                    </span>
                </div>

                <div class="filter-drodpown d-flex">
                    <span class="filter-date ta-font-medium">Date</span>

                    <svg-icon
                        class="svg-date"
                        [src]="'assets/svg/sort-by-descending.svg'"
                    ></svg-icon>
                </div>
            </div>

            <!-- Input Search -->
            <div class="input-holder">
                <input
                    placeholder="Search"
                    (keyup)="filterArrayCommentsRating($event, 'rating')"
                    class="input-search"
                    spellcheck="false"
                />
                <svg-icon
                    class="search-icon"
                    [src]="'assets/svg/common/ic_search.svg'"
                ></svg-icon>
            </div>

            <!-- Tabs -->
            <app-ta-tab-switch
                [tabs]="tabs"
                (switchClicked)="onPrefferedLoadCheck($event)"
                [type]="'rating-review'"
            >
            </app-ta-tab-switch>

            <!-- Add new comment button -->
            <ng-container *ngIf="!loggedUserCommented">
                <app-ta-new-comment
                    [commmentsData]="rating"
                ></app-ta-new-comment>
            </ng-container>

            <!-- Body -->
            <div class="d-flex align-items-center">
                <div class="fleet-container d-flex flex-column">
                    <ng-container
                        *ngFor="
                            let review of rating.rating;
                            let i = id;
                            trackBy: trackByIdentity
                        "
                    >
                        <app-ta-comment
                            [commentCardsDataDropdown]="review"
                            [commentHighlight]="lattersToHighlight"
                            [commentsCardId]="review.id"
                            (closeDropdown)="closeDropdownFromComment($event)"
                        ></app-ta-comment>
                    </ng-container>
                </div>
            </div>
        </div>
    </div>
</ng-template>

<!------------------------------------------------- CARD MODAL DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'cards-modal'">
    <div class="modal-body-holder d-grid">
        <ng-container *ngIf="defaultValue || emptyValue">
            <!-- Input Search -->
            <div class="input-holder">
                <div
                    [ngbPopover]="cardsModalInputDropdown"
                    #cardsModal="ngbPopover"
                    [autoClose]="'outside'"
                    class="table-dropdown-container modal-cards-popover d-flex align-items-center"
                    [placement]="['bottom-left']"
                    popoverClass="table-dropdown-popover"
                    triggers="manual"
                    (click)="
                        toggleCardsModalDropdown(
                            cardsModal,
                            filteredCardsModalData
                        )
                    "
                >
                    <ng-container *ngIf="defaultValue">
                        <input
                            [placeholder]="defaultValue.title"
                            (keyup)="filterArrayCardsModalDropdown($event)"
                            class="input-search cards-modal"
                            spellcheck="false"
                        />
                    </ng-container>

                    <ng-container *ngIf="!defaultValue">
                        <input
                            [placeholder]="emptyValue"
                            (keyup)="filterArrayCardsModalDropdown($event)"
                            class="input-search cards-modal empty-input"
                            spellcheck="false"
                        />
                    </ng-container>
                    <svg-icon
                        class="dropdown-icon"
                        [ngClass]="{ 'empty-svg': !defaultValue }"
                        [src]="'assets/svg/common/arrow-right-details.svg'"
                        [style.width.px]="10"
                        [style.height.px]="6"
                    ></svg-icon>
                </div>
            </div>
        </ng-container>
    </div>
</ng-container>

<!------------------------------------------------- CARD MODAL DROPDOWN ----------------------------------------------------------------->
<ng-template #cardsModalInputDropdown let-titles="titles">
    <div class="table-list-dropdown modals-width">
        <div class="table-inner-modal d-grid">
            <ng-container
                *ngFor="let title of titles; trackBy: trackByIdentity"
            >
                <!-- If selected title is equal to title in loop -->
                <ng-contaner *ngIf="title.title === defaultValue.title">
                    <div class="title-holder d-flex align-items-center">
                        <span class="selected-input ta-font-bold">
                            {{ title.title }}
                        </span>

                        <svg-icon
                            class="checked svg-icons"
                            [src]="'assets/svg/truckassist-table/check-new.svg'"
                            [style.width.px]="14"
                            [style.height.px]="14"
                        ></svg-icon>
                    </div>
                </ng-contaner>

                <!-- If it is not selected title -->
                <ng-contaner *ngIf="!title.selected">
                    <div class="title-holder d-flex align-items-center">
                        <span class="text-white">
                            {{ title.title }}
                        </span>
                    </div>
                </ng-contaner>

                <!-- If it is any selected title -->
                <ng-contaner
                    *ngIf="title.selected && title.title !== defaultValue.title"
                >
                    <div class="title-holder d-flex align-items-center">
                        <span
                            class="selected-in-other-input"
                            [formControl]="getSuperControl"
                        >
                            {{ title.title }}
                        </span>

                        <svg-icon
                            class="disabled svg-icons"
                            [src]="'assets/svg/common/ic_disable.svg'"
                            [style.width.px]="13"
                            [style.height.px]="13"
                        ></svg-icon>
                    </div>
                </ng-contaner>
            </ng-container>
        </div>
    </div>
</ng-template>
