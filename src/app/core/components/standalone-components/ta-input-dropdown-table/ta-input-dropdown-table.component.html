<!------------------------------------------------- OWNER FLEET DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'owner'">
    <div
        [ngbPopover]="dropdownOwnerFleet"
        #ownerDropdown="ngbPopover"
        [autoClose]="'outside'"
        class="table-dropdown-container"
        [placement]="['bottom-left']"
        popoverClass="table-dropdown-popover"
        triggers="manual"
        (click)="toggleDropdownOwnerFleet(ownerDropdown, filteredData)"
        [ngClass]="ownerDropdown.isOpen() ? 'owner-dropdown-opened' : ''"
    >
        <div class="fleet-holder d-flex">
            <div class="ta-font-semi-bold d-flex fleet align-items-center">
                <svg-icon
                    class="d-flex justify-content-center svg-holder"
                    [src]="'assets/svg/common/dropdown-truck.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.truckCount
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.truckCount
                    }"
                >
                    {{ filteredData.truckCount }}
                </span>
            </div>

            <div class="ta-font-semi-bold d-flex fleet align-items-center">
                <svg-icon
                    class="d-flex justify-content-center svg-holder"
                    [src]="'assets/svg/common/dropdown-trailer.svg'"
                    [ngClass]="{
                        'no-count': !filteredData.trailerCount
                    }"
                ></svg-icon>

                <span
                    class="d-flex justify-content-center"
                    [ngClass]="{
                        'no-count-text': !filteredData.trailerCount
                    }"
                >
                    {{ filteredData.trailerCount }}
                </span>
            </div>
        </div>
    </div>
</ng-container>

<!------------------------------------------------- COMMENTS DROPDOWN ----------------------------------------------------------------->
<ng-container *ngIf="type === 'comment'">
    <div
        class="comment-button"
        [ngClass]="commentsDropdown.isOpen() ? 'comments-dropdown-opened' : ''"
    >
        <div
            [ngbPopover]="dropdownComments"
            #commentsDropdown="ngbPopover"
            [autoClose]="'outside'"
            [placement]="['bottom-left', 'bottom-right']"
            popoverClass="table-dropdown-popover"
            triggers="manual"
            class="comments-popover d-flex align-items-center justify-content-center"
            (click)="toggleDropdownComments(commentsDropdown, filteredData)"
        >
            <span class="comment-number ta-font-semi-bold">{{
                _data?.commentsCount
            }}</span>
            <svg-icon
                [src]="svg"
                [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
            ></svg-icon>

            <!-- Show notification if there is new comment -->
            <ng-container *ngIf="_data?.commentsCount > 0">
                <svg-icon
                    class="notification"
                    [src]="'assets/svg/applicant/notification-light.svg'"
                ></svg-icon>
            </ng-container>
        </div>
    </div>
</ng-container>

<!------------------------------------------------- COMMENTS DROPDOWN ----------------------------------------------------------------->
<ng-template #dropdownComments let-commmentsData="commentData">
    <div class="table-list-dropdown comments-width">
        <div class="table-inner">
            <!-- Head of dropdown -->

            <div class="description-titles d-flex justify-content-between">
                <div class="d-flex align-items-center gap">
                    <p
                        class="dropdown-left m-0 ta-font-extra-bold d-flex align-items-center text-white"
                    >
                        COMMENT
                    </p>

                    <span
                        class="total-number-fleet count d-flex align-items-center"
                    >
                        <span class="counter ta-font-extra-bold text-white">
                            {{ commmentsData?.commentsCount }}
                        </span>
                    </span>
                </div>
            </div>

            <!-- Input Search -->
            <div class="input-holder">
                <input
                    [placeholder]="searchPlaceholder"
                    (keyup)="filterArrayComments($event)"
                    class="input-search"
                />
                <svg-icon
                    class="search-icon"
                    [src]="'assets/svg/common/ic_search.svg'"
                ></svg-icon>
            </div>

            <!-- Add new comment button -->
            <ng-container *ngIf="!openNewComment">
                <div
                    class="add-new-comment d-flex justify-content-between align-items-center"
                    (click)="newComment('open-new-comment', commmentsData.id)"
                >
                    <span class="new-comment ta-font-bold">NEW COMMENT</span>
                    <svg-icon
                        [src]="'assets/svg/common/ic_plus.svg'"
                    ></svg-icon>
                </div>
            </ng-container>

            <!-- Add new comment input -->
            <ng-container *ngIf="openNewComment">
                <div class="add-comment">
                    <div class="d-flex justify-content-between">
                        <div class="user-creds d-flex">
                            <div class="user-avatar">
                                <img
                                    src="{{
                                        'data:image/jpg;base64,' + user?.avatar
                                    }}"
                                    alt=""
                                />
                            </div>

                            <div class="user-name d-grid">
                                <span class="title ta-font-semi-bold">{{
                                    user.firstName + ' ' + user.lastName
                                }}</span>

                                <span class="muted ta-font-medium"
                                    >New Comment</span
                                >
                            </div>
                        </div>

                        <div class="user-icons d-flex">
                            <span
                                ngbTooltip
                                mainTooltip="Confirm"
                                type="button"
                                tooltipBackground="#424242"
                                position="top"
                                class="confirm-tooltip d-flex align-items-center justify-content-center"
                                [tooltipClass]="customClass"
                            >
                                <svg-icon
                                    class="confirm-icon d-flex align-items-center justify-content-center"
                                    [src]="'assets/svg/applicant/check.svg'"
                                    (click)="
                                        newComment(
                                            'add-new-comment',
                                            commmentsData.id
                                        )
                                    "
                                    [svgStyle]="{
                                        'width.px': 12,
                                        'height.px': 10
                                    }"
                                ></svg-icon>
                            </span>

                            <span
                                ngbTooltip
                                mainTooltip="Cancel"
                                tooltipBackground="#424242"
                                position="top"
                                type="button"
                                (click)="openNewComment = false"
                                class="cancel-tooltip d-flex align-items-center justify-content-center"
                            >
                                <svg-icon
                                    class="cancel-icon d-flex align-items-center justify-content-center"
                                    [src]="
                                        'assets/svg/applicant/invalid-review-x.svg'
                                    "
                                    [svgStyle]="{
                                        'width.px': 10,
                                        'height.px': 10
                                    }"
                                ></svg-icon>
                            </span>
                        </div>
                    </div>
                    <textarea
                        #textareaRefValue
                        rows="4"
                        cols="50"
                        class="edit-textarea"
                        (keyup)="adjustTextareaHeight($event.target)"
                        placeholder="Write Comment..."
                        spellcheck="false"
                    ></textarea>
                </div>
            </ng-container>

            <!-- Display comments -->
            <div class="comments-holder">
                <ng-container
                    *ngFor="
                        let comment of commmentsData.comments;
                        let i = index;
                        trackBy: trackByIdentity
                    "
                >
                    <app-ta-comment
                        [commentCardsDataDropdown]="comment"
                        [commentHighlight]="lattersToHighlight"
                        [commentsCardId]="commmentsData.id"
                    ></app-ta-comment>
                </ng-container>
            </div>
        </div>
    </div>
</ng-template>

<!------------------------------------------------- OWNER FLEET DROPDOWN ----------------------------------------------------------------->
<ng-template #dropdownOwnerFleet let-ownerFleet="data">
    <div class="table-list-dropdown">
        <!-- Head of dropdown -->
        <div class="description-titles d-flex justify-content-between">
            <div class="d-flex align-items-center gap">
                <p
                    class="dropdown-left m-0 ta-font-extra-bold d-flex align-items-center text-white"
                >
                    FLEET
                </p>

                <span
                    class="total-number-fleet count d-flex align-items-center"
                >
                    <span class="counter ta-font-extra-bold text-white">
                        {{ ownerFleet.truckCount + ownerFleet.trailerCount }}
                    </span>
                </span>
            </div>
        </div>

        <!-- Input Search -->
        <div class="input-holder">
            <input
                placeholder="Search"
                (keyup)="filterArrayOwner($event)"
                class="input-search"
            />
            <svg-icon
                class="search-icon"
                [src]="'assets/svg/common/ic_search.svg'"
            ></svg-icon>
        </div>

        <div
            class="scroll-input-drodpwon"
            [ngClass]="{ 'height-truck-colapsed': truckDropdown }"
        >
            <!-- Trucks Body-->
            <ng-container *ngIf="ownerFleet.truckCount > 0">
                <div class="fleet-container d-flex flex-column">
                    <!-- Body Head -->
                    <div
                        class="d-flex align-items-center justify-content-between gap toogle-dropdown"
                        (click)="
                            toggleDropdownTruckTrailer('Truck', !truckDropdown)
                        "
                    >
                        <div class="d-flex align-items-center">
                            <span class="ta-font-bold muted body-item-title"
                                >TRUCK</span
                            >
                            <span
                                class="text-white count d-flex align-items-center"
                            >
                                <span class="counter ta-font-bold">
                                    <ng-container *ngIf="filteredTruckCount">
                                        {{ filteredTruckCount }} of
                                    </ng-container>

                                    {{ ownerFleet.truckCount }}
                                </span>
                            </span>
                        </div>

                        <div
                            class="open-close-dropdown-icon"
                            [ngClass]="{ rotate: truckDropdown }"
                        >
                            <svg-icon
                                [src]="'assets/svg/common/dropdown-arrow.svg'"
                            ></svg-icon>
                        </div>
                    </div>

                    <!-- Body Items -->
                    <div
                        class="items-holder"
                        [ngClass]="{ 'hide-dropdown-items': truckDropdown }"
                    >
                        <ng-container
                            *ngFor="
                                let truck of ownerFleet.trucks;
                                let i = index
                            "
                        >
                            <div
                                class="table-list-dropdown-content-container d-flex"
                                (click)="
                                    goToDetailsPage(
                                        truck,
                                        '/list/truck/' + truck.id + '/details'
                                    )
                                "
                            >
                                <div
                                    class="dropdown-animate d-flex align-items-center"
                                >
                                    <!-- Truck Svg -->
                                    <div class="type-icon">
                                        <svg-icon
                                            [src]="
                                                'assets/svg/common/trucks/' +
                                                truck?.truckType.logoName
                                            "
                                        ></svg-icon>
                                    </div>

                                    <div
                                        class="text-white"
                                        [innerHTML]="
                                            highlightPartOfTheTextString(
                                                truck.truckNumber
                                            ) | safeHtml
                                        "
                                    ></div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </ng-container>

            <!-- Separator -->
            <ng-container *ngIf="ownerFleet.trailerCount">
                <div class="separator"></div>
            </ng-container>

            <!-- Trailer Body -->
            <ng-container *ngIf="ownerFleet.trailerCount">
                <div class="fleet-container d-flex flex-column">
                    <!-- Body Head -->

                    <div
                        class="d-flex align-items-center justify-content-between gap toogle-dropdown"
                        (click)="
                            toggleDropdownTruckTrailer(
                                'Trailer',
                                !trailerDropdown
                            )
                        "
                    >
                        <div class="d-flex align-items-center">
                            <span class="ta-font-bold muted body-item-title"
                                >TRAILER</span
                            >

                            <span
                                class="text-white count d-flex align-items-center"
                            >
                                <span class="counter ta-font-bold">
                                    <ng-container *ngIf="filteredTrailerCount">
                                        {{ filteredTrailerCount }} of
                                    </ng-container>

                                    {{ ownerFleet.trailerCount }}
                                </span>
                            </span>
                        </div>

                        <div
                            class="open-close-dropdown-icon"
                            [ngClass]="{ rotate: trailerDropdown }"
                        >
                            <svg-icon
                                [src]="'assets/svg/common/dropdown-arrow.svg'"
                            ></svg-icon>
                        </div>
                    </div>

                    <!-- Body -->
                    <div
                        class="items-holder"
                        [ngClass]="{ 'hide-dropdown-items': trailerDropdown }"
                    >
                        <ng-container
                            *ngFor="
                                let trailer of ownerFleet.trailers;
                                let i = index
                            "
                        >
                            <div
                                class="table-list-dropdown-content-container d-flex"
                                (click)="
                                    goToDetailsPage(
                                        trailer,
                                        '/list/trailer/' +
                                            trailer.id +
                                            '/details'
                                    )
                                "
                            >
                                <div
                                    class="dropdown-animate d-flex align-items-center"
                                >
                                    <!-- Trailer Svg -->
                                    <div class="type-icon">
                                        <svg-icon
                                            [src]="
                                                'assets/svg/common/trailers/' +
                                                trailer?.trailerType.logoName
                                            "
                                        ></svg-icon>
                                    </div>

                                    <div
                                        class="text-white"
                                        [innerHTML]="
                                            highlightPartOfTheTextString(
                                                trailer.trailerNumber
                                            ) | safeHtml
                                        "
                                    ></div>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>
</ng-template>
