<div class="navigation">
    <div
        class="nav-holder"
        #navbar
        [ngClass]="isNavigationHovered == true ? 'dark-nav' : 'animation'"
    >
        <div class="navigation-top">
            <app-navigation-header
                (click)="onHoveredNavigation(true)"
                [isNavigationHovered]="isNavigationHovered"
            ></app-navigation-header>

            <app-navigation-modals
                (click)="onHoveredNavigation(true)"
                [isNavigationHoveredAndPanelOpen]="
                    isModalPanelOpen && isNavigationHovered
                "
                [isModalPanelOpen]="isModalPanelOpen"
                [isNavigationHovered]="isNavigationHovered"
            ></app-navigation-modals>
        </div>

        <div
            class="navigation-middle"
            (mouseenter)="onMidleNavHover(true); onFooterHover(false)"
            (mouseleave)="onMidleNavHover(false); onFooterHover(false)"
        >
            <div
                class="navigation-routes"
                *ngFor="
                    let item of navigation;
                    let ind = index;
                    trackBy: identity
                "
                [ngClass]="{
                    'new-magic-line-selected':
                        isActiveRouteOnReload(item.name) ||
                        selectedRoute == item.name
                }"
            >
                <app-navigation-route
                    [activeLink]="item.isRouteActive"
                    *ngIf="!item.arrow"
                    [class]="'close'"
                    [route]="item"
                    [message]="item.messages"
                    [index]="index"
                    [files]="item.files"
                    [isActiveFooterRoute]="isActiveFooterRoute"
                    [isNavigationHovered]="isNavigationHovered"
                    [isActiveSubroute]="isActiveSubroute"
                    (onRouteEvent)="onRouteEvent($event)"
                    [selectedRoute]="selectedRoute"
                    [selectedSubRoute]="selectedSubRoute"
                    [middleIsHovered]="middleIsHovered"
                    (itemIndex)="routeIndex($event)"
                >
                </app-navigation-route>

                <!-- If route has subroutes -->
                <app-navigation-subroute-card
                    (click)="
                        onHoveredNavigation(true);
                        getIndex(ind);
                        dropdownOpened(item.isRouteActive)
                    "
                    *ngIf="item.arrow"
                    (subrouteContainerActive)="isSubrouteContainerOpen($event)"
                    [isRouteActive]="item.isRouteActive"
                    [isNavigationCardActive]="
                        isNavigationHovered &&
                        closeDropdownOnNavClose &&
                        subrouteClicked &&
                        !isModalPanelOpen &&
                        !isUserPanelOpen &&
                        !isSettingsPanelOpen &&
                        !isUserCompanyDetailsOpen
                    "
                    [slowAnimation]="
                        !isSettingsPanelOpen &&
                        !isActiveSubroute &&
                        !isUserPanelOpen &&
                        !isModalPanelOpen &&
                        !openedDropdown
                    "
                    [contentHeight]="item.route.length"
                >
                    <app-navigation-route
                        class="subroute-item"
                        [route]="item"
                        [hideSubrouteTitle]="hideSubrouteTitle"
                        (hideSubrouteFromChild)="hideSubrouteFromChild($event)"
                        [openedDropdown]="openedDropdown"
                        [subrouteContainerOpened]="subrouteContainerOpened"
                        [selectedRoute]="selectedRoute"
                        [activeLink]="item.isRouteActive && isNavigationHovered"
                        [isSettingsPanelOpen]="isSettingsPanelOpen"
                        [isUserPanelOpen]="isUserPanelOpen"
                        [isNavigationHovered]="isNavigationHovered"
                        [closeDropdownOnNavClose]="
                            closeDropdownOnNavClose && subrouteClicked
                        "
                        [isActiveSubroute]="isActiveSubroute"
                        (onRouteEvent)="onRouteEvent($event)"
                        (itemIndex)="routeIndex($event)"
                        (routeWithSubRouteClicked)="
                            routeWithSubRouteClicked($event)
                        "
                        [ind]="ind"
                    >
                    </app-navigation-route>

                    <app-navigation-subroute
                        [openCloseContainer]="
                            isNavigationHovered &&
                            item.isRouteActive &&
                            !isModalPanelOpen &&
                            closeDropdownOnNavClose &&
                            !isUserPanelOpen &&
                            !isSettingsPanelOpen &&
                            !isUserCompanyDetailsOpen &&
                            subrouteClicked
                        "
                        [subroute]="item"
                        [selectedSubRoute]="selectedSubRoute"
                        [isActiveSubroute]="isActiveSubroute"
                        [isNavigationHovered]="isNavigationHovered"
                        [otherContainerOpened]="openedDropdown"
                        (onSubrouteActiveEvent)="onRouteEvent($event)"
                        (subRouteIndex)="routeIndex($event)"
                    >
                    </app-navigation-subroute>
                </app-navigation-subroute-card>
            </div>
            <div
                *ngIf="
                    (middleIsHovered &&
                        !isSettingsPanelOpen &&
                        !isActiveSubroute &&
                        !isUserPanelOpen &&
                        !isModalPanelOpen &&
                        !openedDropdown) ||
                    (isNavigationHovered &&
                        footerRouteActive &&
                        !footerHovered &&
                        !isActiveSubroute &&
                        !isSettingsPanelOpen &&
                        !isModalPanelOpen &&
                        !isUserCompanyDetailsOpen &&
                        !isUserPanelOpen &&
                        !openedDropdown &&
                        selectedRoute != 'Company' &&
                        selectedRoute != 'Notifications')
                "
                [@showHideDetails]="
                    !subrouteContainerOpened &&
                    !isActiveSubroute &&
                    isModalPanelOpen &&
                    !footerRouteActive &&
                    isActiveMagicLine &&
                    isNavigationHovered
                        ? 'false'
                        : 'true'
                "
                class="new-magic-line"
                [ngClass]="{
                    'animate-magic-line': isNavigationHovered,
                    'magic-line-width': !isNavigationHovered
                }"
            ></div>
        </div>
        <!-- Open nav on click -->
        <div
            [ngClass]="{
                'open-navigation': isNavigationHovered,
                'close-navigation': !isNavigationHovered
            }"
        ></div>
        <div
            class="navigation-bottom"
            (mouseenter)="onMidleNavHover(false); onFooterHover(true)"
            (mouseleave)="onMidleNavHover(false); onFooterHover(false)"
        >
            <app-navigation-footer
                (click)="onHoveredNavigation(true)"
                [subrouteContainerOpened]="openedDropdown"
                [isNavigationHovered]="isNavigationHovered"
                [isUserCompanyDetailsOpen]="isUserCompanyDetailsOpen"
                [isSettingsPanelOpen]="isSettingsPanelOpen"
                [isUserPanelOpen]="isUserPanelOpen"
                [isModalPanelOpen]="isModalPanelOpen"
                [isActiveFooterRouteClick]="isActiveFooterRoute"
                [showHideLineIfSettingsActive]="middleIsHovered"
                [isActiveSubroute]="isActiveSubroute"
                [selectedRoute]="selectedRoute"
                [selectedSubRoute]="selectedSubRoute"
                (onActivateFooterRoutes)="onActivateFooterRoute($event)"
            >
            </app-navigation-footer>

            <app-navigation-user-profile
                (click)="onHoveredNavigation(true)"
                [isNavigationHovered]="
                    isNavigationHovered && !isUserCompanyDetailsOpen
                "
                [isUserPanelOpen]="isUserPanelOpen"
                [companiesExists]="companiesExists"
                [isUserCompanyDetailsOpen]="isUserCompanyDetailsOpen"
            >
            </app-navigation-user-profile>

            <app-navigation-user-company
                (click)="onHoveredNavigation(true)"
                [isNavigationHoveredAndPanelOpen]="
                    isUserCompanyDetailsOpen && isNavigationHovered
                "
                (companiesExists)="oneUserCompany($event)"
            ></app-navigation-user-company>
        </div>
    </div>
</div>
