<div cdkDrag class="modal-container">
  <div cdkDragHandle class="modal-header">
    <h5 class="modal-title">{{ modalTitle }}</h5>
    <div class="multiple-choises-wrapper">
      <div class="wrap choise-wrapper">
        <div class="btn-group btn-group-toggle">
          <label class="btn-primary">
            <input (change)="checkIsOwner()" [(ngModel)]="isUserOwner" type="checkbox"/>
            Is Owner
          </label>
        </div>
      </div>
    </div>
    <!-- <app-modal-close></app-modal-close> -->
  </div>
  <div class="modal-body">
    <!-- <app-ta-tab-switch (switchClicked)="tabChange($event)" [tabs]="tabs"></app-ta-tab-switch>
    <app-loading-modal *ngIf="!loaded" class="large"></app-loading-modal> -->
    <form
      (keydown)="keyDownFunction($event)"
      *ngIf="loaded"
      [formGroup]="driverForm"
      class="form-container has-tabs tabs-2{{ ' tab-' + selectedTab }}"
    >
      <div
        *ngIf="inputData.data.type == 'edit'"
        class="form-group d-flex align-items-center mt-0 mt-lg-3 absolute-status"
      >
        <kendo-switch
          [checked]="driver?.status"
          class="switch-grey"
          formControlName="status"
        ></kendo-switch>
      </div>

      <div class="single-tab-container">
        <div class="row">
          <div class="col-4">
            <div class="form-label-group" [ngClass]="inputText ? 'typing' : 'not-typing'">
              <input
                #name
                (paste)="onPaste($event, 'firstName')"
                [modalType]="inputData.data.type"
                (keyup)="onKeyUpMethod($event)"
                appAutoFocus
                appInputFocus
                appInputrestriction="[A-Za-z]"
                class="form-control input-control required"
                formControlName="firstName"
                id="firstName"
                onkeypress="return (event.charCode >= 64 && event.charCode <= 91) || (event.charCode >= 96 && event.charCode <= 123)"
                placeholder="First name"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label class="required-label" for="firstName">First name</label>
              <!-- <app-required-label [control]="driverForm.controls.firstName"></app-required-label> -->
            </div>
          </div>
          <div class="col-4">
            <div class="form-label-group" [ngClass]="inputText ? 'typing' : 'not-typing'">
              <input
                #lastName
                (paste)="onPaste($event, 'lastName')"
                (keyup)="onKeyUpMethod($event)"
                appInputFocus
                appInputrestriction="[A-Za-z]"
                class="form-control input-control required"
                formControlName="lastName"
                id="lastName"
                onkeypress="return (event.charCode >= 64 && event.charCode <= 91) || (event.charCode >= 96 && event.charCode <= 123)"
                placeholder="Last name"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label class="required-label" for="lastName">Last name</label>
              <!-- <app-required-label [control]="driverForm.controls.lastName"></app-required-label> -->
            </div>
          </div>
          <div class="col-4">
            <div class="form-label-group">
              <!-- <kendo-floatinglabel
                class="required datepicker-label{{
                  driverForm.controls.dateOfBirth.value !== null &&
                  driverForm.controls.dateOfBirth.value !== ''
                    ? ' valid-label'
                    : ''
                }}"
                text="DOB"
              >
                <kendo-datepicker
                  [formatPlaceholder]="placeholder"
                  [format]="format"
                  [popupSettings]="{ popupClass: 'custom-datepick' }"
                  formControlName="dateOfBirth"
                  placeholder=""
                  required
                ></kendo-datepicker>
              </kendo-floatinglabel> -->
              <!-- <app-required-label [control]="driverForm.controls.dateOfBirth"></app-required-label> -->
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-4">
            <div class="form-label-group input-icon phone-field-wrapper" [ngClass]="inputText ? 'typing' : 'not-typing'">
              <input
                #phone
                appInputFocus
                (keyup)="onKeyUpMethod($event)"
                class="form-control input-control"
                formControlName="phone"
                id="phone"
                mask="(000) 000-0000"
                placeholder="Phone"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label for="phone">Phone</label>
              <p *ngIf="driverForm.get('phone').hasError('pattern')"></p>
            </div>
          </div>
          <div class="col-8">
            <div
              class="form-label-group input-icon email-field-wrapper {{
                manageInputValidation(driverForm.controls.email)
              }}" [ngClass]="inputText ? 'typing' : 'not-typing'"
            >
              <input
                #email
                (keypress)="onEmailTyping($event)"
                (paste)="onPaste($event, 'email')"
                appInputFocus
                (keyup)="onKeyUpMethod($event)"
                class="form-control input-control required email-input "
                formControlName="email"
                id="email"
                oninput="this.value = this.value.replace(/[ ]|^ /g,'')"
                placeholder="Email"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label class="required-label" for="email">Email</label>
              <!-- <app-required-label [control]="driverForm.controls.email"></app-required-label> -->
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-10">
            <div
              class="form-label-group input-icon address-field-wrapper {{
                manageInputValidation(driverForm.controls.address)
              }}" [ngClass]="inputText ? 'typing' : 'not-typing'"
            >
              <input
                #placesRef="ngx-places"
                (onAddressChange)="handleAddressChange($event)"
                [options]="options"
                appInputFocus
                (keyup)="onKeyUpMethod($event)"
                class="form-control input-control required address-input"
                formControlName="address"
                id="address"
                ngx-google-places-autocomplete
                placeholder="Address, City, State Zip"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label class="required-label" for="address">Address, City, State Zip</label>
              <!-- app-required-label [control]="driverForm.controls.address"></app-required-label> -->
            </div>
          </div>
          <div class="col-2">
            <div class="form-label-group" [ngClass]="inputText ? 'typing' : 'not-typing'">
              <input
                appInputFocus
                appInputrestriction="[A-Za-z0-9-]"
                class="form-control input-control"
                formControlName="addressUnit"
                (keyup)="onKeyUpMethod($event)"
                id="addressUnit"
                maxlength="6"
                placeholder="Unit #"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label for="addressUnit">Unit #</label>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-5">
            <div class="form-label-group" [ngClass]="inputText ? 'typing' : 'not-typing'">
              <input
                (paste)="onPaste($event, 'ssn')"
                appInputFocus
                class="form-control input-control required"
                formControlName="ssn"
                (keyup)="onKeyUpMethod($event)"
                id="ssn"
                mask="000-00-0000"
                placeholder="SSN"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label class="required-label" for="ssn">SSN</label>
              <!-- <app-required-label [control]="driverForm.controls.ssn"></app-required-label> -->
            </div>
          </div>
          <div *ngIf="driverForm.controls.isOwner.value" class="col-7">
            <!-- <app-ta-switch
              (switchClicked)="switchOwner($event)"
              [data]="ownerSwitchData"
            ></app-ta-switch> -->
          </div>
        </div>
        <div
          *ngIf="driverForm.controls.isBusinessOwner.value && driverForm.controls.isOwner.value"
          class="row"
        >
          <div class="col-4">
            <div class="form-label-group">
              <input
                (input)="getBusinessName()"
                (paste)="onPaste($event, 'taxId'); getBusinessName()"
                [required]="ownerFieldsRequired"
                (keyup)="onKeyUpMethod($event)"
                appInputFocus
                class="form-control input-control required"
                formControlName="taxId"
                id="taxId"
                mask="00-0000000"
                placeholder="EIN"
              />
              <div class="icon-container">
                <i class="input-loader"></i>
              </div>
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label class="{{ ownerFieldsRequired ? 'required-label' : '' }}" for="taxId"
              >EIN</label
              >
              <!-- <app-required-label [control]="driverForm.controls.taxId"></app-required-label> -->
            </div>
          </div>
          <div class="col-8">
            <div class="form-label-group">
              <input
                (keydown)="onCheckBackSpace($event)"
                (keypress)="onNameTyping($event)"
                (paste)="onPaste($event, 'businessName')"
                appInputFocus
                (keyup)="onKeyUpMethod($event)"
                appInputrestriction="[0-9A-Za-z\.\,\s]"
                class="form-control input-control required"
                formControlName="businessName"
                id="businessName"
                oninput="this.value = this.value.replace(/[^A-Za-z0-9-,.;'&/.() ]|^ /g,'')"
                placeholder="Business name"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label class="required-label" for="businessName">Bussines name</label>
              <!-- <app-required-label [control]="driverForm.controls.businessName"></app-required-label> -->
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 note-wrapper{{ showNote ? ' visible-note' : ' hidden-note' }}">
            <div (click)="openNote()" class="note-label-wrapper">
              <span class="note-label">Note</span>
              <svg-icon class="down-icon" src="assets/img/svgs/down-arrow.svg"></svg-icon>
            </div>
            <div
              class="example-full-width note-input{{ showNote ? ' note-visible' : ' note-hidden' }}"
            >
              <textarea
                #note
                cdkAutosizeMaxRows="5"
                cdkAutosizeMinRows="2"
                cdkTextareaAutosize
                class="input-custom-textarea form-textarea"
                formControlName="note"
                placeholder="Write a note."
                rows="5"
              ></textarea>
            </div>
          </div>
        </div>
      </div>

      <div class="single-tab-container">
        <div class="row">
          <div class="col-12">
            <div *ngIf="!newBankVisible" class="form-label-group">
              <ng-select
                (change)="onBankChange($event)"
                (clear)="onClose($event)"
                (close)="onClose($event)"
                (search)="onSearch($event)"
                [items]="bankData"
                [searchFn]="customSearch"
                appendTo="body"
                bindLabel="bankName"
                class="bank-name-select has-add-new{{
                  bankSearchItems == 1 ? ' has-one-result' : ''
                }}"
                formControlName="bankData"
                placeholder="Bank name"
              >
                <ng-template let-item="item" let-search="searchTerm" ng-option-tmp>
                  <span *ngIf="item.bankLogo !== null" class="bank-image dropdown-image">
                    <svg-icon
                      src="assets/img/svgs/bank-logos/{{ item.bankLogoWide }}.svg"
                    ></svg-icon>
                  </span>
                  <span *ngIf="item.bankLogo == null" [ngOptionHighlight]="search">{{
                    item.bankName
                    }}</span>
                  <svg-icon
                    (click)="deleteBank(item.id)"
                    *ngIf="item.id !== 0 && item.protected !== null && item.protected !== 1"
                    appTaTooltip="Delete"
                    class="delete-record-icon"
                    position="bottom-left"
                    src="assets/img/trash.svg"
                  ></svg-icon>
                </ng-template>

                <ng-template let-item="item" ng-label-tmp>
                  <span *ngIf="item.bankLogo !== null" class="value-label-container bank-image">
                    <svg-icon
                      src="assets/img/svgs/bank-logos/{{ item.bankLogoWide }}.svg"
                    ></svg-icon>
                  </span>
                  <span *ngIf="item.bankLogo == null" class="value-label-container bank-image">
                    {{ item.bankName }}
                  </span>
                </ng-template>
              </ng-select>
            </div>

            <div *ngIf="newBankVisible" class="add-new-form add-new-bank">
              <div class="form-label-group">
                <input
                  (keypress)="onBankKeyPress($event)"
                  [(ngModel)]="newBank"
                  [ngModelOptions]="{ standalone: true }"
                  appInputFocus
                  class="form-control input-control"
                  id="newBank"
                  placeholder="New bank"
                />
                <label for="newBank">New bank</label>
                <span
                  (click)="saveNewBank()"
                  *ngIf="newBank !== '' && newBank !== null"
                  appTaTooltip="Save"
                  class="save-new-record"
                  position="bottom-right"
                >
                  <svg-icon src="assets/img/svgs/add-save.svg"></svg-icon>
                </span>
                <span
                  (click)="closeNewBank()"
                  appTaTooltip="Cancel"
                  class="close-new-record"
                  position="bottom-right"
                >
                  <svg-icon src="assets/img/svgs/add-cancel.svg"></svg-icon>
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-8">
            <div class="form-label-group">
              <input
                (paste)="onPaste($event, 'accountNumber')"
                class="form-control input-control{{ bankInfoRequired ? ' required' : '' }}"
                formControlName="accountNumber"
                (keyup)="onKeyUpMethod($event)"
                id="accountNumber"
                maxlength="17"
                minlength="4"
                onkeypress="return event.charCode >= 48 && event.charCode <= 57"
                placeholder="Account number"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label class="{{ bankInfoRequired ? 'required-label' : '' }}" for="accountNumber"
              >Account number</label
              >
              <!-- <app-required-label [control]="driverForm.controls.accountNumber"></app-required-label> -->

            </div>
          </div>
          <div class="col-4">
            <div class="form-label-group">
              <input
                (paste)="onPaste($event, 'routingNumber')"
                [required]="bankInfoRequired"
                appInputFocus
                class="form-control input-control{{ bankInfoRequired ? ' required' : '' }}"
                formControlName="routingNumber"
                id="routingNumber"
                maxlength="9"
                minlength="9"
                onkeypress="return event.charCode >= 48 && event.charCode <= 57"
                placeholder="Routing number"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label class="{{ bankInfoRequired ? 'required-label' : '' }}" for="routingNumber"
              >Routing number</label
              >
              <!-- <app-required-label [control]="driverForm.controls.routingNumber"></app-required-label> -->
            </div>
          </div>
        </div>
        <div class="row">
          <div
            class="{{
              driverForm.controls.paymentType.value !== null
                ? 'payment-type col-6'
                : 'payment-type col-12'
            }}"
          >
            <div class="form-label-group">
              <ng-select
                [items]="paymentTypes"
                appendTo="body"
                bindLabel="name"
                formControlName="paymentType"
                placeholder="Pay Type"
              >
                <ng-template let-item="item" let-search="searchTerm" ng-option-tmp>
                  <span [ngOptionHighlight]="search">{{ item.name }}</span>
                </ng-template>
              </ng-select>
            </div>
          </div>
          <div
            *ngIf="
              driverForm.controls.paymentType.value !== null &&
              driverForm.controls.paymentType.value.id == 'mile'
            "
            class="col-3"
          >
            <div class="form-label-group">
              <input
                class="form-control input-control"
                formControlName="loadedMiles"
                id="loadedMiles"
                placeholder="Loaded"
              />
              <label for="loadedMiles">Loaded</label>
            </div>
          </div>
          <div
            *ngIf="
              driverForm.controls.paymentType.value !== null &&
              driverForm.controls.paymentType.value.id == 'mile'
            "
            class="col-3"
          >
            <div class="form-label-group">
              <input
                class="form-control input-control"
                formControlName="emptyMiles"
                id="emptyMiles"
                placeholder="Empty"
              />
              <label for="emptyMiles">Empty Miles</label>
            </div>
          </div>
          <div
            *ngIf="
              driverForm.controls.paymentType.value !== null &&
              driverForm.controls.paymentType.value.id == 'commission'
            "
            class="col-6 slider-wrapper"
          >
            <ngx-slider [options]="sliderOptions" formControlName="commission"></ngx-slider>
          </div>
        </div>
        <div *ngIf="notifications.length > 0" class="row mb-28">
          <div class="col-12">
            <div class="fw500">Notifications</div>
            <div class="multiple-choises-wrapper driver-notifications">
              <div
                *ngFor="let notification of notifications; let i = index"
                class="btn-group btn-group-toggle"
              >
                <label class="btn-primary" ngbButtonLabel>
                  <input
                    [(ngModel)]="notification.checked"
                    [ngModelOptions]="{ standalone: true }"
                    appInputFocus
                    ngbButton
                    type="checkbox"
                  />
                  {{ notification.name }}
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-2">
            <div class="wrap choise-wrapper twic-choise">
              <div class="btn-group btn-group-toggle">
                <label class="btn-primary" ngbButtonLabel>
                  <input
                    (change)="checkTwic()"
                    [(ngModel)]="isTwicChecked"
                    [ngModelOptions]="{ standalone: true }"
                    ngbButton
                    type="checkbox"
                  />
                  TWIC
                </label>
              </div>
            </div>
          </div>
          <div class="col-4">
            <div class="form-label-group">
              <kendo-floatinglabel
                class="{{
                  isRequiredField(driverForm.controls.expirationDate) ? 'required ' : ''
                }}datepicker-label{{
                  driverForm.controls.expirationDate.value !== null &&
                  driverForm.controls.expirationDate.value !== ''
                    ? ' valid-label'
                    : ''
                }}"
                text="Exp. Date"
              >
                <kendo-datepicker
                  [formatPlaceholder]="{
                    year: 'yy',
                    month: 'mm',
                    day: 'dd'
                  }"
                  [format]="format"
                  [popupSettings]="{ popupClass: 'custom-datepick' }"
                  formControlName="expirationDate"
                  placeholder=""
                ></kendo-datepicker>
              </kendo-floatinglabel>
              <!-- <app-required-label [control]="driverForm.controls.expirationDate"></app-required-label> -->
            </div>
          </div>
          <div class="col-6">
            <div class="form-label-group">
              <input
                class="form-control input-control"
                formControlName="fuelCard"
                (keyup)="onKeyUpMethod($event)"
                id="fuelCard"
                placeholder="Fuel Card #"
              />
              <div (click)="clearInput($event)" class="clear-button" ngbTooltip="Clear" placement="bottom-left">
              </div>
              <label for="fuelCard">Fuel Card #</label>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div class="modal-footer">
    <button (click)="closeDriverEdit()" class="cancel-btn" type="button">Cancel</button>
    <button (click)="saveDriver()" [ngClass]="{'invalid-btn' : !driverForm.valid}" class="save-btn" type="button">Save
    </button>
  </div>
</div>
