<app-ta-modal
    [modalTitle]="
        !editData?.type?.includes('edit') ? 'Create Load' : 'Edit Load'
    "
    [editData]="editData"
    [editName]="loadNumber"
    [specificCaseModalName]="true"
    [isModalValid]="loadForm.valid && isFormDirty"
    [customClass]="loadModalSize"
    [isVisibleHazardous]="isHazardousPicked"
    [isVisibleMap]="true"
    [loadModalTemplate]="true"
    [modalAdditionalPart]="true"
    (additionalPartVisibility)="additionalPartVisibility($event)"
    (action)="onModalAction($event)"
>
    <!-- Origin Tab -->
    <form
        origin
        [formGroup]="loadForm"
        class="form-container form-container-without-mb"
    >
        <!-------------------------------- FTL Tab -------------------------------->
        <div class="m-tab">
            <div class="load-ftl-first-row">
                <!-- FTL-LTL Switcher -->
                <app-ta-tab-switch
                    [tabs]="tabs"
                    (switchClicked)="onTabChange($event, 'ftl-ltl')"
                    [type]="'type2-modal-popup'"
                >
                </app-ta-tab-switch>
                <!-- Load Template Picker -->
                <div class="load-template-switcher">
                    <svg-icon
                        src="assets/svg/common/load/ic_load_template_btn.svg"
                    ></svg-icon>
                </div>
                <app-ta-input-dropdown
                    formControlName="dispatcherId"
                    [template]="'load-dispatcher'"
                    [inputConfig]="{
                        name: 'Input Dropdown',
                        type: 'text',
                        label: 'Dispatcher',
                        isDropdown: true,
                        dropdownImageInput: {
                            withText: true,
                            svg: false,
                            image: true,
                            url: selectedDispatcher?.logoName,
                            nameInitialsInsteadUrl:
                                !selectedDispatcher?.logoName
                                    ? selectedDispatcher?.name
                                    : null,
                            template: 'user'
                        },
                        textTransform: 'capitalize',
                        dropdownWidthClass: 'w-col-230'
                    }"
                    [options]="labelsDispatcher"
                    [activeItem]="selectedDispatcher"
                    (selectedItem)="onSelectDropdown($event, 'dispatcher')"
                ></app-ta-input-dropdown>
                <!------------------ Companies Cassses ------------------>
                <!-- Only One Company -->
                <app-ta-input
                    *ngIf="labelsCompanies.length === 1"
                    formControlName="companyId"
                    [inputConfig]="{
                        name: 'Company',
                        type: 'text',
                        label: 'Company',
                        isRequired: true,
                        textTransform: 'uppercase'
                    }"
                ></app-ta-input>
                <!-- Multiple Companies -->
                <app-ta-input-dropdown
                    *ngIf="labelsCompanies.length > 1"
                    formControlName="companyId"
                    [inputConfig]="{
                        name: 'Input Dropdown',
                        type: 'text',
                        label: 'Company',
                        isDropdown: true,
                        dropdownWidthClass: 'w-col-226'
                    }"
                    [options]="labelsCompanies"
                    [activeItem]="selectedCompany"
                    (selectedItem)="onSelectDropdown($event, 'company')"
                ></app-ta-input-dropdown>
                <!------------------  end ------------------>
            </div>
            <div class="row">
                <div class="col-12">
                    <app-ta-input-dropdown
                        formControlName="dispatchId"
                        [template]="'load-dispatches-ttd'"
                        [inputConfig]="loadDispatchesTTDInputConfig"
                        [options]="labelsDispatches"
                        [activeItem]="selectedDispatches"
                        (selectedItem)="onSelectDropdown($event, 'dispatches')"
                    ></app-ta-input-dropdown>
                </div>
            </div>
            <div class="load-ftl-third-row">
                <app-ta-input
                    formControlName="referenceNumber"
                    [inputConfig]="{
                        name: 'Ref Number',
                        type: 'text',
                        label: 'Reference No.',
                        isRequired: true,
                        textTransform: 'capitalize'
                    }"
                ></app-ta-input>
                <app-ta-input-dropdown
                    formControlName="brokerId"
                    [template]="'load-broker'"
                    [inputConfig]="loadBrokerInputConfig"
                    [canAddNew]="true"
                    [canOpenModal]="true"
                    [options]="labelsBroker"
                    [activeItem]="selectedBroker"
                    (selectedItem)="onSelectDropdown($event, 'broker')"
                ></app-ta-input-dropdown>
            </div>
            <div class="load-ftl-fourth-row">
                <app-ta-input-dropdown
                    formControlName="brokerContactId"
                    [template]="'load-broker-contact'"
                    [inputConfig]="loadBrokerContactsInputConfig"
                    [canAddNew]="true"
                    [canOpenModal]="true"
                    [options]="labelsBrokerContacts"
                    [activeItem]="selectedBrokerContact"
                    (selectedItem)="onSelectDropdown($event, 'broker-contact')"
                ></app-ta-input-dropdown>
                <app-ta-input-dropdown
                    formControlName="generalCommodity"
                    [template]="'svgtext-template'"
                    [inputConfig]="{
                        name: 'Input Dropdown',
                        type: 'text',
                        label: 'Commodity',
                        isDropdown: true,
                        dropdownWidthClass: 'w-col-152',
                        placeholderIconRightSide: isHazardousPicked
                            ? 'hazardous'
                            : null,
                        blackInput: true,
                        customClass: 'hazardous-dropdown'
                    }"
                    [options]="labelsGeneralCommodity"
                    [activeItem]="selectedGeneralCommodity"
                    (selectedItem)="
                        onSelectDropdown($event, 'general-commodity')
                    "
                ></app-ta-input-dropdown>
                <app-ta-input
                    formControlName="weight"
                    [inputConfig]="{
                        name: 'Weight',
                        type: 'text',
                        label: 'Weight',
                        placeholderIcon: 'weight',
                        thousandSeparator: true
                    }"
                ></app-ta-input>
            </div>

            <!-- Requirements Card -->
            <app-ta-custom-card
                [cardName]="'Requirements'"
                [animationMarginParams]="{
                    marginTop: '18px',
                    marginBottom: '22px'
                }"
                [isCardOpen]="false"
            >
                <div class="row">
                    <div class="col-6">
                        <app-ta-input-dropdown
                            formControlName="truckTypeId"
                            [template]="'svgtext-template'"
                            [inputConfig]="{
                                name: 'Input Dropdown',
                                type: 'text',
                                label: 'Truck Requirement',
                                isDropdown: true,
                                dropdownImageInput: {
                                    withText: true,
                                    svg: true,
                                    image: false,
                                    url: selectedTruckReq?.logoName,
                                    template: 'truck',
                                    class: selectedTruckReq?.name
                                        ?.trim()
                                        .replace(' ', '')
                                        .toLowerCase()
                                },
                                dropdownWidthClass: 'w-col-296',
                                customClass: 'truck-trailer-dropdown'
                            }"
                            [options]="labelsTruckReq"
                            [activeItem]="selectedTruckReq"
                            (selectedItem)="
                                onSelectDropdown($event, 'truck-req')
                            "
                        ></app-ta-input-dropdown>
                    </div>
                    <div class="col-6">
                        <app-ta-input-dropdown
                            formControlName="trailerTypeId"
                            [template]="'svgtext-template'"
                            [inputConfig]="{
                                name: 'Input Dropdown',
                                type: 'text',
                                label: 'Trailer Requirement',
                                isDropdown: true,
                                dropdownImageInput: {
                                    withText: true,
                                    svg: true,
                                    image: false,
                                    url: selectedTrailerReq?.logoName,
                                    template: 'trailer',
                                    class: selectedTrailerReq?.name
                                        ?.toLowerCase()
                                        .includes('liquid')
                                        ? 'tanker-liquid'
                                        : selectedTrailerReq?.name
                                              ?.toLowerCase()
                                              ?.includes('rgn')
                                        ? 'low-boy-rgn'
                                        : selectedTrailerReq?.name
                                              ?.toLowerCase()
                                              .includes('dry-bulk')
                                        ? 'tanker-dry-bulk'
                                        : selectedTrailerReq?.name
                                              ?.trim()
                                              .replace(' ', '')
                                              .toLowerCase()
                                },
                                dropdownWidthClass: 'w-col-308',
                                customClass: 'truck-trailer-dropdown'
                            }"
                            [options]="labelsTrailerReq"
                            [activeItem]="selectedTrailerReq"
                            (selectedItem)="
                                onSelectDropdown($event, 'trailer-req')
                            "
                        ></app-ta-input-dropdown>
                    </div>
                </div>

                <div class="load-requirements-load-second-row">
                    <app-ta-input-dropdown
                        formControlName="trailerLengthId"
                        [inputConfig]="{
                            name: 'Input Dropdown',
                            type: 'text',
                            label: 'Length',
                            isDropdown: true,
                            dropdownWidthClass: 'w-col-100'
                        }"
                        [options]="labelsTrailerLength"
                        [activeItem]="selectedTrailerLength"
                        (selectedItem)="onSelectDropdown($event, 'length')"
                    ></app-ta-input-dropdown>

                    <app-ta-input-dropdown
                        formControlName="doorType"
                        [inputConfig]="{
                            name: 'Input Dropdown',
                            type: 'text',
                            label: 'Door Type',
                            isDropdown: true,
                            dropdownWidthClass: 'w-col-120'
                        }"
                        [options]="labelsDoorType"
                        [activeItem]="selectedDoorType"
                        (selectedItem)="onSelectDropdown($event, 'door-type')"
                    ></app-ta-input-dropdown>

                    <app-ta-input-dropdown
                        formControlName="suspension"
                        [inputConfig]="{
                            name: 'Input Dropdown',
                            type: 'text',
                            label: 'Suspension',
                            isDropdown: true,
                            dropdownWidthClass: 'w-col-150'
                        }"
                        [options]="labelsSuspension"
                        [activeItem]="selectedSuspension"
                        (selectedItem)="onSelectDropdown($event, 'suspension')"
                    ></app-ta-input-dropdown>

                    <app-ta-input-dropdown
                        formControlName="year"
                        [inputConfig]="{
                            name: 'Input Dropdown',
                            type: 'text',
                            label: 'Year',
                            isDropdown: true,
                            dropdownWidthClass: 'w-col-90'
                        }"
                        [options]="labelsYear"
                        [activeItem]="selectedYear"
                        (selectedItem)="onSelectDropdown($event, 'year')"
                    ></app-ta-input-dropdown>

                    <app-ta-checkbox
                        formControlName="liftgate"
                        [customClass]="'regular-small'"
                        [label]="'Lifgate'"
                    ></app-ta-checkbox>
                </div>
                <div class="row last-row">
                    <div class="col-12">
                        <app-ta-input
                            formControlName="driverMessage"
                            [inputConfig]="{
                                name: 'Description',
                                type: 'text',
                                label: 'Driver Message',
                                minLength: 2,
                                maxLength: 160,
                                textTransform: 'capitalize'
                            }"
                        ></app-ta-input>
                    </div>
                </div>
            </app-ta-custom-card>

            <app-ta-custom-card
                [cardName]="'Stops'"
                [isCardOpen]="true"
                [animationMarginParams]="{
                    marginTop: '18px',
                    marginBottom: '22px'
                }"
            >
                <!-- Pickup Stop  -->
                <app-load-stop
                    [firstOrLast]="true"
                    [stopNumber]="1"
                    [isDelivery]="false"
                    [shipper]="'Becker'"
                    [shipperAddress]="'Address'"
                    [dateRange]="'04/07/23'"
                    [timeRange]="'10:00 AM - 09:00 PM'"
                    [legMile]="'360.5'"
                    [isEmptyLoad]="true"
                    [shipperContact]="{
                        fullName: 'Angelo Trotter'
                    }"
                    (toggle)="toggleStopActivity($event, 'first-pickup')"
                >
                    <div class="row">
                        <div class="col-12">
                            <app-ta-input-dropdown
                                formControlName="pickupShipper"
                                [template]="'load-shipper'"
                                [inputConfig]="loadShipperInputConfig"
                                [canAddNew]="true"
                                [canOpenModal]="true"
                                [options]="labelsShippers"
                                [activeItem]="selectedShipper"
                                (selectedItem)="
                                    onSelectDropdown($event, 'shipper')
                                "
                            ></app-ta-input-dropdown>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-5">
                            <app-ta-tab-switch
                                [tabs]="stopTimeTabs"
                                (switchClicked)="
                                    onTabChange($event, 'stop-time')
                                "
                                [type]="'type2-modal-popup'"
                            ></app-ta-tab-switch>
                        </div>
                        <div class="col-7">
                            <app-ta-input-dropdown
                                formControlName="pickupShipperContactId"
                                [template]="'load-broker-contact'"
                                [inputConfig]="loadShipperContactsInputConfig"
                                [canAddNew]="true"
                                [canOpenModal]="true"
                                [options]="labelsShipperContacts"
                                [activeItem]="selectedShipperContact"
                                (selectedItem)="
                                    onSelectDropdown($event, 'shipper-contact')
                                "
                            ></app-ta-input-dropdown>
                        </div>
                    </div>
                    <div
                        class="stop-load-date-time"
                        [ngClass]="{ 'date-range-active': pickupDateRange }"
                    >
                        <app-ta-input
                            formControlName="pickupDateFrom"
                            [inputConfig]="{
                                name: 'datepicker',
                                type: 'text',
                                isDropdown: true,
                                label: pickupDateRange ? 'Date From' : 'Date',
                                placeholderIcon: 'date',
                                isRequired: true,
                                customClass: 'datetimeclass'
                            }"
                        ></app-ta-input>
                        <div
                            *ngIf="!pickupDateRange"
                            class="load-plus-button"
                            ngbTooltip
                            mainTooltip="Date Range"
                            tooltipBackground="#B7B7B7"
                            position="top"
                            (click)="pickupDateRange = true"
                        >
                            <svg-icon
                                src="assets/svg/common/ic_plus.svg"
                            ></svg-icon>
                        </div>
                        <app-ta-input
                            *ngIf="pickupDateRange"
                            formControlName="pickupDateTo"
                            [inputConfig]="{
                                name: 'datepicker',
                                type: 'text',
                                isDropdown: true,
                                label: 'Date To',
                                placeholderIcon: 'date',
                                customClass: 'datetimeclass'
                            }"
                        ></app-ta-input>

                        <!-- Time Picker -->
                        <app-ta-input
                            formControlName="pickupTimeFrom"
                            [inputConfig]="{
                                name: 'timepicker',
                                type: 'text',
                                label: 'From',
                                placeholderIcon: 'time',
                                isDropdown: true,
                                isRequired: true,
                                customClass: 'datetimeclass'
                            }"
                        ></app-ta-input>
                        <!-- Time Picker -->
                        <app-ta-input
                            formControlName="pickupTimeTo"
                            [inputConfig]="{
                                name: 'timepicker',
                                type: 'text',
                                label: 'To',
                                placeholderIcon: 'time',
                                isDropdown: true,
                                isRequired: true,
                                isDisabled: selectedStopTime === 6,
                                customClass: 'datetimeclass'
                            }"
                        ></app-ta-input>
                    </div>
                </app-load-stop>

                <!-- <div class="row"> -->
                <!-- <div class="col-12">
                            <app-ta-tab-switch
                                [tabs]="stopTabs"
                                (switchClicked)="
                                    onTabChange($event, 'stop-tab')
                                "
                                [type]="
                                    'type2-modal-popup load-type2-modal-popup'
                                "
                            ></app-ta-tab-switch>
                        </div> -->
                <!-- </div> -->

                <!-- Delivery Stop -->
                <app-load-stop
                    [firstOrLast]="true"
                    [stopNumber]="1"
                    [isDelivery]="true"
                    [shipper]="'Delivery Stop'"
                    [shipperAddress]="'Address'"
                    [dateRange]="'04/07/23'"
                    [timeRange]="'10:00 AM - 09:00 PM'"
                    [legMile]="'360.5'"
                    [isEmptyLoad]="false"
                    [shipperContact]="{
                        fullName: 'Angelo Trotter'
                    }"
                    (toggle)="toggleStopActivity($event, 'first-delivery')"
                >
                    <div class="row">
                        <div class="col-12">
                            <app-ta-input-dropdown
                                formControlName="deliveryShipper"
                                [template]="'load-shipper'"
                                [inputConfig]="loadShipperInputConfig"
                                [canAddNew]="true"
                                [canOpenModal]="true"
                                [options]="labelsShippers"
                                [activeItem]="selectedShipper"
                                (selectedItem)="
                                    onSelectDropdown($event, 'shipper')
                                "
                            ></app-ta-input-dropdown>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-5">
                            <app-ta-tab-switch
                                [tabs]="stopTimeTabs"
                                (switchClicked)="
                                    onTabChange($event, 'stop-time')
                                "
                                [type]="'type2-modal-popup'"
                            ></app-ta-tab-switch>
                        </div>
                        <div class="col-7">
                            <app-ta-input-dropdown
                                formControlName="deliveryShipperContactId"
                                [template]="'load-broker-contact'"
                                [inputConfig]="loadShipperContactsInputConfig"
                                [canAddNew]="true"
                                [canOpenModal]="true"
                                [options]="labelsShipperContacts"
                                [activeItem]="selectedShipperContact"
                                (selectedItem)="
                                    onSelectDropdown($event, 'shipper-contact')
                                "
                            ></app-ta-input-dropdown>
                        </div>
                    </div>
                    <div
                        class="stop-load-date-time"
                        [ngClass]="{ 'date-range-active': deliveryDateRange }"
                    >
                        <app-ta-input
                            formControlName="deliveryDateFrom"
                            [inputConfig]="{
                                name: 'datepicker',
                                type: 'text',
                                isDropdown: true,
                                label: deliveryDateRange ? 'Date From' : 'Date',
                                placeholderIcon: 'date',
                                isRequired: true,
                                customClass: 'datetimeclass'
                            }"
                        ></app-ta-input>
                        <div
                            *ngIf="!deliveryDateRange"
                            class="load-plus-button"
                            ngbTooltip
                            mainTooltip="Date Range"
                            tooltipBackground="#B7B7B7"
                            position="top"
                            (click)="deliveryDateRange = true"
                        >
                            <svg-icon
                                src="assets/svg/common/ic_plus.svg"
                            ></svg-icon>
                        </div>
                        <app-ta-input
                            *ngIf="deliveryDateRange"
                            formControlName="pickupDateTo"
                            [inputConfig]="{
                                name: 'datepicker',
                                type: 'text',
                                isDropdown: true,
                                label: 'Date To',
                                placeholderIcon: 'date',
                                customClass: 'datetimeclass'
                            }"
                        ></app-ta-input>

                        <!-- Time Picker -->
                        <app-ta-input
                            formControlName="deliveryTimeFrom"
                            [inputConfig]="{
                                name: 'timepicker',
                                type: 'text',
                                label: 'From',
                                placeholderIcon: 'time',
                                isDropdown: true,
                                isRequired: true,
                                customClass: 'datetimeclass'
                            }"
                        ></app-ta-input>
                        <!-- Time Picker -->
                        <app-ta-input
                            formControlName="deliveryTimeTo"
                            [inputConfig]="{
                                name: 'timepicker',
                                type: 'text',
                                label: 'To',
                                placeholderIcon: 'time',
                                isDropdown: true,
                                isRequired: true,
                                isDisabled: selectedStopTime === 6,
                                customClass: 'datetimeclass'
                            }"
                        ></app-ta-input>
                    </div>
                </app-load-stop>
            </app-ta-custom-card>

            <app-ta-custom-card
                [cardName]="'Billing'"
                [isCardOpen]="true"
                [animationMarginParams]="{
                    marginTop: '18px',
                    marginBottom: '22px'
                }"
            >
                <div class="billing-payment-load">
                    <!-- Base Rate -->
                    <app-ta-input
                        formControlName="baseRate"
                        [inputConfig]="{
                            name: 'base-rate',
                            type: 'text',
                            label: 'Base Rate',
                            isRequired: true,
                            placeholderIcon: 'dollar',
                            customClass: 'dollar-placeholderIcon',
                            thousandSeparator: true,
                            blackInput: true
                        }"
                        [ngStyle]="{ width: '130px' }"
                    ></app-ta-input>

                    <div
                        #t2="ngbPopover"
                        popoverClass="load-additional-options"
                        [ngbPopover]="taInputDropdownPopover"
                        [placement]="['bottom-left']"
                        [container]="'body'"
                        ngbTooltip
                        mainTooltip="Additional"
                        tooltipBackground="#536BC2"
                        position="top"
                        class="load-plus-button"
                    >
                        <svg-icon
                            src="assets/svg/common/ic_plus.svg"
                        ></svg-icon>
                    </div>

                    <ng-template #taInputDropdownPopover>
                        <div class="load-additional-container">
                            <div
                                *ngFor="
                                    let option of additionalBillingTypes;
                                    trackBy: identity
                                "
                                class="dropdown-option"
                                (click)="onSelectAdditionalOption(option)"
                            >
                                {{ option.name }}
                            </div>
                        </div>
                    </ng-template>
                </div>
            </app-ta-custom-card>

            <!-- Comments -->
            <app-ta-custom-card
                [hasCounter]="comments.length ? comments.length : 0"
                [cardName]="'Comment'"
                [isCardOpen]="comments.length > 0"
                [isCommentData]="true"
                [hasBodyData]="comments.length > 0"
                [hasScrollBody]="comments.length > 4"
                [disabledCard]="editData?.type !== 'edit'"
                [hasActionSvg]="
                    editData?.type === 'edit'
                        ? 'assets/svg/common/ic_plus.svg'
                        : ''
                "
                (onActionEvent)="createComment()"
                [animationMarginParams]="{
                    marginTop: '10px',
                    marginBottom: '12px'
                }"
            >
                <app-ta-user-review
                    *ngIf="comments.length"
                    [reviewData]="comments"
                    [isNewReview]="comments[0].isNewReview"
                    (changeReviewsEvent)="changeCommentsEvent($event)"
                ></app-ta-user-review>
            </app-ta-custom-card>

            <!-- Documents -->
            <app-ta-custom-card
                [hasCounter]="documents.length ? documents.length : 0"
                [cardName]="'Document'"
                [isCardOpen]="documents.length > 0"
            >
                <app-ta-upload-files
                    [files]="documents"
                    [size]="'large'"
                    (onFileEvent)="onFilesEvent($event)"
                ></app-ta-upload-files>
            </app-ta-custom-card>

            <!-- Note -->
            <app-ta-input-note
                formControlName="note"
                [isVisibleNote]="
                    loadForm.get('note').value &&
                    loadForm.get('note').value != 'null'
                        ? loadForm.get('note').value
                        : false
                "
                [note]="
                    loadForm.get('note').value &&
                    loadForm.get('note').value != 'null'
                        ? loadForm.get('note').value
                        : ''
                "
            ></app-ta-input-note>
        </div>
    </form>
    <!-------------------------------- Additional Tab Part -------------------------------->
    <div
        additional
        class="load-map-container"
        [ngClass]="{
            'load-hazardous-container': isHazardousVisible
        }"
        [ngStyle]="{
            height: additionalPartHeight,
            overflow: 'hidden',
            'owerflow-y': 'scroll'
        }"
    >
        <!-- Hazardous -->
        <app-load-modal-hazardous
            *ngIf="isHazardousVisible"
        ></app-load-modal-hazardous>

        <!-- Map -->
        <app-maps
            *ngIf="!isHazardousVisible"
            [mapType]="'routing'"
            [routes]="loadStopRoutes"
            [ngStyle]="{ width: '100%', height: '100%' }"
        ></app-maps>
    </div>
</app-ta-modal>
