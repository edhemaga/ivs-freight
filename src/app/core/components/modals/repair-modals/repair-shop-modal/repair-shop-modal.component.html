<app-ta-modal
  [modalTitle]="
    editData?.type !== 'edit' ? 'Add Repair Shop' : 'Edit Repair Shop'
  "
  [editData]="editData"
  [editName]="editData?.data?.name"
  [isModalValid]="repairShopForm.valid"
  (action)="onModalAction($event)"
>
  <form [formGroup]="repairShopForm" class="form-container">
    <div class="row first-row">
      <div class="col-11">
        <app-ta-input
          formControlName="name"
          [inputConfig]="{
            name: 'Shop Name',
            type: 'text',
            label: 'Shop Name',
            isRequired: true,
            textTransform: 'uppercase',
            autoFocus: editData?.type !== 'edit',
            minLength: 2,
            maxLength: 64
          }"
        ></app-ta-input>
      </div>
      <div class="col-1">
        <svg-icon
          class="repair-shop-star"
          [class.active]="isRepairShopFavourite"
          src="assets/svg/common/ic_star.svg"
          (click)="favouriteRepairShop()"
        ></svg-icon>
      </div>
    </div>

    <div
      class="phone-ext-email-small-modal phone-ext-email-small-modal-my-32"
      [ngClass]="{ 'active-phone-ext': isPhoneExtExist }"
    >
      <div class="phone-extension">
        <div class="phone-field">
          <app-ta-input
            formControlName="phone"
            [inputConfig]="{
              name: 'Phone',
              type: 'text',
              label: 'Phone',
              isRequired: true,
              placeholderIcon: 'phone',
              mask: '(000) 000-0000'
            }"
          ></app-ta-input>
        </div>
        <div
          class="extension-field"
          *ngIf="!isPhoneExtExist"
          ngbTooltip
          mainTooltip="Add Extension"
          position="top"
          tooltipBackground="#6c6c6c"
          (click)="isPhoneExtExist = !isPhoneExtExist"
        >
          <svg-icon src="assets/svg/common/ic_plus.svg"></svg-icon>
        </div>
        <app-ta-input
          *ngIf="isPhoneExtExist"
          formControlName="phoneExt"
          [inputConfig]="{
            name: 'phone-extension',
            type: 'text',
            label: 'Ext.',
            minLength: 1,
            maxLength: 8,
            placeholderIcon: 'phone-extension'
          }"
        ></app-ta-input>
      </div>
      <div class="email-field">
        <app-ta-input
          formControlName="email"
          [inputConfig]="{
            name: 'Email',
            type: 'text',
            label: 'Email',
            placeholderIcon: 'email',
            minLength: 5,
            maxLength: 64,
            textTransform: 'lowercase'
          }"
        ></app-ta-input>
      </div>
    </div>
    <div class="row last-row">
      <div class="col-10">
        <app-ta-input-address
          formControlName="address"
          [inputConfig]="{
            name: 'Address',
            type: 'text',
            label: 'Address, City, State Zip',
            isRequired: true,
            placeholderIcon: 'address',
            minLength: 6,
            maxLength: 256,
            textTransform: 'capitalize'
          }"
          [activeAddress]="selectedAddress"
          (selectedAddress)="onHandleAddress($event)"
        ></app-ta-input-address>
      </div>
      <div class="col-2">
        <app-ta-input
          formControlName="addressUnit"
          [inputConfig]="{
            name: 'address-unit',
            type: 'text',
            label: 'Unit #',
            textTransform: 'uppercase',
            minLength: 1,
            maxLength: 10
          }"
        ></app-ta-input>
      </div>
    </div>
    <!-- Company Owned -->
    <div class="custom-checkbox-card">
      <div class="divider"></div>
      <div class="checkbox-card-header pointer">
        <app-ta-checkbox
          formControlName="companyOwned"
          [label]="'Company Owned'"
        ></app-ta-checkbox>
      </div>
    </div>
    <!-- Repair Shop Servies -->
    <app-ta-custom-card
      [hasCounter]="pickedServices() ? pickedServices() : 0"
      [cardName]="'Service'"
      [isCardOpen]="true"
    >
      <div class="repair-shop-services">
        <div
          *ngFor="let repair of services; trackBy: identity"
          class="repair-shop-service"
          [ngClass]="{ active: repair.active }"
          (click)="repair.active = !repair.active"
        >
          <svg-icon src="{{ repair.svg }}"></svg-icon>
          <p>{{ repair.serviceType }}</p>
        </div>
      </div>
    </app-ta-custom-card>
    <!-- Open Hours -->
    <div class="open-hours-card-repair-shop">
      <app-ta-custom-card
        [cardName]="'Open Hours'"
        [isCardOpen]="true"
        [hasBodyData]="true"
      >
        <div
          formArrayName="openHours"
          class="common-fake-table-modal common-fake-table-modal-repair-shop-open-hours"
        >
          <div class="common-fake-table-label">
            <p>DAY</p>
            <p>FROM</p>
            <p>TO</p>
          </div>
          <div *ngFor="let openHour of openHours.controls; let ind = index">
            <div [formGroupName]="ind" class="common-fake-table-card">
              <app-ta-checkbox
                formControlName="isDay"
                [customClass]="'medium'"
                [name]="openHour.get('dayLabel').value"
                [label]="openHour.get('dayLabel').value"
                (formArrayAction)="openHourDayAction($event, ind)"
              ></app-ta-checkbox>
              <!-- Time Picker -->
              <app-ta-input
                *ngIf="openHour.get('isDay').value"
                formControlName="startTime"
                [inputConfig]="{
                  name: 'timepicker',
                  type: 'text',
                  placeholderIcon: 'time',
                  customClass: 'datetimeclass repair-shop-open-hour',
                  hideClear: true
                }"
              ></app-ta-input>
              <app-ta-input
                *ngIf="openHour.get('isDay').value"
                formControlName="endTime"
                [inputConfig]="{
                  name: 'timepicker',
                  type: 'text',
                  placeholderIcon: 'time',
                  customClass: 'datetimeclass repair-shop-open-hour',
                  hideClear: true
                }"
              ></app-ta-input>
            </div>
          </div>
        </div>
      </app-ta-custom-card>
    </div>

    <!-- Bank Account -->
    <app-ta-custom-card [cardName]="'Bank Account'" [isCardOpen]="true">
      <div class="custom-bank-row">
        <div class="bank-field">
          <app-ta-input-dropdown
            formControlName="bankId"
            [template]="'svg-template'"
            [inputConfig]="{
              name: 'Input Dropdown  Bank Name',
              type: 'text',
              label: 'Bank Name',
              minLength: 2,
              maxLength: 64,
              textTransform: 'uppercase',
              isDropdown: true,
              dropdownWidthClass: 'w-col-163'
            }"
            [canAddNew]="true"
            [options]="labelsBank"
            [activeItem]="selectedBank"
            (selectedItem)="onSelectDropdown($event, 'bank')"
            (saveItem)="onSaveNewBank($event)"
          ></app-ta-input-dropdown>
        </div>
        <div class="bank-field">
          <app-ta-input
            formControlName="routing"
            [inputConfig]="{
              name: 'routing-bank',
              type: 'text',
              label: 'Routing #',
              isDisabled: !isBankSelected,
              isRequired: isBankSelected,
              minLength: 9,
              maxLength: 9
            }"
          ></app-ta-input>
        </div>
        <div class="bank-field">
          <app-ta-input
            formControlName="account"
            [inputConfig]="{
              name: 'account-bank',
              type: 'text',
              label: 'Account #',
              isDisabled: !isBankSelected,
              isRequired: isBankSelected,
              maxLength: 17,
              minLength: 5
            }"
          ></app-ta-input>
        </div>
      </div>
    </app-ta-custom-card>
    <!-- Note -->
    <app-ta-input-note
      formControlName="note"
      [isVisibleNote]="repairShopForm.get('note').value"
    ></app-ta-input-note>
  </form>
</app-ta-modal>
