<app-ta-modal
    [modalTitle]="
        editData?.type !== 'edit' ? 'Add Repair Shop' : 'Edit Repair Shop'
    "
    [editData]="editData"
    [editName]="editData?.data?.name"
    [saveAndAddNew]="editData?.type !== 'edit'"
    [isModalValid]="repairShopForm.valid && isFormDirty"
    (action)="onModalAction($event)"
>
    <div origin>
        <app-ta-tab-switch
            [tabs]="tabs"
            (switchClicked)="tabChange($event)"
            [type]="'type1-modal-popup'"
        >
        </app-ta-tab-switch>

        <form
            [formGroup]="repairShopForm"
            class="form-container form-container-without-mb"
            [ngClass]="{
                'tab-2': selectedTab !== 1
            }"
        >
            <div
                class="animation-three-tabs"
                [@animationTabsModal]="animationObject"
            >
                <!-- Details Tab -->
                <div class="m-tab" *ngIf="selectedTab === 1">
                    <div class="row">
                        <div class="col-11">
                            <app-ta-input
                                formControlName="name"
                                [inputConfig]="{
                                    name: 'Shop Name',
                                    type: 'text',
                                    label: 'Shop Name',
                                    isRequired: true,
                                    textTransform: 'uppercase',
                                    autoFocus: editData?.type !== 'edit',
                                    minLength: 2,
                                    maxLength: 64
                                }"
                            ></app-ta-input>
                        </div>
                        <div class="col-1">
                            <svg-icon
                                class="repair-shop-star"
                                [class.active]="isRepairShopFavourite"
                                src="assets/svg/common/ic_star.svg"
                                (click)="favouriteRepairShop()"
                            ></svg-icon>
                        </div>
                    </div>

                    <div
                        class="phone-ext-email-small-modal phone-ext-email-small-modal-my-32"
                        [ngClass]="{ 'active-phone-ext': isPhoneExtExist }"
                    >
                        <div class="phone-extension">
                            <div class="phone-field">
                                <app-ta-input
                                    formControlName="phone"
                                    [inputConfig]="{
                                        name: 'Phone',
                                        type: 'text',
                                        label: 'Phone',
                                        isRequired: true,
                                        placeholderIcon: 'phone',
                                        mask: '(000) 000-0000',
                                        maxLength: 14
                                    }"
                                ></app-ta-input>
                            </div>
                            <div
                                class="extension-field"
                                *ngIf="!isPhoneExtExist"
                                ngbTooltip
                                mainTooltip="Add Extension"
                                position="top"
                                tooltipBackground="#6c6c6c"
                                (click)="isPhoneExtExist = !isPhoneExtExist"
                            >
                                <svg-icon
                                    src="assets/svg/common/ic_plus.svg"
                                ></svg-icon>
                            </div>
                            <app-ta-input
                                *ngIf="isPhoneExtExist"
                                formControlName="phoneExt"
                                [inputConfig]="{
                                    name: 'phone-extension',
                                    type: 'text',
                                    label: 'Ext.',
                                    minLength: 1,
                                    maxLength: 8,
                                    placeholderIcon: 'phone-extension'
                                }"
                            ></app-ta-input>
                        </div>
                        <div class="email-field">
                            <app-ta-input
                                formControlName="email"
                                [inputConfig]="{
                                    name: 'Email',
                                    type: 'text',
                                    label: 'Email',
                                    placeholderIcon: 'email',
                                    minLength: 5,
                                    maxLength: 64,
                                    textTransform: 'lowercase'
                                }"
                            ></app-ta-input>
                        </div>
                    </div>
                    <div class="row last-row">
                        <div class="col-10">
                            <app-input-address-dropdown
                                formControlName="address"
                                [inputConfig]="{
                                    name: 'Address',
                                    type: 'text',
                                    label: 'Address, City, State Zip',
                                    isRequired: true,
                                    placeholderIcon: 'address',
                                    textTransform: 'capitalize',
                                    dropdownWidthClass: 'w-col-376',
                                    minLength: 6,
                                    maxLength: 256
                                }"
                                [placeholderType]="'longAddress'"
                                [activeAddress]="selectedAddress"
                                (selectedAddress)="onHandleAddress($event)"
                            ></app-input-address-dropdown>
                        </div>
                        <div class="col-2">
                            <app-ta-input
                                formControlName="addressUnit"
                                [inputConfig]="{
                                    name: 'address-unit',
                                    type: 'text',
                                    label: 'Unit #',
                                    textTransform: 'uppercase',
                                    minLength: 1,
                                    maxLength: 10
                                }"
                            ></app-ta-input>
                        </div>
                    </div>

                    <!-- Repair Shop Servies -->
                    <app-ta-custom-card
                        [hasCounter]="pickedServices() ? pickedServices() : 0"
                        [cardName]="'Service'"
                        [disableAnimation]="disableCardAnimation"
                        [isCardOpen]="true"
                    >
                        <div class="repair-shop-services">
                            <div
                                *ngFor="
                                    let repair of services;
                                    trackBy: identity
                                "
                                class="repair-shop-service"
                                [ngClass]="{ active: repair.active }"
                                (click)="repair.active = !repair.active"
                            >
                                <svg-icon src="{{ repair.svg }}"></svg-icon>
                                <p>{{ repair.serviceType }}</p>
                            </div>
                        </div>
                    </app-ta-custom-card>
                    <!-- Open Hours -->
                    <div class="open-hours-card-repair-shop">
                        <app-ta-custom-card
                            [cardName]="'Work Hours'"
                            [isCardOpen]="true"
                            [disableAnimation]="disableCardAnimation"
                            [hasBodyData]="true"
                        >
                            <div
                                formArrayName="openHours"
                                class="common-fake-table-modal common-fake-table-modal-repair-shop-open-hours"
                            >
                                <div class="common-fake-table-label">
                                    <p>DAY</p>
                                    <p>FROM</p>
                                    <p>TO</p>
                                </div>
                                <div class="common-fake-table-body">
                                    <div
                                        *ngFor="
                                            let openHour of openHours.controls;
                                            let ind = index
                                        "
                                    >
                                        <div
                                            [formGroupName]="ind"
                                            class="common-fake-table-card"
                                            *ngIf="
                                                ind === 0 ||
                                                ind ===
                                                    openHours.controls.length -
                                                        1 ||
                                                isDaysVisible
                                            "
                                        >
                                            <!-- Switch for all days -->
                                            <div
                                                *ngIf="ind === 0"
                                                class="time-picker-all-days"
                                            >
                                                <svg-icon
                                                    class="time-picker-all-days-btn"
                                                    [ngClass]="{
                                                        rotate: isDaysVisible
                                                    }"
                                                    src="assets/svg/common/ic_arrow_down_updated.svg"
                                                    (click)="toggleDays()"
                                                ></svg-icon>
                                                <span
                                                    class="time-picker-all-days-title"
                                                >
                                                    {{
                                                        openHour.get('dayLabel')
                                                            .value
                                                    }}
                                                </span>
                                            </div>

                                            <!-- Other Days Check -->
                                            <app-ta-checkbox
                                                *ngIf="ind !== 0"
                                                formControlName="isDay"
                                                [customClass]="'medium'"
                                                [name]="
                                                    openHour.get('dayLabel')
                                                        .value
                                                "
                                                [label]="
                                                    openHour.get('dayLabel')
                                                        .value
                                                "
                                                (formArrayAction)="
                                                    openHourDayAction(
                                                        $event,
                                                        ind
                                                    )
                                                "
                                            ></app-ta-checkbox>

                                            <!-- Time Picker -->
                                            <app-ta-input
                                                formControlName="startTime"
                                                [inputConfig]="{
                                                    name: 'timepicker',
                                                    type: 'text',
                                                    placeholderIcon: 'time',
                                                    customClass:
                                                        'datetimeclass repair-shop-open-hour',
                                                    hideClear: true
                                                }"
                                            ></app-ta-input>
                                            <app-ta-input
                                                formControlName="endTime"
                                                [inputConfig]="{
                                                    name: 'timepicker',
                                                    type: 'text',
                                                    placeholderIcon: 'time',
                                                    customClass:
                                                        'datetimeclass repair-shop-open-hour',
                                                    hideClear: true
                                                }"
                                            ></app-ta-input>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </app-ta-custom-card>
                    </div>

                    <!-- Bank Account -->
                    <app-ta-custom-card
                        [cardName]="'Bank Account'"
                        [isCardOpen]="true"
                        [disableAnimation]="disableCardAnimation"
                        [animationMarginParams]="{
                            marginTop: '18px',
                            marginBottom: '22px'
                        }"
                    >
                        <div
                            class="custom-bank-row custom-bank-row-repair-shop"
                        >
                            <app-ta-input-dropdown
                                formControlName="bankId"
                                [template]="'svg-template'"
                                [inputConfig]="{
                                    name: 'Input Dropdown Bank Name',
                                    type: 'text',
                                    label: 'Bank Name',
                                    minLength: 2,
                                    maxLength: 64,
                                    textTransform: 'uppercase',
                                    isDropdown: true,
                                    dropdownWidthClass: 'w-col-163'
                                }"
                                [canAddNew]="true"
                                [options]="labelsBank"
                                [activeItem]="selectedBank"
                                (selectedItem)="
                                    onSelectDropdown($event, 'bank')
                                "
                                (saveItem)="onSaveNewBank($event)"
                            ></app-ta-input-dropdown>
                            <app-ta-input
                                formControlName="routing"
                                [inputConfig]="{
                                    name: 'routing-bank',
                                    type: 'text',
                                    label: 'Routing #',
                                    isDisabled: !isBankSelected,
                                    isRequired: isBankSelected,
                                    minLength: 9,
                                    maxLength: 9
                                }"
                            ></app-ta-input>
                            <app-ta-input
                                formControlName="account"
                                [inputConfig]="{
                                    name: 'account-bank',
                                    type: 'text',
                                    label: 'Account #',
                                    isDisabled: !isBankSelected,
                                    isRequired: isBankSelected,
                                    maxLength: 17,
                                    minLength: 5
                                }"
                            ></app-ta-input>
                        </div>
                    </app-ta-custom-card>
                    <div class="ta-card-body-overflow-none">
                        <app-ta-custom-card
                            [hasCounter]="
                                documents.length ? documents.length : 0
                            "
                            [cardName]="'Documents'"
                            [disableAnimation]="disableCardAnimation"
                            [isCardOpen]="documents.length > 0"
                        >
                            <app-ta-upload-files
                                [files]="documents"
                                [showDropzone]="true"
                                (onFileEvent)="onFilesEvent($event)"
                            ></app-ta-upload-files>
                        </app-ta-custom-card>
                    </div>
                    <!-- Note -->
                    <app-ta-input-note
                        formControlName="note"
                        [isVisibleNote]="
                            repairShopForm.get('note').value &&
                            repairShopForm.get('note').value != 'null'
                                ? repairShopForm.get('note').value
                                : false
                        "
                        [note]="
                            repairShopForm.get('note').value &&
                            repairShopForm.get('note').value != 'null'
                                ? repairShopForm.get('note').value
                                : ''
                        "
                    ></app-ta-input-note>
                </div>
                <!-- Contact Tab -->
                <div class="m-tab" *ngIf="selectedTab === 2">
                    <app-ta-custom-card
                        [hasCounter]="contacts.length ? contacts.length : 0"
                        [cardName]="'Contact'"
                        [hasActionSvg]="'assets/svg/common/ic_plus.svg'"
                        [hasArrow]="false"
                        [isCommentData]="true"
                        [isCardOpen]="contacts.length > 0"
                        [hasScrollBody]="contacts.length > 10"
                        [hasBodyData]="contacts.length > 0"
                        [disabledCard]="!contacts.length"
                        [disableAnimation]="disableCardAnimation"
                        [animationMarginParams]="{
                            marginTop: '10px',
                            marginBottom: '5px'
                        }"
                        (onActionEvent)="addContacts($event)"
                    >
                        <div
                            formArrayName="contacts"
                            class="common-fake-table-modal common-fake-table-modal-original-repair-shop"
                            *ngIf="contacts.length"
                            (scroll)="onScrollingContacts($event)"
                        >
                            <div class="common-fake-table-label">
                                <p>FULL NAME <span>*</span></p>
                                <p>DEPARTMENT <span>*</span></p>
                                <p>PHONE <span>*</span></p>
                                <p>EXT</p>
                                <p>EMAIL</p>
                            </div>
                            <div class="common-fake-table-body">
                                <div
                                    *ngFor="
                                        let contact of contacts.controls;
                                        let ind = index
                                    "
                                >
                                    <div
                                        [formGroupName]="ind"
                                        class="common-fake-table-card"
                                    >
                                        <app-ta-input
                                            formControlName="contactName"
                                            [inputConfig]="{
                                                id: 'Full Name' + ind,
                                                name: 'Full Name',
                                                type: 'text',
                                                minLength: 2,
                                                maxLength: 32,
                                                textTransform: 'capitalize',
                                                hideRequiredCheck: true,
                                                hideErrorMessage: true
                                            }"
                                        ></app-ta-input>
                                        <app-ta-input-dropdown
                                            formControlName="departmentId"
                                            [inputConfig]="{
                                                id: 'Input Dropdown' + ind,
                                                name: 'Input Dropdown Department',
                                                type: 'text',
                                                textTransform: 'capitalize',
                                                isDropdown: true,
                                                dropdownWidthClass: 'w-col-120',
                                                minLength: 2,
                                                maxLength: 36,
                                                hideRequiredCheck: true,
                                                hideErrorMessage: true
                                            }"
                                            [activeItem]="
                                                selectedContractDepartmentFormArray[
                                                    ind
                                                ]
                                            "
                                            [options]="labelsDepartments"
                                            (selectedItem)="
                                                onSelectDropDown(
                                                    $event,
                                                    'contact-department',
                                                    ind
                                                )
                                            "
                                        ></app-ta-input-dropdown>
                                        <app-ta-input
                                            formControlName="phone"
                                            [inputConfig]="{
                                                id: 'Phone' + ind,
                                                name: 'Phone',
                                                type: 'text',
                                                mask: '(000) 000-0000',
                                                maxLength: 14,
                                                hideRequiredCheck: true,
                                                hideErrorMessage: true
                                            }"
                                        ></app-ta-input>
                                        <app-ta-input
                                            formControlName="extensionPhone"
                                            [inputConfig]="{
                                                id: 'Phone Extension' + ind,
                                                name: 'phone-extension',
                                                type: 'text',
                                                minLength: 1,
                                                maxLength: 8,
                                                hideRequiredCheck: true,
                                                hideErrorMessage: true
                                            }"
                                        ></app-ta-input>
                                        <app-ta-input
                                            formControlName="email"
                                            [inputConfig]="{
                                                id: 'Email' + ind,
                                                name: 'Email',
                                                type: 'text',
                                                hideRequiredCheck: true,
                                                blackInput: true,
                                                hideErrorMessage: true,
                                                minLength: 5,
                                                maxLength: 64,
                                                textTransform: 'lowercase'
                                            }"
                                        ></app-ta-input>
                                        <div
                                            ngbTooltip
                                            mainTooltip="Delete"
                                            position="top"
                                            tooltipBackground="#EF5350"
                                            class="common-fake-table-delete"
                                            [ngClass]="{
                                                scrolling:
                                                    isContactCardsScrolling
                                            }"
                                        >
                                            <svg-icon
                                                src="assets/svg/common/ic_trash.svg"
                                                (click)="removeContacts(ind)"
                                            ></svg-icon>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </app-ta-custom-card>
                </div>
                <!-- Review Tab -->
                <div class="m-tab" *ngIf="selectedTab === 3">
                    <app-ta-custom-card
                        [hasCounter]="reviews.length ? reviews.length : 0"
                        [cardName]="'Review'"
                        [hasActionSvg]="'assets/svg/common/ic_plus.svg'"
                        [hasArrow]="false"
                        [hasLikeDislike]="true"
                        [isCardOpen]="true"
                        [isCommentData]="true"
                        [hasBodyData]="reviews.length > 0"
                        [hasScrollBody]="reviews.length > 6"
                        [disableMultipleReviews]="disableOneMoreReview"
                        [disableAnimation]="disableCardAnimation"
                        [animationMarginParams]="{
                            marginTop: '10px',
                            marginBottom: '12px'
                        }"
                        (onActionEvent)="createReview()"
                    >
                        <div class="no-review-broker" *ngIf="!reviews.length">
                            <svg-icon
                                class="no-review-svg"
                                src="assets/svg/common/ic_no_review.svg"
                            ></svg-icon>
                        </div>
                        <app-ta-user-review
                            *ngIf="reviews.length"
                            [reviewData]="reviews"
                            [isNewReview]="reviews[0].isNewReview"
                            (changeReviewsEvent)="changeReviewsEvent($event)"
                        ></app-ta-user-review>
                    </app-ta-custom-card>
                </div>
            </div>
        </form>
    </div>
</app-ta-modal>
