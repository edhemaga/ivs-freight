<app-ta-modal
  [modalTitle]="editData?.header?.concat(' ', 'PM')"
  [editData]="editData"
  [editName]="
    editData?.action?.includes('unit-pm')
      ? 'Unit'.concat(' ', editData?.data?.textUnit)
      : null
  "
  [disableDelete]="true"
  [isModalValid]="PMform.valid"
  (action)="onModalAction($event)"
>
  <form [formGroup]="PMform" class="form-container">
    <app-ta-custom-card
      [hasCounter]="activePMs()"
      [hasDivider]="false"
      [cardName]="'Selected'"
      [hasActionSvg]="
        editData?.action?.includes('unit-pm')
          ? null
          : 'assets/svg/common/ic_plus.svg'
      "
      [hasArrow]="false"
      [isCommentData]="true"
      [isCardOpen]="defaultPMs.length"
      [hasScrollBody]="defaultPMs.length > 18"
      (onActionEvent)="
        addPMs(null, 'new-pm', editData?.header === 'Truck' ? 5000 : 1)
      "
    >
      <!-- Default PMs -->
      <div
        formArrayName="defaultPMs"
        class="common-fake-table-modal common-fake-table-modal-pm"
        *ngIf="defaultPMs.length"
      >
        <div class="common-fake-table-label">
          <p></p>
          <p>TITLE</p>
          <p>
            {{ editData?.header?.includes("Truck") ? "MILEAGE" : "MONTHS" }}
          </p>
        </div>
        <div
          *ngFor="
            let pm of defaultPMs.controls;
            let ind = index;
            trackBy: identity
          "
        >
          <div [formGroupName]="ind" class="common-fake-table-card">
            <app-ta-checkbox
              formControlName="isChecked"
              [name]="ind + 'default'"
              [customClass]="'regular'"
              [disabled]="
                editData?.header?.includes('Truck') ? ind < 4 : ind < 1
              "
              [svg]="pm.get('svg').value"
              [label]="pm.get('title').value"
            >
            </app-ta-checkbox>

            <app-ta-input
              formControlName="mileage"
              [inputConfig]="{
                name: editData?.header?.includes('Truck')
                  ? 'MILEAGE'
                  : 'MONTHS',
                type: 'text',
                hideErrorMessage: true,
                blackInput: true,
                hideRequiredCheck: true,
                commands: {
                  active: true,
                  type: 'pm-increment-decrement',
                  firstCommand: {
                    name: 'decrement',
                    svg: 'assets/svg/common/ic_pm_decrement.svg'
                  },
                  secondCommand: {
                    name: 'increment',
                    svg: 'assets/svg/common/ic_pm_increment.svg'
                  }
                },
                thousandSeparator: true,
                maxLength: editData?.header?.includes('Truck') ? 999999999 : 2
              }"
            ></app-ta-input>
          </div>
        </div>
      </div>

      <!-- New PMs -->
      <div
        formArrayName="newPMs"
        class="common-fake-table-modal common-fake-table-modal-pm"
        [ngStyle]="{ 'margin-top': '0px' }"
        *ngIf="newPMs.length"
      >
        <div
          *ngFor="let pm of newPMs.controls; let ind = index; trackBy: identity"
        >
          <div [formGroupName]="ind" class="common-fake-table-card">
            <app-ta-checkbox
              formControlName="isChecked"
              [name]="ind + 'new'"
              [customClass]="'regular'"
              [svg]="pm.get('svg').value"
              [label]="pm.get('value').value"
            >
            </app-ta-checkbox>
            <div
              class="pm-new-input-container"
              [ngStyle]="{ position: 'absolute', left: '25.5px' }"
              *ngIf="!pm.get('hidden').value"
            >
              <app-ta-input
                formControlName="value"
                [inputConfig]="{
                  name: 'Description',
                  type: 'text',
                  blackInput: true,
                  hideErrorMessage: true,
                  hideRequiredCheck: true,
                  minLength: 20,
                  maxLength: 160,
                  textTransform: 'capitalize',
                  placeholderIcon: 'default_pm'
                }"
                (change)="onChangeValueNewPM(ind)"
              ></app-ta-input>
            </div>

            <app-ta-input
              formControlName="mileage"
              [inputConfig]="{
                name: editData?.header?.includes('Truck')
                  ? 'MILEAGE'
                  : 'MONTHS',
                type: 'text',
                hideErrorMessage: true,
                blackInput: true,
                hideRequiredCheck: true,
                commands: {
                  active: true,
                  type: 'pm-increment-decrement',
                  firstCommand: {
                    name: 'decrement',
                    svg: 'assets/svg/common/ic_pm_decrement.svg'
                  },
                  secondCommand: {
                    name: 'increment',
                    svg: 'assets/svg/common/ic_pm_increment.svg'
                  }
                },
                thousandSeparator: true,
                maxLength: editData?.header?.includes('Truck') ? 999999999 : 2
              }"
            ></app-ta-input>

            <div
              *ngIf="editData?.type === 'new'"
              ngbTooltip
              mainTooltip="Delete"
              position="top"
              tooltipBackground="#EF5350"
              class="common-fake-table-delete"
              (click)="removeNewPMs(ind)"
            >
              <svg-icon src="assets/svg/common/ic_trash.svg"></svg-icon>
            </div>
          </div>
        </div>
      </div>
    </app-ta-custom-card>
  </form>
</app-ta-modal>
