<app-ta-modal
  [modalTitle]="
    editData?.type !== 'edit' ? 'Add Fuel Transaction' : 'Edit Fuel Transaction'
  "
  [editData]="editData"
  [editName]="editData?.id"
  [isModalValid]="fuelForm.valid"
  (modalActionTypeEmitter)="onModalAction($event)"
>
  <form [formGroup]="fuelForm" class="form-container">
    <div class="row">
      <div class="col-6">
        <app-ta-input-dropdown
          formControlName="truckTypeId"
          [template]="'svgtext-template'"
          [inputConfig]="{
            name: 'Input Dropdown',
            type: 'text',
            label: 'Truck #',
            isRequired: true,
            isDropdown: true,
            dropdownWidthClass: 'w-col-6-truckType'
          }"
          [options]="truckType"
          (selectedItem)="onSelectDropdown($event, 'truck')"
        ></app-ta-input-dropdown>
      </div>
      <div class="col-6">
        <app-ta-input
          formControlName="fullName"
          [inputConfig]="{
            name: 'Full name',
            type: 'text',
            label: 'Driver',
            isDisabled: true,
            textTransform: 'capitalize'
          }"
        ></app-ta-input>
      </div>
    </div>
    <div class="row">
      <div class="col-6">
        <app-ta-input
          formControlName="date"
          [inputConfig]="{
            name: 'datepicker',
            type: 'text',
            label: 'Date',
            placeholderIcon: 'date',
            isRequired: true,
            customClass: 'datetimeclass'
          }"
        ></app-ta-input>
      </div>
      <div class="col-6">
        <!-- Time Picker -->
        <app-ta-input
          formControlName="time"
          [inputConfig]="{
            name: 'timepicker',
            type: 'text',
            label: 'Time',
            placeholderIcon: 'time',
            customClass: 'datetimeclass'
          }"
        ></app-ta-input>
      </div>
    </div>
    <div class="row last-row">
      <div class="col-8">
        <app-ta-input-dropdown
          formControlName="fuelStopId"
          [inputConfig]="{
            name: 'Input Dropdown',
            type: 'text',
            label: 'Fuel Stop',
            isRequired: true,
            isDropdown: true,
            dropdownWidthClass: 'w-col-8-fuelstop'
          }"
          [options]="fuelStops"
          (selectedItem)="onSelectDropdown($event, 'fuel')"
        ></app-ta-input-dropdown>
      </div>
      <div class="col-4">
        <app-ta-input-dropdown
          formControlName="storeId"
          [inputConfig]="{
            name: 'Input Dropdown',
            type: 'text',
            label: 'Store #',
            isDropdown: true,
            dropdownWidthClass: 'w-col-4'
          }"
          [options]="storeType"
          (selectedItem)="onSelectDropdown($event, 'store')"
        ></app-ta-input-dropdown>
      </div>
    </div>
    <!-- Fake Table Card -->
    <app-ta-custom-card
      [hasCounter]="fuelItems.length ? fuelItems.length : '0'"
      [cardName]="'Items'"
      [hasActionSvg]="'assets/svg/common/ic_plus.svg'"
      [hasArrow]="false"
      [isCommentData]="true"
      [isCardOpen]="fuelItems.length"
      [hasBodyData]="fuelItems.length"
      [hasScrollBody]="fuelItems.length > 10"
      (onActionEvent)="addFuelItems($event)"
    >
      <div
        cdkDropList
        (cdkDropListDropped)="drop($event)"
        formArrayName="fuelItems"
        class="common-fake-table-modal common-fake-table-modal-fuel-transaction"
        *ngIf="fuelItems.length"
      >
        <div class="common-fake-table-label">
          <p>#</p>
          <p>ITEM <span>*</span></p>
          <p>QTY <span>*</span></p>
          <p>PRICE <span>*</span></p>
          <p>SUBTOTAL</p>
        </div>
        <div
          *ngFor="let fuelItem of fuelItems.controls; let ind = index"
          cdkDrag
        >
          <div [formGroupName]="ind" class="common-fake-table-card">
            <p>{{ fuelItem.controls.id.value }}</p>
            <app-ta-input-dropdown
              formControlName="itemId"
              [inputConfig]="{
                name: 'Input Dropdown',
                type: 'text',
                isDropdown: true,
                dropdownWidthClass: 'w-col-custom-fuel-modal-dropdown'
              }"
              [options]="fuelItemsDropdown"
              (selectedItem)="onSelectDropDown($event, 'fuel-items', ind)"
            ></app-ta-input-dropdown>

            <app-ta-input
              formControlName="qty"
              [inputConfig]="{
                name: 'QTY',
                type: 'text',
                textTransform: 'capitalize'
              }"
              (change)="onChange('qty', ind)"
            ></app-ta-input>
            <app-ta-input
              formControlName="price"
              [inputConfig]="{
                name: 'Price',
                type: 'text',
                textTransform: 'capitalize',
                mask: 'separator.2'
              }"
              (change)="onChange('price', ind)"
            ></app-ta-input>
            <p class="fuel-subtotal">{{ subtotal[ind].value | currency }}</p>
            <div
              ngbTooltip
              mainTooltip="Delete"
              position="top"
              tooltipBackground="#EF5350"
              class="common-fake-table-delete"
              [ngClass]="{
                'new-position':
                  isContactCardsScrolling && brokerContact.get('email').value,
                'new-position-without-email':
                  isContactCardsScrolling && !brokerContact.get('email').value
              }"
              (click)="removeFuelItems(ind, fuelItem.controls)"
            >
              <svg-icon src="assets/svg/common/ic_trash.svg"></svg-icon>
            </div>
          </div>
        </div>
      </div>
      <div class="row fuel-total-row">
        <p class="fuel-total">
          <span class="fuel-total-text">TOTAL</span>
          {{ subtotal | fuelTotal | currency }}
        </p>
      </div>
    </app-ta-custom-card>
  </form>
</app-ta-modal>
