<app-ta-modal
  [modalTitle]="
    editData?.type !== 'edit' ? 'Add Fuel Transaction' : 'Edit Fuel Transaction'
  "
  [editData]="editData"
  [editName]="editData?.id"
  [isModalValid]="fuelForm.valid && isFormDirty"
  (action)="onModalAction($event)"
>
  <form
    origin
    [formGroup]="fuelForm"
    class="form-container form-container-without-mb"
  >
    <div class="row">
      <div [ngClass]="fuelForm.get('trailerId').value ? 'col-4' : 'col-6'">
        <app-ta-input-dropdown
          formControlName="truckId"
          [template]="'svgtext-template'"
          [inputConfig]="{
            name: 'Input Dropdown',
            type: 'text',
            label: 'Truck',
            isRequired: true,
            isDropdown: true,
            dropdownWidthClass: 'w-col-216'
          }"
          [options]="truckType"
          [activeItem]="selectedTruckType"
          (selectedItem)="onSelectDropDown($event, 'truck')"
        ></app-ta-input-dropdown>
      </div>
      <div *ngIf="fuelForm.get('trailerId').value" class="col-4">
        <app-ta-input
          formControlName="trailerId"
          [inputConfig]="{
            name: 'Fuel Trailer',
            type: 'text',
            label: 'Trailer',
            isDisabled: true
          }"
        ></app-ta-input>
      </div>
      <div
        [ngClass]="
          fuelForm.get('trailerId').value ? 'col-4 no-p-left' : 'col-6'
        "
      >
        <app-ta-input
          formControlName="driverFullName"
          [inputConfig]="{
            name: 'Full name',
            type: 'text',
            label: 'Driver',
            isDisabled: true,
            textTransform: 'capitalize',
            minLength: 2,
            maxLength: 32
          }"
        ></app-ta-input>
      </div>
    </div>
    <div class="row">
      <div class="col-6">
        <app-ta-input
          formControlName="transactionDate"
          [inputConfig]="{
            name: 'datepicker',
            type: 'text',
            label: 'Date',
            placeholderIcon: 'date',
            isRequired: true,
            isDropdown: true,
            customClass: 'datetimeclass'
          }"
        ></app-ta-input>
      </div>
      <div class="col-6">
        <!-- Time Picker -->
        <app-ta-input
          formControlName="transactionTime"
          [inputConfig]="{
            name: 'timepicker',
            type: 'text',
            isDropdown: true,
            label: 'Time',
            placeholderIcon: 'time',
            customClass: 'datetimeclass'
          }"
        ></app-ta-input>
      </div>
    </div>
    <div class="row last-row">
      <div class="col-12">
        <div *ngIf="selectedFuelStop" class="selected-item-container">
          <div class="selected-item-label">Fuel Stop <span>*</span></div>
          <p class="selected-item-name">
            {{ selectedFuelStop?.businessName }}
            {{ "#".concat(" ", selectedFuelStop?.name) }}
          </p>
          <div class="selected-item-additional">
            <div *ngIf="selectedFuelStop?.address" class="selected-item-info">
              <svg-icon src="assets/svg/common/ic_address.svg"></svg-icon>
              <p>
                {{ selectedFuelStop?.fullAddress }}
              </p>
            </div>
          </div>
          <div class="clear-selected-item">
            <div
              ngbTooltip
              mainTooltip="Clear"
              tooltipBackground="#6c6c6c"
              position="top"
              class="clear-x"
              (click)="
                selectedFuelStop = null;
                fuelForm.get('fuelStopStoreId').patchValue(null)
              "
            >
              <svg-icon src="assets/svg/ic_x.svg"></svg-icon>
            </div>
          </div>
        </div>
        <app-ta-input-dropdown
          *ngIf="!selectedFuelStop"
          formControlName="fuelStopStoreId"
          [template]="'fuel-franchise'"
          [inputConfig]="{
            name: 'Input Dropdown',
            type: 'text',
            label: 'Fuel Stop',
            isRequired: true,
            isDropdown: true,
            dropdownWidthClass: 'w-col-456'
          }"
          [options]="fuelStops"
          [activeItem]="selectedFuelStop"
          (pagination)="paginationPage($event)"
          (activeGroup)="getFuelStoresByFranchiseId($event)"
          (selectedItem)="onSelectDropDown($event, 'fuel')"
        ></app-ta-input-dropdown>
      </div>
    </div>

    <!-- Fake Table Card -->
    <app-ta-custom-card
      [hasCounter]="fuelItems.length ? fuelItems.length : 0"
      [cardName]="'Item'"
      [headerSvgEnabled]="true"
      [hasActionSvg]="'assets/svg/common/ic_plus.svg'"
      [isCommentData]="true"
      [isCardOpen]="fuelItems.length > 0"
      [hasBodyData]="fuelItems.length > 0"
      [hasScrollBody]="fuelItems.length > 10"
      [actionText]="'ADD NEW ITEM'"
      (onActionEvent)="addFuelItems($event)"
    >
      <div
        cdkDropList
        (cdkDropListDropped)="drop($event)"
        formArrayName="fuelItems"
        class="common-fake-table-modal common-fake-table-modal-fuel-transaction"
        *ngIf="fuelItems.length"
      >
        <div class="common-fake-table-label">
          <p>#</p>
          <p>ITEM <span>*</span></p>
          <p>QTY</p>
          <p>PRICE</p>
          <p>SUBTOTAL</p>
        </div>
        <div class="common-fake-table-body">
          <div
            *ngFor="let fuelItem of fuelItems.controls; let ind = index"
            cdkDrag
          >
            <div
              [formGroupName]="ind"
              class="common-fake-table-card"
              (mouseenter)="hoverRowTable[ind] = true"
              (mouseleave)="hoverRowTable[ind] = false"
            >
              <p *ngIf="!hoverRowTable[ind]">{{ fuelItem.get("id").value }}</p>
              <svg-icon
                class="common-fake-table-card-transfer-svg"
                *ngIf="hoverRowTable[ind]"
                src="assets/svg/common/ic_transfer-array.svg"
              ></svg-icon>
              <app-ta-input-dropdown
                formControlName="itemId"
                [inputConfig]="{
                  name: 'Input Dropdown',
                  type: 'text',
                  isDropdown: true,
                  dropdownWidthClass: 'w-col-114',
                  hideErrorMessage: true,
                  blackInput: true,
                  hideRequiredCheck: true
                }"
                [options]="fuelItemsDropdown"
                [activeItem]="selectedFuelItemsFormArray[ind]"
                (selectedItem)="onSelectDropDown($event, 'fuel-items', ind)"
              ></app-ta-input-dropdown>

              <app-ta-input
                formControlName="qty"
                [inputConfig]="{
                  name: 'QTY',
                  type: 'text',
                  hideErrorMessage: true,
                  blackInput: true,
                  hideRequiredCheck: true
                }"
                (change)="onChange('qty', ind)"
              ></app-ta-input>
              <div class="fuel-item-price-container">
                <span
                  *ngIf="
                    fuelItem.get('price').value &&
                    fuelItem.get('price').value !== ''
                  "
                  class="fuel-item-price-dollar"
                >
                  $
                </span>
                <app-ta-input
                  formControlName="price"
                  [inputConfig]="{
                    name: 'Price',
                    type: 'text',
                    minLength: 4,
                    maxLength: 11,
                    blackInput: true,
                    hideClear: fuelItem.get('price').value === '',
                    hideErrorMessage: true,
                    thousandSeparator: true,
                    hideRequiredCheck: true
                  }"
                  (change)="onChange('price', ind)"
                ></app-ta-input>
              </div>

              <p class="fuel-subtotal">{{ subtotal[ind].value | currency }}</p>
              <div
                ngbTooltip
                mainTooltip="Delete"
                position="top"
                tooltipBackground="#EF5350"
                class="common-fake-table-delete"
                (click)="removeFuelItems(ind)"
              >
                <svg-icon src="assets/svg/common/ic_trash.svg"></svg-icon>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row fuel-total-row">
        <p class="fuel-total">
          <span class="fuel-total-text">TOTAL</span>
          {{ subtotal | sumArrays | currency }}
        </p>
      </div>
    </app-ta-custom-card>

    <div class="ta-card-body-overflow-none">
      <app-ta-custom-card
        [hasCounter]="documents.length ? documents.length : 0"
        [cardName]="'Documents'"
        [isCardOpen]="documents.length > 0"
      >
        <app-ta-upload-files
          [files]="documents"
          (onFileEvent)="onFilesEvent($event)"
        ></app-ta-upload-files>
      </app-ta-custom-card>
    </div>
  </form>
</app-ta-modal>
