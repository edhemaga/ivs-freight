<div
    class="ta-upload-file-container {{ customClassName }}"
    [class.keep_open]="t2?.isOpen()"
>
    <!-- File Header Actions -->

    <!-- Review Actions -->
    <div *ngIf="isReview" class="ta-upload-file-header-review">
        <div
            *ngIf="reviewMode === 'REVIEW_MODE'"
            ngbTooltip
            mainTooltip="Download"
            tooltipBackground="#6c6c6c"
            position="top"
            class="ta-upload-action-download-review"
            (click)="onAction('download')"
        >
            <svg-icon src="assets/svg/common/ic_download.svg"></svg-icon>
        </div>

        <div
            *ngIf="reviewMode === 'REVIEW_MODE'"
            ngbTooltip
            [mainTooltip]="
                file?.incorrect && isIncorrectMarkHover
                    ? 'Unmark'
                    : 'Mark Incorrect'
            "
            [tooltipBackground]="
                file?.incorrect && isIncorrectMarkHover ? '#6c6c6c' : '#EF5350'
            "
            position="top"
            class=" {{
                file?.incorrect && isIncorrectMarkHover
                    ? 'ta-upload-action-mark-correct'
                    : 'ta-upload-action-mark-incorrect'
            }}"
            [ngClass]="{ incorrect: file?.incorrect }"
            (click)="
                onAction(
                    file?.incorrect && isIncorrectMarkHover
                        ? 'mark-correct'
                        : 'mark-incorrect'
                )
            "
            (mouseenter)="isIncorrectMarkHover = true"
            (mouseleave)="isIncorrectMarkHover = false"
        >
            <svg-icon
                src="{{
                    file?.incorrect && isIncorrectMarkHover
                        ? 'assets/svg/common/ic_confirm.svg'
                        : 'assets/svg/ic_x.svg'
                }}"
            ></svg-icon>
        </div>

        <!-- Review Message -->
        <div
            class="review-feedback-container"
            *ngIf="
                reviewMode === 'REVIEW_MODE' || reviewMode === 'FEEDBACK_MODE'
            "
        >
            <app-applicant-review-feedback
                [formControl]="documentReviewInputControl"
                [displayAnnotationButton]="
                    file?.incorrect && !documentReviewInputVisible
                "
                [displayAnnotationTextArea]="
                    file?.incorrect && documentReviewInputVisible
                "
                [isFeedback]="reviewMode === 'FEEDBACK_MODE'"
                [feedbackText]="feedbackText"
                (annotationBtnClickEvent)="getAnnotationReviewEvent($event)"
            ></app-applicant-review-feedback>
        </div>
    </div>

    <!-- No Review Actions -->
    <div
        *ngIf="!isFileDelete || (isReview && reviewMode === 'FEEDBACK_MODE')"
        class="ta-upload-file-header"
    >
        <!-- Left Side -->
        <div
            class="ta-upload-file-action-leftside"
            [ngClass]="{ 'no-action-tag': !hasTag, active: t2?.isOpen() }"
            #t2="ngbPopover"
            [ngbPopover]="tagsPopover"
            [popoverClass]="'tags_popover'"
            [placement]="'left-top left-bottom'"
            autoclose="outside"
            [container]="'body'"
            triggers="'manual'"
        >
            <div
                ngbTooltip
                mainTooltip="Tag"
                tooltipBackground="#6c6c6c"
                position="top"
                class="ta-upload-action-tag"
                (click)="onAction('tag')"
            >
                <svg-icon src="assets/svg/common/ic_tag.svg"></svg-icon>
            </div>
        </div>
        <!-- Right Side -->
        <div
            class="ta-upload-file-action-rightside"
            [ngClass]="{
                'feedback-mode': isReview && reviewMode === 'FEEDBACK_MODE',
                small: type == 'details' || type == 'todo'
            }"
        >
            <div
                ngbTooltip
                mainTooltip="Download"
                tooltipBackground="#6c6c6c"
                position="top"
                class="ta-upload-action-download"
                (click)="onAction('download')"
            >
                <svg-icon src="assets/svg/common/ic_download.svg"></svg-icon>
            </div>
            <div
                ngbTooltip
                mainTooltip="Delete"
                tooltipBackground="#EF5350"
                position="top"
                class="ta-upload-action-delete"
                (click)="isFileDelete = true"
                *ngIf="type != 'details' && type != 'todo'"
            >
                <svg-icon src="assets/svg/common/ic_trash.svg"></svg-icon>
            </div>
        </div>
        <div
            *ngIf="isReview && reviewMode === 'FEEDBACK_MODE'"
            ngbTooltip
            mainTooltip="Marked Incorrect"
            tooltipBackground="#EF5350"
            position="top"
            class="ta-upload-action-feedback-incorrect-mark"
            (click)="onAction('feedback-mark-incorrect')"
        >
            <svg-icon
                src="assets/svg/common/ic_feedback_mark_incorrect.svg"
            ></svg-icon>
        </div>
    </div>

    <!-- File Content -->
    <div class="ta-upload-file-content  {{ customClassName }}">
        <!-- Pdf Content -->
        <pdf-viewer
            *ngIf="
                file?.extension?.toLowerCase() === 'pdf' ||
                fileExtension === 'pdf'
            "
            [src]="file?.url"
            [(page)]="activePage"
            style="display: block"
            [rotation]="0"
            [original-size]="false"
            [show-all]="true"
            [fit-to-page]="false"
            [zoom]="1"
            [zoom-scale]="'page-width'"
            [stick-to-page]="false"
            [render-text]="true"
            [external-link-target]="'blank'"
            [autoresize]="true"
            [show-borders]="false"
            (after-load-complete)="afterLoadComplete($event)"
        ></pdf-viewer>

        <!-- Image Content -->
        <img
            class="ta-upload-file-image"
            [class.details_image]="type == 'details' || type == 'todo'"
            *ngIf="
                file?.extension?.toLowerCase() != 'pdf' &&
                fileExtension != 'pdf'
            "
            [src]="file?.url"
            [alt]="file?.fileName"
        />

        <!-- Number of pages -->
        <div *ngIf="hasNumberOfPages" class="ta-upload-file-number-of-pages">
            <p>{{ numberOfFilePages }}</p>
        </div>

        <!-- Tag Content -->
        <div
            *ngIf="hasTag || categoryTag"
            class="ta-upload-file-tag"
            [ngClass]="{ 'no-tag': (!categoryTag && !file?.tag) || file?.tag == 'No Tag' }"
        >
            <span>{{ file?.tag ? file?.tag : categoryTag ? categoryTag : 'No Tag' }}</span>
        </div>
    </div>

    <!-- File Delete Template -->
    <div *ngIf="isFileDelete" class="ta-upload-file-delete-template">
        <div class="ta-upload-file-delete-text">
            Are you sure you want to delete file?
        </div>
        <div
            class="ta-upload-file-btn ta-upload-file-btn-delete"
            (click)="onAction('delete')"
        >
            Delete
        </div>
        <div
            class="ta-upload-file-btn ta-upload-file-btn-cancel"
            (click)="onAction('cancel')"
        >
            Cancel
        </div>
    </div>

    <!-- File Footer Information -->
    <div
        class="ta-upload-file-footer"
        [ngClass]="{ 'edit-mode': editFile }"
        (click)="onEditFile()"
    >
        <!-- No edit mode -->
        <div class="footer_info">
            <div
                class="ta-upload-file-ext ta-upload-file-ext-{{
                    file?.extension
                        ? file?.extension
                        : (fileExtension | lowercase)
                }}"
                [ngClass]="{ 'no-tag': !file?.tag }"
            >
                <div *ngIf="file?.extension">
                    {{ file?.extension | uppercase }}
                </div>
                <div *ngIf="!file?.extension">
                    {{ file?.url | urlExtension }}
                </div>
            </div>
            <div class="document_info_hold">
                <div
                    class="pdf_page_size"
                    *ngIf="
                        numberOfFilePages &&
                        (file?.extension?.toLowerCase() == 'pdf' ||
                            fileExtension === 'pdf')
                    "
                >
                    {{ numberOfFilePages }}
                </div>
                <div
                    class="file_size"
                    [class.has_pages]="
                        numberOfFilePages &&
                        (file?.extension?.toLowerCase() == 'pdf' ||
                            fileExtension === 'pdf')
                    "
                    *ngIf="!file.realFile"
                >
                    {{ file?.fileSize | byteConvert }}
                </div>
                <div
                    class="file_size"
                    [class.has_pages]="
                        numberOfFilePages &&
                        (file?.extension?.toLowerCase() == 'pdf' ||
                            fileExtension === 'pdf')
                    "
                    *ngIf="file.realFile"
                >
                    {{ file?.size | byteConvert }}
                </div>
            </div>
        </div>
        <p
            *ngIf="!editFile"
            class="ta-upload-file-name"
            [class.details_title]="type == 'details'"
            [class.todo_title]="type == 'todo'"
        >
            {{ file?.fileName }}
        </p>
        <!-- Edit mode -->
        <app-ta-input
            *ngIf="editFile"
            [formControl]="fileNewName"
            [inputConfig]="{
                name: 'File Name',
                type: 'text',
                label: null,
                placeholder: 'Type File Name',
                textTransform: 'capitalize',
                blackInput: true,
                hideClear: true
            }"
        ></app-ta-input>
    </div>
</div>

<ng-template #tagsPopover let-data="data">
    <div class="tags_main_holder">
        <div
            class="tags_inner_holder"
            *ngFor="let tag of tags; index as i"
            [class.firstRow]="i == 0"
            [class.lastRow]="i == tags?.length - 1"
            (click)="selectTag(tag?.name)"
        >
            <div class="tag_options_holder">
                <div class="tag_name" [class.checked]="tag.checked">
                    {{ tag.name }}
                </div>
                <div class="checked_icon" [class.shown]="tag.checked">
                    <svg-icon src="assets/svg/common/ic_confirm.svg"></svg-icon>
                </div>
            </div>
        </div>
    </div>
</ng-template>
