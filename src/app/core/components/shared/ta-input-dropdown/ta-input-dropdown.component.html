<div
  [ngClass]="{
    'multiselect-dropdown':
      inputConfig.multiselectDropdown && multiselectItems.length > 0,
    'focus': isMultiSelectInputFocus
  }"
>
  <p *ngIf="multiselectItems.length > 0" class="multiselect-label">
    {{ multiSelectLabel }}
  </p>
  <!-- Multiselect arrow -->
  <svg-icon
    *ngIf="inputConfig.multiSelectDropdownActive"
    class="multiselect-arrow"
    [ngClass]="{
      valid: !isMultiSelectInputFocus && multiselectItems.length > 0
    }"
    src="assets/svg/common/ic_arrow_down_updated.svg"
    (click)="toggleMultiselectDropdown($event)"
  ></svg-icon>
  <!-- Multiselect items -->
  <div
    *ngIf="inputConfig.multiselectDropdown && multiselectItems.length > 0"
    class="multiselect-items"
  >
    <span
      class="multiselect-item"
      *ngFor="
        let multiSelect of multiselectItems;
        trackBy: identity;
        let ind = index
      "
    >
      {{ multiSelect.name }}
      <div
        ngbTooltip
        mainTooltip="Clear"
        tooltipBackground="#6c6c6c"
        position="top"
        class="multiselect-item-clear"
        (click)="removeMultiSelectItem(ind)"
      >
        <svg-icon src="assets/svg/ic_x.svg"></svg-icon>
      </div>
    </span>
  </div>
  <!-- Dropdown search -->
  <app-ta-input
    [formControl]="getSuperControl"
    [inputConfig]="inputConfig"
    #t2="ngbPopover"
    [ngbPopover]="taInputDropdownPopover"
    [placement]="['bottom-left']"
    popoverClass="ta-input-dropdown"
    [container]="'body'"
  ></app-ta-input>
</div>

<ng-template #taInputDropdownPopover>
  <!--------------------------- Dropdown options --------------------------->
  <div
    *ngIf="!inputConfig.isDisabled"
    class="dropdown-options  {{ inputConfig.dropdownWidthClass }}"
    [ngClass]="{
      scroll: options | taDropdownCount: template,
      'dropdown-options-groups': template === 'groups'
    }"
  >
    <div [ngSwitch]="template">
      <!--------------------------- SVG Template (Render svgs or text if svgs doesn't exist ) --------------------------->
      <div *ngSwitchCase="'svg-template'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            'add-new': options.length === 1 && options[0].name === 'Add New',
            active: option.id === activeItem?.id
          }"
          (click)="onActiveItem(option)"
        >
          <svg-icon
            *ngIf="option.logoName"
            class="svg-template-logo"
            [ngClass]="{ active: option.id === activeItem?.id }"
            [src]="option.logoName | taSvg: option.folder:option?.subFolder"
          ></svg-icon>
          <div
            *ngIf="!option.logoName"
            [innerHtml]="
              option.name
                | taHighlight: [{ index: 45632, text: getSuperControl.value }]
            "
          ></div>
        </div>
      </div>
      <!--------------------------- Svg Text Template (display flex) --------------------------->
      <div *ngSwitchCase="'svgtext-template'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option svg-text-template {{ option.subFolder }} {{
            option.name.trim().replace(' ', '').toLowerCase()
          }}"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            'add-new': options.length === 1 && options[0].name === 'Add New',
            active: option.id === activeItem?.id,
            trailerContainer: option.name === 'Container',
            semisleeper: option.name === 'Semi w/Sleeper',
            lowboyrgn: option.name === 'Low Boy/RGN'
          }"
          (click)="onActiveItem(option)"
        >
          <svg-icon
            class="svgtext-template-logo {{
              option.name.trim().replace(' ', '').toLowerCase()
            }}"
            [ngClass]="{ active: option.id === activeItem?.id }"
            [src]="option.logoName | taSvg: option.folder:option?.subFolder"
          ></svg-icon>
          <div
            class="svgtext-template-text"
            [ngClass]="{ 'truck-text': option.subFolder === 'trucks' }"
            [innerHtml]="
              option.name
                | taHighlight: [{ index: 45632, text: getSuperControl.value }]
            "
          ></div>
        </div>
      </div>
      <!--------------------------- Details template (truck, trailer... details-pages)  --------------------------->
      <div *ngSwitchCase="'details-template'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option details-template"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            active: option.id === activeItem?.id
          }"
          (click)="onActiveItem(option)"
        >
          <div
            class="details-template-text"
            [innerHtml]="
              option.name
                | taHighlight: [{ index: 45632, text: getSuperControl.value }]
            "
          ></div>
          <svg-icon
            class="details-template-logo"
            [ngClass]="{ active: option.id === activeItem?.id }"
            [src]="option.svg | taSvg: option.folder"
          ></svg-icon>
        </div>
      </div>
      <!--------------------------- Grouping template (can see on contact modal)  --------------------------->
      <div *ngSwitchCase="'groups'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-groups"
        >
          <p
            *ngIf="options.length !== 1 && options[0].name !== 'No Results'"
            class="dropdown-group-header"
          >
            {{ option.groupName }}
          </p>
          <div
            *ngFor="let item of option?.groups; trackBy: identity"
            class="dropdown-subgroup-options"
            [ngClass]="{
              'no-result': options.length === 1 && item.name === 'No Results'
            }"
            (click)="onActiveItem(item)"
          >
            <img
              class="dropdown-subgroup-image"
              *ngIf="item.svg"
              [src]="item.svg"
              [alt]="item.name"
            />
            <div
              class="dropdown-subgroup-text"
              [ngClass]="{
                active: item.id === activeItem?.id,
                'no-result': options.length === 1 && item.name === 'No Results'
              }"
              [innerHtml]="
                item.name
                  | taHighlight: [{ index: 45632, text: getSuperControl.value }]
              "
            ></div>
          </div>
        </div>
      </div>
      <!--------------------------- Multiselect Template --------------------------->
      <div *ngSwitchCase="'multiselect'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            active: option?.active
          }"
          (click)="onMultiselectSelect(option)"
          [innerHtml]="
            option.name
              | taHighlight: [{ index: 45632, text: getSuperControl.value }]
          "
        ></div>
      </div>
      <!--------------------------- Default Template - Render Only Text --------------------------->
      <div *ngSwitchDefault>
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            'add-new': options.length === 1 && options[0].name === 'Add New',
            active: option.id === activeItem?.id
          }"
          (click)="onActiveItem(option)"
          [innerHtml]="
            option.name
              | taHighlight: [{ index: 45632, text: getSuperControl.value }]
          "
        ></div>
      </div>
    </div>
  </div>
</ng-template>
