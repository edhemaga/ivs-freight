<div
  [ngClass]="{
    'multiselect-dropdown':
      inputConfig.multiselectDropdown && multiselectItems.length > 0,
    focus: isMultiSelectInputFocus
  }"
>
  <p *ngIf="multiselectItems.length > 0" class="multiselect-label">
    {{ multiSelectLabel }}
  </p>
  <!-- Multiselect arrow -->
  <svg-icon
    *ngIf="inputConfig.multiSelectDropdownActive"
    class="multiselect-arrow"
    [ngClass]="{
      valid: !isMultiSelectInputFocus && multiselectItems.length > 0
    }"
    src="assets/svg/common/ic_arrow_down_updated.svg"
    (click)="toggleMultiselectDropdown($event)"
  ></svg-icon>
  <!-- Multiselect clear all -->
  <div
    *ngIf="multiselectItems.length > 0"
    class="input-clear input-clear-multiselect"
    [ngClass]="{
      'valid-focus-in': !getSuperControl.value && isMultiSelectInputFocus
    }"
    ngbTooltip
    mainTooltip="Clear All"
    tooltipBackground="#6c6c6c"
    position="bottom"
    (click)="delteAllMultiSelectItems($event)"
  >
    <svg-icon src="assets/svg/ic_x.svg" class="input-clear-x"></svg-icon>
  </div>
  <!-- Multiselect items -->
  <div
    *ngIf="
      inputConfig.multiselectDropdown &&
      multiselectItems.length > 0 &&
      template === 'multiselect'
    "
    class="multiselect-items"
  >
    <span
      class="multiselect-item"
      *ngFor="
        let multiSelect of multiselectItems;
        trackBy: identity;
        let ind = index
      "
    >
      {{ multiSelect.name }}
      <div
        ngbTooltip
        mainTooltip="Clear"
        tooltipBackground="#6c6c6c"
        position="top"
        class="multiselect-item-clear"
        (click)="removeMultiSelectItem(ind)"
      >
        <svg-icon src="assets/svg/ic_x.svg"></svg-icon>
      </div>
    </span>
  </div>
  <!-- Multiselect items Restrictions & Endorsments -->
  <div
    *ngIf="
      inputConfig.multiselectDropdown &&
      multiselectItems.length > 0 &&
      template === 'multiselect-res-endors'
    "
    class="multiselect-items"
  >
    <span
      class="multiselect-item"
      *ngFor="
        let multiSelect of multiselectItems;
        trackBy: identity;
        let ind = index
      "
    >
      {{ multiSelect.code | formatRestEndor: multiSelect.description }}
      <div
        ngbTooltip
        mainTooltip="Clear"
        tooltipBackground="#6c6c6c"
        position="top"
        class="multiselect-item-clear"
        (click)="removeMultiSelectItem(ind)"
      >
        <svg-icon src="assets/svg/ic_x.svg"></svg-icon>
      </div>
    </span>
  </div>
  <!-- Dropdown search -->
  <app-ta-input
    #t2="ngbPopover"
    popoverClass="ta-input-dropdown"
    [formControl]="getSuperControl"
    [inputConfig]="inputConfig"
    [ngbPopover]="taInputDropdownPopover"
    [placement]="['bottom-left']"
    [container]="'body'"
    [incorrectValue]="incorrectValue"
    (commandEvent)="commandEvent($event)"
    (incorrectEvent)="onIncorrectInput($event)"
  ></app-ta-input>
</div>

<ng-template #taInputDropdownPopover>
  <!--------------------------- Dropdown options --------------------------->
  <div
    *ngIf="!inputConfig.isDisabled"
    class="dropdown-options  {{ inputConfig.dropdownWidthClass }}"
    [ngClass]="{
      scroll: options | taDropdownCount: template,
      'dropdown-options-groups': template === 'groups'
    }"
  >
    <div [ngSwitch]="template">
      <!--------------------------- SVG Template (Render svgs or text if svgs doesn't exist ) --------------------------->
      <div *ngSwitchCase="'svg-template'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            'add-new': options.length === 1 && options[0].name === 'Add New',
            active: option.id === activeItem?.id
          }"
          (click)="onActiveItem(option)"
        >
          <svg-icon
            *ngIf="option.logoName"
            class="svg-template-logo"
            [ngClass]="{ active: option.id === activeItem?.id }"
            [src]="option.logoName"
          ></svg-icon>
          <div
            [innerHtml]="
              option.name
                | taHighlight: [{ index: 45632, text: getSuperControl.value }]
            "
          ></div>
        </div>
      </div>
      <!--------------------------- Svg Text Template (display flex) --------------------------->
      <div *ngSwitchCase="'svgtext-template'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option svg-text-template {{ option.subFolder }} {{
            option.name.trim().replace(' ', '').toLowerCase()
          }}"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            'add-new': options.length === 1 && options[0].name === 'Add New',
            active: option.id === activeItem?.id,
            trailerContainer: option.name === 'Container',
            semisleeper: option.name === 'Semi w/Sleeper',
            lowboyrgn: option.name === 'Low Boy/RGN'
          }"
          (click)="onActiveItem(option)"
        >
          <svg-icon
            class="svgtext-template-logo {{
              option.name.trim().replace(' ', '').toLowerCase()
            }}"
            [ngClass]="{
              active: option.id === activeItem?.id,
              'hide-hover-icons':
                inputConfig.customClass === 'truck-trailer-dropdown'
            }"
            [src]="option.logoName"
          ></svg-icon>
          <div
            class="svgtext-template-text"
            [ngClass]="{
              'truck-text': option.subFolder === 'trucks',
              'move-hover-text':
                inputConfig.customClass === 'truck-trailer-dropdown'
            }"
            [innerHtml]="
              option.name
                | taHighlight: [{ index: 45632, text: getSuperControl.value }]
            "
          ></div>
        </div>
      </div>
      <!--------------------------- Details template (truck, trailer... details-pages)  --------------------------->
      <div *ngSwitchCase="'details-template'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option details-template"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results'
          }"
          (click)="onActiveItem(option)"
        >
          <div
            class="details-template-text"
            [ngClass]="{
              active: sort === 'active-drivers' && option?.status === 1
            }"
            [innerHtml]="
              option.name
                | taHighlight: [{ index: 45632, text: getSuperControl.value }]
            "
          ></div>
          <svg-icon
            class="details-template-logo"
            [src]="option.svg | taSvg: option.folder"
          ></svg-icon>
        </div>
      </div>
      <!--------------------------- Grouping template (can see on contact modal)  --------------------------->
      <div *ngSwitchCase="'groups'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-groups"
        >
          <p
            *ngIf="options.length !== 1 && options[0].name !== 'No Results'"
            class="dropdown-group-header"
          >
            {{ option.groupName }}
          </p>
          <div
            *ngFor="let item of option?.groups; trackBy: identity"
            class="dropdown-subgroup-options"
            [ngClass]="{
              'no-result': options.length === 1 && item.name === 'No Results'
            }"
            (click)="onActiveItem(item)"
          >
            <img
              class="dropdown-subgroup-image"
              *ngIf="item.svg"
              [src]="item.svg"
              [alt]="item.name"
            />
            <div
              class="dropdown-subgroup-text"
              [ngClass]="{
                active: item.id === activeItem?.id,
                'no-result': options.length === 1 && item.name === 'No Results'
              }"
              [innerHtml]="
                item.name
                  | taHighlight: [{ index: 45632, text: getSuperControl.value }]
              "
            ></div>
          </div>
        </div>
      </div>
      <!--------------------------- Multiselect Template --------------------------->
      <div *ngSwitchCase="'multiselect-res-endors'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            active: option?.active
          }"
          (click)="onMultiselectSelect(option, 'multiselect-res-endors')"
          [innerHtml]="
            option.code
              | formatRestEndor: option.description
              | taHighlight: [{ index: 45632, text: getSuperControl.value }]
          "
        ></div>
      </div>
      <!--------------------------- Multiselect Template --------------------------->
      <div *ngSwitchCase="'multiselect'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            active: option?.active,
            'last-active': lastActiveMultiselectItem?.id === option.id
          }"
          (click)="onMultiselectSelect(option, 'multiselect')"
          [innerHtml]="
            option.name
              | taHighlight: [{ index: 45632, text: getSuperControl.value }]
          "
        ></div>
      </div>
      <!--------------------------- Labels Template --------------------------->
      <div *ngSwitchCase="'labels'">
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option labels-template"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            'add-new': options.length === 1 && options[0].name === 'Add New',
            active: option.id === activeItem?.id
          }"
          (click)="onActiveItem(option)"
        >
          <div
            class="labels-template-left-side"
            [ngClass]="{
              active: option.id === activeItem?.id
            }"
          >
            <svg-icon
              class="labels-template-logo"
              src="assets/svg/common/ic_dynamic_label.svg"
              [svgStyle]="{ fill: option?.code ? option.code : '#b7b7b7' }"
            ></svg-icon>
            <div class="labels-template-vertical-divider"></div>
          </div>
          <div class="labels-template-right-side">
            <div
              class="labels-template-text"
              [innerHtml]="
                option.name
                  | taHighlight: [{ index: 45632, text: getSuperControl.value }]
              "
            ></div>
            <div class="labels-template-counter">
              {{ option.count }}
            </div>
          </div>
        </div>
      </div>
      <!--------------------------- Default Template - Render Only Text --------------------------->
      <div *ngSwitchDefault>
        <div
          *ngFor="let option of options; trackBy: identity"
          class="dropdown-option"
          [ngClass]="{
            disabled: option?.disabled,
            'no-result':
              options.length === 1 && options[0].name === 'No Results',
            'add-new': options.length === 1 && options[0].name === 'Add New',
            active: option.id === activeItem?.id
          }"
          (click)="onActiveItem(option)"
          [innerHtml]="
            option.name
              | taHighlight: [{ index: 45632, text: getSuperControl.value }]
          "
        ></div>
      </div>
    </div>
  </div>
</ng-template>
