<div
    class="toolbar-container"
    [ngClass]="{ mapToolbarStyle: isMapShowning }"
    [ngStyle]="{
        width: !options.toolbarActions.hideWidth ? toolbarWidth : 'auto',
        'max-width.px': maxToolbarWidth
    }"
>
    <!-- LIST NAME -->
    <div
        class="list-name"
        *ngIf="listName && !options.toolbarActions.hideListName"
    >
        {{ listName }}
    </div>

    <!-- ONE TAB -->
    <div class="one-tab-container" *ngIf="tableData.length === 1">
        {{ tableData[0].length }}
    </div>

    <!-- TABS -->
    <div class="tab-wrapper" *ngIf="tableData.length > 1">
        <ng-container *ngFor="let data of tableData; let i = index">
            <ng-container [ngSwitch]="data.type">
                <div
                    *ngSwitchCase="'dropdown'"
                    class="tab-container tab-margin"
                >
                    <app-ta-input-dropdown
                        [formControl]="dropdownSelection"
                        [template]="data.template"
                        [inputConfig]="data.inputConfig"
                        [options]="data.dropdownData"
                        [activeItem]="data.selectedDispatcher"
                        (selectedItem)="onToolBarSelectAction($event)"
                    ></app-ta-input-dropdown>
                </div>
                <div
                    *ngSwitchDefault
                    class="tab-container"
                    [ngClass]="{
                        'tab-inactive': selectedTab !== data.field,
                        'tab-active': selectedTab === data.field,
                        'tab-margin': i !== tableData.length - 1
                    }"
                    (click)="onSelectTab(data)"
                >
                    <div class="tab">
                        <div class="data-count" *ngIf="!data.hideDataCount">
                            {{ data.length }}
                        </div>
                        <svg-icon
                            *ngIf="data.iconLink"
                            [svgStyle]="{ 'width.px': 20, 'height.px': 20 }"
                            [src]="data.iconLink"
                        ></svg-icon>
                        <div class="tab-title">{{ data.title }}</div>
                    </div>
                </div>
            </ng-container>
        </ng-container>
    </div>

    <!-- TOOLBAR FILTERS AND OTHER -->
    <app-toolbar-filters
        [activeTableData]="activeTableData"
        [options]="options"
        (toolbarFilter)="changeModeView($event)"
    ></app-toolbar-filters>

    <!-- TOOLBAR ACTIONS -->
    <div
        class="table-actions"
        [class.m-0]="options.toolbarActions.hideOpenModalButton"
    >
        <div class="actions-container">
            <!-- Activation -->
            <div
                *ngIf="
                    tableRowsSelected.length &&
                    !options.toolbarActions.hideActivationButton
                "
                class="action-div"
            >
                <svg-icon
                    [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
                    [src]="'assets/svg/truckassist-table/activation-icon.svg'"
                ></svg-icon>
            </div>

            <!-- BORDER -->
            <div
                class="border-container"
                *ngIf="
                    tableRowsSelected.length &&
                    !options.toolbarActions.hideDeleteButton
                "
            >
                <div class="border"></div>
            </div>

            <!-- Delete -->
            <div
                *ngIf="
                    tableRowsSelected.length &&
                    !options.toolbarActions.hideDeleteButton
                "
                (click)="deleteSelectedRows()"
                class="action-div"
            >
                <svg-icon
                    [svgStyle]="{ 'width.px': 16, 'height.px': 18 }"
                    [src]="'assets/svg/truckassist-table/trash-icon.svg'"
                ></svg-icon>
            </div>

            <!-- BORDER -->
            <div
                class="border-container"
                *ngIf="
                    tableRowsSelected.length &&
                    !options.toolbarActions.hideActivationButton
                "
            >
                <div class="border"></div>
            </div>

            <!-- Print -->
            <div *ngIf="tableRowsSelected.length" class="action-div">
                <svg-icon
                    [svgStyle]="{ 'width.px': 18, 'height.px': 17 }"
                    [src]="'assets/svg/truckassist-table/print-icon.svg'"
                ></svg-icon>
            </div>

            <!-- BORDER -->
            <div class="border-container" *ngIf="tableRowsSelected.length">
                <div class="border"></div>
            </div>

            <!-- Options -->
            <div
                *ngIf="!options.toolbarActions.hideListColumn"
                #op="ngbPopover"
                (click)="onShowOptions(op)"
                [autoClose]="true"
                [ngbPopover]="optionsPopover"
                [placement]="'bottom-right'"
                [autoClose]="'outside'"
                popoverClass="toolbar-options-popover"
                [ngClass]="{ 'active-options': optionsPopupOpen }"
                triggers="manual"
                (hidden)="optionsPopupOpen = false"
                class="action-div"
            >
                <svg-icon
                    [svgStyle]="{ 'width.px': 18, 'height.px': 17 }"
                    [src]="'assets/svg/truckassist-table/burger-icon.svg'"
                ></svg-icon>
            </div>

            <!-- Dispatchboard table options -->
            <div
                class="lock-unlock-dispatch"
                *ngIf="options.toolbarActions.showDispatchSettings"
                (click)="onToolBarAction('toggle-locked')"
            >
                <svg-icon
                    [src]="
                        dispathcboardTableLocked
                            ? 'assets/svg/common/ic_lock.svg'
                            : 'assets/svg/common/ic_unlock.svg'
                    "
                ></svg-icon>
            </div>
            <!-- BORDER -->
            <div
                class="border-container"
                *ngIf="options.toolbarActions.showDispatchSettings"
            >
                <div class="border"></div>
            </div>
            <div
                class="settings-dispatch"
                *ngIf="options.toolbarActions.showDispatchSettings"
            >
                <svg-icon
                    [src]="'assets/svg/common/ic_settings.svg'"
                ></svg-icon>
            </div>
            <div
                class="new-load"
                *ngIf="options.toolbarActions.showDispatchAdd"
            >
                <svg-icon
                    [src]="'assets/svg/dispatchboard/add-load.svg'"
                ></svg-icon>
            </div>
        </div>
    </div>

    <!-- OPEN GENERAL PM BUTTON -->
    <div
        class="general-pm-open-container"
        *ngIf="options.toolbarActions.showGeneralPmBtn"
        (click)="onToolBarAction('open-general-pm')"
    >
        <svg-icon
            [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
            [src]="'assets/svg/common/repair-pm/ic_custom_pm.svg'"
        ></svg-icon>
    </div>

    <!-- OPEN MODAL BUTTON -->
    <div
        class="modal-open-container"
        (click)="onToolBarAction('open-modal')"
        *ngIf="!options.toolbarActions.hideOpenModalButton"
    >
        <svg-icon
            [svgStyle]="{ 'width.px': 16, 'height.px': 16 }"
            [src]="'assets/svg/truckassist-table/plus-icon.svg'"
        ></svg-icon>
    </div>
</div>

<ng-template #optionsPopover let-data="data" data-toggle="popover">
    <div class="options-container">
        <!-- TOOLBAR OPTIONS -->
        <div *ngFor="let option of optionsPopupContent">
            <!-- Option Border -->
            <div
                class="toolbar-option-border-container"
                *ngIf="option.hasTopBorder && !optionsPopupContent[0].active"
            >
                <div class="option-border"></div>
            </div>

            <!-- Option -->
            <div
                (click)="onOptions(option)"
                [ngClass]="{
                    'active-option': option.active,
                    'inactiv-option': option.isInactive
                }"
                class="options"
                [ngStyle]="{ display: option.hide ? 'none' : 'flex' }"
                (mouseover)="option.showBackToList = true"
                (mouseleave)="option.showBackToList = false"
            >
                <!-- Back To List Icon -->
                <div
                    class="back-to-list-icon"
                    *ngIf="
                        option?.showBackToList &&
                        option.hasOwnSubOpions &&
                        option.active
                    "
                >
                    <svg-icon
                        [svgStyle]="{
                            'width.px': 14,
                            'height.px': 14
                        }"
                        [src]="option.backToListIcon"
                    ></svg-icon>
                </div>

                <div class="text">
                    {{
                        option?.showBackToList &&
                        option.hasOwnSubOpions &&
                        option.active
                            ? 'Back to Menu'
                            : option.text
                    }}
                </div>

                <!-- Normal Icon -->
                <div class="icon">
                    <svg-icon
                        *ngIf="!option.backToListIcon || !option.active"
                        class="option-icon"
                        [svgStyle]="{
                            'width.px': 18,
                            'height.px': 18
                        }"
                        [src]="option.svgPath"
                    ></svg-icon>

                    <svg-icon
                        (click)="onResetTable()"
                        *ngIf="option.backToListIcon && option.active"
                        class="columns-active-icon"
                        [svgStyle]="{
                            'width.px': 18,
                            'height.px': 18
                        }"
                        [src]="'assets/svg/truckassist-table/reset-icon.svg'"
                    ></svg-icon>
                </div>
            </div>
        </div>

        <!-- Option -->
        <div
            class="options-border-container"
            *ngIf="optionsPopupContent[0].active"
        >
            <div class="options-border"></div>
        </div>

        <!-- COLUMNS LIST  -->
        <div class="columns-options" *ngIf="optionsPopupContent[0].active">
            <div class="columns-container">
                <div
                    *ngFor="
                        let column of columnsOptionsWithGroups;
                        let i = index
                    "
                >
                    <!-- For Regular Column -->
                    <div
                        (click)="onToaggleColumn(column, i)"
                        class="column"
                        *ngIf="!column.isGroup"
                    >
                        <div class="checkbox" *ngIf="!column.isPined">
                            <input
                                [checked]="!column.hidden"
                                class="columns-options-checkbox"
                                id="checkbox{{ i }}"
                                type="checkbox"
                            />
                            <label
                                class="columns-options-label"
                                for="checkbox{{ i }}"
                            ></label>
                        </div>

                        <div class="not-allowed-action" *ngIf="column.isPined">
                            <svg-icon
                                [svgStyle]="{
                                    'width.px': 14,
                                    'height.px': 14
                                }"
                                [src]="
                                    'assets/svg/truckassist-table/user-owner-icon.svg'
                                "
                            ></svg-icon>
                        </div>

                        <div
                            class="column-text"
                            [ngClass]="{ 'selectable-text': !column.isPined }"
                        >
                            {{
                                column.title !== '' ? column.title : column.name
                            }}
                        </div>
                    </div>

                    <!-- For Group -->
                    <div
                        class="group-columns-container"
                        *ngIf="column.isGroup"
                        [ngClass]="{ 'group-columns-active': column.isOpen }"
                    >
                        <div class="group-columns-title">
                            <div class="checkbox">
                                <input
                                    [checked]="column.areAllActive"
                                    (click)="onToaggleAllInGroup(i)"
                                    class="columns-options-checkbox"
                                    id="checkbox{{ i }}"
                                    type="checkbox"
                                />
                                <label
                                    [ngClass]="{'some-selected': column.areSomeSelected}"
                                    class="columns-options-label"
                                    for="checkbox{{ i }}"
                                ></label>
                            </div>

                            <div
                                class="column-text selectable-text"
                                (click)="openColumnsGroupDropdown(i)"
                            >
                                {{ column.optionsGroupName }}
                            </div>

                            <div
                                class="group-columns-arrow"
                                (click)="openColumnsGroupDropdown(i)"
                            >
                                <svg-icon
                                    [svgStyle]="{
                                        'width.px': 7.18,
                                        'height.px': 12.66
                                    }"
                                    [src]="
                                        '../../../../../../assets/svg/truckassist-table/toolbar-group-dropdown-arrow.svg'
                                    "
                                ></svg-icon>
                            </div>
                        </div>

                        <div class="group-columns">
                            <div
                                class="group-column"
                                (click)="onToaggleGroupColumn(columnGroup, j)"
                                *ngFor="
                                    let columnGroup of column.group;
                                    let j = index
                                "
                            >
                                <div
                                    class="checkbox"
                                    *ngIf="!columnGroup.isPined"
                                >
                                    <input
                                        [checked]="!columnGroup.hidden"
                                        class="columns-options-checkbox"
                                        id="checkbox{{
                                            columnGroup.groupColumnTitle + j
                                        }}"
                                        type="checkbox"
                                    />
                                    <label
                                        class="columns-options-label"
                                        for="checkbox{{
                                            columnGroup.groupColumnTitle + j
                                        }}"
                                    ></label>
                                </div>

                                <div
                                    class="not-allowed-action"
                                    *ngIf="columnGroup.isPined"
                                >
                                    <svg-icon
                                        [svgStyle]="{
                                            'width.px': 14,
                                            'height.px': 14
                                        }"
                                        [src]="
                                            'assets/svg/truckassist-table/user-owner-icon.svg'
                                        "
                                    ></svg-icon>
                                </div>

                                <div
                                    class="column-text"
                                    [ngClass]="{
                                        'selectable-text': !columnGroup.isPined
                                    }"
                                >
                                    {{ columnGroup.groupColumnTitle }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-template>
