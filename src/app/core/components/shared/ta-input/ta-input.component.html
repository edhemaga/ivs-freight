<div
  class="input-custom-group"
  [ngClass]="{
    'hover-focus-out': !focusInput,
    'hide-placeholder-icon':
      inputConfig.type === 'password' && getSuperControl.value,
    'invalid': getSuperControl.value && getSuperControl.invalid && !focusInput,
    'invalid-empty-required':
      inputConfig.isRequired &&
      !getSuperControl.value &&
      getSuperControl.invalid &&
      !focusInput,
    'invalid-empty-focus-required':
      inputConfig.isRequired &&
      !getSuperControl.value &&
      getSuperControl.invalid &&
      focusInput,
    'valid': getSuperControl.value && getSuperControl.valid && !focusInput,
    'invalid-empty-dropdown':
      inputConfig.isRequired &&
      !getSuperControl.value &&
      getSuperControl.invalid &&
      inputConfig.isDropdown &&
      touchedInput &&
      !focusInput
  }"
>

  <!-- Input Clear -->
  <div
    *ngIf="!inputConfig.hideClear && !inputConfig.isDisabled"
    class="input-clear {{ inputConfig.customClass }}"
    [ngClass]="{
      'valid-focus-in':
        getSuperControl.value &&
        getSuperControl.valid &&
        focusInput &&
        !isVisiblePasswordEye,
      'invalid-focus-in':
        getSuperControl.value &&
        getSuperControl.invalid &&
        focusInput &&
        !isVisiblePasswordEye &&
        !inputConfig.isDropdown,
      'dropdown-position':
        getSuperControl.value &&
        inputConfig.isDropdown &&
        !inputConfig.isDisabled &&
        !isDropdownAddModeActive,
      'password-eye': 
        inputConfig.type === 'password' && 
        isVisiblePasswordEye &&
        getSuperControl.value
    }"
    ngbTooltip
    mainTooltip="Clear"
    tooltipBackground="#6c6c6c"
    position="top"
    (click)="clearInput()"
  >
    <svg-icon src="assets/svg/ic_x.svg" class="input-clear-x"></svg-icon>
  </div>

  <!-- Input Invalid Danger Mark -->
  <svg-icon
    *ngIf="
    !inputConfig.isDropdown &&
    (touchedInput && 
     inputConfig.isRequired && 
     getSuperControl.invalid && 
     !inputConfig.placeholderIcon && 
     !focusInput) || 
    (touchedInput && 
     !inputConfig.isRequired && 
     getSuperControl.value && 
     getSuperControl.invalid && 
     !inputConfig.placeholderIcon && 
     !focusInput)"
    class="input-invalid-danger-mark"
    src="assets/svg/common/ic_danger.svg"
  >
  </svg-icon>

  <!-- Input Required Check -->
  <svg-icon
    class="input-required-check {{ inputConfig.customClass }}"
    *ngIf="
      getSuperControl.value &&
      getSuperControl.valid &&
      !focusInput &&
      !inputConfig.isDisabled &&
      !inputConfig.placeholderIcon &&
      !inputConfig.isDropdown
    "
    src="assets/svg/common/ic_confirm.svg"
  ></svg-icon>

  <!-- Input Password Eye -->
  <div
    *ngIf="inputConfig.type === 'password'"
    class="input-password-eye {{ inputConfig.customClass }}"
    [ngClass]="{
      'visible': isVisiblePasswordEye,
      'valid': getSuperControl.valid && !focusInput && !isVisiblePasswordEye,
      'not-focused': !focusInput}"
    ngbTooltip
    mainTooltip="{{ !togglePassword ? 'Show Password' : 'Hide Password' }}"
    tooltipBackground="#6c6c6c"
    position="top"
    (click)="onTogglePassword()"
  >
    <svg-icon
      src="{{
        togglePassword
          ? 'assets/svg/common/ic_eye-visible.svg'
          : 'assets/svg/common/ic_eye-hidden.svg'
      }}"
    ></svg-icon>
  </div>

  <!-- Input Confirm New Item in Dropdown -->
  <div
    *ngIf="isDropdownAddModeActive && inputConfig.isDropdown && focusInput"
    class="input-dropdown-confirm"
    (click)="onAddItemInDropdown()"
    ngbTooltip
    mainTooltip="Confirm"
    tooltipBackground="#536BC2"
    position="top"
  >
    <svg-icon
      class="input-dropdow-confirm-svg"
      src="assets/svg/common/ic_confirm.svg"
    ></svg-icon>
  </div>

  <!-- Input Drodown Array -->
  <svg-icon
    class="input-dropdown-arrow"
    *ngIf="
      inputConfig.isDropdown &&
      !inputConfig.isDisabled &&
      !isDropdownAddModeActive
    "
    [ngClass]="{
      'active': !inputConfig.isDisabled && focusInput,
      'valid': getSuperControl.value && getSuperControl.valid && focusInput,
      'valid-focus-out-required':
        getSuperControl.value && getSuperControl.valid && !focusInput,
      'focus-out-hover': !focusInput,

      'invalid-focus-out-required':
        inputConfig.isRequired &&
        !getSuperControl.value &&
        getSuperControl.invalid &&
        touchedInput &&
        !focusInput
    }"
    src="assets/svg/common/ic_arrow_down_updated.svg"
    (click)="toggleDropdownOptions()"
  ></svg-icon>

  <!-- Input Icon Placeholder -->
  <svg-icon
    #t2="ngbPopover"
    [ngbPopover]="dateTimePopover"
    [disablePopover]="
      inputConfig.name !== 'datepicker' && inputConfig.name !== 'timepicker'
    "
    [placement]="['left']"
    [popoverClass]="'datetimepopovermain'"
    autoClose="outside"
    [container]="'body'"
    (shown)="onPopoverShown()"
    (hidden)="onPopoverHidden()"
    class="input-icon {{ inputConfig.customClass }}"
    *ngIf="inputConfig.placeholderIcon && !isVisiblePasswordEye"
    [ngClass]="{
      'disabled-empty': !getSuperControl.value && inputConfig.isDisabled,
      'disabled-filled': getSuperControl.value && inputConfig.isDisabled,
      'valid-required-in':
        getSuperControl.value && getSuperControl.valid && focusInput,
      'valid-required-out':
        getSuperControl.value && getSuperControl.valid && !focusInput,
      'invalid-required-in':
        getSuperControl.value && getSuperControl.invalid && focusInput,
      'invalid-required-empty':
        !getSuperControl.value &&
        getSuperControl.invalid &&
        !focusInput &&
        touchedInput,
      'invalid-required-filled-out':
        getSuperControl.value && getSuperControl.invalid && !focusInput
    }"
    [src]="inputConfig.placeholderIcon?.toLowerCase() | taSvg: 'common'"
  ></svg-icon>

  <!-- Input Placeholder Text -->
  <svg-icon
    *ngIf="inputConfig.placeholderText && getSuperControl.value"
    class="placeholder-text"
    [class.focused]="focusInput"
    [style.left]="11 + getSuperControl.value.toString().length * 7 + 'px'"
    [src]="inputConfig.placeholderText?.toLowerCase() | taSvg: 'common'"
  >
  </svg-icon>

  <!-- Input Control -->
  <input
    #input
    [type]="inputConfig.type | inputType: togglePassword"
    [id]="inputConfig.name"
    [name]="inputConfig.name"
    [disabled]="inputConfig.isDisabled"
    [autocomplete]="inputConfig.autocomplete ? inputConfig.autocomplete : 'off'"
    [pattern]="inputConfig.pattern"
    [placeholder]="inputConfig.placeholder ? inputConfig.placeholder : ''"
    [minLength]="inputConfig.minLength ? inputConfig.minLength : 0"
    [maxLength]="inputConfig.maxLength ? inputConfig.maxLength : 999"
    [mask]="inputConfig.mask"
    [min]="inputConfig.min ? inputConfig.min : 0"
    [max]="inputConfig.max"
    thousandSeparator="{{ inputConfig.mask === 'separator.2' ? ',' : null }}"
    inputformat="dd-mm-yy"
    class="input-control 
    {{ inputConfig.textTransform }} 
    {{ inputConfig.textAlign }} 
    {{ inputConfig.customClass }}"
    [ngClass]="{
      'disabled': !getSuperControl.value && inputConfig.isDisabled,
      'disabled-filled': getSuperControl.value && inputConfig.isDisabled,
      'valid-focus-in':
        getSuperControl.value &&
        getSuperControl.valid &&
        focusInput &&
        !isVisiblePasswordEye,
      'invalid-focus-in':
        getSuperControl.value && getSuperControl.invalid && focusInput,
      'password-eye': inputConfig.type === 'password' && isVisiblePasswordEye,
      'has-input-icon': inputConfig.placeholderIcon,
    
      'dropdown-placeholder-active':
        inputConfig.isDropdown &&
        inputConfig.placeholder &&
        isDropdownOptionsActive &&
        focusInput,
      'dropdown-add-mode': isDropdownAddModeActive && inputConfig.isDropdown
    }"
    [(ngModel)]="input.value"
    (keypress)="manipulateWithInput($event)"
    (keyup)="onKeyUp($event)"
    (input)="onChange($event.target.value)"
    (blur)="onBlur()"
    (focus)="onFocus()"
    (paste)="onPaste($event, inputConfig.maxLength)"
  />

  <!-- DateTime Picker -->
  <div
    class="date_time_holder input-control"
    *ngIf="
      inputConfig.name === 'datepicker' || inputConfig.name === 'timepicker'
    "
    [class.active]="showDateInput"
    (click)="showDateTimePlaceholder()"
    [ngClass]="{
      focused: focusInput,
      'invalid-focus-in':
        inputConfig.isRequired &&
        getSuperControl.value &&
        getSuperControl.invalid &&
        focusInput
    }"
  >
    <span
      #span1
      class="main"
      tabindex="0"
      (focus)="onFocus()"
      (click)="setSelection($event)"
      (keydown)="changeSelection($event)"
      (blur)="onBlur()"
      [innerHTML]="inputConfig.name === 'datepicker' ? 'mm' : 'HH'"
    ></span>
    <span
      (click)="setSelection($event)"
      [innerHTML]="inputConfig.name === 'datepicker' ? '/' : ':'"
      >/</span
    >
    <span
      #span2
      class="main"
      tabindex="1"
      (focus)="onFocus()"
      (click)="setSelection($event)"
      (keydown)="changeSelection($event)"
      (blur)="onBlur()"
      [innerHTML]="inputConfig.name === 'datepicker' ? 'dd' : 'MM'"
    ></span>
    <span
      (click)="setSelection($event)"
      [innerHTML]="inputConfig.name === 'datepicker' ? '/' : ' '"
      >/</span
    >
    <span
      #span3
      class="main"
      tabindex="2"
      (focus)="onFocus()"
      (click)="setSelection($event)"
      (keydown)="changeSelection($event)"
      (blur)="onBlur()"
      [innerHTML]="inputConfig.name === 'datepicker' ? 'yy' : 'AM'"
    ></span>
  </div>

  <!-- Input Label -->
  <label
    [for]="inputConfig.name"
    class="input-label {{ inputConfig.customClass }}"
    [ngClass]="{
      'required': inputConfig.isRequired && !inputConfig.isDisabled,
      'disabled-empty': !getSuperControl.value && inputConfig.isDisabled,
      'disabled-filled': getSuperControl.value && inputConfig.isDisabled,
      'up-label': getSuperControl.value || focusInput || showDateInput,
      'has-input-icon': inputConfig.placeholderIcon,
      'valid-focus-out':
        getSuperControl.value && getSuperControl.valid && !focusInput,
      'invalid-focus-out':
        getSuperControl.value && getSuperControl.invalid && !focusInput
    }"
  >
    {{ inputConfig.label }}
  </label>

  <!-- Input Error Message -->
  <span
    *ngIf="
      !inputConfig.hideErrorMessage &&
      !(!getSuperControl.value && focusInput) &&
      (touchedInput || getSuperControl.value) &&
      getSuperControl.invalid
    "
    class="input-error {{ inputConfig.customClass }}"
  >
    {{ getSuperControl.errors | inputError: inputConfig.name }}
  </span>
</div>

<!-- Popover for DateTime Pickers -->
<ng-template #dateTimePopover let-data="data">
  <div class="datetime-dropdown-holder">
    <app-custom-datetime-pickers
      [calendarType]="inputConfig.name === 'datepicker' ? 'date' : 'time'"
      [placeholder]="'MM/DD/YY'"
      [dateTime]="dateTimeInputDate"
      (closePopover)="closePopover()"
    ></app-custom-datetime-pickers>
  </div>
</ng-template>
