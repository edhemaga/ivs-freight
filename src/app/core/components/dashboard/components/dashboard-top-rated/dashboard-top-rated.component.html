<div
    class="dashboard-top-rated"
    [ngClass]="{
        'd-flex flex-column justify-content-center': topRatedList.length
    }"
>
    <!--  -->
    <!-- Header -->

    <div
        class="d-flex align-items-center justify-content-between dashboard-top-rated-header"
    >
        <!-- Left Side -->
        <div class="d-flex align-items-center">
            <!-- Title -->

            <div class="dashboard-top-rated-header-title">
                <p class="m-0 ta-font-black">
                    Top {{ topRatedTitle }} ({{ topRatedList.length }})
                </p>
            </div>

            <!-- Dropdown -->

            <button
                class="dashboard-top-rated-header-arrow-btn"
                #popover="ngbPopover"
                autoClose="outside"
                [ngbPopover]="topRatedPopover"
                [popoverClass]="'top-rated-popover-main'"
                [placement]="['bottom']"
                [container]="'body'"
                [ngClass]="{ active: popover?.isOpen() }"
            >
                <svg-icon
                    src="assets/svg/common/fill_arrow_down.svg"
                    [svgStyle]="{ 'width.px': '18', 'height.px': '18' }"
                ></svg-icon>
            </button>

            <ng-template #topRatedPopover>
                <div class="top-rated-popover-container">
                    <div
                        *ngFor="
                            let topRatedDropdownItem of topRatedDropdownList;
                            trackBy: trackByIdentity
                        "
                        class="top-rated-popover-item"
                        [ngClass]="{ active: topRatedDropdownItem.isActive }"
                        (click)="
                            handleSwitchTopRatedClick(topRatedDropdownItem)
                        "
                    >
                        <p class="m-0">{{ topRatedDropdownItem.name }}</p>

                        <div class="popover-icon-container">
                            <svg-icon
                                src="assets/svg/common/ic_confirm.svg"
                                [svgStyle]="{ 'width.px': 14, 'height.px': 14 }"
                            ></svg-icon>
                        </div>
                    </div>
                </div>
            </ng-template>

            <!-- Tabs -->

            <div
                class="d-flex align-items-center dashboard-top-rated-header-tabs"
            >
                <ng-container *ngIf="topRatedTitle !== 'Shipper'">
                    <app-ta-tab-switch
                        [tabs]="topRatedTabs"
                        [dashboardHeight]="true"
                        (switchClicked)="handleSwitchTabClick($event)"
                    >
                    </app-ta-tab-switch
                ></ng-container>

                <ng-container *ngIf="topRatedTitle === 'Shipper'">
                    <div class="shipper-tab-container">
                        <p class="m-0 ta-font-extra-bold">Load</p>
                    </div>
                </ng-container>
            </div>
        </div>

        <!-- Right Side -->
        <div
            class="d-flex align-items-center dashboard-top-rated-header-right-side-container"
            [formGroup]="topRatedForm"
        >
            <!-- Dropdowns -->

            <div
                class="d-flex align-items-center dashboard-top-rated-header-dropdown"
            >
                <div
                    class="dropdown-left-container"
                    [ngClass]="{
                        'dropdown-left-w-1':
                            selectedMainPeriod?.name === 'Today',
                        'dropdown-left-w-2':
                            selectedMainPeriod?.name === 'Week-to-Date',
                        'dropdown-left-w-3':
                            selectedMainPeriod?.name === 'Month-to-Date',
                        'dropdown-left-w-4':
                            selectedMainPeriod?.name === 'Year-to-Date',
                        'dropdown-left-w-5':
                            selectedMainPeriod?.name === 'All Time',
                        'dropdown-left-w-6':
                            selectedMainPeriod?.name === 'Custom',
                        'dropdown-left-w-7':
                            selectedMainPeriod?.name === 'Quartal-to-Date'
                    }"
                >
                    <app-ta-input-dropdown
                        formControlName="mainPeriod"
                        [inputConfig]="{
                            name: 'Input Dropdown',
                            type: 'text',
                            isDropdown: true,
                            hideClear: true,
                            hideColorValidations: true,
                            removeInputBackground: true,
                            dropdownWidthClass: 'w-col-157'
                        }"
                        [options]="mainPeriodDropdownList"
                        [activeItem]="selectedMainPeriod"
                        (selectedItem)="
                            handleInputSelect($event, 'MAIN_PERIOD_DROPDOWN')
                        "
                    ></app-ta-input-dropdown>
                </div>

                <ng-container *ngIf="!isDisplayingCustomPeriodRange">
                    <div class="dashboard-top-rated-header-border"></div>

                    <div
                        class="dropdown-right-container"
                        [ngClass]="{
                            'dropdown-right-w-1':
                                selectedSubPeriod?.name === 'Hourly',
                            'dropdown-right-w-2':
                                selectedSubPeriod?.name === '3 Hours' ||
                                selectedSubPeriod?.name === '6 Hours',
                            'dropdown-right-w-3':
                                selectedSubPeriod?.name === 'Semi-Daily',
                            'dropdown-right-w-4':
                                selectedSubPeriod?.name === 'Daily',
                            'dropdown-right-w-5':
                                selectedSubPeriod?.name === 'Weekly',
                            'dropdown-right-w-6':
                                selectedSubPeriod?.name === 'Bi-Weekly',
                            'dropdown-right-w-7':
                                selectedSubPeriod?.name === 'Semi-Monthly',
                            'dropdown-right-w-8':
                                selectedSubPeriod?.name === 'Monthly',
                            'dropdown-right-w-9':
                                selectedSubPeriod?.name === 'Quarterly',
                            'dropdown-right-w-10':
                                selectedSubPeriod?.name === 'Yearly'
                        }"
                    >
                        <app-ta-input-dropdown
                            formControlName="subPeriod"
                            [inputConfig]="{
                                name: 'Input Dropdown',
                                type: 'text',
                                isDropdown: true,
                                hideClear: true,
                                hideColorValidations: true,
                                removeInputBackground: true,
                                dropdownWidthClass: 'w-col-157'
                            }"
                            [options]="subPeriodDropdownList"
                            [activeItem]="selectedSubPeriod"
                            (selectedItem)="
                                handleInputSelect($event, 'SUB_PERIOD_DROPDOWN')
                            "
                        ></app-ta-input-dropdown>
                    </div>
                </ng-container>
            </div>
        </div>
    </div>

    <!-- Placeholder -->

    <ng-container *ngIf="!topRatedList.length">
        <app-dashboard-data-placeholder></app-dashboard-data-placeholder>
    </ng-container>

    <!-- Body-->

    <ng-container *ngIf="topRatedList.length">
        <div
            class="d-flex flex-column justify-content-center dashboard-top-rated-body"
        >
            <!-- Body Up -->

            <div class="dashboard-top-rated-body-up">
                <!-- Top Rated List -->

                <div
                    class="dashboard-top-rated-body-up-list"
                    [ngClass]="{
                        'd-flex flex-column': !isDisplayingPlaceholder,
                        'show-more': isShowingMore
                    }"
                >
                    <!-- Search -->

                    <ng-container *ngIf="isShowingMore">
                        <div class="dashboard-top-rated-body-up-list-search">
                            <app-carrier-search-two
                                [placeHolderText]="topRatedTitle"
                                [clearSearchValue]="clearSearchValue"
                                (searchValueEmitter)="handleSearchValue($event)"
                            ></app-carrier-search-two>
                        </div>
                    </ng-container>

                    <!-- Placeholder -->

                    <ng-container *ngIf="isDisplayingPlaceholder">
                        <app-dashboard-data-placeholder
                            [searchPlaceholder]="true"
                        ></app-dashboard-data-placeholder>
                    </ng-container>

                    <!-- List -->

                    <ng-container *ngIf="!isDisplayingPlaceholder">
                        <ng-container
                            *ngFor="
                                let topRatedListItem of topRatedList
                                    | slice : 0 : topRatedListSliceEnd;
                                let i = index;
                                trackBy: trackByIdentity
                            "
                        >
                            <div
                                class="d-flex align-items-center justify-content-between top-rated-item"
                                placement="bottom"
                                [ngbTooltip]="
                                    searchValue &&
                                    selectedTopRatedList.length === 5 &&
                                    '5 max selected'
                                "
                                [ngStyle]="
                                    i <= 9 &&
                                    topRatedListItem.isSelected && {
                                        background: mainColorsPallete[i].code
                                    }
                                "
                                [ngClass]="{
                                    selected:
                                        i <= 9 && topRatedListItem.isSelected,
                                    'not-selected':
                                        selectedTopRatedList.length &&
                                        !topRatedListItem.isSelected
                                }"
                                (click)="
                                    handleAddSelectedClick(topRatedListItem, i)
                                "
                                (mouseenter)="
                                    (topRatedListItem.isSelected ||
                                        (!topRatedListItem.isSelected &&
                                            !selectedTopRatedList.length &&
                                            searchValue)) &&
                                        handleHoverSelected(i)
                                "
                                (mouseleave)="
                                    (topRatedListItem.isSelected ||
                                        (!topRatedListItem.isSelected &&
                                            !selectedTopRatedList.length &&
                                            searchValue)) &&
                                        handleHoverSelected(i, true)
                                "
                            >
                                <div
                                    class="align-items-center top-rated-item-left"
                                >
                                    <div
                                        class="d-flex align-items-center justify-content-center top-rated-item-number-box"
                                    >
                                        <p class="m-0 ta-font-semi-bold">
                                            {{ i + 1 }}
                                        </p>

                                        <svg-icon
                                            class="close-icon"
                                            [src]="
                                                'assets/svg/applicant/close-x.svg'
                                            "
                                            [svgStyle]="{
                                                'width.px': 18,
                                                'height.px': 18
                                            }"
                                            (click)="
                                                handleRemoveSelectedClick(
                                                    $event,
                                                    topRatedListItem,
                                                    i
                                                )
                                            "
                                        ></svg-icon>
                                    </div>

                                    <div
                                        class="d-flex align-items-center justify-content-center top-rated-item-color-box"
                                        [ngStyle]="{
                                            background:
                                                (topRatedList.length <= 10 &&
                                                    i <= 2) ||
                                                (topRatedList.length > 10 &&
                                                    topRatedList.length <= 30 &&
                                                    i <= 4) ||
                                                (topRatedList.length >= 30 &&
                                                    i <= 9)
                                                    ? mainColorsPallete[i].code
                                                    : mainColorsPallete[10].code
                                        }"
                                    ></div>

                                    <div
                                        class="d-flex align-items-center top-rated-item-name-box"
                                    >
                                        <p
                                            class="m-0 ta-font-extra-bold"
                                            [innerHTML]="
                                                highlightSearchValue(
                                                    topRatedListItem.name,
                                                    topRatedListItem.isSelected
                                                )
                                            "
                                        ></p>
                                    </div>
                                </div>

                                <div
                                    class="d-flex align-items-center top-rated-item-right"
                                >
                                    <div
                                        class="d-flex align-items-center top-rated-item-first-tab-box"
                                    >
                                        <p class="m-0">
                                            {{
                                                currentActiveTab.name ===
                                                    'Revenue' ||
                                                currentActiveTab.name === 'Cost'
                                                    ? '$'
                                                    : ''
                                            }}
                                        </p>
                                        <p class="m-0">
                                            {{
                                                currentActiveTab.name ===
                                                    'Revenue' ||
                                                currentActiveTab.name === 'Cost'
                                                    ? (topRatedListItem.value
                                                      | addThousandSign)
                                                    : topRatedListItem.value
                                            }}
                                        </p>
                                    </div>

                                    <div
                                        class="d-flex align-items-center justify-content-end top-rated-item-second-tab-box"
                                    >
                                        <p class="m-0 ta-font-semi-bold">
                                            {{
                                                topRatedListItem.isSelected
                                                    ? topRatedListSelectedPercentage
                                                    : topRatedListItem.percent
                                            }}%
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </ng-container>
                    </ng-container>

                    <!-- Show More -->

                    <ng-container *ngIf="!isDisplayingPlaceholder">
                        <div
                            class="d-flex align-items-center justify-content-between show-more-container"
                        >
                            <div
                                class="d-flex align-items-center show-more-container-left"
                            >
                                <p class="m-0 ta-font-semi-bold">
                                    {{
                                        !isShowingMore &&
                                        topRatedList.length > 10
                                            ? '10'
                                            : topRatedList.length
                                    }}
                                    OF {{ topRatedList.length }}
                                </p>
                            </div>

                            <ng-container *ngIf="topRatedList.length > 10">
                                <div
                                    class="d-flex align-items-center show-more-container-right"
                                >
                                    <button
                                        type="button"
                                        class="ta-font-bold show-more-btn"
                                        (click)="handleShowMoreClick()"
                                    >
                                        {{
                                            isShowingMore
                                                ? 'SHOW LESS'
                                                : 'SHOW MORE'
                                        }}
                                    </button>
                                </div>
                            </ng-container>
                        </div>
                    </ng-container>
                </div>

                <!-- Border -->

                <div class="dashboard-top-rated-body-up-border"></div>

                <!-- Doughnut Chart -->

                <div
                    class="d-flex justify-content-center align-items-center dashboard-top-rated-body-up-doughnut-chart-container"
                >
                    <app-ta-chart
                        #doughnutChart
                        [chartConfig]="doughnutChartConfig"
                        [axesProperties]="{}"
                        [legendAttributes]="{}"
                    >
                    </app-ta-chart>

                    <!-- Custom Period Range -->

                    <!--   clickOutsideElement
                    (clickOutsideEmitter)="
                        handleOutsideCustomPeriodRangeClick()
                    " -->

                    <ng-container *ngIf="isDisplayingCustomPeriodRange">
                        <div class="custom-period-range-container">
                            <app-ta-custom-period-range
                                [subPeriodDropdownList]="subPeriodDropdownList"
                                [selectedSubPeriod]="selectedSubPeriod"
                                (customPeriodRangeSubperiodEmitter)="
                                    handleCustomPeriodRangeSubperiodEmit($event)
                                "
                                (customPeriodRangeValuesEmitter)="
                                    handleSetCustomPeriodRangeClick($event)
                                "
                            ></app-ta-custom-period-range>
                        </div>
                    </ng-container>
                </div>
            </div>

            <!-- Body Down -->

            <div
                class="d-flex flex-column justify-content-center dashboard-top-rated-body-down"
            >
                <!-- Body Down Header -->

                <div
                    class="d-flex align-items-center justify-content-between dashboard-top-rated-body-down-header"
                >
                    <div
                        class="d-flex align-items-center dashboard-top-rated-body-down-header-left"
                    >
                        <p class="m-0 ta-font-bold">{{ barChartDateTitle }}</p>
                    </div>

                    <ng-container *ngIf="!selectedTopRatedList.length">
                        <div
                            class="d-flex align-items-center dashboard-top-rated-body-down-header-right"
                        >
                            <div class="d-flex align-items-center">
                                <svg-icon
                                    class="round-icon round-icon-top-ten"
                                    [src]="'assets/svg/common/round_blue.svg'"
                                    [svgStyle]="{
                                        'width.px': 10,
                                        'height.px': 10
                                    }"
                                ></svg-icon>

                                <p class="m-0 ta-font-semi-bold">
                                    {{
                                        topRatedList.length <= 10
                                            ? 'Top 3'
                                            : topRatedList.length > 10 &&
                                              topRatedList.length <= 30
                                            ? 'Top 5'
                                            : 'Top 10'
                                    }}
                                </p>
                            </div>

                            <div class="d-flex align-items-center">
                                <svg-icon
                                    class="round-icon round-icon-all-others"
                                    [src]="'assets/svg/common/round_blue.svg'"
                                    [svgStyle]="{
                                        'width.px': 10,
                                        'height.px': 10
                                    }"
                                ></svg-icon>

                                <p class="m-0 ta-font-semi-bold">All Others</p>
                            </div>
                        </div>
                    </ng-container>
                </div>

                <!-- Bar Chart -->

                <div class="bar-chart-container">
                    <app-ta-chart
                        #barChart
                        [chartConfig]="barChartConfig"
                        [axesProperties]="barChartAxes"
                        [legendAttributes]="{}"
                    >
                    </app-ta-chart>
                </div>
            </div>
        </div>
    </ng-container>
</div>
