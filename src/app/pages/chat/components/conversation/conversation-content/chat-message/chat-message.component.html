<!-- Do not use (mouseover) nad (mouseout)!! -->
<div
    class="message-container"
    (mouseenter)="toggleActions(true)"
    (mouseleave)="toggleActions(false)"
>
    <ng-container *ngIf="message.content">
        <div
            class="content-wrapper d-flex justify-content-end"
            [ngClass]="
                currentUserId === (message.senderId || message.sender?.id)
                    ? 'flex-row'
                    : 'flex-row-reverse'
            "
        >
            <ng-container *ngIf="hasActionsDisplayed">
                <div
                    class="message-actions d-flex justify-content-center align-items-center"
                >
                    <ng-container
                        *ngTemplateOutlet="
                            iconAction;
                            context: {
                                item: {
                                    icon: chatSvgRoutes.replyIcon,
                                    actionType: chatMessageActionEnum.REPLY
                                }
                            }
                        "
                    ></ng-container>
                    <ng-container
                        *ngIf="
                            currentUserId ===
                            (message.senderId || message.sender?.id)
                        "
                    >
                        <ng-container
                            *ngTemplateOutlet="
                                iconAction;
                                context: {
                                    item: {
                                        icon: chatSvgRoutes.trashBinIcon,
                                        actionType: chatMessageActionEnum.DELETE
                                    }
                                }
                            "
                        ></ng-container>
                        <ng-container
                            *ngTemplateOutlet="
                                iconAction;
                                context: {
                                    item: {
                                        icon: chatSvgRoutes.editPenIcon,
                                        actionType: chatMessageActionEnum.EDIT
                                    }
                                }
                            "
                        ></ng-container
                    ></ng-container>

                    <app-chat-vertical-divider></app-chat-vertical-divider>
                </ng-container>
            </div>

            <ng-container *ngIf="isDateDisplayed">
                <div
                    class="message-time d-flex justify-content-center align-items-center"
                >
                    {{ messageDateAndTime }}
                </div>
            </ng-container>
            <div
                class="content ta-font-regular"
                [ngClass]="
                    currentUserId === (message.senderId || message.sender?.id)
                        ? 'current-user'
                        : 'other'
                "
                [ngStyle]="
                    message.linksCount && {
                        'max-width': '300px'
                    }
                "
            >
                {{ message.content }}

                <ng-container *ngIf="message.filesCount">
                    <div
                        class="attachment-list d-flex"
                        [ngStyle]="
                            message.fileCount < 3
                                ? { 'flex-direction': 'row' }
                                : { 'flex-direction': 'column' }
                        "
                    >
                        <ng-container
                            *ngFor="
                                let attachment of message.files;
                                let ind = index;
                                trackBy: '' | trackByProperty
                            "
                        >
                            <div class="attachment-preview d-flex">
                                <app-chat-message-attachment-preview
                                    [index]="ind"
                                    [attachment]="attachment"
                                    [isNameReduced]="true"
                                    [isInMessage]="true"
                                    [previewWidth]="'100%'"
                                ></app-chat-message-attachment-preview>
                            </div>
                        </ng-container>
                    </div>
                </ng-container>

                <ng-container
                    *ngIf="
                        message.linksCount &&
                        message.links[0]?.metadata?.imageUrl
                    "
                >
                    <div class="link-wrapper">
                        <img
                            width="300"
                            height="150"
                            [src]="message.links[0].metadata?.imageUrl"
                            [alt]="message.links[0].metadata?.title"
                        />
                    </div>
                    <div class="link-title font-weight-normal">
                        {{ message.links[0].metadata?.title }}
                    </div>
                </ng-container>
            </div>
        </div>
    </ng-container>

    <ng-container *ngIf="message.mediaCount">
        <div
            class="media-preview-wrapper d-flex"
            [ngClass]="
                currentUserId === (message.senderId || message.sender?.id)
                    ? 'flex-row-reverse'
                    : 'flex-row'
            "
        >
            <ng-container
                *ngFor="
                    let attachment of message.media;
                    let ind = index;
                    trackBy: '' | trackByProperty
                "
            >
                <div class="media-preview d-flex">
                    <img
                        class="media-preview-thumbnail"
                        [ngStyle]="
                            (message.mediaCount || message.media?.length) > 1 ? {
                                height: '120px',
                                width: '120px',  
                            } : {
                                'max-width': '300px',
                                'max-height': '300px',
                                'aspect-ration':  singleImageAspectRation
                            }
                        "
                        [src]="attachment.url"
                        [alt]="attachment.fileName"
                    />
                </div>
            </ng-container>
        </div>
    </ng-container>
</div>

<ng-template #iconAction let-item="item">
    <div
        class="action-wrapper d-flex justify-content-center align-content-center"
        (click)="messageAction(item.actionType)"
    >
        <div class="action d-flex justify-content-center align-content-center">
            <svg-icon
                class="pointer d-flex justify-content-center align-items-center"
                [ngClass]="item.customClass"
                [svgStyle]="{
                    'width.px': 12,
                    'height.px': 12
                }"
                [src]="item.icon"
            ></svg-icon>
        </div>
    </div>
</ng-template>
