<div class="messages-container d-flex">
    <div class="messages-wrapper">
        <ng-container *ngIf="!isAttachmentUploadActive; else upload">
            <div
                class="messages-content"
                [scrollTop]="messagesContent?.scrollHeight"
                [ngStyle]="
                    isChatTypingActivated &&
                    (attachments$ | async)?.length && {
                        height: 'calc(100% - 160px)'
                    }
                "
                #messagesContent
            >
                <ng-container *ngIf="messages?.length; else emptyConversation">
                    <ng-container
                        *ngFor="
                            let message of messages;
                            let ind = index;
                            trackBy: 'id' | trackByProperty
                        "
                    >
                        <ng-container *ngIf="message?.messageType">
                            <ng-container
                                *ngIf="
                                    (message.createdAt | chatDatePipe) !==
                                    (messages[ind - 1]?.createdAt
                                        | chatDatePipe)
                                "
                            >
                                <div
                                    class="d-flex justify-content-center align-content-center"
                                >
                                    <div class="message-date ta-font-medium">
                                        {{ message.createdAt | chatDatePipe }}
                                    </div>
                                </div>
                            </ng-container>

                            <app-chat-message
                                [currentUserId]="
                                    getCurrentUserHelper.currentUserId
                                "
                                [message]="message"
                                [isDateDisplayed]="
                                    (message.createdAt | formatTime) !==
                                        (messages[ind - 1]?.createdAt
                                            | formatTime) ||
                                    message.sender?.id !==
                                        message[ind - 1]?.sender?.id
                                "
                                [isReplyOrEditOpen]="
                                    messageIdActionsDisplayed === message.id &&
                                    isReplyOrEditOpen
                                "
                                (messageActionReplyOrEdit)="
                                    handleMessageReplyOrEdit($event)
                                "
                                (messageDeletedEvent)="
                                    handleMessageDelete($event)
                                "
                            ></app-chat-message>
                        </ng-container>
                    </ng-container>
                </ng-container>
                <!-- TODO Rework empty conversation screen -->
                <ng-template #emptyConversation>
                    <!-- <div class="d-flex justify-content-center">
                        <div class="empty-conversation">
                            <div
                                class="image-wrapper d-flex justify-content-center"
                            >
                                <img
                                    [src]="ChatPngRoutes.contact"
                                    [alt]="remainingParticipants[0]?.fullName"
                                />
                            </div>
                            <div class="fullname ta-font-bold">
                                {{ remainingParticipants[0]?.fullName }}
                            </div>
                        </div>
                    </div> -->
                </ng-template>
            </div>
        </ng-container>
    </div>
</div>

<ng-template #upload>
    <div class="upload-wrapper">
        <app-ta-upload-files
            #filesUpload
            [files]="[]"
            [showDropzone]="true"
            [dropzoneFocus]="false"
            [dropZoneConfig]="ChatDropzone.inputDropzone"
            [size]="'large'"
            [customClassName]="'no-background-color full-height expand'"
            [hasSlider]="false"
            (onFileEvent)="addAttachments($event.files)"
        ></app-ta-upload-files>
    </div>
</ng-template>

<ng-template #iconAction let-item="item">
    <div
        class="action-wrapper d-flex justify-content-center align-content-center"
    >
        <div
            class="action d-flex justify-content-center align-content-center"
            (click)="handleSend()"
        >
            <ng-container *ngIf="item.text">
                <div
                    class="item-text d-flex justify-content-center align-content-center ta-font-bold"
                >
                    <div class="text">{{ item.text }}</div>
                </div>
            </ng-container>

            <svg-icon
                class="pointer d-flex justify-content-center align-items-center"
                [ngClass]="item.customClass"
                [svgStyle]="{
                    'width.px': 18,
                    'height.px': 18
                }"
                [src]="item.icon"
            ></svg-icon>
        </div>
    </div>
</ng-template>
