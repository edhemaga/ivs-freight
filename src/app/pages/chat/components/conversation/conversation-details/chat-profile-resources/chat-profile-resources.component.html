<div class="header d-flex align-items-center">
    <div
        class="title ta-font-extra-bold"
        [ngStyle]="!count && { color: '#aaaaaa' }"
    >
        {{ title }}
    </div>
    <ng-container *ngIf="count">
        <div
            class="data-count ta-font-bold"
            [ngClass]="isExpanded && 'data-count-focused'"
        >
            {{ count }}
        </div>
        <div
            class="show-all ta-font-bold"
            [ngClass]="isExpanded ? 'show-all-focused' : 'show-all-unfocused'"
            (click)="toggleShowAll()"
        >
            <ng-container *ngIf="isExpanded; else showAll"
                >Show less</ng-container
            >
            <ng-template #showAll>Show all</ng-template>
        </div>
    </ng-container>
</div>
<div
    [className]="customClass"
    [ngClass]="
        !isExpanded && resources?.length > 3 && customClass + '-not-empty'
    "
    [ngStyle]="
        isExpanded && {
            height: 'fit-content',
            'overflow-y': 'none'
        }
    "
>
    <ng-container [ngSwitch]="type">
        <ng-container
            *ngSwitchCase="chatUserProfileResourceTypeEnum.PARTICIPANTS"
        >
            <div class="search">
                <div class="form-wrapper" [formGroup]="searchForm">
                    <app-ta-input
                        formControlName="searchTerm"
                        [inputConfig]="
                            chatInput.userSearchInput(
                                chatSearchPlaceHolders.PARTICIPANT
                            )
                        "
                    ></app-ta-input>
                </div>
            </div>
            <div class="company-user-wrapper">
                <ng-container
                    *ngTemplateOutlet="
                        participantsTitle;
                        context: {
                            item: {
                                name: 'Company users',
                                icon: chatSvgRoutes.companyUserIcon,
                                count: companyUsers?.length
                            }
                        }
                    "
                ></ng-container>
            </div>
            <div class="dirvers-wrapper">
                <ng-container
                    *ngTemplateOutlet="
                        participantsTitle;
                        context: {
                            item: {
                                name: 'Drivers',
                                icon: chatSvgRoutes.steeringWheelIcon,
                                count: drivers?.length
                            }
                        }
                    "
                ></ng-container>
            </div>
        </ng-container>

        <ng-container
            *ngFor="
                let item of resources;
                let ind = index;
                trackBy: '' | trackByProperty
            "
        >
            <ng-container *ngSwitchCase="chatUserProfileResourceTypeEnum.MEDIA">
                <img [src]="item?.url" [alt]="item?.fileName" />
            </ng-container>
            <ng-container *ngSwitchCase="chatUserProfileResourceTypeEnum.FILES">
                <div class="attachment-wrapper">
                    <app-chat-message-attachment-preview
                        [index]="ind"
                        [attachment]="item"
                        [isNameReduced]="false"
                        [isInMessage]="false"
                        [isFocused]="false"
                        [isDateDisplayed]="true"
                        [isSizeDisplayed]="false"
                    ></app-chat-message-attachment-preview>
                </div>
            </ng-container>
            <ng-container *ngSwitchCase="chatUserProfileResourceTypeEnum.LINKS">
                <div class="links d-flex align-items-center">
                    <div class="link-thumbnail">
                        <div class="link-thumbnail-content">
                            <ng-container
                                *ngIf="item.metadata?.imageUrl; else linkIcon"
                            >
                                <img
                                    [src]="item.metadata?.imageUrl"
                                    [alt]="item.metadata.title"
                                    width="36"
                                    height="32"
                                />
                            </ng-container>
                            <ng-template #linkIcon>
                                <svg-icon
                                    class="d-flex justify-content-center align-items-center"
                                    [svgStyle]="{
                                        'width.px': 29,
                                        'height.px': 29
                                    }"
                                    [src]="chatSvgRoutes.linkIcon"
                                >
                                </svg-icon>
                            </ng-template>
                        </div>
                    </div>
                    <div class="link-information">
                        <div class="ta-font-medium">
                            {{ item.metadata?.title || item.url }}
                        </div>
                        <div class="ta-font-regular">
                            {{ item.time | formatDateP : 'date-time' }}
                        </div>
                    </div>
                </div>
            </ng-container>
        </ng-container>
    </ng-container>
</div>
<ng-container *ngIf="hasHorizontalBorder">
    <div class="horizontal-border"></div>
</ng-container>

<ng-template #participantsTitle let-item="item">
    <div class="title d-flex align-content-center">
        <svg-icon
            class="d-flex justify-content-center align-items-center"
            [svgStyle]="{
                'width.px': 14,
                'height.px': 14
            }"
            [src]="item?.icon"
        >
        </svg-icon>
        <div
            class="text d-flex align-content-center justify-content-center ta-font-bold"
        >
            <div>{{ item?.name | uppercase }}</div>
        </div>
        <div
            class="count d-flex align-content-center justify-content-center ta-font-semi-bold"
            [ngStyle]="!item?.count && { color: '#aaaaaa' }"
        >
            <div>
                {{ item?.count }}
            </div>
        </div>
    </div>
</ng-template>
