<app-ta-modal
    (action)="onModalAction($event)"
    [modalTitle]="modalTitle"
    [saveAndAddNew]="!isEditMode"
    [isModalValid]="isModalValidToSubmit"
    [editName]="tabTitle"
    [specificCaseModalName]="isEditMode"
    [editData]="editData"
    [editDate]="!!editData"
>
    <div origin *ngIf="repairShopForm">
        <app-ta-tab-switch
            (switchClicked)="tabChange($event)"
            [tabs]="tabs"
            [type]="'type2-modal-popup'"
            class="repair-shop__main-tabs"
        >
        </app-ta-tab-switch>

        <form
            [formGroup]="repairShopForm"
            [ngClass]="{ 'tab-2': selectedTab === TableStringEnum.CONTACT }"
            class="form-container form-container-without-mb"
        >
            <div
                [@animationTabsModal]="animationObject"
                [class]="animationTabClass"
            >
                <!-- Details Tab -->
                 <!-- Use hidden so we don't reinitilaze every field once they are set,
                 Also for contacts, all data is lost on tab change  -->
                <div
                    [hidden]="selectedTab !== TableStringEnum.DETAILS"
                    class="m-tab"
                >
                    <div class="row">
                        <div class="col-11">
                            <app-ta-input
                                [inputConfig]="{
                                    name: 'Shop Name',
                                    type: 'text',
                                    label: 'Shop Name',
                                    isRequired: true,
                                    textTransform: 'uppercase',
                                    minLength: 2,
                                    maxLength: 64
                                }"
                                [formControlName]="
                                    RepairShopModalStringEnum.NAME
                                "
                            ></app-ta-input>
                        </div>

                        <div class="col-1">
                            <div
                                [mainTooltip]="favoriteLabel"
                                ngbTooltip
                                position="bottom"
                                tooltipBackground="#424242"
                            >
                                <svg-icon
                                    (click)="addShopToFavorite()"
                                    [class.repair-shop__favorite-active]="
                                        isFavorite
                                    "
                                    class="repair-shop__favorite"
                                    src="assets/svg/common/ic_star.svg"
                                ></svg-icon>
                            </div>
                        </div>
                    </div>

                    <div
                        [ngClass]="{ 'active-phone-ext': showPhoneExt }"
                        class="phone-ext-email-small-modal phone-ext-email-small-modal-my-32"
                    >
                        <div class="phone-extension">
                            <div class="phone-field">
                                <app-ta-input
                                    [inputConfig]="{
                                        name: 'Phone',
                                        type: 'text',
                                        label: 'Phone',
                                        isRequired: true,
                                        placeholderIcon: 'phone',
                                        mask: '(000) 000-0000',
                                        maxLength: 14
                                    }"
                                    [formControlName]="
                                        RepairShopModalStringEnum.PHONE
                                    "
                                ></app-ta-input>
                            </div>
                            <div
                                (click)="showPhoneExt = !showPhoneExt"
                                *ngIf="!showPhoneExt"
                                class="extension-field"
                                mainTooltip="Add Extension"
                                ngbTooltip
                                position="top"
                                tooltipBackground="#6c6c6c"
                            >
                                <svg-icon
                                    src="assets/svg/common/ic_plus.svg"
                                ></svg-icon>
                            </div>
                            <app-ta-input
                                *ngIf="showPhoneExt"
                                [inputConfig]="{
                                    name: 'phone-extension',
                                    type: 'text',
                                    label: 'Ext.',
                                    minLength: 1,
                                    maxLength: 8,
                                    placeholderIcon: 'phone-extension'
                                }"
                                [formControlName]="
                                    RepairShopModalStringEnum.PHONE_EXT
                                "
                            ></app-ta-input>
                        </div>
                        <div class="email-field">
                            <app-ta-input
                                [inputConfig]="{
                                    name: 'Email',
                                    type: 'text',
                                    label: 'Email',
                                    placeholderIcon: 'email',
                                    minLength: 5,
                                    maxLength: 64,
                                    textTransform: 'lowercase'
                                }"
                                [formControlName]="
                                    RepairShopModalStringEnum.EMAIL
                                "
                            ></app-ta-input>
                        </div>
                    </div>

                    <div class="row last-row">
                        <div class="col-10">
                            <app-ta-input-address-dropdown
                                (selectedAddress)="onAddressChange($event)"
                                [activeAddress]="selectedAddress"
                                [inputConfig]="{
                                    name: 'Address',
                                    type: 'text',
                                    label: 'Address, City, State Zip',
                                    isRequired: true,
                                    placeholderIcon: 'address',
                                    textTransform: 'capitalize',
                                    dropdownWidthClass: 'w-col-376',
                                    minLength: 6,
                                    maxLength: 256
                                }"
                                [placeholderType]="'longAddress'"
                                [formControlName]="
                                    RepairShopModalStringEnum.ADDRESS
                                "
                            ></app-ta-input-address-dropdown>
                        </div>
                        <div class="col-2">
                            <app-ta-input
                                [inputConfig]="{
                                    name: 'address-unit',
                                    type: 'text',
                                    label: 'Unit No.',
                                    textTransform: 'uppercase',
                                    minLength: 1,
                                    maxLength: 10
                                }"
                                [formControlName]="
                                    RepairShopModalStringEnum.ADDRESS_UNIT
                                "
                            ></app-ta-input>
                        </div>
                    </div>

                    <!-- Repair Shop Services -->
                    <app-ta-custom-card
                        [cardName]="'Service'"
                        [disableAnimation]="disableCardAnimation"
                        [hasCounter]="services | activeItems"
                        [isCardOpen]="true"
                        [disabledCard]="true"
                    >
                        <div class="col-12 service-types">
                            <app-ta-tab-switch
                                (switchClicked)="repairTypeTabChange($event)"
                                [tabs]="repairTypes"
                                [type]="'type2-modal-popup'"
                            >
                            </app-ta-tab-switch>
                        </div>

                        <div class="repair-shop-services">
                            <div
                                *ngFor="
                                    let repair of services;
                                    trackBy: identity
                                "
                                (click)="activeRepairService(repair)"
                                [ngClass]="{ active: repair.active }"
                                class="repair-shop-service d-flex align-items-center"
                            >
                                <ng-container
                                    *ngIf="repair.svg.includes('.svg')"
                                >
                                    <svg-icon
                                        src="{{ repair.svg }}"
                                        [style.width.px]="14"
                                        [style.height.px]="14"
                                        class="d-flex"
                                    ></svg-icon>
                                </ng-container>

                                <p class="ta-font-bold">
                                    {{ repair.serviceType | uppercase }}
                                </p>
                            </div>
                        </div>
                    </app-ta-custom-card>
                    <!-- Open Hours -->
                     <!-- isCardOpen: Close card since backend not working now neither does frontend-->
                    <app-ta-custom-card
                        (onActionEvent)="toggle247WorkingHours($event)"
                        [cardName]="'Work Hours'"
                        [disableAnimation]="disableCardAnimation"
                        [has24Hours]="true"
                        [hasBodyData]="true"
                        [is24Hours]="isOpenAllDay"
                        [isCardOpen]="false" 
                        [disabledCard]="true"
                    >
                        <div
                            [formArrayName]="
                                RepairShopModalStringEnum.OPEN_HOURS
                            "
                        >
                            <div class="timeline__card">
                                <div class="timeline__card-range ta-font-bold">
                                    Day
                                </div>
                                <div class="timeline__card-range ta-font-bold">
                                    From
                                </div>
                                <div class="timeline__card-range ta-font-bold">
                                    To
                                </div>
                            </div>

                            <div
                                *ngFor="
                                    let openHour of openHours.controls;
                                    let ind = index
                                "
                            >
                                <div
                                    *ngIf="
                                        ind === 0 ||
                                        ind === openHours.controls.length - 1 ||
                                        ind === openHours.controls.length - 2 ||
                                        isDaysVisible
                                    "
                                    [formGroupName]="ind"
                                    class="timeline__card timeline__card-hover"
                                >
                                    <!-- Switch for all days -->
                                    <div
                                        *ngIf="ind === 0"
                                        (click)="toggleDays()"
                                    >
                                        <svg-icon
                                            class="timeline__card-icon"
                                            [class.timeline__card-icon-rotate]="
                                                isDaysVisible
                                            "
                                            src="assets/svg/common/ic_arrow_down_updated.svg"
                                        ></svg-icon>
                                        <span class="timeline__card-label">
                                            {{ openHour.get('dayLabel').value }}
                                        </span>
                                    </div>

                                    <!-- Other Days Check -->
                                    <!-- Hide checkbox for MON - FRI label -->
                                    <app-ta-checkbox
                                        (formArrayAction)="
                                            addNewWorkingDays(ind)
                                        "
                                        *ngIf="ind !== 0"
                                        [customClass]="'medium'"
                                        [label]="openHour.get('dayLabel').value"
                                        [name]="openHour.get('dayLabel').value"
                                        [formControlName]="
                                            RepairShopModalStringEnum.IS_WORKING_DAY
                                        "
                                    ></app-ta-checkbox>

                                    <!-- Time Picker -->
                                    <app-ta-input
                                        *ngIf="
                                            openHour.get('isWorkingDay').value
                                        "
                                        [inputConfig]="{
                                            name: 'timepicker',
                                            type: 'text',
                                            placeholderIcon: 'time',
                                            customClass: 'datetimeclass',
                                            hideClear: true
                                        }"
                                        [formControlName]="
                                            RepairShopModalStringEnum.START_TIME
                                        "
                                    ></app-ta-input>
                                    <app-ta-input
                                        *ngIf="
                                            openHour.get('isWorkingDay').value
                                        "
                                        [inputConfig]="{
                                            name: 'timepicker',
                                            type: 'text',
                                            placeholderIcon: 'time',
                                            customClass: 'datetimeclass',
                                            hideClear: true
                                        }"
                                        [formControlName]="
                                            RepairShopModalStringEnum.END_TIME
                                        "
                                    ></app-ta-input>
                                </div>
                            </div>
                        </div>
                    </app-ta-custom-card>

                    <!-- Bank Account -->
                    <app-ta-custom-card
                        [animationMarginParams]="{
                            marginTop: '18px',
                            marginBottom: '22px'
                        }"
                        [cardName]="'Bank Account'"
                        [disableAnimation]="disableCardAnimation"
                        [hasBodyData]="true"
                        [isCardOpen]="true"
                        [disabledCard]="true"
                    >
                        <!-- This class are coming from form.scss -->
                        <div
                            class="custom-bank-row custom-bank-row-repair-shop"
                        >
                            <app-ta-input-dropdown
                                (saveItem)="onSaveNewBank($event)"
                                (selectedItem)="onBankSelected($event)"
                                [activeItem]="selectedBank"
                                [canAddNew]="true"
                                [inputConfig]="{
                                    name: 'Input Dropdown Bank Name',
                                    type: 'text',
                                    label: 'Bank Name',
                                    minLength: 2,
                                    maxLength: 64,
                                    textTransform: 'uppercase',
                                    isDropdown: true,
                                    dropdownWidthClass: 'w-col-163'
                                }"
                                [options]="banks"
                                [template]="'svg-template'"
                                [formControlName]="
                                    RepairShopModalStringEnum.BANK_ID
                                "
                            ></app-ta-input-dropdown>

                            <app-ta-input
                                [inputConfig]="{
                                    name: 'routing-bank',
                                    type: 'text',
                                    label: 'Routing',
                                    isDisabled: !isBankSelected,
                                    isRequired: isBankSelected,
                                    minLength: 9,
                                    maxLength: 9
                                }"
                                [formControlName]="
                                    RepairShopModalStringEnum.ROUTING
                                "
                            ></app-ta-input>

                            <app-ta-input
                                [inputConfig]="{
                                    name: 'account-bank',
                                    type: 'text',
                                    label: 'Account',
                                    isDisabled: !isBankSelected,
                                    isRequired: isBankSelected,
                                    maxLength: 17,
                                    minLength: 5
                                }"
                                [formControlName]="
                                    RepairShopModalStringEnum.ACCOUNT
                                "
                            ></app-ta-input>
                        </div>
                    </app-ta-custom-card>

                    <div class="ta-card-body-overflow-none">
                        <app-ta-custom-card
                            [cardName]="'Document'"
                            [disableAnimation]="disableCardAnimation"
                            [hasCounter]="
                                files.length ? files.length : 0
                            "
                            [isCardOpen]="files.length"
                        >
                            <app-ta-upload-files
                                (onFileEvent)="onFilesEvent($event)"
                                [customClassName]="'modals'"
                                [files]="files"
                                [showDropzone]="true"
                            ></app-ta-upload-files>
                        </app-ta-custom-card>
                    </div>
                    <!-- Note -->
                    <app-ta-input-note
                        [isVisibleNote]="
                            repairShopForm.get(RepairShopModalStringEnum.NOTE)
                                .value !== null
                        "
                        [note]="
                            repairShopForm.get(RepairShopModalStringEnum.NOTE)
                                .value
                        "
                        [formControlName]="RepairShopModalStringEnum.NOTE"
                    ></app-ta-input-note>
                </div>
                <div
                [hidden]="selectedTab !== TableStringEnum.CONTACT"
                    class="m-tab"
                >
                    <app-ta-custom-card
                        (onActionEvent)="addContact()"
                        [animationMarginParams]="{
                            marginTop: '10px',
                            marginBottom: '5px'
                        }"
                        [cardName]="'Contact'"
                        [disableAnimation]="disableCardAnimation"
                        [disabledCard]="!contactAddedCounter"
                        [hasActionSvg]="'assets/svg/common/ic_plus.svg'"
                        [hasArrow]="false"
                        [hasCounter]="contactAddedCounter"
                        [hasScrollBody]="contactAddedCounter > 10"
                        [isCardOpen]="contactAddedCounter"
                        [isCommentData]="true"
                    >
                        <div
                            (scroll)="onScrollingContacts($event)"
                            class="common-fake-table-modal common-fake-table-modal-original-repair-shop"
                        >
                            <app-ta-modal-table
                                [tableType]="modalTableTypeEnum.CONTACT"
                                [modalTableData]="contacts"
                                [isNewRowCreated]="isNewContactAdded"
                                (modalTableValueEmitter)="
                                    handleModalTableValueEmit($event)
                                "
                                (modalTableValidStatusEmitter)="
                                    handleModalTableValidStatusEmit($event)
                                "
                            >
                            </app-ta-modal-table>
                        </div>
                    </app-ta-custom-card>
                    <div class="no-review-broker" *ngIf="!contactAddedCounter">
                        <svg-icon
                            class="no-review-svg"
                            src="assets/svg/common/ic_no_contacts.svg"
                        ></svg-icon>
                    </div>
                </div>
                <div
                [hidden]="selectedTab !== TableStringEnum.REVIEW"
                    class="m-tab"
                >
                    <app-ta-custom-card
                        (onActionEvent)="createReview()"
                        [animationMarginParams]="{
                            marginTop: '10px',
                            marginBottom: '12px'
                        }"
                        [cardName]="'Review'"
                        [disableAnimation]="disableCardAnimation"
                        [disableMultipleReviews]="disableOneMoreReview"
                        [hasActionSvg]="'assets/svg/common/ic_plus.svg'"
                        [hasArrow]="false"
                        [hasBodyData]="reviews.length > 0"
                        [hasCounter]="reviews.length ?? 0"
                        [hasLikeDislike]="true"
                        [hasScrollBody]="reviews.length > 6"
                        [isCardOpen]="true"
                        [isCommentData]="true"
                    >
                        <div *ngIf="!reviews.length" class="no-review-broker">
                            <svg-icon
                                class="no-review-svg"
                                src="assets/svg/common/ic_no_review.svg"
                            ></svg-icon>
                        </div>
                        <app-ta-user-review
                            (changeReviewsEvent)="changeReviewsEvent($event)"
                            *ngIf="reviews.length"
                            [isNewReview]="reviews[0].isNewReview"
                            [reviewData]="reviews"
                        ></app-ta-user-review>
                    </app-ta-custom-card>
                </div>
            </div>
        </form>
    </div>
</app-ta-modal>
