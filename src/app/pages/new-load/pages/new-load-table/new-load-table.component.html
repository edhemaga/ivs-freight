@let store =
    {
        viewData: loadStoreService.loadsSelector$ | async,
        columns: loadStoreService.tableColumnsSelector$ | async,
        selectedTab: loadStoreService.selectedTabSelector$ | async,
        tableSettings: loadStoreService.tableSettingsSelector$ | async,
        selectedCount: loadStoreService.selectedCountSelector$ | async,
        selectedTabCountSelector:
            loadStoreService.selectedTabCountSelector$ | async,
    };
@if (store) {
    @let headerTemplates = { selectHeaderTemplate };
    @let templates =
        {
            loadNumber,
            loadInvoice,
            loadDispatcher,
            loadStatus,
            select,
            edit,
            action,
            loadStatus,
            templateName,
            commodity,
            billingRate,
            invoicedDate,
            driverInfo,
            brokerContact,
            brokerPhone,
        };

    @let isTableLocked = store.tableSettings.isTableLocked;
    <app-new-table
        [columns]="store.columns"
        [rows]="store.viewData"
        [headerTemplates]="{
            select: selectHeaderTemplate,
        }"
        [totalDataCount]="store.selectedTabCountSelector"
        [templates]="templates"
        [isTableLocked]="isTableLocked"
        (onShowMore)="onShowMoreClick()"
    >
        <ng-template #selectHeaderTemplate>
            <app-ca-checkbox-selected-count
                [itemsTotalCount]="store.viewData.length"
                [itemsSelectedCount]="store.selectedCount"
                (onCheckboxCountClick)="onCheckboxCountClick($event)"
            ></app-ca-checkbox-selected-count>
        </ng-template>

        <ng-template let-data="data" #select>
            @let loadName = 'Load-' + data.id;
            <app-ca-checkbox
                [isChecked]="data.isSelected"
                [isRegularCheckbox]="false"
                [itemIndex]="data.id"
                [name]="loadName"
                (columnCheckAction)="onSelectLoad(data.id)"
            ></app-ca-checkbox>
        </ng-template>

        <ng-template
            #invoicedDate
            let-data="data"
            let-cellColumnTextColorClass="cellColumnTextColorClass"
        >
            <div
                class="text-color-black-2 text-size-14"
                [class]="cellColumnTextColorClass"
            >
                {{ data.invoicedDate | date: eDateTimeFormat.MM_DD_YY }}
            </div>
        </ng-template>

        <ng-template
            #brokerPhone
            let-data="data"
            let-cellColumnTextColorClass="cellColumnTextColorClass"
        >
            <div
                class="text-color-black-2 text-size-14"
                [class]="cellColumnTextColorClass"
            >
                {{ data.broker?.phone }}
            </div>
        </ng-template>

        <ng-template
            #brokerContact
            let-data="data"
            let-cellColumnTextColorClass="cellColumnTextColorClass"
        >
            <div
                class="text-color-black-2 text-size-14"
                [class]="cellColumnTextColorClass"
            >
                {{ data.broker?.contact }}
            </div>
        </ng-template>

        <ng-template
            #driverInfo
            let-cellColumnTextColorClass="cellColumnTextColorClass"
            let-data="data"
        >
            <div
                class="text-color-black-2 text-size-14"
                [class]="cellColumnTextColorClass"
            >
                {{ data.driverInfo.firstName }}
                {{ data.driverInfo.lastName }}
            </div>
        </ng-template>

        <ng-template
            #billingRate
            let-data="data"
            let-cellColumnTextColorClass="cellColumnTextColorClass"
        >
            <span
                class="ta-font-bold text-size-14 text-color-black"
                [class]="cellColumnTextColorClass"
            >
                {{ data.billingRate | currency }}
            </span>
        </ng-template>

        <ng-template
            #loadNumber
            let-data="data"
            let-cellColumnTextColorClass="cellColumnTextColorClass"
        >
            <span
                ngbTooltip
                [mainTooltip]="eGeneralActions.VIEW_DETAILS"
                [tooltipBackground]="eColor.BLACK"
                [position]="ePosition.BOTTOM"
                class="c-pointer text-color-black text-hover-blue-15 ta-font-bold text-size-14 text-truncate"
                (click)="navigateToLoadDetails(data.id)"
                [class]="cellColumnTextColorClass"
            >
                {{ data.loadNumber }}
            </span>
        </ng-template>

        <ng-template let-data="data" #templateName>
            <div class="text-color-black text-size-14 ta-font-bold">
                {{ data.templateName }}
            </div>
        </ng-template>

        <ng-template let-data="data" #commodity>
            <div class="text-color-black-2 text-size-14">
                @if (data.generalCommodity?.name === eSharedString.HAZARDOUS) {
                    <svg-icon
                        [src]="sharedSvgRoutes.HAZARDOUS_ICON"
                        class="svg-size-14"
                    ></svg-icon>
                }
                {{ data.generalCommodity?.name }}
            </div>
        </ng-template>

        <ng-template let-data="data" #loadDispatcher>
            <div class="d-flex gap-1">
                <app-ca-profile-image
                    [name]="data.dispatcher?.fullName"
                    [size]="'small'"
                    [type]="'user'"
                    [withTooltip]="true"
                    [size]="18"
                    [isDispatch]="true"
                    [avatarImg]="data.dispatcher?.avatarFile?.url"
                >
                </app-ca-profile-image>

                <div class="text-color-black-2 text-size-14">
                    {{ data.dispatcher?.fullName }}
                </div>
            </div>
        </ng-template>

        <ng-template let-data="data" #loadStatus>
            <span
                class="ta-font-bold text-size-14 text-color-black"
                #ngbStatus="ngbPopover"
                [autoClose]="true"
                [ngbPopover]="statusPopover"
                [placement]="ePosition.BOTTOM + ' ' + ePosition.TOP"
                container="body"
                popoverClass="table-status-popover"
                triggers="manual"
                (click)="onOpenChangeStatusDropdown(ngbStatus, data.id)"
            >
                <app-ca-load-status
                    [status]="{
                        name: data.status?.statusString,
                        id: data.status?.statusValue?.id,
                    }"
                    [isDefaultHoverFocus]="true"
                    [isNoStyle]="false"
                    [fontSize]="14"
                    height="26"
                >
                </app-ca-load-status>
            </span>
        </ng-template>

        <ng-template let-data="data" #action>
            <ca-dropdown-menu
                [type]="'dots-menu-type'"
                [placement]="eDropdownMenu.TABLE_CARDS_PLACEMENT"
                [options]="data.tableDropdownContent"
                (dropdownOptionEmitter)="
                    onToggleDropdownMenuActions($event, data, store.selectedTab)
                "
            >
            </ca-dropdown-menu>
        </ng-template>
    </app-new-table>

    <ng-template #statusPopover>
        @let possibleStatuses =
            loadStoreService.changeDropdownpossibleStatusesSelector$ | async;

        <app-ca-status-change-dropdown
            [statuses]="possibleStatuses"
            (onNextStatus)="onNextStatus($event)"
            (onPreviousStatus)="onPreviousStatus($event)"
        ></app-ca-status-change-dropdown>
    </ng-template>
}
