@let store =
    {
        viewData: loadStoreService.loadsSelector$ | async,
        columns: loadStoreService.tableColumnsSelector$ | async,
        selectedTab: loadStoreService.selectedTabSelector$ | async,
        tableSettings: loadStoreService.tableSettingsSelector$ | async,
    };
@if (store) {
    @let templates =
        {
            loadNumber,
            loadStatus,
            edit,
        };

    @let isTableLocked = store.tableSettings.isTableLocked;
    <app-new-table
        [columns]="store.columns"
        [rows]="store.viewData"
        [templates]="templates"
        [isTableLocked]="isTableLocked"
    >
        <ng-template let-data="data" #edit>
            <!-- TODO: For testing load modal only !! Will be removed later !! -->
            <div (click)="onOpenModal(data.id, store.selectedTab)">EDIT</div>
        </ng-template>

        <ng-template let-data="data" #loadNumber>
            <span
                class="ta-font-bold text-size-14 text-color-black c-pointer text-hover-blue-15"
                (click)="navigateToLoadDetails(data.id)"
            >
                {{ data.loadNumber }}
            </span>
        </ng-template>

        <ng-template let-data="data" #loadStatus>
            <span 
                class="ta-font-bold text-size-14 text-color-black"
                #ngbStatus="ngbPopover"
                [autoClose]="true"
                [ngbPopover]="statusPopover"
                [placement]="'bottom top'"
                container="body"
                popoverClass="table-status-popover"
                triggers="manual"
                (click)="openChangeStatuDropdown(ngbStatus, data.id)"
            >
                <app-ca-load-status
                    [status]="{
                        name: data.status?.statusString,
                        id: data.status?.statusValue?.id,
                    }"
                    [isDefaultHoverFocus]="true"
                    [isNoStyle]="false"
                    [fontSize]="14"
                >
                </app-ca-load-status>
            </span>
        </ng-template>
    </app-new-table>

    <ng-template #statusPopover>
        @let possibleStatuses = loadStoreService.changeDropdownpossibleStatusesSelector$ | async;

        <app-ca-status-change-dropdown 
            [statuses]="possibleStatuses"
            (onNextStatus)="onNextStatus($event)"
            (onPreviousStatus)="onPreviousStatus($event)"
        ></app-ca-status-change-dropdown>
    </ng-template>
}
