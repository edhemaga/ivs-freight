@let load = loadStoreService.resolveLoadDetails$ | async;
@let isLoading = !(loadStoreService.isLoadDetailsLoaded$ | async);
@let isSpacingBottom = true;

<div class="m-t-16">
    <div class="background-white p-8 br-3">
        <div class="d-flex flex-column px-1">
            <app-ca-skeleton
                [width]="223"
                [height]="16"
                [isLoading]="isLoading"
                [contentTemplate]="contentTemplate"
                class="mb-2"
            >
                <ng-template #contentTemplate>
                    <div
                        class="ta-font-semi-bold text-size-18 text-color-black h-30 mb-1"
                    >
                        Ref. {{ load.referenceNumber }}
                    </div>
                </ng-template>
            </app-ca-skeleton>

            <div class="d-flex align-items-center flex-wrap">
                <ng-container
                    *ngTemplateOutlet="
                        iconTextTemplate;
                        context: {
                            icon: sharedIcons.STATUS_ICON,
                            text: load.status?.statusString,
                            isLoading,
                            isSpacingBottom,
                            width: 110,
                            colWidth: 'col-6',
                        }
                    "
                >
                </ng-container>
                <ng-container
                    *ngTemplateOutlet="
                        iconTextTemplate;
                        context: {
                            icon: sharedIcons.COMPANY_ICON,
                            text: load.company?.companyName,
                            isLoading,
                            isSpacingBottom,
                            width: 140,
                            colWidth: 'col-6',
                        }
                    "
                >
                </ng-container>
                <ng-container
                    *ngTemplateOutlet="
                        iconTextTemplate;
                        context: {
                            icon: sharedIcons.TIME_ICON,
                            text: load.company?.companyName,
                            isLoading,
                            isSpacingBottom,
                            width: 130,
                            colWidth: 'col-6',
                        }
                    "
                >
                </ng-container>
                <ng-container
                    *ngTemplateOutlet="
                        iconTextTemplate;
                        context: {
                            icon: sharedIcons.USER_ICON,
                            text: load.dispatcher?.fullName,
                            isLoading,
                            isSpacingBottom,
                            width: 120,
                            colWidth: 'col-6',
                        }
                    "
                >
                </ng-container>
            </div>
        </div>

        <div class="divider divider--small divider--dark"></div>
        <div class="d-flex align-items-center flex-wrap m-t-8 px-1">
            <ng-container
                *ngTemplateOutlet="
                    iconTextTemplate;
                    context: {
                        icon: sharedIcons.ADDED_DATE,
                        text: load?.createdAt | formatDateP,
                        isLoading,
                        width: 64,
                        colWidth: 'col-6',
                    }
                "
            >
            </ng-container>
            <ng-container
                *ngTemplateOutlet="
                    iconTextTemplate;
                    context: {
                        icon: sharedIcons.DATE_EDITED,
                        text: load?.updatedAt | formatDateP,
                        isLoading,
                        width: 64,
                        colWidth: 'col-6',
                    }
                "
            >
            </ng-container>
        </div>
    </div>

    <div class="m-t-8 background-white br-3 pb-2">
        <div class="d-flex flex-column p-x-12 pt-1">
            <app-ca-skeleton
                [width]="100"
                [height]="14"
                [isLoading]="isLoading"
                [contentTemplate]="brokerDetailContentTemplate"
            >
                <ng-template #brokerDetailContentTemplate>
                    <div
                        class="ta-font-extra-bold text-size-14 text-color-black h-26 mb-1 d-flex align-items-center"
                    >
                        Broker Detail
                    </div>
                </ng-template>
            </app-ca-skeleton>

            <app-ca-skeleton
                [width]="190"
                [height]="18"
                [isLoading]="isLoading"
                [contentTemplate]="brokerDetailNameContentTemplate"
                class="mb-2"
            >
                <ng-template #brokerDetailNameContentTemplate>
                    <div
                        class="ta-font-medium text-size-18 text-color-black mb-1 text-truncate"
                    >
                        {{ load.broker?.businessName }}
                    </div>
                </ng-template>
            </app-ca-skeleton>
            <div class="d-flex align-items-center flex-wrap">
                <ng-container
                    *ngTemplateOutlet="
                        iconTextTemplate;
                        context: {
                            icon: sharedIcons.USER_CIRCLE_ICON,
                            text: load.brokerContact?.contactName,
                            isLoading,
                            isSpacingBottom,
                            width: 160,
                            colWidth: 'col-6',
                            textColorClass: 'text-color-black-2',
                        }
                    "
                >
                </ng-container>
                <ng-container
                    *ngTemplateOutlet="
                        iconTextTemplate;
                        context: {
                            icon: sharedIcons.PHONE_ICON,
                            text: load.brokerContact?.phone,
                            isLoading,
                            isSpacingBottom,
                            width: 140,
                            colWidth: 'col-6',
                            extension: load.brokerContact?.extensionPhone,
                            textColorClass: 'text-color-black-2',
                        }
                    "
                >
                </ng-container>
                <ng-container
                    *ngTemplateOutlet="
                        iconTextTemplate;
                        context: {
                            icon: sharedIcons.EMAIL_ICON,
                            text: load.brokerContact?.email,
                            isLoading,
                            isSpacingBottom,
                            width: 180,
                            colWidth: 'col-12',
                            textColorClass: 'text-color-black-2',
                        }
                    "
                >
                </ng-container>
            </div>
        </div>

        <div class="p-x-6 mb-1">
            <div class="divider divider--small divider--dark"></div>
        </div>

        <div class="p-x-12">
            <div
                class="ta-font-extra-bold text-size-14 text-color-black h-26 mb-2 d-flex align-items-center m-b-8"
            >
                Assigned To
            </div>

            <div class="row gutter-x-12">
                @let isLoadAssigned = load.dispatch;

                <div class="col-6">
                    <div
                        class="background-bw2 h-26 br-2 p-x-6 p-y-1 d-flex align-items-center"
                    >
                        @let truck = load.dispatch?.truck;

                        @if (isLoadAssigned && truck) {
                            @let truckIcon =
                                'assets/svg/common/trucks/' +
                                truck.truckType.logoName;
                            <div class="h-18 w-42 d-flex">
                                <svg-icon
                                    class="h-18 w-36 d-flex"
                                    [src]="truckIcon"
                                ></svg-icon>
                            </div>

                            <span
                                class="text-color-black text-size-14 ta-font-medium"
                                >{{ truck.truckNumber }}</span
                            >
                        } @else {
                            <span
                                class="text-color-light-grey-2 text-size-14 ta-font-medium ml-1"
                                >No Truck</span
                            >
                        }
                    </div>
                </div>
                <div class="col-6">
                    <div
                        class="background-bw2 h-26 br-2 p-x-6 p-y-1 d-flex align-items-center"
                    >
                        @let trailer = load.dispatch?.trailer;

                        @if (isLoadAssigned && trailer) {
                            @let trailerIcon =
                                'assets/svg/common/trailers/' +
                                trailer.trailerType.logoName;
                            <div class="h-18 w-42 d-flex">
                                <svg-icon
                                    [src]="trailerIcon"
                                    class="h-18 w-42 d-flex"
                                ></svg-icon>
                            </div>
                            <span
                                class="text-color-black text-size-14 ta-font-medium ml-1"
                                >{{ trailer.trailerNumber }}</span
                            >
                        } @else {
                            <span
                                class="text-color-light-grey-2 text-size-14 ta-font-medium"
                                >No Trailer</span
                            >
                        }
                    </div>
                </div>
                <div class="col-12">
                    <div class="background-bw2 h-26 br-2 p-x-6 p-y-1 m-t-12">
                        @let driver = load.dispatch?.driver;

                        @if (isLoadAssigned && driver) {
                            <span
                                class="text-color-black text-size-14 ta-font-medium"
                                >{{ driver.firstName }}
                                {{ driver.lastName }}</span
                            >
                        } @else {
                            <span
                                class="text-color-light-grey-2 text-size-14 ta-font-medium"
                                >No Driver</span
                            >
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<ng-template
    #iconTextTemplate
    let-icon="icon"
    let-text="text"
    let-isLoading="isLoading"
    let-width="width"
    let-isSpacingBottom="isSpacingBottom"
    let-colWidth="colWidth"
    let-extension="extension"
    let-textColorClass="textColorClass"
>
    <div
        class="d-flex align-items-center h-26"
        [ngClass]="isSpacingBottom && 'mb-2'"
        [class]="colWidth"
    >
        <app-ca-skeleton
            [width]="15"
            [height]="15"
            [isCircle]="true"
            [isLoading]="isLoading"
            [contentTemplate]="contentTemplate"
            [ngClass]="isLoading && 'mr-1'"
        >
            <ng-template #contentTemplate>
                <svg-icon
                    [src]="icon"
                    class="svg-fill-muted svg-size-18 d-flex mr-1 justify-content-center"
                ></svg-icon>
            </ng-template>
        </app-ca-skeleton>

        <app-ca-skeleton
            [width]="width"
            [height]="16"
            [isLoading]="isLoading"
            [contentTemplate]="textTemplate"
            class="overflow-hidden"
        >
            <ng-template #textTemplate>
                <div
                    class="text-size-14 text-truncate"
                    [ngClass]="textColorClass || 'text-color-black'"
                >
                    {{ text }}
                    @if (extension) {
                        <span class="text-color-grey">x{{ extension }} </span>
                    }
                </div>
            </ng-template>
        </app-ca-skeleton>
    </div>
</ng-template>
