<app-ta-modal
    [modalTitle]="editData?.header"
    [editData]="editData"
    [editName]="
        editData?.action?.includes('unit-pm') ? editData?.data?.textUnit : null
    "
    [disableDelete]="true"
    [isModalValid]="PMform.valid && isFormDirty"
    (action)="onModalAction($event)"
>
    <form
        origin
        [formGroup]="PMform"
        class="form-container form-container-without-mb"
    >
        <app-ta-custom-card
            [hasCounter]="activePMs()"
            [hasDivider]="false"
            [cardName]="'Selected'"
            [hasActionSvg]="
                editData?.action?.includes('unit-pm')
                    ? null
                    : 'assets/svg/common/ic_plus.svg'
            "
            [hasArrow]="false"
            [isCardOpen]="defaultPMs.length > 0"
            [hasScrollBody]="defaultPMs.length > 18"
            [disabledCard]="!defaultPMs.length"
            [disableAnimation]="disableCardAnimation"
            (onActionEvent)="
                addPMs(null, 'new-pm', editData?.header === 'Truck' ? 5000 : 1)
            "
        >
            <!-- Default PMs -->
            <div
                formArrayName="defaultPMs"
                class="common-fake-table-modal common-fake-table-modal-pm"
                *ngIf="defaultPMs.length"
            >
                <div class="common-fake-table-label">
                    <p>
                        <svg-icon
                            src="../../../../../assets/svg/common/ic_modal_card_sort.svg"
                        ></svg-icon>
                    </p>
                    <p>TITLE</p>
                    <p>
                        {{
                            editData?.header?.includes('Truck')
                                ? 'MILEAGE'
                                : 'MONTHS'
                        }}
                    </p>
                </div>
                <div
                    class="common-fake-table-body common-fake-table-body-height-auto"
                >
                    <div
                        *ngFor="
                            let pm of defaultPMs.controls;
                            let ind = index;
                            trackBy: identity
                        "
                    >
                        <div
                            [formGroupName]="ind"
                            class="common-fake-table-card"
                        >
                            <div
                                class="common-fake-table-card-number"
                                [class.always-active]="
                                    pm?.get('status')?.value?.name ===
                                        'Default' || editData?.type !== 'new'
                                "
                            >
                                {{ ind + 1 }}
                            </div>
                            <app-ta-checkbox
                                formControlName="isChecked"
                                [name]="ind + 'default'"
                                [customClass]="'regular'"
                                [disabled]="
                                    editData?.header?.includes('Truck')
                                        ? ind < 4
                                        : ind < 1
                                "
                                [svg]="pm.get('svg').value"
                                [label]="pm.get('title').value"
                            >
                            </app-ta-checkbox>

                            <app-ta-input
                                formControlName="mileage"
                                [inputConfig]="{
                                    name: editData?.header?.includes('Truck')
                                        ? 'MILEAGE'
                                        : 'MONTHS',
                                    type: 'text',
                                    commands: {
                                        active: true,
                                        type: 'pm-increment-decrement',
                                        blueCommands: true,
                                        firstCommand: {
                                            name: 'decrement',
                                            svg: 'assets/svg/common/ic_pm_decrement.svg'
                                        },
                                        secondCommand: {
                                            name: 'increment',
                                            svg: 'assets/svg/common/ic_pm_increment.svg'
                                        },
                                        thirdCommand: {
                                            name: 'reset',
                                            svg: 'assets/svg/common/ic_input_reset.svg'
                                        }
                                    },
                                    maxLength: editData?.header?.includes(
                                        'Truck'
                                    )
                                        ? 999999999
                                        : 2,
                                    thousandSeparator: true,
                                    hideErrorMessage: true,
                                    blueInput: true,
                                    hideRequiredCheck: true,
                                    hideClear: true,
                                    defaultValue: pm.get('defaultMileage').value
                                }"
                            ></app-ta-input>

                            <div
                                *ngIf="
                                    editData?.type === 'new' &&
                                    pm.get('status').value.name !== 'Default'
                                "
                                ngbTooltip
                                mainTooltip="Delete"
                                position="top"
                                tooltipBackground="#EF5350"
                                class="common-fake-table-delete"
                                (click)="removeNewPMs(ind)"
                            >
                                <svg-icon
                                    src="assets/svg/common/ic_trash.svg"
                                ></svg-icon>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New PMs -->
            <div
                formArrayName="newPMs"
                class="common-fake-table-modal common-fake-table-modal-pm"
                [ngStyle]="{ 'margin-top': '0px' }"
                *ngIf="newPMs.length"
            >
                <div class="common-fake-table-body">
                    <div
                        *ngFor="
                            let pm of newPMs.controls;
                            let ind = index;
                            trackBy: identity
                        "
                    >
                        <div
                            [formGroupName]="ind"
                            class="common-fake-table-card"
                        >
                            <div
                                class="common-fake-table-card-number"
                                [class.always-active]="
                                    pm?.get('status')?.value?.name ===
                                        'Default' || editData?.type !== 'new'
                                "
                            >
                                {{ defaultPMs.length + ind + 1 }}
                            </div>
                            <app-ta-checkbox
                                formControlName="isChecked"
                                [name]="ind + 'new'"
                                [customClass]="'regular'"
                                [svg]="pm.get('svg').value"
                                [label]="pm.get('value').value"
                            >
                            </app-ta-checkbox>
                            <div
                                class="pm-new-input-container"
                                [ngStyle]="{
                                    position: 'absolute',
                                    left: '25.5px'
                                }"
                                *ngIf="!pm.get('hidden').value"
                            >
                                <app-ta-input
                                    class="pm-desription"
                                    formControlName="value"
                                    [inputConfig]="{
                                        name: 'Description',
                                        type: 'text',
                                        minLength: 2,
                                        maxLength: 160,
                                        textTransform: 'capitalize',
                                        placeholderIcon: 'default_pm',
                                        blueInput: true,
                                        hideErrorMessage: true,
                                        hideRequiredCheck: true
                                    }"
                                    (change)="onChangeValueNewPM(ind)"
                                ></app-ta-input>
                            </div>

                            <app-ta-input
                                formControlName="mileage"
                                [inputConfig]="{
                                    name: editData?.header?.includes('Truck')
                                        ? 'MILEAGE'
                                        : 'MONTHS',
                                    type: 'text',
                                    commands: {
                                        active: true,
                                        type: 'pm-increment-decrement',
                                        blueCommands: true,
                                        firstCommand: {
                                            name: 'decrement',
                                            svg: 'assets/svg/common/ic_pm_decrement.svg'
                                        },
                                        secondCommand: {
                                            name: 'increment',
                                            svg: 'assets/svg/common/ic_pm_increment.svg'
                                        },
                                        thirdCommand: {
                                            name: 'reset',
                                            svg: 'assets/svg/common/ic_input_reset.svg'
                                        }
                                    },
                                    thousandSeparator: true,
                                    hideErrorMessage: true,
                                    blueInput: true,
                                    hideRequiredCheck: true,
                                    maxLength: editData?.header?.includes(
                                        'Truck'
                                    )
                                        ? 999999999
                                        : 2,
                                    defaultValue: pm.get('defaultMileage').value
                                }"
                            ></app-ta-input>

                            <div
                                *ngIf="editData?.type === 'new'"
                                ngbTooltip
                                mainTooltip="Delete"
                                position="top"
                                tooltipBackground="#EF5350"
                                class="common-fake-table-delete"
                                (click)="removeNewPMs(ind)"
                            >
                                <svg-icon
                                    src="assets/svg/common/ic_trash.svg"
                                ></svg-icon>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </app-ta-custom-card>
    </form>
</app-ta-modal>
