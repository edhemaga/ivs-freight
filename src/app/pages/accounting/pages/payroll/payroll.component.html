<div class="table-container d-flex">
    <div class="payroll-main" [class.open]="reportTableExpanded$ | async">
        <app-payroll-toolbar
            [selectedTab]="selectedTab"
            (toolBarAction)="onToolBarAction($event)"
            [tableExpanded]="reportTableExpanded$ | async"
        >
        </app-payroll-toolbar>

        <div class="payroll-tables-holder">
            <ng-container
                *ngFor="
                    let payroll of (payrollCountsResponse$ | async).payrollData;
                    let indx = index;
                    trackBy: trackByIndex
                "
            >
                <div class="card-holder">
                    <app-ca-payroll-list-summary-overview
                        [index]="indx"
                        [isExpanded]="openedIndex === indx"
                        [item]="payroll"
                        (toggle)="hideShowTables($event)"
                        [leftTemplate]="driverMileageOpenSumary"
                        [showLeftTemplate]="
                            selectedOpenFromList && openedIndex === indx
                        "
                    >
                        <ng-container #container></ng-container>
                    </app-ca-payroll-list-summary-overview>
                </div>
            </ng-container>
        </div>
    </div>
    <ng-container *ngIf="reportTableExpanded$ | async">
        <div class="report-hold">
            <ng-container [ngSwitch]="payrollReportType">
                <ng-container *ngSwitchCase="PayrollTables.DRIVER_MILES">
                    <app-payroll-report
                        [selectedTab]="selectedTabForReport"
                        [reportId]="reportTableDataId"
                    ></app-payroll-report>
                </ng-container>
                <ng-container *ngSwitchCase="PayrollTables.DRIVER_COMMISSION">
                    <app-driver-commission-report
                        [selectedTab]="selectedTabForReport"
                        [reportId]="reportTableDataId"
                    ></app-driver-commission-report>
                </ng-container>
                <ng-container *ngSwitchCase="PayrollTables.DRIVER_OWNER">
                    <app-driver-owner-report
                        [selectedTab]="selectedTabForReport"
                        [reportId]="reportTableDataId"
                    ></app-driver-owner-report>
                </ng-container>
                <ng-container *ngSwitchCase="PayrollTables.DRIVER_FLAT_RATE">
                    <app-driver-flat-rate-report
                        [selectedTab]="selectedTabForReport"
                        [reportId]="reportTableDataId"
                    ></app-driver-flat-rate-report>
                </ng-container>
            </ng-container>
        </div>
    </ng-container>
</div>

<ng-template #customIndex let-index="index">
    <div>{{ index }}</div>
</ng-template>

<ng-template #customCell>
    <div>
        <app-ca-note
            [note]="''"
            [openedAll]="false"
            [parking]="false"
        ></app-ca-note>
    </div>
</ng-template>

<ng-template #driverMileageOpenSumary>
    <div class="driver-opened-payroll-sumary d-f-aic">
        <div class="d-f-aic" (click)="closeOpenPreview($event)">
            <div class="close_open_payroll_arrow d-f-aic-jcc">
                <svg-icon src="assets/svg/common/back-arrow.svg"></svg-icon>
            </div>
            <div class="table-text with-border">
                {{ selectedOpenFromList?.title }}
            </div>
        </div>

        <div class="driver-info d-flex">
            <ng-container *ngIf="!selectedOpenFromList?.hideAvatar">
                <app-ca-profile-image
                    [avatarColor]="{
                        background: '#DFC2F9',
                        color: '#9E47EC66'
                    }"
                    [textShortName]="'FJ'"
                    [size]="20"
                    [isRound]="false"
                    [isHoverEffect]="false"
                ></app-ca-profile-image>
            </ng-container>

            <div class="table-text">
                {{ selectedOpenFromList?.fullName }}
            </div>
            <div class="item-count d-f-aic-jcc d-flex">
                {{ selectedOpenFromList?.payrollCount }}
            </div>
        </div>
    </div>
</ng-template>
