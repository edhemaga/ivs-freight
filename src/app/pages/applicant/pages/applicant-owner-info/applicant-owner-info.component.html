<ng-container *ngIf="isValidLoad">
    <div class="container-fluid">
        <div class="row">
            <div
                class="container-fluid d-flex flex-column justify-content-between owner-info-container"
            >
                <div class="d-flex flex-column align-items-center">
                    <app-applicant-header
                        [mode]="selectedMode"
                    ></app-applicant-header>

                    <h1 class="m-0 text-center title ta-font-bold">
                        Owner Info
                    </h1>

                    <h2
                        class="m-0 text-center subtitle ta-font-regular"
                        [ngStyle]="{
                            color:
                                selectedMode === selectedModeEnum.FEEDBACK
                                    ? '#919191'
                                    : '#6C6C6C'
                        }"
                    >   Please select owner type and fill in all required fields.
                    </h2>

                    <!-- TABS -->

                    <div class="owner-info-tabs">
                        <app-ta-tab-switch
                            [tabs]="ownerInfoTabs"
                            (switchClicked)="onTabChange($event)"
                            [type]="'type1-modal-popup'"
                        >
                        </app-ta-tab-switch>
                    </div>

                    <!-- FORM SECTION -->

                    <div class="d-flex form-section">
                        <ng-container *ngIf="selectedTab === ownerInfoTabEnum.COMPANY">
                            <form [formGroup]="ownerInfoForm">
                                <div
                                    class="d-flex flex-column align-items-center"
                                >
                                    <!-- BUSINESS NAME, EIN NUMBER -->

                                    <div class="d-flex line-container">
                                        <div class="group business-name-group">
                                            <app-ta-input
                                                formControlName="businessName"
                                                [inputConfig]="businessNameInputConfig"
                                                [incorrectValue]="
                                                    openAnnotationArray[0]
                                                        .lineInputs[0]
                                                "
                                                (incorrectEvent)="
                                                    incorrectInput($event, 0, 0)
                                                "
                                            ></app-ta-input>
                                        </div>

                                        <div class="group ein-group">
                                            <app-ta-input
                                                formControlName="ein"
                                                [inputConfig]="einInputConfig"
                                                [incorrectValue]="
                                                    openAnnotationArray[0]
                                                        .lineInputs[1]
                                                "
                                                (incorrectEvent)="
                                                    incorrectInput($event, 1, 0)
                                                "
                                            ></app-ta-input>
                                        </div>

                                        <!-- REVIEW AND FEEDBACK -->

                                        <ng-container
                                            *ngIf="
                                                selectedMode !==
                                                selectedModeEnum.APPLICANT
                                            "
                                        >
                                            <div
                                                class="review-feedback-container"
                                            >
                                                <app-applicant-review-feedback
                                                    formControlName="firstRowReview"
                                                    [displayAnnotationButton]="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                        openAnnotationArray[0]
                                                            .displayAnnotationButton
                                                    "
                                                    [displayAnnotationTextArea]="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                        openAnnotationArray[0]
                                                            .displayAnnotationTextArea
                                                    "
                                                    [lineIndex]="0"
                                                    [isFeedback]="
                                                        selectedMode ===
                                                        selectedModeEnum.FEEDBACK
                                                    "
                                                    [feedbackText]="
                                                        selectedMode ===
                                                            selectedModeEnum.FEEDBACK &&
                                                        stepFeedbackValues?.businessNameEinMessage
                                                    "
                                                    (annotationBtnClickEvent)="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                            getAnnotationBtnClickValue(
                                                                $event
                                                            )
                                                    "
                                                ></app-applicant-review-feedback>
                                            </div>
                                        </ng-container>
                                    </div>

                                    <!-- PHONE, EMAIL -->

                                    <div class="d-flex line-container">
                                        <div class="group phone-group">
                                            <app-ta-input
                                                formControlName="phone"
                                                [inputConfig]="phoneInputConfig"
                                                [incorrectValue]="
                                                    openAnnotationArray[1]
                                                        .lineInputs[0]
                                                "
                                                (incorrectEvent)="
                                                    incorrectInput($event, 0, 1)
                                                "
                                            ></app-ta-input>
                                        </div>

                                        <div class="group email-group">
                                            <app-ta-input
                                                formControlName="email"
                                                [inputConfig]="emailInputConfig"
                                                [incorrectValue]="
                                                    openAnnotationArray[1]
                                                        .lineInputs[1]
                                                "
                                                (incorrectEvent)="
                                                    incorrectInput($event, 1, 1)
                                                "
                                            ></app-ta-input>
                                        </div>

                                        <!-- REVIEW AND FEEDBACK -->

                                        <ng-container
                                            *ngIf="
                                                selectedMode !==
                                                selectedModeEnum.APPLICANT
                                            "
                                        >
                                            <div
                                                class="review-feedback-container"
                                            >
                                                <app-applicant-review-feedback
                                                    formControlName="secondRowReview"
                                                    [displayAnnotationButton]="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                        openAnnotationArray[1]
                                                            .displayAnnotationButton
                                                    "
                                                    [displayAnnotationTextArea]="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                        openAnnotationArray[1]
                                                            .displayAnnotationTextArea
                                                    "
                                                    [lineIndex]="1"
                                                    [isFeedback]="
                                                        selectedMode ===
                                                        selectedModeEnum.FEEDBACK
                                                    "
                                                    [feedbackText]="
                                                        selectedMode ===
                                                            selectedModeEnum.FEEDBACK &&
                                                        stepFeedbackValues?.contactMessage
                                                    "
                                                    (annotationBtnClickEvent)="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                            getAnnotationBtnClickValue(
                                                                $event
                                                            )
                                                    "
                                                ></app-applicant-review-feedback>
                                            </div>
                                        </ng-container>
                                    </div>

                                    <!-- ADDRESS, ADDRESS UNIT -->

                                    <div class="d-flex line-container">
                                        <div class="group address-group">
                                            <app-ta-input-address-dropdown
                                                formControlName="address"
                                                [inputConfig]="addressInputConfig"
                                                [incorrectValue]="
                                                    openAnnotationArray[2]
                                                        .lineInputs[0]
                                                "
                                                (incorrectEvent)="
                                                    incorrectInput($event, 0, 2)
                                                "
                                                [placeholderType]="
                                                    'longAddress'
                                                "
                                                (selectedAddress)="
                                                    handleInputSelect(
                                                        $event,
                                                        'ADDRESS'
                                                    )
                                                "
                                            ></app-ta-input-address-dropdown>
                                        </div>

                                        <div class="group address-unit-group">
                                            <app-ta-input
                                                formControlName="addressUnit"
                                                [inputConfig]="addressUnitInputConfig"
                                                [incorrectValue]="
                                                    openAnnotationArray[2]
                                                        .lineInputs[1]
                                                "
                                                (incorrectEvent)="
                                                    incorrectInput($event, 1, 2)
                                                "
                                            ></app-ta-input>
                                        </div>

                                        <!-- REVIEW AND FEEDBACK -->

                                        <ng-container
                                            *ngIf="
                                                selectedMode !==
                                                selectedModeEnum.APPLICANT
                                            "
                                        >
                                            <div
                                                class="review-feedback-container"
                                            >
                                                <app-applicant-review-feedback
                                                    formControlName="thirdRowReview"
                                                    [displayAnnotationButton]="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                        openAnnotationArray[2]
                                                            .displayAnnotationButton
                                                    "
                                                    [displayAnnotationTextArea]="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                        openAnnotationArray[2]
                                                            .displayAnnotationTextArea
                                                    "
                                                    [lineIndex]="2"
                                                    [isFeedback]="
                                                        selectedMode ===
                                                        selectedModeEnum.FEEDBACK
                                                    "
                                                    [feedbackText]="
                                                        selectedMode ===
                                                            selectedModeEnum.FEEDBACK &&
                                                        stepFeedbackValues?.addressMessage
                                                    "
                                                    (annotationBtnClickEvent)="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                            getAnnotationBtnClickValue(
                                                                $event
                                                            )
                                                    "
                                                ></app-applicant-review-feedback>
                                            </div>
                                        </ng-container>
                                    </div>

                                    <!-- BANK, ACCOUNT, ROUTING -->

                                    <div class="d-flex line-container">
                                        <div class="group bank-group">
                                            <app-ta-input-dropdown
                                                formControlName="bank"
                                                [template]="'svg-template'"
                                                [inputConfig]="bankInputConfig"
                                                [activeItem]="selectedBank"
                                                [options]="banksDropdownList"
                                                [canAddNew]="true"
                                                (saveItem)="
                                                    onSaveNewBank($event)
                                                "
                                                (selectedItem)="
                                                    handleInputSelect(
                                                        $event,
                                                        'BANK'
                                                    )
                                                "
                                            ></app-ta-input-dropdown>
                                        </div>

                                        <div class="group account-group">
                                            <app-ta-input
                                                formControlName="accountNumber"
                                                [inputConfig]="accountNumberInputConfig"
                                                [incorrectValue]="
                                                    openAnnotationArray[3]
                                                        .lineInputs[0]
                                                "
                                                (incorrectEvent)="
                                                    incorrectInput($event, 0, 3)
                                                "
                                            ></app-ta-input>
                                        </div>

                                        <div class="group routing-group">
                                            <app-ta-input
                                                formControlName="routingNumber"
                                                [inputConfig]="routingNumberInputConfig"
                                            ></app-ta-input>
                                        </div>

                                        <!-- REVIEW AND FEEDBACK -->

                                        <ng-container
                                            *ngIf="
                                                selectedMode !==
                                                selectedModeEnum.APPLICANT
                                            "
                                        >
                                            <div
                                                class="review-feedback-container"
                                            >
                                                <app-applicant-review-feedback
                                                    formControlName="fourthRowReview"
                                                    [displayAnnotationButton]="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                        openAnnotationArray[3]
                                                            .displayAnnotationButton
                                                    "
                                                    [displayAnnotationTextArea]="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                        openAnnotationArray[3]
                                                            .displayAnnotationTextArea
                                                    "
                                                    [lineIndex]="3"
                                                    [isFeedback]="
                                                        selectedMode ===
                                                        selectedModeEnum.FEEDBACK
                                                    "
                                                    [feedbackText]="
                                                        selectedMode ===
                                                            selectedModeEnum.FEEDBACK &&
                                                        stepFeedbackValues?.accountRoutingMessage
                                                    "
                                                    (annotationBtnClickEvent)="
                                                        selectedMode ===
                                                            selectedModeEnum.REVIEW &&
                                                            getAnnotationBtnClickValue(
                                                                $event
                                                            )
                                                    "
                                                ></app-applicant-review-feedback>
                                            </div>
                                        </ng-container>
                                    </div>

                                    <!-- DIVIDER -->

                                    <div class="divider"></div>

                                    <app-applicant-truck-details
                                        [formGroup]="ownerInfoForm"
                                        [selectedMode]="selectedMode"
                                        [selectedTruckType]="selectedTruckType"
                                        [selectedTruckMake]="selectedTruckMake"
                                        [selectedTruckColor]="selectedTruckColor"
                                        [stepFeedbackValues]="stepFeedbackValues"
                                        [dropdownOptions]="dropdownOptions"
                                        [documents]="documents"
                                        [displayDocumentsRequiredNote]="displayDocumentsRequiredNote"
                                        (onFilesAction)="onFilesAction($event)"
                                        (onInputSelect)="handleInputSelectTruckTrailer($event)"
                                    >
                                    </app-applicant-truck-details>


                                    <!-- ADD TRAILER / TRAILER DETAIL -->

                                    <div
                                        class="d-flex w-100 justify-content-between add-trailer-row"
                                        [ngClass]="{'flex-column': isAddTrailerSelected}"
                                    >
                                        <ng-container *ngIf="!isAddTrailerSelected else trailerDetail">
                                            <p class="m-0 ta-font-extra-bold">
                                                Have trailer in your possession?
                                            </p>
    
                                            <button
                                                type="button"
                                                (click)="toggleAddTrailer()"
                                                class="d-flex justify-content-center align-items-center add-trailer-btn"
                                            >
                                                <p class="m-0 ta-font-bold">
                                                    Add Trailer
                                                </p>
                                            </button>
                                        </ng-container>

                                        <ng-template #trailerDetail>
                                            <div class="divider"></div>

                                            <div class="d-flex justify-content-between">
                                                <div
                                                    class="d-flex align-self-start add-truck-container"
                                                >
                                                    <p class="m-0 ta-font-extra-bold">
                                                        Trailer Detail
                                                    </p>
                                                </div>
        
                                                <div
                                                    class="d-flex justify-content-center align-items-center delete-btn-container"
                                                >
                                                    <div
                                                        ngbTooltip
                                                        mainTooltip="Clear"
                                                        tooltipBackground="#2F2F2F"
                                                        position="top"
                                                        (click)="toggleAddTrailer()"
                                                    >
                                                        <svg-icon
                                                            class="delete-icon"
                                                            src="assets/svg/truckassist-table/dropdown/content/delete.svg"
                                                        ></svg-icon>
                                                    </div>
                                                </div>
                                            </div>

                                        </ng-template>
                                    </div>

                                    <ng-container *ngIf="isAddTrailerSelected">
                                        <app-applicant-trailer-details
                                            [formGroup]="ownerInfoForm"
                                            [selectedMode]="selectedMode"
                                            [selectedTrailerType]="selectedTrailerType"
                                            [selectedTrailerMake]="selectedTrailerMake"
                                            [selectedTrailerLength]="selectedTrailerLength"
                                            [selectedTrailerColor]="selectedTrailerColor"
                                            [stepFeedbackValues]="stepFeedbackValues"
                                            [loadingTrailerVinDecoder]="loadingTrailerVinDecoder"
                                            [dropdownOptions]="dropdownOptions"
                                            [documents]="documents"
                                            [displayDocumentsRequiredNote]="displayDocumentsRequiredNote"
                                            [isAddTrailerSelected]="isAddTrailerSelected"
                                            (onFilesAction)="onFilesAction($event)"
                                            (onInputSelect)="handleInputSelectTruckTrailer($event)"
                                        >
                                        </app-applicant-trailer-details>
                                    </ng-container>
                                </div>
                            </form>
                        </ng-container>

                        <ng-container *ngIf="selectedTab === ownerInfoTabEnum.SOLE_PROPRIETOR">
                            <div
                                class="d-flex flex-column align-items-center"
                            >
                                <!-- DIVIDER -->

                                <div class="divider"></div>

                                <!-- ADD TRUCK -->

                                <app-applicant-truck-details
                                    [formGroup]="ownerInfoSoleForm"
                                    [selectedMode]="selectedMode"
                                    [selectedTruckType]="selectedSoleTruckType"
                                    [selectedTruckMake]="selectedSoleTruckMake"
                                    [selectedTruckColor]="selectedSoleTruckColor"
                                    [stepFeedbackValues]="stepFeedbackValues"
                                    [dropdownOptions]="dropdownOptions"
                                    [documents]="documents"
                                    [displayDocumentsRequiredNote]="displayDocumentsRequiredNote"
                                    (onFilesAction)="onFilesAction($event)"
                                    (onInputSelect)="handleInputSelectTruckTrailer($event)"
                                >
                                </app-applicant-truck-details>


                                <!-- ADD TRAILER / TRAILER DETAIL -->

                                <div
                                    class="d-flex w-100 justify-content-between add-trailer-row"
                                    [ngClass]="{'flex-column': isSoleAddTrailerSelected}"
                                >
                                    <ng-container *ngIf="!isSoleAddTrailerSelected else trailerDetail">
                                        <p class="m-0 ta-font-extra-bold">
                                            Have trailer in your possession?
                                        </p>

                                        <button
                                            type="button"
                                            (click)="toggleSoleAddTrailer()"
                                            class="d-flex justify-content-center align-items-center add-trailer-btn"
                                        >
                                            <p class="m-0 ta-font-bold">
                                                Add Trailer
                                            </p>
                                        </button>
                                    </ng-container>

                                    <ng-template #trailerDetail>
                                        <div class="divider"></div>

                                        <div class="d-flex justify-content-between">
                                            <div
                                                class="d-flex align-self-start add-truck-container"
                                            >
                                                <p class="m-0 ta-font-extra-bold">
                                                    Trailer Detail
                                                </p>
                                            </div>
    
                                            <div
                                                class="d-flex justify-content-center align-items-center delete-btn-container"
                                            >
                                                <div
                                                    ngbTooltip
                                                    mainTooltip="Clear"
                                                    tooltipBackground="#2F2F2F"
                                                    position="top"
                                                    (click)="toggleSoleAddTrailer()"
                                                >
                                                    <svg-icon
                                                        class="delete-icon"
                                                        src="assets/svg/truckassist-table/dropdown/content/delete.svg"
                                                    ></svg-icon>
                                                </div>
                                            </div>
                                        </div>

                                    </ng-template>
                                </div>

                                <!-- TRAILER SOLE GROUP -->
                                <ng-container *ngIf="isSoleAddTrailerSelected">
                                    <app-applicant-trailer-details
                                        [formGroup]="ownerInfoSoleForm"
                                        [selectedMode]="selectedMode"
                                        [selectedTrailerType]="selectedSoleTrailerType"
                                        [selectedTrailerMake]="selectedSoleTrailerMake"
                                        [selectedTrailerLength]="selectedSoleTrailerLength"
                                        [selectedTrailerColor]="selectedSoleTrailerColor"
                                        [stepFeedbackValues]="stepFeedbackValues"
                                        [loadingTrailerVinDecoder]="loadingTrailerVinDecoder"
                                        [dropdownOptions]="dropdownOptions"
                                        [documents]="documents"
                                        [displayDocumentsRequiredNote]="displayDocumentsRequiredNote"
                                        [isAddTrailerSelected]="isSoleAddTrailerSelected"
                                        (onFilesAction)="onFilesAction($event)"
                                        (onInputSelect)="handleInputSelectTruckTrailer($event)"
                                    >
                                    </app-applicant-trailer-details>
                                </ng-container>
                            </div>
                        </ng-container>
                    </div>
                </div>

                <!-- FOOTER -->

                <app-applicant-footer
                    [mode]="selectedMode"
                ></app-applicant-footer>
            </div>
        </div>
    </div>

    <!-- NEXT BTN -->

    <div
        class="d-flex justify-content-center align-items-center next-btn-container"
    >
        <app-applicant-next-back-btn
            [nextStep]="true"
            [lastStep]="true"
            [filledCorrectly]="
                ownerInfoForm.valid &&
                (selectedMode === selectedModeEnum.APPLICANT ||
                    (selectedMode === selectedModeEnum.FEEDBACK &&
                        isFeedbackValueUpdated))
            "
            [hasIncorrectFields]="
                selectedMode === selectedModeEnum.REVIEW && hasIncorrectFields
            "
            [mode]="selectedMode"
            (stepEvent)="onStepAction($event)"
        ></app-applicant-next-back-btn>
    </div>

    <!-- BACK BTN -->

    <div
        class="d-flex justify-content-center align-items-center back-btn-container"
        >
        <app-applicant-next-back-btn
            [backStep]="true"
            (stepEvent)="onStepAction($event)"
        ></app-applicant-next-back-btn>
    </div>
</ng-container>
