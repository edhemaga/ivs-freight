<app-ta-modal
    [isVisibleMap]="true"
    [modalTitle]="modalTitle"
    [editData]="editData"
    [editName]="editName"
    [specificCaseModalName]="true"
    [isModalValid]="
        loadForm.valid &&
        loadForm.touched &&
        isEachStopItemsRowValid &&
        !reorderingStarted &&
        !isMilesLoading
    "
    [customClass]="loadModalSize"
    [partClass]="'load-modal-origin-part'"
    [isVisibleHazardous]="isHazardousPicked"
    [loadModalTemplate]="true"
    [modalAdditionalPart]="true"
    [isConvertedToTemplate]="isConvertedToTemplate"
    [saveAndAddNew]="true"
    (additionalPartVisibility)="additionalPartVisibility($event)"
    (action)="onModalAction($event)"
    [isClickEnabledWhileFormInvalid]="true"
    (runFormValidation)="runFormValidation()"
>
    <!-- Origin Tab -->

    <form
        origin
        #originElement
        [formGroup]="loadForm"
        class="form-container form-container-without-mb"
    >
        <div class="m-tab">
            <!-- FTL - LTL, Dispatcher, Company -->

            <div
                class="align-items-center load-ftl-first-row"
                [ngClass]="{
                    'template-row': isConvertedToTemplate,
                    'edit-load': editData.type === 'edit',
                    'select-template': !isConvertedToTemplate && !isActiveLoad,
                }"
            >
                <!-- FTL-LTL Switcher -->
                <div class="tabs-container">
                    @if (!isActiveLoad) {
                        <app-ta-tab-switch
                            [tabs]="tabs"
                            (switchClicked)="onTabChange($event, 'ftl-ltl')"
                            [type]="'type2-modal-popup'"
                        >
                        </app-ta-tab-switch>
                    } @else {
                        <ta-input-dropdown-status
                            [options]="statusDropDownList"
                            [previousStatus]="previousStatus"
                            [selectedStatus]="selectedStatus"
                            [inputConfig]="getStatusInputConfig"
                            (selectedItem)="onSelectDropdown($event, 'status')"
                        ></ta-input-dropdown-status>
                    }
                </div>

                <!-- Load Template Picker -->

                @if (!isConvertedToTemplate && !isActiveLoad) {
                    @if (!isTemplateSelected) {
                        <button
                            class="d-flex align-items-center justify-content-center load-template-switcher-container"
                            [ngClass]="{
                                active: popover.isOpen(),
                                valid: !popover.isOpen() && isTemplateSelected,
                            }"
                            #popover="ngbPopover"
                            autoClose="outside"
                            [ngbPopover]="dropdownPopover"
                            popoverClass="popover-main"
                            placement="bottom-start"
                            container="body"
                            ngbTooltip
                            [mainTooltip]="
                                !popover.isOpen() && labelsTemplate.length
                                    ? 'Select Template'
                                    : null
                            "
                            position="bottom"
                            tooltipBackground="#424242"
                            [disabled]="!labelsTemplate.length"
                        >
                            <svg-icon
                                class="load-template-switcher-icon"
                                src="assets/svg/common/load/ic_load_template_btn.svg"
                                [svgStyle]="{
                                    'width.px': '16',
                                    'height.px': '16',
                                }"
                            ></svg-icon>
                        </button>

                        <ng-template #dropdownPopover>
                            <div
                                class="popover-container load-template-switcher-popover-container scrollable-element pb-0"
                            >
                                @for (
                                    template of labelsTemplate;
                                    let i = $index;
                                    track i
                                ) {
                                    <div
                                        class="popover-item"
                                        (click)="
                                            handleTemplateSelectClick(
                                                template.id
                                            )
                                        "
                                    >
                                        <p class="m-0 text-truncate">
                                            {{ template.name }}
                                        </p>
                                    </div>
                                }
                            </div>
                        </ng-template>
                    } @else {
                        <button
                            class="d-flex align-items-center justify-content-center remove-template-btn"
                            ngbTooltip
                            mainTooltip="Remove Template"
                            position="bottom"
                            tooltipBackground="#424242"
                            (click)="handleRemoveTemplateClick()"
                        >
                            <svg-icon
                                class="switcher-icon"
                                src="assets/svg/common/load/ic_load_template_btn.svg"
                                [svgStyle]="{
                                    'width.px': '16',
                                    'height.px': '16',
                                }"
                            ></svg-icon>
                        </button>
                    }
                }

                <!-- Dispatcher -->

                <div class="dispatcher-container">
                    <app-ca-input-dropdown
                        formControlName="dispatcherId"
                        [template]="'load-dispatcher'"
                        [inputConfig]="getDispatcherInputConfig()"
                        [options]="labelsDispatcher"
                        (selectedItem)="onSelectDropdown($event, 'dispatcher')"
                    ></app-ca-input-dropdown>
                </div>

                <!-- Truck -->

                <div class="company-template-name-container">
                    <!-- Template Name -->

                    @if (isConvertedToTemplate) {
                        <ca-input-test
                            formControlName="templateName"
                            [inputConfig]="loadTemplateInputConfig"
                        ></ca-input-test>
                    } @else {
                        <app-ca-input-dropdown
                            formControlName="companyId"
                            [inputConfig]="loadCompanyInputConfig"
                            [options]="labelsCompanies"
                            [activeItem]="selectedCompany"
                            (selectedItem)="onSelectDropdown($event, 'company')"
                        ></app-ca-input-dropdown>
                    }
                </div>
            </div>

            <div class="load-ftl-fourth-row">
                <app-ca-input-dropdown
                    formControlName="dispatchId"
                    [template]="'load-dispatches-ttd'"
                    [inputConfig]="loadDispatchesTTDInputConfig"
                    [options]="labelsDispatches"
                    [activeItem]="selectedDispatch"
                    (selectedItem)="
                        onSelectDropdown($event, 'dispatches', 0, true)
                    "
                ></app-ca-input-dropdown>
            </div>

            <!-- Broker -->
            <div class="load-ftl-second-row">
                <ca-input-test
                    formControlName="referenceNumber"
                    [inputConfig]="loadReferenceInputConfig"
                ></ca-input-test>
                <app-ca-input-dropdown
                    formControlName="brokerId"
                    [template]="'load-broker'"
                    [inputConfig]="loadBrokerInputConfig"
                    [canAddNew]="true"
                    [canOpenModal]="true"
                    [options]="labelsBroker"
                    [activeItem]="selectedBroker"
                    (selectedItem)="onSelectDropdown($event, 'broker')"
                ></app-ca-input-dropdown>
            </div>

            <!-- Reference No, General Commodity, Weight -->

            <div class="load-ftl-third-row">
                <app-ca-input-dropdown
                    formControlName="brokerContactId"
                    [template]="'load-broker-contact'"
                    [inputConfig]="loadBrokerContactsInputConfig"
                    [canAddNew]="true"
                    [canOpenModal]="true"
                    [options]="labelsBrokerContacts"
                    [activeItem]="selectedBrokerContact"
                    (selectedItem)="onSelectDropdown($event, 'broker-contact')"
                ></app-ca-input-dropdown>
                <app-ca-input-dropdown
                    formControlName="generalCommodity"
                    [template]="'svgtext-template'"
                    [inputConfig]="loadCommodityInputConfig"
                    [options]="labelsGeneralCommodity"
                    [activeItem]="selectedGeneralCommodity"
                    (selectedItem)="
                        onSelectDropdown($event, 'general-commodity')
                    "
                ></app-ca-input-dropdown>

                <ca-input-test
                    formControlName="weight"
                    [inputConfig]="loadWeightInputConfig"
                ></ca-input-test>
            </div>
            <!-- Requirement -->

            <div
                class="d-flex flex-column justify-content-center requirement-container"
            >
                <app-ta-custom-card
                    [cardName]="'Requirement'"
                    [isCardOpen]="isRequirementVisible"
                    [hasBodyData]="true"
                    [hasDivider]="false"
                    [animationMarginParams]="{
                        marginTop: '10px',
                        marginBottom: '0',
                    }"
                >
                    <div class="pt-3">
                        <div class="load-requirements-load-first-row">
                            <app-ca-input-dropdown
                                #truckInputDropdown
                                formControlName="truckTypeId"
                                [template]="'svgtext-template'"
                                [inputConfig]="getTruckTypeIdInputConfig"
                                [options]="labelsTruckReq"
                                [activeItem]="selectedTruckReq"
                                (selectedItem)="
                                    onSelectDropdown($event, 'truck-req')
                                "
                            ></app-ca-input-dropdown>

                            <app-ca-input-dropdown
                                #trailerInputDropdown
                                formControlName="trailerTypeId"
                                [template]="'svgtext-template'"
                                [inputConfig]="getTrailerInputConfig"
                                [options]="labelsTrailerReq"
                                [activeItem]="selectedTrailerReq"
                                (selectedItem)="
                                    onSelectDropdown($event, 'trailer-req')
                                "
                            ></app-ca-input-dropdown>
                        </div>

                        <div class="load-requirements-load-second-row">
                            <app-ca-input-dropdown
                                formControlName="trailerLengthId"
                                [inputConfig]="loadTrailerLengthInputConfig"
                                [options]="labelsTrailerLength"
                                [activeItem]="selectedTrailerLength"
                                (selectedItem)="
                                    onSelectDropdown($event, 'length')
                                "
                            ></app-ca-input-dropdown>

                            <app-ca-input-dropdown
                                formControlName="doorType"
                                [inputConfig]="loadDoorTypeInputConfig"
                                [options]="labelsDoorType"
                                [activeItem]="selectedDoorType"
                                (selectedItem)="
                                    onSelectDropdown($event, 'door-type')
                                "
                            ></app-ca-input-dropdown>

                            <app-ca-input-dropdown
                                formControlName="suspension"
                                [inputConfig]="loadSuspensionInputConfig"
                                [options]="labelsSuspension"
                                [activeItem]="selectedSuspension"
                                (selectedItem)="
                                    onSelectDropdown($event, 'suspension')
                                "
                            ></app-ca-input-dropdown>

                            <app-ca-input-dropdown
                                formControlName="year"
                                [inputConfig]="loadYearInputConfig"
                                [options]="labelsYear"
                                [activeItem]="selectedYear"
                                (selectedItem)="
                                    onSelectDropdown($event, 'year')
                                "
                            ></app-ca-input-dropdown>

                            <div
                                class="d-flex align-items-center justify-content-end"
                            >
                                <app-ta-checkbox
                                    formControlName="liftgate"
                                    name="liftgate"
                                    [customClass]="'medium'"
                                    [label]="'Lifgate'"
                                ></app-ta-checkbox>
                            </div>
                        </div>
                    </div>
                </app-ta-custom-card>
            </div>

            <!-- Driver Message -->

            <div class="load-modal-row">
                <app-ta-input-note
                    formControlName="driverMessage"
                    [isVisibleNote]="
                        loadForm.get('driverMessage').value &&
                        loadForm.get('driverMessage').value !== 'null'
                    "
                    [note]="
                        loadForm.get('driverMessage').value &&
                        loadForm.get('driverMessage').value !== 'null'
                            ? loadForm.get('driverMessage').value
                            : ''
                    "
                    [noteLabel]="'Driver Message'"
                    [placeholder]="'Type something...'"
                    (styledValueEmitter)="
                        getDriverMessageOrNote($event, 'driverMessage')
                    "
                ></app-ta-input-note>
            </div>

            <!-- Stops -->

            <div class="d-flex align-items-center load-modal-row">
                <app-ta-custom-card
                    [cardName]="'Stops'"
                    [capsulaText]="
                        loadExtraStops.length
                            ? loadExtraStops.length + ' EXTRA'
                            : null
                    "
                    [isCardOpen]="true"
                    [hasCounter]="loadExtraStops.length + 2"
                    [hasActionSvg]="true"
                    [isActionDisabled]="!hasValidSteps"
                    [hasBodyData]="true"
                    [hasArrow]="false"
                    [animationMarginParams]="{
                        marginTop: '10px',
                        marginBottom: '12px',
                    }"
                    (onActionEvent)="onExtraStopAction($event)"
                    [isFinishReorderingButtonVisible]="reorderingStarted"
                    [reorderingSaveError]="reorderingSaveError"
                >
                    <!-- Stops Header -->

                    <div class="align-items-center stops-header-bar">
                        <p class="m-0 ta-font-bold">
                            <svg-icon
                                [src]="loadModalSvgRoutes.sorting"
                            ></svg-icon>
                        </p>
                        <p class="m-0 ta-font-bold">SHIPPER, LOCATION</p>
                        @if (selectedPickupShipper) {
                            <p class="m-0 ta-font-bold">DATE & TIME</p>
                            <p class="m-0 ta-font-bold text-right">
                                LEG, CONTACT
                            </p>
                        }
                    </div>

                    <!-- Pickup Stop  -->
                    <app-load-modal-stop
                        [firstOrLast]="true"
                        [stopNumber]="loadForm.get('pickupStopOrder').value"
                        [isDelivery]="false"
                        [shipper]="selectedPickupShipper?.name"
                        [shipperAddress]="selectedPickupShipper?.address"
                        [dateRange]="
                            loadForm.get('pickupDateFrom').value
                                | loadDatetimeRange
                                    : loadForm.get('pickupDateTo').value
                        "
                        [timeRange]="
                            loadForm.get('pickupTimeFrom').value
                                | loadTimeType
                                | loadDatetimeRange
                                    : (loadForm.get('pickupTimeTo').value
                                          | loadTimeType)
                        "
                        [legMile]="loadForm.get('pickuplegMiles').value"
                        [isEmptyLoad]="true"
                        [shipperContact]="{
                            fullName: selectedPickupShipperContact?.name,
                        }"
                        [state]="validatePickupStops(loadForm)"
                        [isCardOpen]="isActivePickupStop"
                        [stopFinished]="isPickupStopFinished()"
                        [appointment]="isPickupAppointment()"
                        [waitTime]="loadForm.get('pickupWaitTime').value"
                        [legHours]="loadForm.get('pickuplegHours').value"
                        [legMinutes]="loadForm.get('pickuplegMinutes').value"
                        (toggle)="toggleStopActivity($event, 'first-pickup')"
                    >
                        <!--  Shipper-->

                        <div class="row row-no-mt">
                            <div class="col-12">
                                <app-ca-input-dropdown
                                    formControlName="pickupShipper"
                                    [template]="'load-shipper'"
                                    [inputConfig]="loadPickupShipperInputConfig"
                                    [canAddNew]="true"
                                    [canOpenModal]="true"
                                    [options]="labelsShippers"
                                    (selectedItem)="
                                        onSelectDropdown(
                                            $event,
                                            'shipper-pickup',
                                            -1,
                                            true
                                        )
                                    "
                                    (closeDropdown)="
                                        loadForm
                                            .get('pickupShipper')
                                            .markAsTouched()
                                    "
                                >
                                </app-ca-input-dropdown>
                            </div>
                        </div>

                        <!-- Work Hours, Appointment, Shipper Contact -->
                        <div class="load-shipper-contact-row">
                            <app-ta-tab-switch
                                [tabs]="stopTimeTabsPickup"
                                (switchClicked)="
                                    onTabChange($event, 'stop-time-pickup')
                                "
                                [type]="'type2-modal-popup'"
                            ></app-ta-tab-switch>
                            <app-ca-input-dropdown
                                formControlName="pickupShipperContactId"
                                [template]="'load-broker-contact'"
                                [inputConfig]="
                                    loadPickupShipperContactsInputConfig
                                "
                                [canAddNew]="true"
                                [canOpenModal]="true"
                                [options]="labelsShipperContacts"
                                [activeItem]="selectedPickupShipperContact"
                                (selectedItem)="
                                    onSelectDropdown(
                                        $event,
                                        'shipper-contact-pickup'
                                    )
                                "
                            ></app-ca-input-dropdown>
                        </div>

                        <!--  Date Pickers & Time Pickers -->

                        <div
                            class="stop-load-date-time"
                            [ngClass]="{ 'date-range-active': pickupDateRange }"
                        >
                            <ca-input-datetime-picker
                                formControlName="pickupDateFrom"
                                [inputConfig]="getPickupDateFromInputConfig"
                                (blurInput)="
                                    markInputAsTouched('pickupDateFrom')
                                "
                                (clear)="
                                    markInputAsTouched('pickupDateFrom', true)
                                "
                            ></ca-input-datetime-picker>

                            @if (!pickupDateRange) {
                                <div
                                    class="d-flex align-items-center justify-content-center load-plus-button"
                                    [ngClass]="{
                                        disabled:
                                            selectedStopTimePickup === 6 ||
                                            selectedStopTimePickup === 2,
                                    }"
                                    (click)="addDateRange('pickup', true)"
                                    [mainTooltip]="'Date Range'"
                                    [tooltipBackground]="'#424242'"
                                    ngbTooltip
                                    position="bottom"
                                >
                                    <svg-icon
                                        class="plus-icon"
                                        src="assets/svg/common/ic_plus.svg"
                                        [svgStyle]="{
                                            'width.px': '14',
                                            'height.px': '14',
                                        }"
                                    ></svg-icon>
                                </div>
                            } @else {
                                <ca-input-datetime-picker
                                    formControlName="pickupDateTo"
                                    [inputConfig]="loadPickupEndDateInputConfig"
                                    (blurInput)="
                                        markInputAsTouched('pickupDateTo')
                                    "
                                    (clear)="
                                        markInputAsTouched('pickupDateTo', true)
                                    "
                                ></ca-input-datetime-picker>
                            }

                            <ca-input-datetime-picker
                                formControlName="pickupTimeFrom"
                                [inputConfig]="getPickupTimeFromInputConfig"
                                (blurInput)="
                                    markInputAsTouched('pickupTimeFrom')
                                "
                                (clear)="
                                    markInputAsTouched('pickupTimeFrom', true)
                                "
                            ></ca-input-datetime-picker>

                            <ca-input-datetime-picker
                                formControlName="pickupTimeTo"
                                [inputConfig]="getPickupTimeToInputConfig"
                                (blurInput)="markInputAsTouched('pickupTimeTo')"
                                (clear)="
                                    markInputAsTouched('pickupTimeTo', true)
                                "
                            ></ca-input-datetime-picker>
                        </div>

                        <div class="stop-load-date-time-driver">
                            <app-ta-checkbox
                                formControlName="pickupInvolveDriver"
                                [customClass]="'medium'"
                                [disabled]="isHazardousPicked"
                                [label]="'Involve driver in loading the cargo'"
                                (click)="onPickupDriver()"
                                name="pickupInvolveDriver"
                            ></app-ta-checkbox>
                        </div>

                        <!-- Stop Items -->

                        <div class="stop-items-wrapper">
                            <app-ta-custom-card
                                [cardName]="'Item'"
                                [isCardOpen]="isPickupItemsVisible"
                                [hasCounter]="savedPickupStopItems.length"
                                [disabledCard]="!savedPickupStopItems.length"
                                [hasActionSvg]="true"
                                [hasBodyData]="true"
                                [hasArrow]="savedPickupStopItems.length"
                                [animationMarginParams]="{
                                    marginTop: '10px',
                                    marginBottom: '12px',
                                }"
                                [hasScrollBodyXAxis]="isPickupItemsVisible"
                                [customClass]="'scrollable'"
                                (onActionEvent)="
                                    createNewStopItemsRow('pickup')
                                "
                                (onOpenCard)="toggleStopItemRow('pickup')"
                            >
                                <app-ta-modal-table
                                    [tableType]="modalTableTypeEnum.LOAD_ITEMS"
                                    [isNewRowCreated]="
                                        isCreatedNewStopItemsRow.pickup
                                    "
                                    [modalTableData]="pickupStopItems"
                                    [stopItemDropdownLists]="
                                        stopItemDropdownLists
                                    "
                                    [selectedTrailer]="selectedTrailerReq"
                                    [isHazardous]="isHazardousPicked"
                                    (modalTableValueEmitter)="
                                        handleStopItemsDataValueEmit(
                                            $event,
                                            'pickup'
                                        )
                                    "
                                    (modalTableValidStatusEmitter)="
                                        handleStopItemsValidStatusEmit(
                                            $event,
                                            'pickup'
                                        )
                                    "
                                ></app-ta-modal-table>
                            </app-ta-custom-card>
                        </div>

                        @if (pickupStatusHistory?.length) {
                            <app-load-modal-wait-time
                                [statusHistory]="pickupStatusHistory"
                                (formChanged)="
                                    pickupStatusHistoryChange($event, 'pickup')
                                "
                            ></app-load-modal-wait-time>
                        }
                    </app-load-modal-stop>

                    <!-- Extra Stops -->
                    <div cdkDropList (cdkDropListDropped)="drop($event)">
                        <div formArrayName="extraStops">
                            @for (
                                extraStop of loadExtraStops.controls;
                                let indx = $index;
                                track indx
                            ) {
                                <div
                                    cdkDrag
                                    [cdkDragDisabled]="
                                        shouldDisableDrag(extraStop)
                                    "
                                    (cdkDragStarted)="onDragStart()"
                                    (cdkDragEnded)="onDragEnd()"
                                >
                                    <div
                                        class="dragdrop-custom-placeholder"
                                        *cdkDragPlaceholder
                                    ></div>
                                    <div [formGroupName]="indx">
                                        @if (loadExtraStops.controls.length) {
                                            <app-load-modal-stop
                                                [stopFinished]="
                                                    isStepFinished(extraStop)
                                                "
                                                [preventOpening]="
                                                    isDragAndDropActive
                                                "
                                                [firstOrLast]="false"
                                                [stopNumber]="
                                                    extraStopNumbers?.[indx] ??
                                                    1
                                                "
                                                [isDelivery]="
                                                    selectExtraStopType[indx]
                                                        ?.toString()
                                                        ?.startsWith('4')
                                                        ? true
                                                        : false
                                                "
                                                [isDragAndDropActive]="
                                                    isDragAndDropActive
                                                "
                                                [shipper]="
                                                    selectedExtraStopShipper[
                                                        indx
                                                    ]?.name
                                                "
                                                [shipperAddress]="
                                                    selectedExtraStopShipper[
                                                        indx
                                                    ]?.address
                                                "
                                                [waitTime]="
                                                    loadExtraStops
                                                        .at(indx)
                                                        .get('waitTime').value
                                                "
                                                [legHours]="
                                                    loadExtraStops
                                                        .at(indx)
                                                        .get('legHours').value
                                                "
                                                [legMinutes]="
                                                    loadExtraStops
                                                        .at(indx)
                                                        .get('legMinutes').value
                                                "
                                                [dateRange]="
                                                    loadExtraStops
                                                        .at(indx)
                                                        .get('dateFrom').value
                                                        | loadDatetimeRange
                                                            : loadExtraStops
                                                                  .at(indx)
                                                                  .get('dateTo')
                                                                  .value
                                                "
                                                [timeRange]="
                                                    loadExtraStops
                                                        .at(indx)
                                                        .get('timeFrom').value
                                                        | loadTimeType
                                                        | loadDatetimeRange
                                                            : (loadExtraStops
                                                                  .at(indx)
                                                                  .get('timeTo')
                                                                  .value
                                                                  | loadTimeType)
                                                "
                                                [legMile]="
                                                    loadExtraStops
                                                        .at(indx)
                                                        .get('legMiles').value
                                                "
                                                [isEmptyLoad]="false"
                                                [shipperContact]="{
                                                    fullName:
                                                        selectedExtraStopShipperContact[
                                                            indx
                                                        ]?.name,
                                                }"
                                                [isCardOpen]="
                                                    loadExtraStops
                                                        .at(indx)
                                                        .get('openClose').value
                                                "
                                                [state]="
                                                    validateExtraStops(
                                                        loadExtraStops,
                                                        indx
                                                    )
                                                "
                                                (delete)="
                                                    removeLoadExtraStop(indx)
                                                "
                                                (toggle)="
                                                    toggleStopActivity(
                                                        $event,
                                                        'extra-stops',
                                                        indx
                                                    )
                                                "
                                                [appointment]="
                                                    isExtraStopAppointment(indx)
                                                "
                                            >
                                                <!-- Tabs  -->
                                                <div class="row">
                                                    <div class="col-12">
                                                        <app-ta-tab-switch
                                                            [tabs]="
                                                                typeOfExtraStops[
                                                                    indx
                                                                ]
                                                            "
                                                            (switchClicked)="
                                                                onTabChange(
                                                                    $event,
                                                                    'stop-tab',
                                                                    indx
                                                                )
                                                            "
                                                            [type]="
                                                                'type2-modal-popup'
                                                            "
                                                        ></app-ta-tab-switch>
                                                    </div>
                                                </div>

                                                <!-- Shipper -->

                                                <div class="row">
                                                    <div class="col-12">
                                                        <app-ca-input-dropdown
                                                            formControlName="shipperId"
                                                            [template]="
                                                                'load-shipper'
                                                            "
                                                            [inputConfig]="
                                                                loadExtraStopsShipperInputConfig[
                                                                    indx
                                                                ]
                                                            "
                                                            [canAddNew]="true"
                                                            [canOpenModal]="
                                                                true
                                                            "
                                                            [options]="
                                                                labelsShippers
                                                            "
                                                            [activeItem]="
                                                                selectedExtraStopShipper[
                                                                    indx
                                                                ]
                                                            "
                                                            (selectedItem)="
                                                                onSelectDropdown(
                                                                    $event,
                                                                    'shipper-extra-stops',
                                                                    indx,
                                                                    true
                                                                )
                                                            "
                                                            (closeDropdown)="
                                                                loadExtraStops
                                                                    .at(indx)
                                                                    .get(
                                                                        'shipperId'
                                                                    )
                                                                    .markAsTouched()
                                                            "
                                                        ></app-ca-input-dropdown>
                                                    </div>
                                                </div>

                                                <!--  Work Hours, Appointment, Contact -->

                                                <div
                                                    class="load-shipper-contact-row"
                                                >
                                                    <app-ta-tab-switch
                                                        [tabs]="
                                                            stopTimeTabsExtraStops[
                                                                indx
                                                            ]
                                                        "
                                                        (switchClicked)="
                                                            onTabChange(
                                                                $event,
                                                                'extra-stops-time',
                                                                indx
                                                            )
                                                        "
                                                        [type]="
                                                            'type2-modal-popup'
                                                        "
                                                    ></app-ta-tab-switch>

                                                    <app-ca-input-dropdown
                                                        formControlName="shipperContactId"
                                                        [template]="
                                                            'load-broker-contact'
                                                        "
                                                        [inputConfig]="
                                                            loadExtraStopsShipperContactsInputConfig[
                                                                indx
                                                            ]
                                                        "
                                                        [canAddNew]="true"
                                                        [canOpenModal]="true"
                                                        [options]="
                                                            labelsShipperContacts
                                                        "
                                                        [activeItem]="
                                                            selectedExtraStopShipperContact[
                                                                indx
                                                            ]
                                                        "
                                                        (selectedItem)="
                                                            onSelectDropdown(
                                                                $event,
                                                                'shipper-contact-extra-stops',
                                                                indx
                                                            )
                                                        "
                                                    ></app-ca-input-dropdown>
                                                </div>

                                                <!--  Date Pickers & Time Pickers -->

                                                <div
                                                    class="stop-load-date-time"
                                                    [ngClass]="{
                                                        'date-range-active':
                                                            loadExtraStopsDateRange[
                                                                indx
                                                            ],
                                                    }"
                                                >
                                                    <ca-input-datetime-picker
                                                        formControlName="dateFrom"
                                                        [inputConfig]="
                                                            getExtraStopsDateFromInputConfig(
                                                                loadExtraStopsDateRange[
                                                                    indx
                                                                ]
                                                            )
                                                        "
                                                        (blurInput)="
                                                            loadExtraStops
                                                                .at(indx)
                                                                .get('dateFrom')
                                                                .markAsTouched()
                                                        "
                                                    ></ca-input-datetime-picker>

                                                    @if (
                                                        !loadExtraStopsDateRange[
                                                            indx
                                                        ]
                                                    ) {
                                                        <div
                                                            mainTooltip="Date Range"
                                                            [tooltipBackground]="
                                                                '#424242'
                                                            "
                                                            ngbTooltip
                                                            position="bottom"
                                                            class="d-flex align-items-center justify-content-center load-plus-button"
                                                            [ngClass]="{
                                                                disabled:
                                                                    selectedExtraStopTime[
                                                                        indx
                                                                    ] === 2 ||
                                                                    selectedExtraStopTime[
                                                                        indx
                                                                    ]
                                                                        ?.toString()
                                                                        ?.startsWith(
                                                                            '9'
                                                                        ),
                                                            }"
                                                            (click)="
                                                                addDateRange(
                                                                    'extra-stop',
                                                                    true,
                                                                    indx
                                                                )
                                                            "
                                                        >
                                                            <svg-icon
                                                                class="plus-icon"
                                                                [src]="
                                                                    loadModalSvgRoutes.plus
                                                                "
                                                                [svgStyle]="{
                                                                    'width.px':
                                                                        '14',
                                                                    'height.px':
                                                                        '14',
                                                                }"
                                                            ></svg-icon>
                                                        </div>
                                                    } @else {
                                                        <ca-input-datetime-picker
                                                            formControlName="dateTo"
                                                            [inputConfig]="
                                                                getExtraStopsToDate(
                                                                    indx
                                                                )
                                                            "
                                                            (blurInput)="
                                                                loadExtraStops
                                                                    .at(indx)
                                                                    .get(
                                                                        'dateTo'
                                                                    )
                                                                    .markAsTouched()
                                                            "
                                                        ></ca-input-datetime-picker>
                                                    }

                                                    <ca-input-datetime-picker
                                                        formControlName="timeFrom"
                                                        [inputConfig]="
                                                            getExtraStopsDateFromTimeFromInputConfig(
                                                                selectedExtraStopTime[
                                                                    indx
                                                                ]
                                                            )
                                                        "
                                                        (blurInput)="
                                                            loadExtraStops
                                                                .at(indx)
                                                                .get('timeFrom')
                                                                .markAsTouched()
                                                        "
                                                    ></ca-input-datetime-picker>

                                                    <ca-input-datetime-picker
                                                        formControlName="timeTo"
                                                        [inputConfig]="
                                                            getExtraStopsDateToTimeToInputConfig(
                                                                selectedExtraStopTime[
                                                                    indx
                                                                ]
                                                            )
                                                        "
                                                        (blurInput)="
                                                            loadExtraStops
                                                                .at(indx)
                                                                .get('timeTo')
                                                                .markAsTouched()
                                                        "
                                                    ></ca-input-datetime-picker>
                                                </div>

                                                <div
                                                    class="stop-load-date-time-driver"
                                                >
                                                    <app-ta-checkbox
                                                        formControlName="involveDriver"
                                                        [customClass]="'medium'"
                                                        [label]="
                                                            'Involve driver in loading the cargo'
                                                        "
                                                        name="involveDriver"
                                                    ></app-ta-checkbox>
                                                </div>

                                                <!-- Stop Items -->

                                                <div class="stop-items-wrapper">
                                                    <app-ta-custom-card
                                                        [cardName]="'Item'"
                                                        [isCardOpen]="
                                                            isExtraStopItemsVisible[
                                                                indx
                                                            ] ?? false
                                                        "
                                                        [disabledCard]="
                                                            !(
                                                                savedExtraStopItems[
                                                                    indx
                                                                ] &&
                                                                savedExtraStopItems[
                                                                    indx
                                                                ]?.length
                                                            )
                                                        "
                                                        [hasCounter]="
                                                            savedExtraStopItems[
                                                                indx
                                                            ] &&
                                                            savedExtraStopItems[
                                                                indx
                                                            ]?.length
                                                        "
                                                        [hasActionSvg]="true"
                                                        [hasBodyData]="true"
                                                        [hasArrow]="
                                                            savedExtraStopItems[
                                                                indx
                                                            ]?.length
                                                        "
                                                        [animationMarginParams]="{
                                                            marginTop: '10px',
                                                            marginBottom:
                                                                '12px',
                                                        }"
                                                        [hasScrollBodyXAxis]="
                                                            isExtraStopItemsVisible[
                                                                indx
                                                            ] ?? false
                                                        "
                                                        (onActionEvent)="
                                                            createNewStopItemsRow(
                                                                'extra-stop',
                                                                indx
                                                            )
                                                        "
                                                        (onOpenCard)="
                                                            toggleStopItemRow(
                                                                'extra-stop',
                                                                indx
                                                            )
                                                        "
                                                    >
                                                        <app-ta-modal-table
                                                            [tableType]="
                                                                modalTableTypeEnum.LOAD_ITEMS
                                                            "
                                                            [isNewRowCreated]="
                                                                isCreatedNewStopItemsRow
                                                                    .extraStops[
                                                                    indx
                                                                ]
                                                            "
                                                            [modalTableData]="
                                                                extraStopItems[
                                                                    indx
                                                                ]
                                                            "
                                                            [stopItemDropdownLists]="
                                                                stopItemDropdownLists
                                                            "
                                                            [selectedTrailer]="
                                                                selectedTrailerReq
                                                            "
                                                            [isHazardous]="
                                                                isHazardousPicked
                                                            "
                                                            (modalTableValueEmitter)="
                                                                handleStopItemsDataValueEmit(
                                                                    $event,
                                                                    'extra-stop',
                                                                    indx
                                                                )
                                                            "
                                                            (modalTableValidStatusEmitter)="
                                                                handleStopItemsValidStatusEmit(
                                                                    $event,
                                                                    'extra-stop',
                                                                    indx
                                                                )
                                                            "
                                                        ></app-ta-modal-table>
                                                    </app-ta-custom-card>
                                                </div>

                                                @if (
                                                    extraStopStatusHistory[
                                                        indx
                                                    ] &&
                                                    extraStopStatusHistory[indx]
                                                        .length
                                                ) {
                                                    <ng-container>
                                                        <app-load-modal-wait-time
                                                            [statusHistory]="
                                                                extraStopStatusHistory[
                                                                    indx
                                                                ]
                                                            "
                                                            (formChanged)="
                                                                pickupStatusHistoryChange(
                                                                    $event,
                                                                    'extra-stop',
                                                                    indx
                                                                )
                                                            "
                                                        ></app-load-modal-wait-time>
                                                    </ng-container>
                                                }
                                            </app-load-modal-stop>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    </div>
                    <!-- Delivery Stop -->

                    <app-load-modal-stop
                        [firstOrLast]="true"
                        [stopNumber]="
                            loadForm.get('deliveryStopOrder').value || 1
                        "
                        [shipper]="selectedDeliveryShipper?.name"
                        [shipperAddress]="selectedDeliveryShipper?.address"
                        [dateRange]="
                            loadForm.get('deliveryDateFrom').value
                                | loadDatetimeRange
                                    : loadForm.get('deliveryDateTo').value
                        "
                        [timeRange]="
                            loadForm.get('deliveryTimeFrom').value
                                | loadTimeType
                                | loadDatetimeRange
                                    : (loadForm.get('deliveryTimeTo').value
                                          | loadTimeType)
                        "
                        [stopFinished]="isDeliveryStopFinished()"
                        [legMile]="
                            selectedDeliveryShipper &&
                            loadForm.get('deliverylegMiles').value
                        "
                        [isEmptyLoad]="false"
                        [shipperContact]="{
                            fullName: selectedDeliveryShipperContact?.name,
                        }"
                        [isDestinationTab]="true"
                        [disabledCard]="!selectedPickupShipper"
                        [isCardOpen]="isActiveDeliveryStop"
                        [isDelivery]="true"
                        [state]="validateDeliveryStops(loadForm)"
                        [appointment]="isDeliveryAppointment()"
                        [legHours]="loadForm.get('deliverylegHours').value"
                        [legMinutes]="loadForm.get('deliverylegMinutes').value"
                        (toggle)="toggleStopActivity($event, 'first-delivery')"
                    >
                        <!-- Shipper -->

                        <div class="row">
                            <div class="col-12">
                                <app-ca-input-dropdown
                                    formControlName="deliveryShipper"
                                    [template]="'load-shipper'"
                                    [inputConfig]="
                                        loadDeliveryShipperInputConfig
                                    "
                                    [canAddNew]="true"
                                    [canOpenModal]="true"
                                    [options]="labelsShippers"
                                    (selectedItem)="
                                        onSelectDropdown(
                                            $event,
                                            'shipper-delivery',
                                            -1,
                                            true
                                        )
                                    "
                                    (closeDropdown)="
                                        loadForm
                                            .get('deliveryShipper')
                                            .markAsTouched()
                                    "
                                ></app-ca-input-dropdown>
                            </div>
                        </div>

                        <!-- Work Hours, Appointment, Contact -->

                        <div class="load-shipper-contact-row">
                            <app-ta-tab-switch
                                [tabs]="stopTimeTabsDelivery"
                                (switchClicked)="
                                    onTabChange($event, 'stop-time-delivery')
                                "
                                [type]="'type2-modal-popup'"
                            ></app-ta-tab-switch>

                            <app-ca-input-dropdown
                                formControlName="deliveryShipperContactId"
                                [template]="'load-broker-contact'"
                                [inputConfig]="
                                    loadDeliveryShipperContactsInputConfig
                                "
                                [canAddNew]="true"
                                [canOpenModal]="true"
                                [options]="labelsShipperContacts"
                                [activeItem]="selectedDeliveryShipperContact"
                                (selectedItem)="
                                    onSelectDropdown(
                                        $event,
                                        'shipper-contact-delivery'
                                    )
                                "
                            ></app-ca-input-dropdown>
                        </div>

                        <!--  Date Pickers & Time Pickers -->

                        <div
                            class="stop-load-date-time"
                            [ngClass]="{
                                'date-range-active': deliveryDateRange,
                            }"
                        >
                            <ca-input-datetime-picker
                                formControlName="deliveryDateFrom"
                                [inputConfig]="getDeliveryDateFromInputConfig"
                                (blurInput)="
                                    loadForm
                                        .get('deliveryDateFrom')
                                        .markAsTouched()
                                "
                            ></ca-input-datetime-picker>

                            @if (!deliveryDateRange) {
                                <div
                                    mainTooltip="Date Range"
                                    [tooltipBackground]="'#424242'"
                                    ngbTooltip
                                    position="bottom"
                                    class="d-flex align-items-center justify-content-center load-plus-button"
                                    [ngClass]="{
                                        disabled:
                                            selectedStopTimeDelivery === 2 ||
                                            selectedStopTimeDelivery === 8,
                                    }"
                                    (click)="addDateRange('delivery', true)"
                                >
                                    <svg-icon
                                        class="plus-icon"
                                        src="assets/svg/common/ic_plus.svg"
                                        [svgStyle]="{
                                            'width.px': '14',
                                            'height.px': '14',
                                        }"
                                    ></svg-icon>
                                </div>
                            }

                            @if (deliveryDateRange) {
                                <ca-input-datetime-picker
                                    formControlName="deliveryDateTo"
                                    [inputConfig]="
                                        loadDeliveryDateToInputConfig
                                    "
                                    (blurInput)="
                                        markInputAsTouched('deliveryDateTo')
                                    "
                                    (clear)="
                                        markInputAsTouched(
                                            'deliveryDateTo',
                                            true
                                        )
                                    "
                                ></ca-input-datetime-picker>
                            }

                            <ca-input-datetime-picker
                                formControlName="deliveryTimeFrom"
                                [inputConfig]="getDeliveryTimeFromInputConfig"
                                (blurInput)="
                                    markInputAsTouched('deliveryTimeFrom')
                                "
                                (clear)="
                                    markInputAsTouched('deliveryTimeFrom', true)
                                "
                            ></ca-input-datetime-picker>

                            <ca-input-datetime-picker
                                formControlName="deliveryTimeTo"
                                [inputConfig]="getDeliveryTimeToInputConfig"
                                (blurInput)="
                                    markInputAsTouched('deliveryTimeTo')
                                "
                                (clear)="
                                    markInputAsTouched('deliveryTimeTo', true)
                                "
                            ></ca-input-datetime-picker>
                        </div>

                        <!-- Stop Items -->
                        <div class="stop-items-wrapper">
                            <app-ta-custom-card
                                [cardName]="'Item'"
                                [isCardOpen]="isDeliveryItemsVisible"
                                [disabledCard]="!savedDeliveryStopItems.length"
                                [hasCounter]="savedDeliveryStopItems.length"
                                [hasActionSvg]="true"
                                [hasBodyData]="true"
                                [hasArrow]="savedDeliveryStopItems.length"
                                [animationMarginParams]="{
                                    marginTop: '10px',
                                    marginBottom: '12px',
                                }"
                                [hasScrollBodyXAxis]="isDeliveryItemsVisible"
                                (onActionEvent)="
                                    createNewStopItemsRow('delivery')
                                "
                                (onOpenCard)="toggleStopItemRow('delivery')"
                            >
                                <app-ta-modal-table
                                    [tableType]="modalTableTypeEnum.LOAD_ITEMS"
                                    [isNewRowCreated]="
                                        isCreatedNewStopItemsRow.delivery
                                    "
                                    [modalTableData]="deliveryStopItems"
                                    [stopItemDropdownLists]="
                                        stopItemDropdownLists
                                    "
                                    [selectedTrailer]="selectedTrailerReq"
                                    [isHazardous]="isHazardousPicked"
                                    (modalTableValueEmitter)="
                                        handleStopItemsDataValueEmit(
                                            $event,
                                            'delivery'
                                        )
                                    "
                                    (modalTableValidStatusEmitter)="
                                        handleStopItemsValidStatusEmit(
                                            $event,
                                            'delivery'
                                        )
                                    "
                                ></app-ta-modal-table>
                            </app-ta-custom-card>
                        </div>

                        @if (deliveryStatusHistory?.length) {
                            <app-load-modal-wait-time
                                [statusHistory]="deliveryStatusHistory"
                                (formChanged)="
                                    pickupStatusHistoryChange(
                                        $event,
                                        'delivery'
                                    )
                                "
                            ></app-load-modal-wait-time>
                        }
                    </app-load-modal-stop>

                    <!-- Stops Footer -->

                    <div
                        class="d-flex align-items-center justify-content-between stops-footer-bar"
                    >
                        <div
                            class="d-flex align-items-center stops-footer-bar-left-side"
                        >
                            <svg-icon
                                [src]="loadModalSvgRoutes.loadIcon"
                                class="load-modal-icon"
                            ></svg-icon>

                            <span class="m-0 ta-font-bold loaded-miles-value"
                                >{{
                                    loadForm.get('loadMiles').value
                                        | number: '1.2-2'
                                }}
                                <span>mi</span>
                            </span>
                        </div>

                        <div
                            class="d-flex align-items-center stops-footer-bar-right-side"
                        >
                            <div>
                                <svg-icon
                                    [src]="loadModalSvgRoutes.milesIcon"
                                    class="load-modal-icon"
                                ></svg-icon>

                                <span class="m-0 ta-font-bold total-miles-value"
                                    >{{
                                        loadForm.get('totalMiles').value
                                            | number: '1.2-2'
                                    }}
                                    <span>mi</span>
                                </span>
                            </div>

                            <div class="load-modal-time">
                                <svg-icon
                                    [src]="loadModalSvgRoutes.timeIcon"
                                    class="load-modal-icon"
                                ></svg-icon>
                                <span class="m-0 ta-font-bold total-miles-value"
                                    >
                                    @if (totalLegHours) {
                                        {{ totalLegHours }}h
                                    }
                                    {{ totalLegMinutes || 0 }}m</span
                                >
                            </div>
                        </div>
                    </div>
                </app-ta-custom-card>
            </div>

            <!-- Financial -->

            <div class="load-modal-row">
                <app-load-modal-financial
                    [firstHeaderTitle]="'Billing'"
                    [billing]="
                        loadModalBill
                            | financialCalculation: 'billing'
                            | currency
                    "
                    [billingCount]="billingCount"
                    [disableBillAction]="
                        !loadForm.get('baseRate').value ||
                        !additionalBillingTypes?.length
                    "
                    [adjusted]="
                        showAdjustedRate && loadForm.get('adjustedRate').value
                            ? loadForm.get('adjustedRate').value
                            : showDriverRate && loadForm.get('driverRate').value
                              ? loadForm.get('driverRate').value
                              : null
                    "
                    [secondHeaderTitle]="'Payment'"
                    [paymentCount]="additionalPayments().length"
                    [payment]="
                        loadModalPayment
                            | financialCalculation: 'payment'
                            | currency
                    "
                    [baseRate]="loadForm.get('baseRate').value"
                    [revised]="loadForm.get('revisedRate').value"
                    [tonu]="loadForm.get('tonuRate').value"
                    [disablePaymentAction]="!loadForm.get('baseRate').value"
                    [thirdHeaderTitle]="'Invoice Ageing'"
                    [isCardOpen]="true"
                    [animationMarginParams]="{
                        marginTop: '18px',
                        marginBottom: '22px',
                    }"
                    (action)="onFinancialAction($event)"
                >
                    <div class="load-financial-container">
                        <div class="load-financial-billing">
                            <!-- Base Rate -->

                            <ca-input-test
                                formControlName="baseRate"
                                [inputConfig]="loadBaseRateInputConfig"
                                [ngClass]="{
                                    'load-financial-container-override':
                                        loadForm.get('tonuRate').value ||
                                        loadForm.get('revisedRate').value,
                                }"
                            ></ca-input-test>

                            <!-- Driver Rate -->
                            @if (showDriverRate) {
                                <ca-input-test
                                    formControlName="driverRate"
                                    [inputConfig]="getDriverRateInputConfig"
                                ></ca-input-test>
                            }

                            <!-- Adjusted Rate -->
                            @if (showAdjustedRate) {
                                <ca-input-test
                                    formControlName="adjustedRate"
                                    [inputConfig]="getAdjustedRateInputConfig"
                                    (clear)="
                                        removeAdditionalBilling('adjusted', 0)
                                    "
                                    [ngClass]="{
                                        'load-financial-container-override':
                                            loadForm.get('tonuRate').value ||
                                            loadForm.get('revisedRate').value,
                                    }"
                                ></ca-input-test>
                            }

                            <!-- Tonu Rate -->
                            @if (showTonuRate) {
                                <ca-input-test
                                    formControlName="tonuRate"
                                    [inputConfig]="getTonuRateInputConfig"
                                ></ca-input-test>
                            }

                            <!-- Adjusted Rate -->
                            @if (showRevisedRate) {
                                <ca-input-test
                                    formControlName="revisedRate"
                                    [inputConfig]="getRevisedRateInputConfig"
                                ></ca-input-test>
                            }

                            <div formArrayName="additionalBillings">
                                @for (
                                    additional of additionalBillings().controls;
                                    let indx = $index;
                                    track indx
                                ) {
                                    <div [ngStyle]="{ 'margin-bottom': '4px' }">
                                        <div [formGroupName]="indx">
                                            <ca-input-test
                                                [ngClass]="{
                                                    'load-financial-container-override':
                                                        loadForm.get('tonuRate')
                                                            .value,
                                                }"
                                                formControlName="billingValue"
                                                [inputConfig]="
                                                    getBillingValueInputConfig(
                                                        additional
                                                    )
                                                "
                                                (clear)="
                                                    removeAdditionalBilling(
                                                        'billing',
                                                        indx
                                                    )
                                                "
                                            ></ca-input-test>
                                        </div>
                                    </div>
                                }
                            </div>
                            @if (isVisibleBillDropdown) {
                                <app-ca-input-dropdown
                                    formControlName="billingDropdown"
                                    [inputConfig]="
                                        loadBillingDropdownInputConfig
                                    "
                                    [options]="additionalBillingTypes"
                                    [activeItem]="null"
                                    (selectedItem)="
                                        addAdditionalBilling($event, true)
                                    "
                                ></app-ca-input-dropdown>
                            }
                        </div>

                        <div>
                            @if (isVisiblePayment) {
                                <div formArrayName="additionalPayments">
                                    @for (
                                        additional of additionalPayments()
                                            .controls;
                                        let indx = $index;
                                        track indx
                                    ) {
                                        <div
                                            [ngStyle]="{
                                                'margin-bottom': '4px',
                                            }"
                                        >
                                            <div [formGroupName]="indx">
                                                <div
                                                    class="load-financial-payment"
                                                >
                                                    <ca-input-test
                                                        formControlName="pay"
                                                        [inputConfig]="
                                                            getPaymentInputConfig(
                                                                additional
                                                            )
                                                        "
                                                        (clear)="
                                                            removePaymentBilling(
                                                                indx
                                                            )
                                                        "
                                                    ></ca-input-test>

                                                    <app-ca-input-dropdown
                                                        formControlName="displayPaymentType"
                                                        [inputConfig]="
                                                            loadPaymentTypeInputConfig
                                                        "
                                                        [canOpenModal]="true"
                                                        [options]="
                                                            paymentMethodsDropdownList
                                                        "
                                                        (selectedItem)="
                                                            onSelectDropdown(
                                                                $event,
                                                                'pay-type',
                                                                indx
                                                            )
                                                        "
                                                    ></app-ca-input-dropdown>

                                                    <loadPaydateInputConfig
                                                        formControlName="payDate"
                                                        [inputConfig]="
                                                            loadPaydateInputConfig
                                                        "
                                                    ></loadPaydateInputConfig>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            }

                            @if (
                                showPaymentArray &&
                                paymentTypesDropdownList.length
                            ) {
                                <app-ca-input-dropdown
                                    formControlName="paymentDropdown"
                                    [inputConfig]="
                                        loadPaymentDropdownInputConfig
                                    "
                                    [options]="paymentTypesDropdownList"
                                    [activeItem]="null"
                                    (selectedItem)="addPaymentBilling($event)"
                                ></app-ca-input-dropdown>
                            }
                        </div>

                        <div class="load-financial-invoice">
                            <ca-input-datetime-picker
                                formControlName="invoicedDate"
                                [inputConfig]="loadInvoiceDateInputConfig()"
                            ></ca-input-datetime-picker>

                            @if (invoicePercent.daysToPay) {
                                <app-ta-progres-bar
                                    [type]="'days'"
                                    [text]="invoicePercent.daysLeft"
                                    [daysToPay]="invoicePercent.daysToPay"
                                    [percents]="invoicePercent.percent"
                                    [daysExpired]="true"
                                >
                                </app-ta-progres-bar>
                            }
                        </div>
                    </div>
                </app-load-modal-financial>
            </div>

            <!-- Comments -->
            @if (editData?.type?.includes('edit')) {
                <div class="load-modal-row">
                    <app-ta-custom-card
                        [cardName]="'Comment'"
                        [isCardOpen]="comments?.length || isCommentsVisible"
                        [hasCounter]="comments?.length"
                        [hasActionSvg]="editData"
                        [hasScrollBody]="comments?.length"
                        [hasBodyData]="true"
                        [animationMarginParams]="{
                            marginTop: '10px',
                            marginBottom: '12px',
                        }"
                        [disabledCard]="!editData"
                        (onActionEvent)="createComment()"
                    >
                        <app-load-details-item-comments
                            [load]="editData?.data"
                            [isAddNewComment]="isCommenting"
                            [isSearchComment]="false"
                            [isHeaderHidden]="true"
                            (commentsCountChanged)="commentsCountChanged()"
                        >
                        </app-load-details-item-comments>
                    </app-ta-custom-card>
                </div>
            }
            <!-- Documents -->

            <div class="load-modal-row">
                <app-ta-custom-card
                    [cardName]="'Document'"
                    [isCardOpen]="!!documents.length"
                    [hasBodyData]="true"
                    [hasDivider]="true"
                    [hasCounter]="documents?.length"
                    [animationMarginParams]="{
                        marginTop: '0',
                        marginBottom: '0',
                    }"
                >
                    <app-ta-upload-files
                        [files]="documents"
                        [size]="'medium'"
                        [showDropzone]="true"
                        (onFileEvent)="onFilesEvent($event)"
                        [customClassName]="'modals'"
                        [hasTagsDropdown]="true"
                        [tags]="tags"
                    ></app-ta-upload-files>
                </app-ta-custom-card>
            </div>

            <!-- Note -->

            <div class="load-modal-row">
                <app-ta-input-note
                    formControlName="note"
                    [isVisibleNote]="
                        loadForm.get('note').value &&
                        loadForm.get('note').value !== 'null'
                    "
                    [note]="
                        loadForm.get('note').value &&
                        loadForm.get('note').value !== 'null'
                            ? loadForm.get('note').value
                            : ''
                    "
                    (styledValueEmitter)="
                        getDriverMessageOrNote($event, 'note')
                    "
                ></app-ta-input-note>
            </div>
        </div>
    </form>

    <!-- Additional Tab Part -->

    <div
        additional
        class="load-map-container"
        [ngClass]="{
            'load-hazardous-container': isHazardousVisible,
        }"
        [ngStyle]="{
            overflow: 'hidden',
            'owerflow-y': 'scroll',
        }"
    >
        <!-- Hazardous -->
        @if (isHazardousVisible) {
            <app-load-modal-hazardous></app-load-modal-hazardous>
        } @else {
            <!-- Map -->
            <app-ca-map [data]="mapData"></app-ca-map>
        }
    </div>
</app-ta-modal>
