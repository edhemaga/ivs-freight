<app-ta-modal
    [modalTitle]="modalTitle"
    [editData]="editData"
    [editName]="isConvertedToTemplate ? null : loadNumber"
    [specificCaseModalName]="true"
    [isModalValid]="
        loadForm.valid &&
        isFormDirty &&
        isEachStopItemsRowValid &&
        !reorderingStarted
    "
    [customClass]="loadModalSize"
    [partClass]="'load-modal-origin-part'"
    [isVisibleHazardous]="isHazardousPicked"
    [isVisibleMap]="true"
    [loadModalTemplate]="true"
    [modalAdditionalPart]="true"
    [isConvertedToTemplate]="isConvertedToTemplate"
    [saveAndAddNew]="true"
    (additionalPartVisibility)="additionalPartVisibility($event)"
    (action)="onModalAction($event)"
    [enableClickWhileFormInvalid]="true"
    (runFormValidation)="runFormValidation()"
>
    <!-- Origin Tab -->

    <form
        origin
        #originElement
        [formGroup]="loadForm"
        class="form-container form-container-without-mb"
    >
        <div class="m-tab">
            <!-- FTL - LTL, Dispatcher, Company -->

            <div
                class="align-items-center load-ftl-first-row"
                [ngClass]="{
                    'template-row': isConvertedToTemplate,
                    'edit-load': editLoad
                }"
            >
                <!-- FTL-LTL Switcher -->

                <div class="tabs-container">
                    <ng-container
                        *ngIf="!editData?.type?.includes('edit'); else editLoad"
                    >
                        <app-ta-tab-switch
                            [tabs]="tabs"
                            (switchClicked)="onTabChange($event, 'ftl-ltl')"
                            [type]="'type2-modal-popup'"
                        >
                        </app-ta-tab-switch>
                    </ng-container>

                    <ng-template #editLoad>
                        <app-ta-input-dropdown
                            [template]="'svgtext-template'"
                            formControlName="status"
                            [inputConfig]="getStatusInputConfig"
                            [options]="statusDropDownList"
                            [activeItem]="selectedStatus"
                            (selectedItem)="onSelectDropdown($event, 'status')"
                        ></app-ta-input-dropdown>
                    </ng-template>
                </div>

                <!-- Load Template Picker -->

                <ng-container *ngIf="!isConvertedToTemplate && !editLoad">
                    <ng-container *ngIf="!isTemplateSelected">
                        <button
                            class="d-flex align-items-center justify-content-center load-template-switcher-container"
                            [ngClass]="{
                                active: popover.isOpen(),
                                valid: !popover.isOpen() && isTemplateSelected
                            }"
                            #popover="ngbPopover"
                            autoClose="outside"
                            [ngbPopover]="dropdownPopover"
                            popoverClass="popover-main"
                            placement="bottom-start"
                            container="body"
                            ngbTooltip
                            [mainTooltip]="
                                !popover.isOpen() ? 'Select Template' : null
                            "
                            position="bottom"
                            tooltipBackground="#424242"
                        >
                            <svg-icon
                                class="load-template-switcher-icon"
                                src="assets/svg/common/load/ic_load_template_btn.svg"
                                [svgStyle]="{
                                    'width.px': '16',
                                    'height.px': '16'
                                }"
                            ></svg-icon>
                        </button>

                        <ng-template #dropdownPopover>
                            <div
                                class="popover-container load-template-switcher-popover-container"
                            >
                                <ng-container
                                    *ngFor="
                                        let template of labelsTemplate;
                                        index as i;
                                        trackBy: trackByIdentity
                                    "
                                >
                                    <div
                                        class="popover-item"
                                        (click)="
                                            handleTemplateSelectClick(
                                                template.id
                                            )
                                        "
                                    >
                                        <p class="m-0">{{ template.name }}</p>
                                    </div>
                                </ng-container>
                            </div>
                        </ng-template>
                    </ng-container>

                    <ng-container *ngIf="isTemplateSelected">
                        <button
                            class="d-flex align-items-center justify-content-center remove-template-btn"
                            ngbTooltip
                            mainTooltip="Remove Template"
                            position="bottom"
                            tooltipBackground="#424242"
                            (click)="handleRemoveTemplateClick()"
                        >
                            <svg-icon
                                class="switcher-icon"
                                src="assets/svg/common/load/ic_load_template_btn.svg"
                                [svgStyle]="{
                                    'width.px': '16',
                                    'height.px': '16'
                                }"
                            ></svg-icon>
                        </button>
                    </ng-container>
                </ng-container>

                <!-- Dispatcher -->

                <div class="dispatcher-container">
                    <app-ta-input-dropdown
                        formControlName="dispatcherId"
                        [template]="'load-dispatcher'"
                        [inputConfig]="getDispatcherInputConfig()"
                        [options]="labelsDispatcher"
                        [activeItem]="selectedDispatcher"
                        (selectedItem)="onSelectDropdown($event, 'dispatcher')"
                    ></app-ta-input-dropdown>
                </div>

                <!-- Truck -->

                <div class="company-template-name-container">
                    <!-- Template Name -->

                    <ng-container *ngIf="isConvertedToTemplate">
                        <app-ta-input
                            formControlName="templateName"
                            [inputConfig]="loadTemplateInputConfig"
                        ></app-ta-input>
                    </ng-container>

                    <ng-container *ngIf="!isConvertedToTemplate">
                        <!-- Only One Company -->

                        <app-ta-input
                            *ngIf="labelsCompanies.length <= 1"
                            formControlName="companyId"
                            [inputConfig]="loadMainCompanyInputConfig"
                        ></app-ta-input>

                        <!-- Multiple Companies -->

                        <app-ta-input-dropdown
                            *ngIf="labelsCompanies.length > 1"
                            formControlName="companyId"
                            [inputConfig]="loadCompanyInputConfig"
                            [options]="labelsCompanies"
                            [activeItem]="selectedCompany"
                            (selectedItem)="onSelectDropdown($event, 'company')"
                        ></app-ta-input-dropdown>
                    </ng-container>
                </div>
            </div>

            <div class="load-ftl-fourth-row">
                <app-ta-input-dropdown
                    formControlName="dispatchId"
                    [template]="'load-dispatches-ttd'"
                    [inputConfig]="loadDispatchesTTDInputConfig"
                    [options]="labelsDispatches"
                    [activeItem]="selectedDispatches"
                    (selectedItem)="onSelectDropdown($event, 'dispatches')"
                ></app-ta-input-dropdown>
            </div>

            <!-- Broker -->
            <div class="load-ftl-second-row">
                <app-ta-input
                    formControlName="referenceNumber"
                    [inputConfig]="loadReferenceInputConfig"
                ></app-ta-input>
                <app-ta-input-dropdown
                    formControlName="brokerId"
                    [template]="'load-broker'"
                    [inputConfig]="loadBrokerInputConfig"
                    [canAddNew]="true"
                    [canOpenModal]="true"
                    [options]="labelsBroker"
                    [activeItem]="selectedBroker"
                    (selectedItem)="onSelectDropdown($event, 'broker')"
                ></app-ta-input-dropdown>
            </div>

            <!-- Reference No, General Commodity, Weight -->

            <div class="load-ftl-third-row">
                <app-ta-input-dropdown
                    formControlName="brokerContactId"
                    [template]="'load-broker-contact'"
                    [inputConfig]="loadBrokerContactsInputConfig"
                    [canAddNew]="true"
                    [canOpenModal]="true"
                    [options]="labelsBrokerContacts"
                    [activeItem]="selectedBrokerContact"
                    (selectedItem)="onSelectDropdown($event, 'broker-contact')"
                ></app-ta-input-dropdown>
                <app-ta-input-dropdown
                    formControlName="generalCommodity"
                    [template]="'svgtext-template'"
                    [inputConfig]="loadCommodityInputConfig"
                    [options]="labelsGeneralCommodity"
                    [activeItem]="selectedGeneralCommodity"
                    (selectedItem)="
                        onSelectDropdown($event, 'general-commodity')
                    "
                ></app-ta-input-dropdown>

                <app-ta-input
                    formControlName="weight"
                    [inputConfig]="loadWeightInputConfig"
                ></app-ta-input>
            </div>
            <!-- Requirement -->

            <div
                class="d-flex flex-column justify-content-center requirement-container"
            >
                <app-ta-custom-card
                    [cardName]="'Requirement'"
                    [isCardOpen]="isRequirementVisible"
                    [hasBodyData]="true"
                    [hasDivider]="false"
                    [animationMarginParams]="{
                        marginTop: '10px',
                        marginBottom: '12px'
                    }"
                >
                    <div class="pt-2">
                        <div class="load-requirements-load-first-row">
                            <app-ta-input-dropdown
                                formControlName="truckTypeId"
                                [template]="'svgtext-template'"
                                [inputConfig]="getTruckTypeIdInputConfig"
                                [options]="labelsTruckReq"
                                [activeItem]="selectedTruckReq"
                                (selectedItem)="
                                    onSelectDropdown($event, 'truck-req')
                                "
                            ></app-ta-input-dropdown>

                            <app-ta-input-dropdown
                                formControlName="trailerTypeId"
                                [template]="'svgtext-template'"
                                [inputConfig]="getTrailerInputConfig"
                                [options]="labelsTrailerReq"
                                [activeItem]="selectedTrailerReq"
                                (selectedItem)="
                                    onSelectDropdown($event, 'trailer-req')
                                "
                            ></app-ta-input-dropdown>
                        </div>

                        <div class="load-requirements-load-second-row">
                            <app-ta-input-dropdown
                                formControlName="trailerLengthId"
                                [inputConfig]="loadTrailerLengthInputConfig"
                                [options]="labelsTrailerLength"
                                [activeItem]="selectedTrailerLength"
                                (selectedItem)="
                                    onSelectDropdown($event, 'length')
                                "
                            ></app-ta-input-dropdown>

                            <app-ta-input-dropdown
                                formControlName="doorType"
                                [inputConfig]="loadDoorTypeInputConfig"
                                [options]="labelsDoorType"
                                [activeItem]="selectedDoorType"
                                (selectedItem)="
                                    onSelectDropdown($event, 'door-type')
                                "
                            ></app-ta-input-dropdown>

                            <app-ta-input-dropdown
                                formControlName="suspension"
                                [inputConfig]="loadSuspensionInputConfig"
                                [options]="labelsSuspension"
                                [activeItem]="selectedSuspension"
                                (selectedItem)="
                                    onSelectDropdown($event, 'suspension')
                                "
                            ></app-ta-input-dropdown>

                            <app-ta-input-dropdown
                                formControlName="year"
                                [inputConfig]="loadYearInputConfig"
                                [options]="labelsYear"
                                [activeItem]="selectedYear"
                                (selectedItem)="
                                    onSelectDropdown($event, 'year')
                                "
                            ></app-ta-input-dropdown>

                            <div
                                class="d-flex align-items-center justify-content-end"
                            >
                                <app-ta-checkbox
                                    formControlName="liftgate"
                                    name="liftgate"
                                    [customClass]="'medium'"
                                    [label]="'Lifgate'"
                                ></app-ta-checkbox>
                            </div>
                        </div>
                    </div>
                </app-ta-custom-card>
            </div>

            <!-- Driver Message -->

            <div class="load-modal-row">
                <app-ta-input-note
                    formControlName="driverMessage"
                    [isVisibleNote]="
                        loadForm.get('driverMessage').value &&
                        loadForm.get('driverMessage').value !== 'null'
                    "
                    [note]="
                        loadForm.get('driverMessage').value &&
                        loadForm.get('driverMessage').value !== 'null'
                            ? loadForm.get('driverMessage').value
                            : ''
                    "
                    [noteLabel]="'Driver Message'"
                    [placeholder]="'Type something...'"
                    (styledValueEmitter)="
                        getDriverMessageOrNote($event, 'driverMessage')
                    "
                ></app-ta-input-note>
            </div>

            <!-- Stops -->

            <div class="d-flex align-items-center load-modal-row">
                <app-ta-custom-card
                    [cardName]="'Stops'"
                    [capsulaText]="
                        loadExtraStops().length
                            ? loadExtraStops().length + ' EXTRA'
                            : null
                    "
                    [isCardOpen]="true"
                    [hasCounter]="loadExtraStops().length + 2"
                    [hasActionSvg]="true"
                    [hasBodyData]="true"
                    [hasArrow]="false"
                    [animationMarginParams]="{
                        marginTop: '10px',
                        marginBottom: '12px'
                    }"
                    (onActionEvent)="onExtraStopAction($event)"
                    [showFinishReordering]="reorderingStarted"
                    [reorderingSaveError]="reorderingSaveError"
                >
                    <!-- Stops Header -->

                    <div class="align-items-center stops-header-bar">
                        <p class="m-0 ta-font-bold">
                            <svg-icon
                                [src]="loadModalSvgRoutes.sorting"
                            ></svg-icon>
                        </p>
                        <p class="m-0 ta-font-bold">SHIPPER, LOCATION</p>
                        <p class="m-0 ta-font-bold">DATE & TIME</p>
                        <p class="m-0 ta-font-bold text-right">LEG, CONTACT</p>
                    </div>

                    <!-- Pickup Stop  -->

                    <app-load-modal-stop
                        [firstOrLast]="true"
                        [stopNumber]="loadForm.get('pickupStopOrder').value"
                        [isDelivery]="false"
                        [shipper]="selectedPickupShipper?.name"
                        [shipperAddress]="selectedPickupShipper?.address"
                        [dateRange]="
                            loadForm.get('pickupDateFrom').value
                                | loadDatetimeRange
                                    : loadForm.get('pickupDateTo').value
                        "
                        [timeRange]="
                            loadForm.get('pickupTimeFrom').value
                                | loadTimeType
                                | loadDatetimeRange
                                    : (loadForm.get('pickupTimeTo').value
                                          | loadTimeType)
                        "
                        [legMile]="loadForm.get('pickuplegMiles').value"
                        [isEmptyLoad]="true"
                        [shipperContact]="{
                            fullName: selectedPickupShipperContact?.name
                        }"
                        [state]="
                            loadForm.get('pickupShipper').valid &&
                            loadForm.get('pickupDateFrom').valid &&
                            loadForm.get('pickupTimeFrom').valid &&
                            (selectedStopTimePickup === 6
                                ? !loadForm.get('pickupTimeTo').errors
                                : loadForm.get('pickupTimeTo').valid)
                                ? 'valid'
                                : (loadForm.get('pickupShipper').errors &&
                                      loadForm.get('pickupShipper').touched) ||
                                  (loadForm.get('pickupDateFrom').errors &&
                                      loadForm.get('pickupDateFrom').touched) ||
                                  (loadForm.get('pickupDateTo').errors &&
                                      loadForm.get('pickupDateTo').touched) ||
                                  (loadForm.get('pickupTimeFrom').errors &&
                                      loadForm.get('pickupTimeFrom').touched) ||
                                  (loadForm.get('pickupTimeTo').errors &&
                                      loadForm.get('pickupTimeTo').touched)
                                ? 'invalid'
                                : null
                        "
                        [isCardOpen]="isActivePickupStop"
                        (toggle)="toggleStopActivity($event, 'first-pickup')"
                    >
                        <!--  Shipper-->

                        <div class="row row-no-mt">
                            <div class="col-12">
                                <app-ta-input-dropdown
                                    formControlName="pickupShipper"
                                    [template]="'load-shipper'"
                                    [inputConfig]="loadPickupShipperInputConfig"
                                    [canAddNew]="true"
                                    [canOpenModal]="true"
                                    [options]="labelsShippers"
                                    [activeItem]="selectedPickupShipper"
                                    (selectedItem)="
                                        onSelectDropdown(
                                            $event,
                                            'shipper-pickup'
                                        )
                                    "
                                    (closeDropdown)="
                                        loadForm
                                            .get('pickupShipper')
                                            .markAsTouched()
                                    "
                                >
                                </app-ta-input-dropdown>
                            </div>
                        </div>

                        <!-- Work Hours, Appointment, Shipper Contact -->
                        <div class="load-shipper-contact-row">
                            <app-ta-tab-switch
                                [tabs]="stopTimeTabsPickup"
                                (switchClicked)="
                                    onTabChange($event, 'stop-time-pickup')
                                "
                                [type]="'type2-modal-popup'"
                            ></app-ta-tab-switch>

                            <app-ta-input-dropdown
                                formControlName="pickupShipperContactId"
                                [template]="'load-broker-contact'"
                                [inputConfig]="
                                    loadPickupShipperContactsInputConfig
                                "
                                [canAddNew]="true"
                                [canOpenModal]="true"
                                [options]="labelsShipperContacts"
                                [activeItem]="selectedPickupShipperContact"
                                (selectedItem)="
                                    onSelectDropdown(
                                        $event,
                                        'shipper-contact-pickup'
                                    )
                                "
                            ></app-ta-input-dropdown>
                        </div>

                        <!--  Date Pickers & Time Pickers -->

                        <div
                            class="stop-load-date-time"
                            [ngClass]="{ 'date-range-active': pickupDateRange }"
                        >
                            <app-ta-input
                                formControlName="pickupDateFrom"
                                [inputConfig]="getPickupDateFromInputConfig"
                                (blurInput)="
                                    loadForm
                                        .get('pickupDateFrom')
                                        .markAsTouched()
                                "
                            ></app-ta-input>

                            <ng-container *ngIf="!pickupDateRange">
                                <div
                                    class="d-flex align-items-center justify-content-center load-plus-button"
                                    [ngClass]="{
                                        disabled: selectedStopTimePickup === 6
                                    }"
                                    (click)="pickupDateRange = true"
                                >
                                    <svg-icon
                                        class="plus-icon"
                                        src="assets/svg/common/ic_plus.svg"
                                        [svgStyle]="{
                                            'width.px': '14',
                                            'height.px': '14'
                                        }"
                                    ></svg-icon>
                                </div>
                            </ng-container>

                            <app-ta-input
                                *ngIf="pickupDateRange"
                                formControlName="pickupDateTo"
                                [inputConfig]="loadPickupEndDateInputConfig"
                                (blurInput)="
                                    loadForm.get('pickupDateTo').markAsTouched()
                                "
                            ></app-ta-input>

                            <app-ta-input
                                formControlName="pickupTimeFrom"
                                [inputConfig]="getPickupTimeFromInputConfig"
                                (blurInput)="
                                    loadForm
                                        .get('pickupTimeFrom')
                                        .markAsTouched()
                                "
                            ></app-ta-input>

                            <app-ta-input
                                formControlName="pickupTimeTo"
                                [inputConfig]="getPickupTimeToInputConfig"
                                (blurInput)="
                                    loadForm.get('pickupTimeTo').markAsTouched()
                                "
                            ></app-ta-input>
                        </div>

                        <div class="stop-load-date-time-driver">
                            <app-ta-checkbox
                                formControlName="pickupInvolveDriver"
                                [customClass]="'medium'"
                                [label]="'Involve driver in loading the cargo'"
                                name="pickupInvolveDriver"
                            ></app-ta-checkbox>
                        </div>

                        <!-- Stop Items -->

                        <div class="stop-items-wrapper">
                            <app-ta-custom-card
                                [cardName]="'Item'"
                                [isCardOpen]="pickupStopItems.length"
                                [hasCounter]="pickupStopItems.length"
                                [hasActionSvg]="true"
                                [hasBodyData]="true"
                                [hasArrow]="false"
                                [animationMarginParams]="{
                                    marginTop: '10px',
                                    marginBottom: '12px'
                                }"
                                [hasScrollBodyXAxis]="pickupStopItems.length"
                                (onActionEvent)="
                                    createNewStopItemsRow('pickup')
                                "
                                [customClass]="'scrollable'"
                            >
                                <app-load-modal-stop-items
                                    [createNewStopItemsRow]="
                                        isCreatedNewStopItemsRow.pickup
                                    "
                                    [stopItemDropdownLists]="
                                        stopItemDropdownLists
                                    "
                                    (stopItemsDataValueEmitter)="
                                        handleStopItemsDataValueEmit(
                                            $event,
                                            'pickup'
                                        )
                                    "
                                    (stopItemsValidStatusEmitter)="
                                        handleStopItemsValidStatusEmit($event)
                                    "
                                ></app-load-modal-stop-items>
                            </app-ta-custom-card>
                        </div>

                        <ng-container *ngIf="pickupStatusHistory.length">
                            <app-load-modal-wait-time
                                [areFieldsDisabled]="isLoadClosed"
                                [statusHistory]="pickupStatusHistory"
                                (formChanged)="
                                    pickupStatusHistoryChange($event, 'pickup')
                                "
                            ></app-load-modal-wait-time>
                        </ng-container>
                    </app-load-modal-stop>

                    <!-- Extra Stops -->
                    <div cdkDropList (cdkDropListDropped)="drop($event)">
                        <div formArrayName="extraStops">
                            <div
                                *ngFor="
                                    let extraStop of loadExtraStops().controls;
                                    let indx = index;
                                    trackBy: trackByIdentity
                                "
                                cdkDrag
                                [cdkDragDisabled]="shouldDisableDrag(extraStop)"
                            >
                                <div
                                    class="dragdrop-custom-placeholder"
                                    *cdkDragPlaceholder
                                ></div>
                                <div [formGroupName]="indx">
                                    <app-load-modal-stop
                                        *ngIf="loadExtraStops().controls.length"
                                        [stopFinished]="
                                            isStepFinished(extraStop)
                                        "
                                        [firstOrLast]="false"
                                        [stopNumber]="indx + 2"
                                        [isDelivery]="
                                            selectExtraStopType[indx]
                                                ?.toString()
                                                ?.startsWith('4')
                                                ? true
                                                : false
                                        "
                                        [isDragAndDropActive]="
                                            isDragAndDropActive
                                        "
                                        [shipper]="
                                            selectedExtraStopShipper[indx]?.name
                                        "
                                        [shipperAddress]="
                                            selectedExtraStopShipper[indx]
                                                ?.address
                                        "
                                        [dateRange]="
                                            loadExtraStops()
                                                .at(indx)
                                                .get('dateFrom').value
                                                | loadDatetimeRange
                                                    : loadExtraStops()
                                                          .at(indx)
                                                          .get('dateTo').value
                                        "
                                        [timeRange]="
                                            loadExtraStops()
                                                .at(indx)
                                                .get('timeFrom').value
                                                | loadTimeType
                                                | loadDatetimeRange
                                                    : (loadExtraStops()
                                                          .at(indx)
                                                          .get('timeTo').value
                                                          | loadTimeType)
                                        "
                                        [legMile]="
                                            loadExtraStops()
                                                .at(indx)
                                                .get('legMiles').value
                                        "
                                        [isEmptyLoad]="false"
                                        [shipperContact]="{
                                            fullName:
                                                selectedExtraStopShipperContact[
                                                    indx
                                                ]?.name
                                        }"
                                        [isCardOpen]="
                                            loadExtraStops()
                                                .at(indx)
                                                .get('openClose').value &&
                                            !isDragAndDropActive
                                        "
                                        [state]="
                                            loadExtraStops()
                                                .at(indx)
                                                .get('shipperId').valid &&
                                            loadExtraStops()
                                                .at(indx)
                                                .get('dateFrom').valid &&
                                            loadExtraStops()
                                                .at(indx)
                                                .get('timeFrom').valid &&
                                            loadExtraStops()
                                                .at(indx)
                                                .get('timeTo').valid
                                                ? 'valid'
                                                : (loadExtraStops()
                                                      .at(indx)
                                                      .get('shipperId')
                                                      .errors &&
                                                      loadExtraStops()
                                                          .at(indx)
                                                          .get('shipperId')
                                                          .touched) ||
                                                  (loadExtraStops()
                                                      .at(indx)
                                                      .get('dateFrom').errors &&
                                                      loadExtraStops()
                                                          .at(indx)
                                                          .get('dateFrom')
                                                          .touched) ||
                                                  (loadExtraStops()
                                                      .at(indx)
                                                      .get('dateTo').errors &&
                                                      loadExtraStops()
                                                          .at(indx)
                                                          .get('dateTo')
                                                          .touched) ||
                                                  (loadExtraStops()
                                                      .at(indx)
                                                      .get('timeFrom').errors &&
                                                      loadExtraStops()
                                                          .at(indx)
                                                          .get('timeFrom')
                                                          .touched) ||
                                                  (loadExtraStops()
                                                      .at(indx)
                                                      .get('timeTo').errors &&
                                                      loadExtraStops()
                                                          .at(indx)
                                                          .get('timeTo')
                                                          .touched)
                                                ? 'invalid'
                                                : null
                                        "
                                        (delete)="removeLoadExtraStop(indx)"
                                        (toggle)="
                                            toggleStopActivity(
                                                $event,
                                                'extra-stops',
                                                indx
                                            )
                                        "
                                    >
                                        <!-- Tabs  -->

                                        <div class="row">
                                            <div class="col-12">
                                                <app-ta-tab-switch
                                                    [tabs]="
                                                        typeOfExtraStops[indx]
                                                    "
                                                    (switchClicked)="
                                                        onTabChange(
                                                            $event,
                                                            'stop-tab',
                                                            indx
                                                        )
                                                    "
                                                    [type]="'type2-modal-popup'"
                                                ></app-ta-tab-switch>
                                            </div>
                                        </div>

                                        <!-- Shipper -->

                                        <div class="row">
                                            <div class="col-12">
                                                <app-ta-input-dropdown
                                                    formControlName="shipperId"
                                                    [template]="'load-shipper'"
                                                    [inputConfig]="
                                                        loadExtraStopsShipperInputConfig[
                                                            indx
                                                        ]
                                                    "
                                                    [canAddNew]="true"
                                                    [canOpenModal]="true"
                                                    [options]="labelsShippers"
                                                    [activeItem]="
                                                        selectedExtraStopShipper[
                                                            indx
                                                        ]
                                                    "
                                                    (selectedItem)="
                                                        onSelectDropdown(
                                                            $event,
                                                            'shipper-extra-stops',
                                                            indx
                                                        )
                                                    "
                                                    (closeDropdown)="
                                                        loadExtraStops()
                                                            .at(indx)
                                                            .get('shipperId')
                                                            .markAsTouched()
                                                    "
                                                ></app-ta-input-dropdown>
                                            </div>
                                        </div>

                                        <!--  Work Hours, Appointment, Contact -->

                                        <div class="load-shipper-contact-row">
                                            <app-ta-tab-switch
                                                [tabs]="
                                                    stopTimeTabsExtraStops[indx]
                                                "
                                                (switchClicked)="
                                                    onTabChange(
                                                        $event,
                                                        'extra-stops-time',
                                                        indx
                                                    )
                                                "
                                                [type]="'type2-modal-popup'"
                                            ></app-ta-tab-switch>

                                            <app-ta-input-dropdown
                                                formControlName="shipperContactId"
                                                [template]="
                                                    'load-broker-contact'
                                                "
                                                [inputConfig]="
                                                    loadExtraStopsShipperContactsInputConfig[
                                                        indx
                                                    ]
                                                "
                                                [canAddNew]="true"
                                                [canOpenModal]="true"
                                                [options]="
                                                    labelsShipperContacts
                                                "
                                                [activeItem]="
                                                    selectedExtraStopShipperContact[
                                                        indx
                                                    ]
                                                "
                                                (selectedItem)="
                                                    onSelectDropdown(
                                                        $event,
                                                        'shipper-contact-extra-stops',
                                                        indx
                                                    )
                                                "
                                            ></app-ta-input-dropdown>
                                        </div>

                                        <!--  Date Pickers & Time Pickers -->

                                        <div
                                            class="stop-load-date-time"
                                            [ngClass]="{
                                                'date-range-active':
                                                    loadExtraStopsDateRange[
                                                        indx
                                                    ]
                                            }"
                                        >
                                            <app-ta-input
                                                formControlName="dateFrom"
                                                [inputConfig]="
                                                    getExtraStopsDateFromInputConfig(
                                                        loadExtraStopsDateRange[
                                                            indx
                                                        ]
                                                    )
                                                "
                                                (blurInput)="
                                                    loadExtraStops()
                                                        .at(indx)
                                                        .get('dateFrom')
                                                        .markAsTouched()
                                                "
                                            ></app-ta-input>

                                            <ng-container
                                                *ngIf="
                                                    !loadExtraStopsDateRange[
                                                        indx
                                                    ]
                                                "
                                            >
                                                <div
                                                    class="d-flex align-items-center justify-content-center load-plus-button"
                                                    [ngClass]="{
                                                        disabled:
                                                            selectedExtraStopTime[
                                                                indx
                                                            ]
                                                                ?.toString()
                                                                ?.startsWith(
                                                                    '9'
                                                                )
                                                    }"
                                                    (click)="
                                                        loadExtraStopsDateRange[
                                                            indx
                                                        ] = true
                                                    "
                                                >
                                                    <svg-icon
                                                        class="plus-icon"
                                                        [src]="
                                                            loadModalSvgRoutes.plus
                                                        "
                                                        [svgStyle]="{
                                                            'width.px': '14',
                                                            'height.px': '14'
                                                        }"
                                                    ></svg-icon>
                                                </div>
                                            </ng-container>

                                            <app-ta-input
                                                *ngIf="
                                                    loadExtraStopsDateRange[
                                                        indx
                                                    ]
                                                "
                                                formControlName="dateTo"
                                                [inputConfig]="
                                                    loadExtraStopsToDateInputConfig
                                                "
                                                (blurInput)="
                                                    loadExtraStops()
                                                        .at(indx)
                                                        .get('dateTo')
                                                        .markAsTouched()
                                                "
                                            ></app-ta-input>

                                            <app-ta-input
                                                formControlName="timeFrom"
                                                [inputConfig]="
                                                    getExtraStopsDateFromTimeFromInputConfig(
                                                        selectedExtraStopTime[
                                                            indx
                                                        ]
                                                    )
                                                "
                                                (blurInput)="
                                                    loadExtraStops()
                                                        .at(indx)
                                                        .get('timeFrom')
                                                        .markAsTouched()
                                                "
                                            ></app-ta-input>

                                            <app-ta-input
                                                formControlName="timeTo"
                                                [inputConfig]="
                                                    getExtraStopsDateToTimeToInputConfig(
                                                        selectedExtraStopTime[
                                                            indx
                                                        ]
                                                    )
                                                "
                                                (blurInput)="
                                                    loadExtraStops()
                                                        .at(indx)
                                                        .get('timeTo')
                                                        .markAsTouched()
                                                "
                                            ></app-ta-input>
                                        </div>

                                        <!-- Stop Items -->

                                        <div class="stop-items-wrapper">
                                            <app-ta-custom-card
                                                [cardName]="'Item'"
                                                [isCardOpen]="
                                                    extraStopItems[indx].length
                                                "
                                                [hasCounter]="
                                                    extraStopItems[indx].length
                                                "
                                                [hasActionSvg]="true"
                                                [hasBodyData]="true"
                                                [hasArrow]="true"
                                                [animationMarginParams]="{
                                                    marginTop: '10px',
                                                    marginBottom: '12px'
                                                }"
                                                [hasScrollBodyXAxis]="
                                                    extraStopItems[indx].length
                                                "
                                                (onActionEvent)="
                                                    createNewStopItemsRow(
                                                        'extra-stop',
                                                        indx
                                                    )
                                                "
                                            >
                                                <app-load-modal-stop-items
                                                    [createNewStopItemsRow]="
                                                        isCreatedNewStopItemsRow
                                                            .extraStops[indx]
                                                    "
                                                    [stopItemDropdownLists]="
                                                        stopItemDropdownLists
                                                    "
                                                    (stopItemsDataValueEmitter)="
                                                        handleStopItemsDataValueEmit(
                                                            $event,
                                                            'extra-stop',
                                                            indx
                                                        )
                                                    "
                                                    (stopItemsValidStatusEmitter)="
                                                        handleStopItemsValidStatusEmit(
                                                            $event
                                                        )
                                                    "
                                                ></app-load-modal-stop-items>
                                            </app-ta-custom-card>
                                        </div>
                                        <ng-container
                                            *ngIf="
                                                extraStopStatusHistory[indx] &&
                                                extraStopStatusHistory[indx]
                                                    .length
                                            "
                                        >
                                            <app-load-modal-wait-time
                                                [areFieldsDisabled]="
                                                    isLoadClosed
                                                "
                                                [statusHistory]="
                                                    extraStopStatusHistory[indx]
                                                "
                                                (formChanged)="
                                                    pickupStatusHistoryChange(
                                                        $event,
                                                        'extra-stop',
                                                        indx
                                                    )
                                                "
                                            ></app-load-modal-wait-time>
                                        </ng-container>
                                    </app-load-modal-stop>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Delivery Stop -->

                    <app-load-modal-stop
                        [firstOrLast]="true"
                        [stopNumber]="loadForm.get('deliveryStopOrder').value"
                        [stopFinished]="false"
                        [shipper]="selectedDeliveryShipper?.name"
                        [shipperAddress]="selectedDeliveryShipper?.address"
                        [dateRange]="
                            loadForm.get('deliveryDateFrom').value
                                | loadDatetimeRange
                                    : loadForm.get('deliveryDateTo').value
                        "
                        [timeRange]="
                            loadForm.get('deliveryTimeFrom').value
                                | loadTimeType
                                | loadDatetimeRange
                                    : (loadForm.get('deliveryTimeTo').value
                                          | loadTimeType)
                        "
                        [legMile]="
                            selectedDeliveryShipper &&
                            loadForm.get('deliverylegMiles').value
                        "
                        [isEmptyLoad]="false"
                        [shipperContact]="{
                            fullName: selectedDeliveryShipperContact?.name
                        }"
                        [isDestinationTab]="true"
                        [disabledCard]="!selectedPickupShipper"
                        [isCardOpen]="isActiveDeliveryStop"
                        [isDelivery]="true"
                        [state]="
                            loadForm.get('deliveryShipper').valid &&
                            loadForm.get('deliveryDateFrom').valid &&
                            loadForm.get('deliveryTimeFrom').valid &&
                            (selectedStopTimeDelivery === 6
                                ? !loadForm.get('deliveryTimeTo').errors
                                : loadForm.get('deliveryTimeTo').valid)
                                ? 'valid'
                                : (loadForm.get('deliveryShipper').errors &&
                                      loadForm.get('deliveryShipper')
                                          .touched) ||
                                  (loadForm.get('deliveryDateFrom').errors &&
                                      loadForm.get('deliveryDateFrom')
                                          .touched) ||
                                  (loadForm.get('deliveryDateTo').errors &&
                                      loadForm.get('deliveryDateTo').touched) ||
                                  (loadForm.get('deliveryTimeFrom').errors &&
                                      loadForm.get('deliveryTimeFrom')
                                          .touched) ||
                                  (loadForm.get('deliveryTimeTo').errors &&
                                      loadForm.get('deliveryTimeTo').touched)
                                ? 'invalid'
                                : null
                        "
                        (toggle)="toggleStopActivity($event, 'first-delivery')"
                    >
                        <!-- Shipper -->

                        <div class="row">
                            <div class="col-12">
                                <app-ta-input-dropdown
                                    formControlName="deliveryShipper"
                                    [template]="'load-shipper'"
                                    [inputConfig]="
                                        loadDeliveryShipperInputConfig
                                    "
                                    [canAddNew]="true"
                                    [canOpenModal]="true"
                                    [options]="labelsShippers"
                                    [activeItem]="selectedDeliveryShipper"
                                    (selectedItem)="
                                        onSelectDropdown(
                                            $event,
                                            'shipper-delivery'
                                        )
                                    "
                                    (closeDropdown)="
                                        loadForm
                                            .get('deliveryShipper')
                                            .markAsTouched()
                                    "
                                ></app-ta-input-dropdown>
                            </div>
                        </div>

                        <!-- Work Hours, Appointment, Contact -->

                        <div class="load-shipper-contact-row">
                            <app-ta-tab-switch
                                [tabs]="stopTimeTabsDelivery"
                                (switchClicked)="
                                    onTabChange($event, 'stop-time-delivery')
                                "
                                [type]="'type2-modal-popup'"
                            ></app-ta-tab-switch>

                            <app-ta-input-dropdown
                                formControlName="deliveryShipperContactId"
                                [template]="'load-broker-contact'"
                                [inputConfig]="
                                    loadDeliveryShipperContactsInputConfig
                                "
                                [canAddNew]="true"
                                [canOpenModal]="true"
                                [options]="labelsShipperContacts"
                                [activeItem]="selectedDeliveryShipperContact"
                                (selectedItem)="
                                    onSelectDropdown(
                                        $event,
                                        'shipper-contact-delivery'
                                    )
                                "
                            ></app-ta-input-dropdown>
                        </div>

                        <!--  Date Pickers & Time Pickers -->

                        <div
                            class="stop-load-date-time"
                            [ngClass]="{
                                'date-range-active': deliveryDateRange
                            }"
                        >
                            <app-ta-input
                                formControlName="deliveryDateFrom"
                                [inputConfig]="getDeliveryDateFromInputConfig"
                                (blurInput)="
                                    loadForm
                                        .get('deliveryDateFrom')
                                        .markAsTouched()
                                "
                            ></app-ta-input>

                            <ng-container *ngIf="!deliveryDateRange">
                                <div
                                    class="d-flex align-items-center justify-content-center load-plus-button"
                                    [ngClass]="{
                                        disabled: selectedStopTimeDelivery === 8
                                    }"
                                    (click)="deliveryDateRange = true"
                                >
                                    <svg-icon
                                        class="plus-icon"
                                        src="assets/svg/common/ic_plus.svg"
                                        [svgStyle]="{
                                            'width.px': '14',
                                            'height.px': '14'
                                        }"
                                    ></svg-icon>
                                </div>
                            </ng-container>

                            <app-ta-input
                                *ngIf="deliveryDateRange"
                                formControlName="deliveryDateTo"
                                [inputConfig]="loadDeliveryDateTo"
                                (blurInput)="
                                    loadForm
                                        .get('deliveryDateTo')
                                        .markAsTouched()
                                "
                            ></app-ta-input>

                            <app-ta-input
                                formControlName="deliveryTimeFrom"
                                [inputConfig]="getDeliveryTimeFromInputConfig"
                                (blurInput)="
                                    loadForm
                                        .get('deliveryTimeFrom')
                                        .markAsTouched()
                                "
                            ></app-ta-input>

                            <app-ta-input
                                formControlName="deliveryTimeTo"
                                [inputConfig]="getDeliveryTimeToInputConfig"
                                (blurInput)="
                                    loadForm
                                        .get('deliveryTimeTo')
                                        .markAsTouched()
                                "
                            ></app-ta-input>
                        </div>

                        <!-- Stop Items -->
                        <div class="stop-items-wrapper">
                            <app-ta-custom-card
                                [cardName]="'Item'"
                                [isCardOpen]="deliveryStopItems.length"
                                [hasCounter]="deliveryStopItems.length"
                                [hasActionSvg]="true"
                                [hasBodyData]="true"
                                [hasArrow]="true"
                                [animationMarginParams]="{
                                    marginTop: '10px',
                                    marginBottom: '12px'
                                }"
                                [hasScrollBodyXAxis]="deliveryStopItems.length"
                                (onActionEvent)="
                                    createNewStopItemsRow('delivery')
                                "
                            >
                                <app-load-modal-stop-items
                                    [createNewStopItemsRow]="
                                        isCreatedNewStopItemsRow.delivery
                                    "
                                    [stopItemDropdownLists]="
                                        stopItemDropdownLists
                                    "
                                    (stopItemsDataValueEmitter)="
                                        handleStopItemsDataValueEmit(
                                            $event,
                                            'delivery'
                                        )
                                    "
                                    (stopItemsValidStatusEmitter)="
                                        handleStopItemsValidStatusEmit($event)
                                    "
                                ></app-load-modal-stop-items>
                            </app-ta-custom-card>
                        </div>

                        <ng-container *ngIf="deliveryStatusHistory.length">
                            <app-load-modal-wait-time
                                [areFieldsDisabled]="isLoadClosed"
                                [statusHistory]="deliveryStatusHistory"
                                (formChanged)="
                                    pickupStatusHistoryChange(
                                        $event,
                                        'delivery'
                                    )
                                "
                            ></app-load-modal-wait-time>
                        </ng-container>
                    </app-load-modal-stop>

                    <!-- Stops Footer -->

                    <div
                        class="d-flex align-items-center justify-content-between stops-footer-bar"
                    >
                        <div
                            class="d-flex align-items-center stops-footer-bar-left-side"
                        >
                            <svg-icon
                                [src]="loadModalSvgRoutes.loadIcon"
                                class="load-modal-icon"
                            ></svg-icon>

                            <span class="m-0 ta-font-bold loaded-miles-value"
                                >{{
                                    loadForm.get('loadMiles').value
                                        | number : '1.2-2'
                                }}
                                <span>mi</span>
                            </span>
                        </div>

                        <div
                            class="d-flex align-items-center stops-footer-bar-right-side"
                        >
                            <div>
                                <svg-icon
                                    [src]="loadModalSvgRoutes.milesIcon"
                                    class="load-modal-icon"
                                ></svg-icon>

                                <span class="m-0 ta-font-bold total-miles-value"
                                    >{{
                                        loadForm.get('totalMiles').value
                                            | number : '1.2-2'
                                    }}
                                    <span>mi</span>
                                </span>
                            </div>

                            <div class="load-modal-time">
                                <svg-icon
                                    [src]="loadModalSvgRoutes.timeIcon"
                                    class="load-modal-icon"
                                ></svg-icon>
                                <span class="m-0 ta-font-bold total-miles-value"
                                    >≈ 0m</span
                                >
                            </div>
                        </div>
                    </div>
                </app-ta-custom-card>
            </div>

            <!-- Financial -->

            <div class="load-modal-row">
                <app-load-modal-financial
                    [firstHeaderTitle]="'Billing'"
                    [billing]="
                        loadModalBill
                            | financialCalculation : 'billing'
                            | currency
                    "
                    [disableBillAction]="
                        !loadForm.get('baseRate').value ||
                        !additionalBillingTypes?.length
                    "
                    [adjusted]="
                        adjustedRate || loadForm.get('driverRate').value
                    "
                    [secondHeaderTitle]="'Payment'"
                    [payment]="
                        loadModalPayment
                            | financialCalculation : 'payment'
                            | currency
                    "
                    [baseRate]="loadForm.get('baseRate').value"
                    [revised]="loadForm.get('revisedRate').value"
                    [tonu]="loadForm.get('tonuRate').value"
                    [disablePaymentAction]="!loadForm.get('baseRate').value"
                    [thirdHeaderTitle]="'Invoice Ageing'"
                    [isCardOpen]="true"
                    [animationMarginParams]="{
                        marginTop: '18px',
                        marginBottom: '22px'
                    }"
                    (action)="onFinancialAction($event)"
                    [disablePaymentAction]="!paymentTypesDropdownList.length"
                >
                    <div class="load-financial-container">
                        <div class="load-financial-billing">
                            <!-- Base Rate -->

                            <app-ta-input
                                formControlName="baseRate"
                                [inputConfig]="loadBaseRateInputConfig"
                                [ngClass]="{
                                    'load-financial-container-override':
                                        loadForm.get('tonuRate').value ||
                                        loadForm.get('revisedRate').value
                                }"
                            ></app-ta-input>

                            <!-- Driver Rate -->
                            <app-ta-input
                                *ngIf="showDriverRate"
                                formControlName="driverRate"
                                [inputConfig]="getDriverRateInputConfig"
                            ></app-ta-input>

                            <!-- Adjusted Rate -->
                            <app-ta-input
                                *ngIf="showAdjustedRate"
                                formControlName="adjustedRate"
                                [inputConfig]="getAdjustedRateInputConfig"
                                (clear)="removeAdditionalBilling('adjusted', 0)"
                                [ngClass]="{
                                    'load-financial-container-override':
                                        loadForm.get('tonuRate').value ||
                                        loadForm.get('revisedRate').value
                                }"
                            ></app-ta-input>

                            <!-- Tonu Rate -->
                            <app-ta-input
                                *ngIf="showTonuRate"
                                formControlName="tonuRate"
                                [inputConfig]="getTonuRateInputConfig"
                            ></app-ta-input>

                            <!-- Adjusted Rate -->
                            <app-ta-input
                                *ngIf="showRevisedRate"
                                formControlName="revisedRate"
                                [inputConfig]="getRevisedRateInputConfig"
                            ></app-ta-input>

                            <div formArrayName="additionalBillings">
                                <div
                                    *ngFor="
                                        let additional of additionalBillings()
                                            .controls;
                                        let indx = index;
                                        trackBy: trackByIdentity
                                    "
                                    [ngStyle]="{ 'margin-bottom': '4px' }"
                                >
                                    <div [formGroupName]="indx">
                                        <app-ta-input
                                            [ngClass]="{
                                                'load-financial-container-override':
                                                    loadForm.get('tonuRate')
                                                        .value
                                            }"
                                            formControlName="billingValue"
                                            [inputConfig]="
                                                getBillingValueInputConfig(
                                                    additional
                                                )
                                            "
                                            (clear)="
                                                removeAdditionalBilling(
                                                    'billing',
                                                    indx
                                                )
                                            "
                                        ></app-ta-input>
                                    </div>
                                </div>
                            </div>
                            <ng-container *ngIf="isVisibleBillDropdown">
                                <app-ta-input-dropdown
                                    formControlName="billingDropdown"
                                    [inputConfig]="
                                        loadBillingDropdownInputConfig
                                    "
                                    [options]="additionalBillingTypes"
                                    [activeItem]="null"
                                    (selectedItem)="
                                        addAdditionalBilling($event)
                                    "
                                ></app-ta-input-dropdown>
                            </ng-container>
                        </div>

                        <div>
                            <div
                                formArrayName="additionalPayments"
                                *ngIf="isVisiblePayment"
                            >
                                <div
                                    *ngFor="
                                        let additional of additionalPayments()
                                            .controls;
                                        let indx = index;
                                        trackBy: trackByIdentity
                                    "
                                    [ngStyle]="{ 'margin-bottom': '4px' }"
                                >
                                    <div [formGroupName]="indx">
                                        <div class="load-financial-payment">
                                            <app-ta-input
                                                formControlName="pay"
                                                [inputConfig]="
                                                    getPaymentInputConfig(
                                                        additional
                                                    )
                                                "
                                                (clear)="
                                                    removePaymentBilling(indx)
                                                "
                                            ></app-ta-input>

                                            <app-ta-input-dropdown
                                                formControlName="displayPaymentType"
                                                [inputConfig]="
                                                    loadPaymentTypeInputConfig
                                                "
                                                [canOpenModal]="true"
                                                [options]="
                                                    paymentMethodsDropdownList
                                                "
                                                (selectedItem)="
                                                    onSelectDropdown(
                                                        $event,
                                                        'pay-type',
                                                        indx
                                                    )
                                                "
                                            ></app-ta-input-dropdown>

                                            <app-ta-input
                                                formControlName="payDate"
                                                [inputConfig]="
                                                    loadPaydateInputConfig
                                                "
                                            ></app-ta-input>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <ng-container *ngIf="showPaymentArray && paymentTypesDropdownList.length">
                                <app-ta-input-dropdown
                                    formControlName="paymentDropdown"
                                    [inputConfig]="
                                        loadPaymentDropdownInputConfig
                                    "
                                    [options]="paymentTypesDropdownList"
                                    [activeItem]="null"
                                    (selectedItem)="addPaymentBilling($event)"
                                ></app-ta-input-dropdown>
                            </ng-container>
                        </div>

                        <div class="load-financial-invoice">
                            <app-ta-input
                                formControlName="invoicedDate"
                                [inputConfig]="loadInvoiceDateInputConfig()"
                            ></app-ta-input>

                            <ng-container *ngIf="invoicePercent.daysToPay">
                                <app-ta-progres-bar
                                    [type]="'days'"
                                    [text]="invoicePercent.daysLeft"
                                    [daysToPay]="invoicePercent.daysToPay"
                                    [percents]="invoicePercent.percent"
                                    [daysExpired]="true"
                                >
                                </app-ta-progres-bar>
                            </ng-container>
                        </div>
                    </div>
                </app-load-modal-financial>
            </div>

            <!-- Comments -->
            <div
                class="load-modal-row"
                *ngIf="editData?.type?.includes('edit')"
            >
                <app-ta-custom-card
                    [cardName]="'Comment'"
                    [isCardOpen]="comments.length"
                    [hasCounter]="comments.length"
                    [hasActionSvg]="
                        editData && !isCommented && !isCommentEdited
                    "
                    [hasScrollBody]="comments.length"
                    [hasBodyData]="true"
                    [animationMarginParams]="{
                        marginTop: '10px',
                        marginBottom: '12px'
                    }"
                    [disabledCard]="!editData"
                    (onActionEvent)="createComment()"
                >
                    <ng-container
                        *ngFor="let comment of comments; let i = index"
                    >
                        <app-ta-comment
                            [commentData]="comment"
                            [commentIndex]="i"
                            [isMe]="
                                comment.companyUser.id === companyUser.userId
                            "
                            [isEditButtonDisabled]="
                                isCommented || isCommentEdited
                            "
                            (btnActionEmitter)="handleCommentActionEmit($event)"
                        ></app-ta-comment>
                    </ng-container>
                </app-ta-custom-card>
            </div>

            <!-- Documents -->

            <div class="load-modal-row">
                <app-ta-custom-card
                    [hasCounter]="documents?.length"
                    [cardName]="'Document'"
                    [isCardOpen]="documents?.length"
                    (onOpenCard)="handleOpenCloseDocumentsCard($event)"
                >
                    <app-ta-upload-files
                        *ngIf="isDocumentsCardOpen"
                        [files]="documents"
                        [size]="'medium'"
                        [showDropzone]="true"
                        (onFileEvent)="onFilesEvent($event)"
                        [customClassName]="'modals'"
                        [hasTagsDropdown]="true"
                        [tags]="tags"
                    ></app-ta-upload-files>
                </app-ta-custom-card>
            </div>

            <!-- Note -->

            <div class="load-modal-row">
                <app-ta-input-note
                    formControlName="note"
                    [isVisibleNote]="
                        loadForm.get('note').value &&
                        loadForm.get('note').value !== 'null'
                    "
                    [note]="
                        loadForm.get('note').value &&
                        loadForm.get('note').value !== 'null'
                            ? loadForm.get('note').value
                            : ''
                    "
                    (styledValueEmitter)="
                        getDriverMessageOrNote($event, 'note')
                    "
                ></app-ta-input-note>
            </div>
        </div>
    </form>

    <!-- Additional Tab Part -->

    <div
        additional
        class="load-map-container"
        [ngClass]="{
            'load-hazardous-container': isHazardousVisible
        }"
        [ngStyle]="{
            overflow: 'hidden',
            'owerflow-y': 'scroll',
            height: originHeight + 130 + 'px'
        }"
    >
        <!-- Hazardous -->

        <app-load-modal-hazardous
            *ngIf="isHazardousVisible"
        ></app-load-modal-hazardous>

        <!-- Map -->

        <app-ta-maps
            *ngIf="!isHazardousVisible"
            [mapType]="'routing'"
            [routes]="loadStopRoutes"
            [ngStyle]="{ width: '100%', height: '100%' }"
        ></app-ta-maps>
    </div>
</app-ta-modal>
