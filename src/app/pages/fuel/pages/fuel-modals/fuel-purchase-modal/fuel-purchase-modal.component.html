<app-ta-modal
    [modalTitle]="
        editData?.type !== 'edit'
            ? 'Add Fuel Transaction'
            : 'Edit Fuel Transaction'
    "
    [editData]="editData"
    [editName]="fuelTransactionName"
    [isModalValid]="fuelForm.valid && isFormDirty"
    [disableDelete]="true"
    (action)="onModalAction($event)"
>
    <form
        origin
        [formGroup]="fuelForm"
        class="form-container form-container-without-mb"
    >
        <div
            *ngIf="
                editData?.type === 'edit' &&
                fuelTransactionType?.name !== 'Manual'
            "
            class="row"
        >
            <div class="col-6">
                <app-ta-input
                    formControlName="efsAccount"
                    [inputConfig]="{
                        name: 'EFS Account',
                        type: 'text',
                        label: 'EFS Account',
                        isDisabled: true
                    }"
                ></app-ta-input>
            </div>
            <div class="col-6">
                <app-ta-input
                    formControlName="fuelCard"
                    [inputConfig]="{
                        name: 'Fuel Card',
                        type: 'text',
                        label: 'Fuel Card',
                        isDisabled: true,
                        placeholderIcon: 'fuel-card'
                    }"
                ></app-ta-input>
            </div>
        </div>
        <div class="row">
            <div class="col-4">
                <app-ta-input
                    formControlName="invoice"
                    [inputConfig]="{
                        name: 'Invoice',
                        type: 'text',
                        label: 'Invoice',
                        textTransform: 'uppercase',
                        isRequired: true,
                        minLength: 1,
                        maxLength: 22
                    }"
                ></app-ta-input>
            </div>
            <div class="col-4">
                <app-ta-input
                    formControlName="transactionDate"
                    [inputConfig]="{
                        name: 'datepicker',
                        type: 'text',
                        label: 'Date',
                        placeholderIcon: 'date',
                        isRequired: true,
                        isDropdown: true,
                        isDisabled:
                            editData?.type === 'edit' &&
                            fuelTransactionType?.name !== 'Manual',
                        customClass: 'datetimeclass'
                    }"
                ></app-ta-input>
            </div>
            <div class="col-4">
                <!-- Time Picker -->
                <app-ta-input
                    formControlName="transactionTime"
                    [inputConfig]="{
                        name: 'timepicker',
                        type: 'text',
                        label: 'Time',
                        placeholderIcon: 'time',
                        isDropdown: true,
                        isRequired: true,
                        isDisabled:
                            editData?.type === 'edit' &&
                            fuelTransactionType?.name !== 'Manual',
                        customClass: 'datetimeclass'
                    }"
                ></app-ta-input>
            </div>
        </div>
        <div class="row">
            <div
                [ngClass]="fuelForm.get('trailerId').value ? 'col-4' : 'col-6'"
            >
                <app-ta-input-dropdown
                    formControlName="truckId"
                    [template]="'svgtext-template'"
                    [inputConfig]="{
                        name: 'Input Dropdown',
                        type: 'text',
                        label: 'Truck',
                        isDropdown: true,
                        isRequired: true,
                        dropdownImageInput: {
                            withText: true,
                            svg: true,
                            image: false,
                            url: selectedTruckType?.logoName,
                            template: 'truck',
                            class: selectedTruckType?.name
                                ?.trim()
                                .replace(' ', '')
                                .toLowerCase()
                        },
                        dropdownWidthClass: 'w-col-216 truck-trailer-dropdown',
                        customClass: 'truck-trailer-dropdown'
                    }"
                    [options]="truckType"
                    [activeItem]="selectedTruckType"
                    (selectedItem)="onSelectDropDown($event, 'truck')"
                ></app-ta-input-dropdown>
            </div>
            <div *ngIf="fuelForm.get('trailerId').value" class="col-4">
                <app-ta-input-dropdown
                    formControlName="trailerId"
                    [template]="'svgtext-template'"
                    [activeItem]="selectedTrailerType"
                    [inputConfig]="{
                        name: 'Input Dropdown',
                        type: 'text',
                        label: 'Trailer',
                        isRequired: true,
                        isDropdown: true,
                        dropdownImageInput: {
                            withText: true,
                            svg: true,
                            image: false,
                            url: selectedTrailerType?.logoName,
                            template: 'trailer', 
                        },
                        dropdownWidthClass: 'w-col-216', 
                        customClass: 'truck-trailer-dropdown',
                        isDisabled: true
                    }"
                ></app-ta-input-dropdown>
            </div>
            <div
                [ngClass]="
                    fuelForm.get('trailerId').value
                        ? 'col-4 no-p-left'
                        : 'col-6'
                "
            >
                <app-ta-input
                    formControlName="driverFullName"
                    [inputConfig]="{
                        name: 'Full name',
                        type: 'text',
                        label: 'Driver',
                        isDisabled: true,
                        textTransform: 'capitalize',
                        minLength: 2,
                        maxLength: 32
                    }"
                ></app-ta-input>
            </div>
        </div>
        <div class="row last-row">
            <div class="col-12">
                <div
                    *ngIf="selectedFuelStop"
                    class="d-flex flex-column selected-item-container selected-item-container-small"
                    [ngClass]="{
                        'non-editable':
                            editData?.type === 'edit' &&
                            fuelTransactionType?.name !== 'Manual'
                    }"
                >
                    <div class="selected-item-label">
                        Fuel Stop <span>*</span>
                    </div>
                    <p class="m-0 ta-font-bold text-size-14 text-color-black mb-1 d-flex align-items-center">
                        <span>{{ selectedFuelStop?.businessName }}</span>

                        <ng-container *ngIf="selectedFuelStop.favorite">
                            <svg-icon
                                class="svg-fill-blue-13 svg-size-14 ml-1 d-flex"
                                [src]="svgRoutes.STAR"
                            ></svg-icon>
                        </ng-container>
                    </p>
                    <div class="d-flex align-items-center">
                        <div
                            *ngIf="selectedFuelStop?.address"
                            class="d-flex align-items-center selected-item-info"
                        >
                            <svg-icon
                                class="svg-fill-blue-13 svg-size-14 d-flex"
                                [src]="svgRoutes.ADDRESS"
                            ></svg-icon>
                            <p
                                class="ml-1 text-size-11 ta-font-medium text-color-black-2"
                            >
                                {{ selectedFuelStop?.fullAddress }}
                            </p>
                        </div>
                    </div>
                    <div
                        *ngIf="
                            editData?.type !== 'edit' ||
                            fuelTransactionType?.name === 'Manual'
                        "
                        class="clear-selected-item"
                    >
                        <div
                            ngbTooltip
                            mainTooltip="Clear"
                            tooltipBackground="#6c6c6c"
                            position="top"
                            class="clear-x"
                            (click)="
                                selectedFuelStop = null;
                                fuelForm.get('fuelStopStoreId').patchValue(null)
                            "
                        >
                            <svg-icon src="assets/svg/ic_x.svg"></svg-icon>
                        </div>
                    </div>
                </div>
                <app-ta-input-dropdown
                    *ngIf="!selectedFuelStop"
                    formControlName="fuelStopStoreId"
                    [template]="'fuel-franchise'"
                    [inputConfig]="{
                        name: 'Input Dropdown',
                        type: 'text',
                        label: 'Fuel Stop',
                        isRequired: true,
                        isDropdown: true,
                        dropdownWidthClass: 'w-col-456'
                    }"
                    [options]="fuelStops"
                    [activeItem]="selectedFuelStop"
                    (pagination)="paginationFuelStopPage($event)"
                    (activeGroup)="getFuelStoresByFranchiseId($event)"
                    (selectedItem)="onSelectDropDown($event, 'fuel')"
                ></app-ta-input-dropdown>
            </div>
        </div>

        <app-ta-custom-card
            [cardName]="'Item'"
            [disableAnimation]="disableCardAnimation"
            [hasActionSvg]="true"
            [hasArrow]="false"
            [hasScrollBody]="
                (editData?.data && updatedRepairItems?.length > 10) ||
                fuelItems?.length > 10
            "
            [isCardOpen]="
                (editData?.data && updatedRepairItems?.length) ||
                fuelItems?.length
            "
            [disabledCard]="
                (editData?.data && !updatedRepairItems?.length) ||
                !fuelItems?.length
            "
            [hasCounter]="
                (editData?.data && updatedRepairItems?.length) ||
                fuelItems?.length
            "
            (onActionEvent)="addRepairItem()"
        >
            <app-ta-modal-table
                [tableType]="modalTableTypeEnum.REPAIR_BILL"
                [isNewRowCreated]="isRepairBillRowCreated"
                [modalTableData]="updatedRepairItems"
                [isFuelTable]="true"
                [fuelItemsDropdown]="fuelItemsDropdown"
                (modalTableValueEmitter)="handleModalTableValueEmit($event)"
                (modalTableValidStatusEmitter)="
                    handleModalTableValidStatusEmit($event)
                " 
            >
            </app-ta-modal-table>

            <div class="item-total d-flex justify-content-between mt-1">
                <span class="ta-font-semi-bold text-color-muted text-size-14"
                    >Total Cost
                </span>

                <span class="ta-font-bold text-size-14 text-color-black">
                    {{ total | currency }}
                </span>
            </div>
        </app-ta-custom-card>

        <div class="ta-card-body-overflow-none">
            <app-ta-custom-card
                [hasCounter]="documents.length ? documents.length : 0"
                [cardName]="'Document'"
                [disableAnimation]="disableCardAnimation"
                [isCardOpen]="!!documents.length"
            >
                <app-ta-upload-files
                    [files]="documents"
                    [showDropzone]="true"
                    (onFileEvent)="onFilesEvent($event)"
                    [customClassName]="'modals'"
                ></app-ta-upload-files>
            </app-ta-custom-card>
        </div>
    </form>
</app-ta-modal>
