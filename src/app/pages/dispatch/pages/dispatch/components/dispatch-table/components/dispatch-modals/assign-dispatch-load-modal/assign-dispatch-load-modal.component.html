<app-ta-modal
    [modalTitle]="'Assign Load'"
    [customClass]="loadModalSize"
    [isAdditionalAssignLoadModalVisible]="isAdditonalViewOpened"
    [isAssignLoadModal]="true"
    (additionalPartVisibility)="additionalPartVisibility($event)"
>
    <div origin>
        <div class="dispatch-load">
            <form [formGroup]="assingLoadForm" class="mb-2">
                <app-ta-input-dropdown
                    formControlName="dispatchId"
                    [template]="'load-dispatches-ttd'"
                    [inputConfig]="loadDispatchesTTDInputConfig"
                ></app-ta-input-dropdown>
            </form>

            <!-- [options]="labelsDispatches"
        [activeItem]="selectedDispatches"
            (selectedItem)="onSelectDropdown($event, 'dispatches')" -->
            <!-- Table header -->
            <div class="d-grid dispatch-load-grid">
                <div>
                    <span
                        class="dispatch-load-header text-color-muted ta-font-bold"
                    >
                        #
                    </span>
                </div>
                <div>
                    <span
                        class="dispatch-load-header text-color-muted ta-font-bold"
                    >
                        LOAD
                    </span>
                </div>
                <div>
                    <span
                        class="dispatch-load-header text-color-green ta-font-bold"
                    >
                        PICKUP
                    </span>
                </div>
                <div>
                    <span
                        class="dispatch-load-header text-color-red-10 ta-font-bold"
                    >
                        DELIVERY
                    </span>
                </div>
                <div class="text-right">
                    <span
                        class="dispatch-load-header text-color-muted ta-font-bold"
                    >
                        TOTAL
                    </span>
                </div>
            </div>

            <app-ta-custom-card
                [cardName]="'Assigned'"
                [hasCounter]="editData.data.assignedLoadsCount"
                [isCardOpen]="true"
                [hasActionSvg]="false"
                [hasBodyData]="true"
                [hasArrow]="true"
                [showReorderButton]="showReorderButton"
                [showFinishReordering]="showFinishReordering"
                (onActionEvent)="onReorderAction($event)"
                cdkDropList
                (cdkDropListDropped)="dropAssigned($event)"
            >
                <ng-container
                    *ngIf="
                        editData.data.assignedLoads.length;
                        else showNoAssignedLoads
                    "
                >
                    <div
                        *ngFor="
                            let assignedLoad of editData.data.assignedLoads;
                            let index = index;
                            trackBy: trackByIdentity
                        "
                        cdkDrag
                    >
                        <div
                            class="dragdrop-custom-placeholder-assign-load"
                            *cdkDragPlaceholder
                        ></div>
                        <app-load-short-details
                            [load]="assignedLoad"
                            [index]="index + 1"
                            [isAssigned]="true"
                            (changeLoadList$)="changeLoadList(assignedLoad.id, true)"
                            (selectLoad$)="selectLoad(assignedLoad.id, true)"
                        ></app-load-short-details>
                    </div>
                </ng-container>

                <ng-template #showNoAssignedLoads>
                    <div
                        class="d-flex flex-column align-items-center justify-content-center"
                    >
                        <svg-icon [src]="svgIcons.noLoads"></svg-icon>

                        <div
                            class="ta-font-bold dispatch-load-no-results-title"
                        >
                            No data found
                        </div>
                        <p class="ta-font-medium dispatch-load-no-results-text">
                            There are currently no assigned loads
                        </p>
                    </div>
                </ng-template>
            </app-ta-custom-card>

            <app-ta-custom-card
                [cardName]="'Unassigned'"
                [hasCounter]="editData.data.unassignedLoadsCount"
                [isCardOpen]="true"
                [hasActionSvg]="false"
                [hasBodyData]="true"
                [hasArrow]="true"
            >
                <ng-container
                    *ngIf="
                        editData.data.unassignedLoads.length;
                        else showNoUnassignedLoads
                    "
                >
                    <div
                        *ngFor="
                            let unassignedLoad of editData.data.unassignedLoads;
                            let index = index;
                            trackBy: trackByIdentity
                        "
                    >
                        <app-load-short-details
                            [load]="unassignedLoad"
                            [index]="index + 1"
                            [isAssigned]="false"
                            (changeLoadList$)="changeLoadList(unassignedLoad.id, false)"
                            (selectLoad$)="selectLoad(unassignedLoad.id, false)"
                        ></app-load-short-details>
                    </div>
                </ng-container>

                <ng-template #showNoUnassignedLoads>
                    <div
                        class="d-flex flex-column align-items-center justify-content-center"
                    >
                        <svg-icon [src]="svgIcons.noLoads"></svg-icon>
                        <div
                            class="ta-font-bold dispatch-load-no-results-title"
                        >
                            No data found
                        </div>
                        <p class="ta-font-medium dispatch-load-no-results-text">
                            There are currently no unassigned loads
                        </p>
                    </div>
                </ng-template>
            </app-ta-custom-card>
        </div>
    </div>

    <div assignLoadModal>
        <ng-container *ngIf="selectedLoad; else modalTitle">
            <div class="modal-header d-flex justify-content-between">
                <div class="modal-header-leftside">
                    <h5 class="modal-title">Load</h5>
                    <h5 class="edit-name">
                        {{ selectedLoad.loadNumber }}
                    </h5>
                </div>

                <div class="modal-header-rightside">
                    <div
                        [mainTooltip]="'Edit load'"
                        [tooltipBackground]="'#424242'"
                        ngbTooltip
                        position="bottom"
                        class="modal-header-edit-button"
                        (click)="editLoad()"
                    >
                        <svg-icon [src]="svgIcons.penIcon"></svg-icon>
                    </div>

                    <div
                        [mainTooltip]="isAssignedLoad ? 'Unassign' : 'Assign'"
                        [tooltipBackground]="'#424242'"
                        ngbTooltip
                        position="bottom"
                        [ngClass]="{
                            'dispatch-table-driver_hover': !isAssignedLoad
                        }"
                        (click)="changeLoadList(selectedLoad.id, isAssignedLoad, true)"
                    >
                        <ng-container *ngIf="isAssignedLoad; else notAssigned">
                            <svg-icon [src]="svgIcons.minus"></svg-icon>
                        </ng-container>
                        <ng-template #notAssigned>
                            <svg-icon [src]="svgIcons.plus"></svg-icon
                        ></ng-template>
                    </div>
                </div>
            </div>

            <app-ta-custom-card
                [cardName]="'Stops'"
                [capsulaText]="
                    selectedLoad?.stops.length - 2
                        ? selectedLoad?.stops.length - 2 + ' EXTRA'
                        : null
                "
                [isCardOpen]="true"
                [hasCounter]="selectedLoad?.stops.length"
                [hasActionSvg]="false"
                [hasBodyData]="true"
                [hasArrow]="false"
                [animationMarginParams]="{
                    marginTop: '10px',
                    marginBottom: '12px'
                }"
                [addSpaceToXAsis]="true"
            >
                <app-load-deatils-item-stops-main
                    [stopsData]="{
                        statusType: selectedLoad?.statusType,
                        stops: selectedLoad?.stops
                    }"
                    [isMapDisplayed]="false"
                    [isSmallDesign]="true"
                >
                </app-load-deatils-item-stops-main>
            </app-ta-custom-card>
        </ng-container>

        <ng-template #modalTitle>
            <div class="modal-header modal-header-absolute d-flex justify-content-between">
                <div class="modal-header-leftside">
                    <h5 class="modal-title">Assigned ({{editData.data.assignedLoads.length}})</h5>
                </div>
            </div>
        </ng-template>
        <div
            class="d-flex justify-content-center align-items-center dispatch-load-map"
        >
            <app-ta-maps
                [mapType]="'routing'"
                [routes]="loadStopRoutes"
                [ngStyle]="{ width: '100%', height: '100%' }"
            ></app-ta-maps>
        </div>
    </div>
</app-ta-modal>
