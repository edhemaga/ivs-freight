<div
    class="dispatch-table"
    [ngClass]="{
        unlocked: !isDispatchBoardLocked && showAddAddressFieldIndex === -1,
        'unlocked-skip-location':
            !isDispatchBoardLocked && showAddAddressFieldIndex !== -1,
        'unlocked-drag-trailer': isDrag && draggingType === 'trailer',
        'unlocked-drag-driver': isDrag && draggingType === 'driver',
    }"
    cdkDropList
    (cdkDropListDropped)="dragEndRow($event)"
>
    <div
        class="table-container-dispatch scrollable"
        [class.flex-column]="
            !dispatchData?.dispatches?.length &&
            !isAllBoardsList &&
            isDispatchBoardLocked
        "
    >
        @if (isDispatchBoardChangeInProgress) {
            <div
                @dispatchBackgroundAnimation
                class="change-in-progress-background-cover"
            ></div>
        }

        <table>
            <!-- Table Header -->

            <thead>
                @if (
                    !isAllBoardsList ||
                    (isAllBoardsList && dispatchData?.teamBoard)
                ) {
                    <tr class="d-flex">
                        @for (
                            tableHeaderItem of dispatchTableHeaderItems;
                            let headerItemIndex = $index;
                            track headerItemIndex
                        ) {
                            @if (
                                tableHeaderItem.title
                                    | dispatchTableHeaderShowPipe
                                        : columnsToShow
                                        : true
                            ) {
                                <th
                                    class="ta-font-bold"
                                    [ngClass]="{
                                        'd-flex justify-content-center align-items-center':
                                            !tableHeaderItem?.title &&
                                            tableHeaderItem?.icon,
                                        'd-flex align-items-center pickup-delivery':
                                            tableHeaderItem?.secondTitle,
                                        'smaller-padding':
                                            !isDispatchBoardLocked &&
                                            (tableHeaderItem?.title ===
                                                'INSPECTION' ||
                                                tableHeaderItem?.title ===
                                                    'DISPATCHER' ||
                                                (tableHeaderItem?.title ===
                                                    'NOTE' &&
                                                    !_isNoteExpanded)),
                                    }"
                                    [ngStyle]="
                                        resizedColumnsWidth
                                            | dispatchTableColumnWidths
                                                : tableHeaderItem.headerProperty
                                                : tableHeaderItem?.title ===
                                                      'DRIVER' &&
                                                      isDriverEndorsementActive
                                    "
                                >
                                    <div
                                        class="resize d-flex justify-content-between align-items-center pe-none"
                                        appResizable
                                        [title]="tableHeaderItem.title"
                                        [columns]="columnsToShow"
                                        [resizeEnabled]="!isDispatchBoardLocked"
                                        [isNoteExpanded]="_isNoteExpanded"
                                        [isDriverEndorsementActive]="
                                            isDriverEndorsementActive
                                        "
                                        [hasAdditionalFieldTruck]="
                                            hasAdditionalFieldTruck
                                        "
                                        [hasAdditionalFieldTrailer]="
                                            hasAdditionalFieldTrailer
                                        "
                                        (onResizeAction)="
                                            onResizeAction($event)
                                        "
                                        [ngClass]="{
                                            'show-after':
                                                !isDispatchBoardLocked,
                                        }"
                                    >
                                        <div
                                            (click)="
                                                handleHeaderClick(
                                                    tableHeaderItem?.title,
                                                    true
                                                )
                                            "
                                            [ngClass]="{
                                                'close-icon-show d-flex justify-content-between align-items-center':
                                                    !isDispatchBoardLocked &&
                                                        tableHeaderItem.title
                                                    | dispatchTableHeaderShowPipe
                                                        : columnsToShow
                                                        : false,
                                            }"
                                        >
                                            <div
                                                class="pe-auto"
                                                [ngStyle]="{
                                                    cursor:
                                                        tableHeaderItem?.title ===
                                                            'NOTE' ||
                                                        tableHeaderItem?.title ===
                                                            'TRUCK' ||
                                                        tableHeaderItem?.title ===
                                                            'TRAILER' ||
                                                        tableHeaderItem?.title ===
                                                            'DRIVER' ||
                                                        tableHeaderItem?.title ===
                                                            'PARKING' ||
                                                        tableHeaderItem?.title ===
                                                            'LAST LOCATION'
                                                            ? 'pointer'
                                                            : 'default',
                                                }"
                                            >
                                                <svg-icon
                                                    class="icon"
                                                    [class.expanded]="
                                                        tableHeaderItem?.title ===
                                                            'NOTE' &&
                                                        _isNoteExpanded
                                                    "
                                                    [svgStyle]="{
                                                        'width.px': '14',
                                                        'height.px': '14',
                                                    }"
                                                    [src]="
                                                        tableHeaderItem?.icon
                                                    "
                                                ></svg-icon>

                                                @if (
                                                    (tableHeaderItem?.title !==
                                                        'INSPECTION' &&
                                                        tableHeaderItem?.title !==
                                                            'DISPATCHER' &&
                                                        tableHeaderItem?.title !==
                                                            'NOTE') ||
                                                    (tableHeaderItem?.title ===
                                                        'NOTE' &&
                                                        _isNoteExpanded)
                                                ) {
                                                    {{ tableHeaderItem?.title }}
                                                }
                                            </div>

                                            @if (
                                                !isDispatchBoardLocked &&
                                                    tableHeaderItem.title
                                                    | dispatchTableHeaderShowPipe
                                                        : columnsToShow
                                                        : false
                                            ) {
                                                <div
                                                    class="pe-auto"
                                                    [ngStyle]="{
                                                        'padding-right': '10px',
                                                        cursor: 'pointer',
                                                    }"
                                                >
                                                    <svg-icon
                                                        [svgStyle]="{
                                                            'width.px': '14',
                                                            'height.px': '14',
                                                        }"
                                                        [src]="
                                                            dispatchTableSvgRoutes?.closeSvgRoute
                                                        "
                                                        (click)="
                                                            handleHeaderClick(
                                                                tableHeaderItem?.title,
                                                                false
                                                            )
                                                        "
                                                    ></svg-icon>
                                                </div>
                                            }
                                        </div>

                                        @if (tableHeaderItem?.secondIcon) {
                                            <div>
                                                <svg-icon
                                                    class="icon delivery"
                                                    [svgStyle]="{
                                                        'width.px': '14',
                                                        'height.px': '14',
                                                    }"
                                                    [src]="
                                                        tableHeaderItem?.secondIcon
                                                    "
                                                ></svg-icon>

                                                {{
                                                    tableHeaderItem?.secondTitle
                                                }}
                                            </div>
                                        }

                                        <!-- Sort -->

                                        @if (
                                            sortBy ===
                                                tableHeaderItem?.sortBy &&
                                            sortDirection
                                        ) {
                                            <div
                                                class="d-flex justify-content-center align-items-center sort-indicator-container me-2"
                                            >
                                                <svg-icon
                                                    [svgStyle]="{
                                                        'width.px': 12,
                                                        'height.px': 12,
                                                    }"
                                                    [src]="
                                                        sortDirection === 'asc'
                                                            ? dispatchTableSvgRoutes?.sortAscendingArrow
                                                            : dispatchTableSvgRoutes?.sortDescendingArrow
                                                    "
                                                ></svg-icon>
                                            </div>
                                        }
                                    </div>
                                </th>
                            }
                        }
                    </tr>
                }
            </thead>

            <!-- Table -->

            <tbody class="d-flex flex-column">
                <!-- Locked Table -->

                @if (dispatchData?.dispatches?.length) {
                    @for (
                        item of dispatchData.dispatches;
                        let rowIndex = $index;
                        track rowIndex
                    ) {
                        <tr
                            #tableBodyRow
                            class="reorder-row"
                            [ngClass]="{ drag: !isDispatchBoardLocked }"
                            cdkDrag
                            cdkDragLockAxis="y"
                            cdkDragPreviewContainer="parent"
                            cdkDragBoundary=".dispatch-table"
                            [cdkDragDisabled]="
                                isDispatchBoardLocked || !item.truck
                            "
                            (cdkDragStarted)="dragStartRow()"
                            (cdkDragEnded)="dragEnd()"
                            (mouseenter)="isHoveringRowIndex = rowIndex"
                            (mouseleave)="isHoveringRowIndex = -1"
                        >
                            <div
                                *cdkDragPlaceholder
                                class="dragdrop-custom-placeholder"
                                [ngStyle]="{
                                    width: tableBodyRowWidth + 'px',
                                    maxWidth: '100%',
                                }"
                            ></div>

                            <td
                                cdkDragHandle
                                #columnField
                                class="truck-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'truckNumber'
                                            : hasAdditionalFieldTruck
                                "
                            >
                                <app-dispatch-table-truck-trailer
                                    [type]="'truck'"
                                    [truckDropdownWidth]="
                                        columnSpecifications?.truckWidth
                                    "
                                    [truck]="item?.truck"
                                    [truckList]="
                                        truckList
                                            | allowedTruckTrailer
                                                : item?.allowedTruckIds
                                    "
                                    [isYearShown]="!columnsToShow[1].hidden"
                                    [rowIndex]="rowIndex"
                                    [isBoardLocked]="isDispatchBoardLocked"
                                    [isDrag]="isDrag"
                                    [isActiveLoad]="
                                        item?.activeLoad?.statusType?.name ===
                                        'Active'
                                    "
                                    [isHoveringRow]="
                                        !isDrag &&
                                        isHoveringRowIndex === rowIndex
                                    "
                                    (addTruckTrailerEmitter)="
                                        handleAddTruckTrailerClick($event)
                                    "
                                    (removeTruckTrailerEmitter)="
                                        handleRemoveTruckTrailerClick($event)
                                    "
                                >
                                </app-dispatch-table-truck-trailer>
                            </td>

                            <td
                                #columnField
                                class="trailer-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'trailerNumber'
                                            : hasAdditionalFieldTrailer
                                "
                            >
                                <div
                                    class="main_inside"
                                    [class.dragging]="
                                        isDrag && draggingType === 'trailer'
                                    "
                                    cdkDropList
                                    id="{{
                                        rowIndex | cdkId: gridIndex : 'trailer'
                                    }}"
                                    [cdkDropListData]="item"
                                    [cdkDropListConnectedTo]="
                                        rowIndex
                                            | cdkConnect
                                                : dispatchData.dispatches.length
                                                : gridIndex
                                                : 'trailer'
                                    "
                                    [cdkDropListEnterPredicate]="
                                        dragPositionPredictionTrailer
                                    "
                                    (cdkDropListDropped)="
                                        dragEndTrailer(rowIndex)
                                    "
                                >
                                    <div
                                        class="drag-hold-between"
                                        cdkDrag
                                        cdkDragLockAxis="y"
                                        cdkDragPreviewContainer="parent"
                                        cdkDragBoundary=".dispatch-table table tbody"
                                        [cdkDragDisabled]="
                                            isDispatchBoardLocked ||
                                            !item.trailer ||
                                            item?.activeLoad?.statusType
                                                ?.name === 'Active'
                                        "
                                        (cdkDragStarted)="
                                            dragStartTrailer(rowIndex)
                                        "
                                        (cdkDragEnded)="dragEnd()"
                                    >
                                        <div
                                            *cdkDragPlaceholder
                                            class="custom-dispatch-placeholder"
                                        ></div>

                                        <app-dispatch-table-truck-trailer
                                            [type]="'trailer'"
                                            [trailerDropdownWidth]="
                                                columnSpecifications?.trailerWidth
                                            "
                                            [truck]="item?.truck"
                                            [trailer]="item?.trailer"
                                            [trailerList]="
                                                trailerList
                                                    | allowedTruckTrailer
                                                        : item?.allowedTrailerIds
                                            "
                                            [isYearShown]="
                                                !columnsToShow[3].hidden
                                            "
                                            [rowIndex]="rowIndex"
                                            [isBoardLocked]="
                                                isDispatchBoardLocked
                                            "
                                            [isDrag]="isDrag"
                                            [isActiveLoad]="
                                                item?.activeLoad?.statusType
                                                    ?.name === 'Active'
                                            "
                                            [isHoveringRow]="
                                                !isDrag &&
                                                isHoveringRowIndex === rowIndex
                                            "
                                            [isTrailerAddNewHidden]="
                                                item?.truck | hiddenAddTrailer
                                            "
                                            [previousDragTrailerTypeId]="
                                                previousDragTrailerTypeId
                                            "
                                            (addTruckTrailerEmitter)="
                                                handleAddTruckTrailerClick(
                                                    $event
                                                )
                                            "
                                            (removeTruckTrailerEmitter)="
                                                handleRemoveTruckTrailerClick(
                                                    $event
                                                )
                                            "
                                        >
                                        </app-dispatch-table-truck-trailer>
                                    </div>
                                </div>
                            </td>

                            <td
                                #columnField
                                class="driver-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'firstName'
                                            : isDriverEndorsementActive
                                "
                            >
                                <div
                                    class="main_inside"
                                    [class.dragging]="
                                        isDrag && draggingType === 'driver'
                                    "
                                    cdkDropList
                                    id="{{
                                        rowIndex | cdkId: gridIndex : 'driver'
                                    }}"
                                    [cdkDropListData]="item"
                                    [cdkDropListConnectedTo]="
                                        rowIndex
                                            | cdkConnect
                                                : dispatchData.dispatches.length
                                                : gridIndex
                                                : 'driver'
                                    "
                                    [cdkDropListEnterPredicate]="
                                        dragPositionPredictionDriver
                                    "
                                    (cdkDropListDropped)="
                                        dragEndDriver(rowIndex)
                                    "
                                >
                                    <div
                                        class="drag-hold-between"
                                        cdkDrag
                                        cdkDragLockAxis="y"
                                        cdkDragPreviewContainer="parent"
                                        cdkDragBoundary=".dispatch-table table tbody"
                                        [cdkDragDisabled]="
                                            isDispatchBoardLocked ||
                                            !item.driver ||
                                            item?.activeLoad?.statusType
                                                ?.name === 'Active'
                                        "
                                        (cdkDragStarted)="
                                            dragStartDriver(rowIndex)
                                        "
                                        (cdkDragEnded)="dragEnd()"
                                    >
                                        <div
                                            *cdkDragPlaceholder
                                            class="custom-dispatch-placeholder"
                                        ></div>

                                        <app-dispatch-table-driver
                                            [driver]="item?.driver"
                                            [driverList]="driverList"
                                            [rowIndex]="rowIndex"
                                            [isBoardLocked]="
                                                isDispatchBoardLocked
                                            "
                                            [isDrag]="isDrag"
                                            [phone]="item?.phone"
                                            [email]="item?.email"
                                            [openedDriverDropdown]="
                                                openedDriverDropdown
                                            "
                                            [isActiveLoad]="
                                                item?.activeLoad?.statusType
                                                    ?.name === 'Active'
                                            "
                                            [hoursOfService]="
                                                item?.hoursOfService
                                            "
                                            [isHosShown]="
                                                !columnsToShow[5].hidden
                                            "
                                            [isEndorsmentShow]="
                                                !columnsToShow[6].hidden
                                            "
                                            [dispatchId]="item.id"
                                            [isHoveringRow]="
                                                !isDrag &&
                                                isHoveringRowIndex === rowIndex
                                            "
                                            [driverDropdownWidth]="
                                                columnSpecifications?.driverWidth
                                            "
                                            (addDriverEmitter)="
                                                handleAddDriverClick($event)
                                            "
                                            (removeDriverEmitter)="
                                                handleRemoveDriverClick($event)
                                            "
                                            (driverVacationEmitter)="
                                                changeDriverVacation(item)
                                            "
                                        >
                                        </app-dispatch-table-driver>
                                    </div>
                                </div>
                            </td>

                            @if (!columnsToShow[10].hidden) {
                                <td class="pre-trip">
                                    <app-dispatch-table-pre-trip-inspection
                                        [dispatchId]="item?.id"
                                        [dispatchBoardId]="
                                            item?.dispatchBoardId
                                        "
                                        [status]="item?.preTripInspection"
                                        [time]="item?.preTripInspectionTime"
                                        [isHoveringRow]="
                                            isDispatchBoardLocked &&
                                            isHoveringRowIndex === rowIndex
                                        "
                                        [isUnlockable]="_isUnlockable"
                                    ></app-dispatch-table-pre-trip-inspection>
                                </td>
                            }

                            <td
                                #columnField
                                class="location-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths: 'city'
                                "
                            >
                                <app-dispatch-table-last-location
                                    [address]="item.location"
                                    [rowIndex]="rowIndex"
                                    [showAddAddressField]="
                                        showAddAddressFieldIndex
                                    "
                                    [parkingList]="parkingList"
                                    [isHoveringRow]="
                                        isDispatchBoardLocked &&
                                        isHoveringRowIndex === rowIndex
                                    "
                                    [isDisplayingAddressInput]="
                                        isDisplayingAddressInput
                                    "
                                    [locationDropdownWidth]="
                                        columnSpecifications?.locationWidth
                                    "
                                    (updateLastLocationEmit)="
                                        handleUpdateLastLocationEmit($event)
                                    "
                                    (isDropdownHidden)="
                                        handleLastLocationDropdownClose()
                                    "
                                >
                                </app-dispatch-table-last-location>
                            </td>

                            <td
                                class="status-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths: 'status'
                                "
                            >
                                <app-dispatch-table-status
                                    [time]="item.lastStatusPassed"
                                    [status]="item.status"
                                    [dispatchId]="item.id"
                                    [dispatchBoardId]="item?.dispatchBoardId"
                                    [dispatcher]="item"
                                    [isHoveringRow]="
                                        isDispatchBoardLocked &&
                                        isHoveringRowIndex === rowIndex
                                    "
                                    [isUnlockable]="_isUnlockable"
                                    (updateStatusEmitter)="
                                        handleUpdateStatusEmit($event)
                                    "
                                >
                                </app-dispatch-table-status>
                            </td>

                            <td
                                class="pickup-delivery-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'pickup_delivery'
                                "
                                (click)="
                                    getLoadInformationForSignleDispatchResponse(
                                        item
                                    )
                                "
                            >
                                <app-dispatch-table-pickup-delivery
                                    [isDispatchBoardLocked]="
                                        isDispatchBoardLocked
                                    "
                                    [isHoveringRowIndex]="isHoveringRowIndex"
                                    [rowIndex]="rowIndex"
                                    [dispatchResponse]="item"
                                    [isDispatchBoardLocked]="
                                        isDispatchBoardLocked
                                    "
                                    [dispatchLoads]="
                                        currentDispatchGroupedLoadsResponse
                                    "
                                    [columnWidth]="
                                        resizedColumnsWidth[
                                            'pickup_delivery'
                                        ] ?? 340
                                    "
                                ></app-dispatch-table-pickup-delivery>
                            </td>

                            @if (!columnsToShow[14].hidden) {
                                <td
                                    class="progress-field"
                                    [ngStyle]="
                                        resizedColumnsWidth
                                            | dispatchTableColumnWidths
                                                : 'progress'
                                    "
                                >
                                    <div
                                        class="main_inside"
                                        [class.filled]="
                                            progressBarData?.[rowIndex]
                                        "
                                    >
                                        <div
                                            class="padding-inside"
                                            [class.hovering]="
                                                isDispatchBoardLocked &&
                                                isHoveringRowIndex ===
                                                    rowIndex &&
                                                progressBarData?.[rowIndex]
                                            "
                                        >
                                            <div
                                                class="info-item d-block p-0 w-100"
                                            >
                                                @if (
                                                    progressBarData?.[rowIndex]
                                                ) {
                                                    <app-ca-progress-bar
                                                        [currentPosition]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].currentPosition
                                                        "
                                                        [mileageInfo]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].mileageInfo
                                                        "
                                                        [currentStop]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].currentStop
                                                        "
                                                        [gpsTitle]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].gpsTitle
                                                        "
                                                        [gpsIcon]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].gpsIcon
                                                        "
                                                        [gpsInfo]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].gpsInfo
                                                        "
                                                        [mileagesPercent]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].mileagesPercent
                                                        "
                                                        [totalMiles]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].totalMiles
                                                        "
                                                        [gpsLocationIcon]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].gpsLocationIcon
                                                        "
                                                        [gpsProgress]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].gpsProgress
                                                        "
                                                        [dispatchStatus]="
                                                            progressBarData[
                                                                rowIndex
                                                            ].dispatchStatus
                                                        "
                                                        (onOpenMap)="
                                                            onOpenProgressMap(
                                                                progressBarData[
                                                                    rowIndex
                                                                ],
                                                                rowIndex
                                                            )
                                                        "
                                                    ></app-ca-progress-bar>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            }

                            @if (!columnsToShow[15].hidden) {
                                <td
                                    #columnField
                                    class="parking-field"
                                    [ngStyle]="
                                        resizedColumnsWidth
                                            | dispatchTableColumnWidths
                                                : 'slotNumber'
                                    "
                                >
                                    <app-dispatch-table-parking
                                        [parkingList]="parkingList"
                                        [parkingSlot]="item.parkingSlot"
                                        [isWideTable]="parkingList?.length > 1"
                                        [truckId]="item.truck?.id"
                                        [trailerId]="item.trailer?.id"
                                        [isHoveringRow]="
                                            isDispatchBoardLocked &&
                                            isHoveringRowIndex === rowIndex &&
                                            parkingList.length
                                        "
                                        [isUnlockable]="_isUnlockable"
                                        [parkingDropdownWidth]="
                                            columnSpecifications?.parkingWidth
                                        "
                                        (updateParking)="
                                            updateParking($event, item.id)
                                        "
                                    ></app-dispatch-table-parking>
                                </td>
                            }

                            @if (!columnsToShow[16].hidden) {
                                <td class="box-item">
                                    <div
                                        class="main_inside"
                                        [class.filled]="
                                            item.dispatcher?.fullName
                                        "
                                    >
                                        <div
                                            class="padding-inside"
                                            [ngClass]="{
                                                hovering:
                                                    isDispatchBoardLocked &&
                                                    item.dispatcher?.fullName &&
                                                    isHoveringRowIndex ===
                                                        rowIndex,
                                            }"
                                        >
                                            <div
                                                class="info-item justify-content-center"
                                            >
                                                @if (
                                                    item.dispatcher?.fullName
                                                ) {
                                                    <app-ta-profile-images
                                                        [indx]="rowIndex"
                                                        [name]="
                                                            item.dispatcher
                                                                ?.fullName
                                                        "
                                                        [size]="'small'"
                                                        [type]="'user'"
                                                        [withTooltip]="true"
                                                        [isDispatch]="true"
                                                    >
                                                    </app-ta-profile-images>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            }

                            @if (!columnsToShow[17].hidden) {
                                <td
                                    class="note-field"
                                    [class.expanded]="_isNoteExpanded"
                                    [ngStyle]="
                                        resizedColumnsWidth
                                            | dispatchTableColumnWidths
                                                : 'note'
                                                : _isNoteExpanded
                                    "
                                >
                                    <app-dispatch-table-note
                                        [truck]="item.truck"
                                        [note]="item.note"
                                        [noteWidth]="noteWidth"
                                        [isNoteExpanded]="_isNoteExpanded"
                                        [isHoveringRowIndex]="
                                            isDispatchBoardLocked &&
                                            isHoveringRowIndex
                                        "
                                        [rowIndex]="rowIndex"
                                        [dispatchId]="item.id"
                                        [isUnlockable]="_isUnlockable"
                                        (saveNoteValue)="saveNoteValue($event)"
                                    >
                                    </app-dispatch-table-note>
                                </td>
                            }

                            <td class="box-item">
                                <div
                                    class="main_inside"
                                    [class.filled]="
                                        item.driver &&
                                        item.truck &&
                                        _isUnlockable
                                    "
                                >
                                    <div class="padding-inside p-0">
                                        <app-dispatch-table-assign-load
                                            [driver]="item.driver"
                                            [truck]="item.truck"
                                            [trailer]="item.driver"
                                            [isActiveLoad]="
                                                item?.activeLoad?.statusType
                                                    ?.name === 'Active'
                                            "
                                            [dispatchId]="item.id"
                                            [isHoveringRow]="
                                                isDispatchBoardLocked &&
                                                isHoveringRowIndex === rowIndex
                                            "
                                            [isUnlockable]="_isUnlockable"
                                        ></app-dispatch-table-assign-load>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    }
                } @else {
                    <ng-container
                        *ngTemplateOutlet="emptyRowPlaceholderTemplate"
                    ></ng-container>
                }

                <!-- Unlocked Table - Extra Row - Add -->

                @if (!isDispatchBoardLocked && !isDrag) {
                    <tr>
                        <td
                            #columnField
                            class="truck-field"
                            [ngStyle]="
                                resizedColumnsWidth
                                    | dispatchTableColumnWidths
                                        : 'truckNumber'
                                        : hasAdditionalFieldTruck
                            "
                        >
                            <app-dispatch-table-truck-trailer
                                [type]="'truck'"
                                [truck]="addNewTruckData"
                                [truckDropdownWidth]="
                                    columnSpecifications?.truckWidth
                                "
                                [truckList]="truckList"
                                [isYearShown]="!columnsToShow[1].hidden"
                                [rowIndex]="rowIndex"
                                [isBoardLocked]="isDispatchBoardLocked"
                                [isDrag]="isDrag"
                                [isHoveringRow]="
                                    isHoveringRowIndex === rowIndex
                                "
                                (addTruckTrailerEmitter)="
                                    handleAddTruckTrailerClick($event)
                                "
                                (removeTruckTrailerEmitter)="
                                    handleRemoveTruckTrailerClick($event)
                                "
                            >
                            </app-dispatch-table-truck-trailer>
                        </td>

                        <td
                            #columnField
                            class="trailer-field"
                            [ngStyle]="
                                resizedColumnsWidth
                                    | dispatchTableColumnWidths
                                        : 'trailerNumber'
                                        : hasAdditionalFieldTrailer
                            "
                        >
                            <app-dispatch-table-truck-trailer
                                [type]="'trailer'"
                                [trailerDropdownWidth]="
                                    columnSpecifications?.trailerWidth
                                "
                                [trailerList]="trailerList"
                                [rowIndex]="rowIndex"
                                [isBoardLocked]="isDispatchBoardLocked"
                                [isYearShown]="!columnsToShow[3].hidden"
                                [isDrag]="isDrag"
                                [isHoveringRow]="
                                    isHoveringRowIndex === rowIndex
                                "
                                [isTrailerAddNewHidden]="isTrailerAddNewHidden"
                                (addTruckTrailerEmitter)="
                                    handleAddTruckTrailerClick($event)
                                "
                                (removeTruckTrailerEmitter)="
                                    handleRemoveTruckTrailerClick($event)
                                "
                            >
                            </app-dispatch-table-truck-trailer>
                        </td>

                        <td
                            #columnField
                            class="driver-field"
                            [ngStyle]="
                                resizedColumnsWidth
                                    | dispatchTableColumnWidths
                                        : 'firstName'
                                        : isDriverEndorsementActive
                            "
                        >
                            <app-dispatch-table-driver
                                [driverList]="driverList"
                                [rowIndex]="rowIndex"
                                [isBoardLocked]="isDispatchBoardLocked"
                                [isDrag]="isDrag"
                                [draggingType]="draggingType"
                                [openedDriverDropdown]="openedDriverDropdown"
                                [isHosShown]="!columnsToShow[5].hidden"
                                [isEndorsmentShow]="!columnsToShow[6].hidden"
                                [isHoveringRow]="
                                    isHoveringRowIndex === rowIndex
                                "
                                [driverDropdownWidth]="
                                    columnSpecifications?.driverWidth
                                "
                                (addDriverEmitter)="
                                    handleAddDriverClick($event)
                                "
                                (removeDriverEmitter)="
                                    handleRemoveDriverClick($event)
                                "
                                (driverVacationEmitter)="
                                    changeDriverVacation($event)
                                "
                                (setDriverDropdownIndexEmitter)="
                                    changeDriverDropdownIndex($event)
                                "
                            >
                            </app-dispatch-table-driver>
                        </td>

                        @if (!columnsToShow[10].hidden) {
                            <td class="pre-trip">
                                <app-dispatch-table-pre-trip-inspection></app-dispatch-table-pre-trip-inspection>
                            </td>
                        }

                        <td
                            #columnField
                            class="location-field"
                            [ngStyle]="
                                resizedColumnsWidth
                                    | dispatchTableColumnWidths: 'city'
                            "
                        >
                            @if (showAddAddressFieldIndex === -2) {
                                <app-dispatch-table-last-location
                                    [rowIndex]="showAddAddressFieldIndex"
                                    [showAddAddressField]="
                                        showAddAddressFieldIndex
                                    "
                                    [parkingList]="parkingList"
                                    [isDisplayingAddressInput]="
                                        isDisplayingAddressInput
                                    "
                                    [locationDropdownWidth]="
                                        columnSpecifications?.locationWidth
                                    "
                                    (updateLastLocationEmit)="
                                        handleUpdateLastLocationEmit($event)
                                    "
                                    (isDropdownHidden)="
                                        handleLastLocationDropdownClose()
                                    "
                                >
                                </app-dispatch-table-last-location>
                            } @else {
                                <div class="main_inside">
                                    <div class="padding-inside"></div>
                                </div>
                            }
                        </td>

                        <td
                            class="status-field"
                            [ngStyle]="
                                resizedColumnsWidth
                                    | dispatchTableColumnWidths: 'status'
                            "
                        >
                            <div class="main_inside">
                                <div class="padding-inside"></div>
                            </div>
                        </td>

                        <td
                            class="pickup-delivery-field"
                            [ngStyle]="
                                resizedColumnsWidth
                                    | dispatchTableColumnWidths
                                        : 'pickup_delivery'
                            "
                        >
                            <div class="main_inside">
                                <div class="padding-inside"></div>
                            </div>
                        </td>

                        @if (!columnsToShow[14].hidden) {
                            <td
                                class="progress-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths: 'progress'
                                "
                            >
                                <div class="main_inside">
                                    <div class="padding-inside"></div>
                                </div>
                            </td>
                        }

                        @if (!columnsToShow[15].hidden) {
                            <td
                                #columnField
                                class="parking-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'slotNumber'
                                "
                            >
                                <div class="main_inside">
                                    <div class="padding-inside"></div>
                                </div>
                            </td>
                        }

                        @if (!columnsToShow[16].hidden) {
                            <td class="box-item">
                                <div class="main_inside">
                                    <div class="padding-inside"></div>
                                </div>
                            </td>
                        }

                        @if (!columnsToShow[17].hidden) {
                            <td
                                class="note-field"
                                [class.expanded]="_isNoteExpanded"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'note'
                                            : _isNoteExpanded
                                "
                            >
                                <div class="main_inside">
                                    <div class="padding-inside"></div>
                                </div>
                            </td>
                        }

                        <td class="box-item">
                            <div class="main_inside">
                                <div class="padding-inside"></div>
                            </div>
                        </td>
                    </tr>
                }

                <!-- Empty Rows Placeholders -->

                <ng-template #emptyRowPlaceholderTemplate>
                    @if (isAllBoardsList) {
                        <tr class="reorder-row fake-row">
                            <td
                                #columnField
                                class="truck-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'truckNumber'
                                            : hasAdditionalFieldTruck
                                "
                            >
                                <div class="main_inside"></div>
                            </td>

                            <td
                                #columnField
                                class="trailer-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'trailerNumber'
                                            : hasAdditionalFieldTrailer
                                "
                            >
                                <div class="main_inside"></div>
                            </td>

                            <td
                                class="driver-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'firstName'
                                            : isDriverEndorsementActive
                                "
                            >
                                <div class="main_inside"></div>
                            </td>

                            @if (!columnsToShow[10].hidden) {
                                <td class="pre-trip">
                                    <div class="main_inside"></div>
                                </td>
                            }

                            <td
                                #columnField
                                class="location-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths: 'city'
                                "
                            >
                                <div class="main_inside"></div>
                            </td>

                            <td
                                class="status-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths: 'status'
                                "
                            >
                                <div class="main_inside"></div>
                            </td>

                            <td
                                class="pickup-delivery-field"
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'pickup_delivery'
                                "
                            >
                                <div class="main_inside"></div>
                            </td>

                            @if (!columnsToShow[14].hidden) {
                                <td
                                    class="progress-field"
                                    [ngStyle]="
                                        resizedColumnsWidth
                                            | dispatchTableColumnWidths
                                                : 'progress'
                                    "
                                >
                                    <div class="main_inside"></div>
                                </td>
                            }

                            @if (!columnsToShow[15].hidden) {
                                <td
                                    #columnField
                                    class="parking-field"
                                    [ngStyle]="
                                        resizedColumnsWidth
                                            | dispatchTableColumnWidths
                                                : 'slotNumber'
                                    "
                                >
                                    <div class="main_inside"></div>
                                </td>
                            }

                            @if (!columnsToShow[16].hidden) {
                                <td class="box-item">
                                    <div class="main_inside"></div>
                                </td>
                            }

                            @if (!columnsToShow[17].hidden) {
                                <td
                                    class="note-field"
                                    [class.expanded]="_isNoteExpanded"
                                    [ngStyle]="
                                        resizedColumnsWidth
                                            | dispatchTableColumnWidths
                                                : 'note'
                                                : _isNoteExpanded
                                    "
                                >
                                    <div class="main_inside">
                                        <div class="padding-inside"></div>
                                    </div>
                                </td>
                            }

                            <td class="box-item">
                                <div class="main_inside"></div>
                            </td>
                        </tr>
                    } @else {
                        <ng-container
                            *ngTemplateOutlet="
                                multipleEmptyRowsPlaceholderTemplate
                            "
                        ></ng-container>
                    }
                </ng-template>

                <ng-template #multipleEmptyRowsPlaceholderTemplate>
                    @if (isDispatchBoardLocked) {
                        @for (
                            row of [].constructor(3);
                            let i = $index;
                            track i
                        ) {
                            <tr
                                class="no-data-table-row"
                                [ngClass]="{
                                    'first-row': i === 0,
                                    'second-row': i === 1,
                                    'third-row': i === 2,
                                }"
                            >
                                @for (
                                    field of [].constructor(12);
                                    let ind = $index;
                                    track ind
                                ) {
                                    <td
                                        [ngClass]="{
                                            hidden:
                                                (columnsToShow[10].hidden &&
                                                    ind === 3) ||
                                                (columnsToShow[14].hidden &&
                                                    ind === 7) ||
                                                (columnsToShow[15].hidden &&
                                                    ind === 8) ||
                                                (columnsToShow[16].hidden &&
                                                    ind === 9) ||
                                                (columnsToShow[17].hidden &&
                                                    ind === 10),
                                        }"
                                        [ngStyle]="
                                            resizedColumnsWidth
                                                | dispatchTableColumnWidths
                                                    : null
                                                    : null
                                                    : ind
                                        "
                                    >
                                        <div></div>
                                    </td>
                                }
                            </tr>
                        }
                    }
                </ng-template>
            </tbody>

            <!-- Table Info -->

            @if (isAllBoardsList || dispatchData?.dispatches?.length) {
                <tfoot>
                    <tr class="d-flex">
                        <td
                            [ngStyle]="
                                resizedColumnsWidth
                                    | dispatchTableColumnWidths
                                        : 'truckNumber'
                                        : hasAdditionalFieldTruck
                            "
                        >
                            <app-dispatch-table-info
                                [type]="'truck'"
                                [count]="dispatchData.truckCount"
                            ></app-dispatch-table-info>
                        </td>

                        <td
                            [ngStyle]="
                                resizedColumnsWidth
                                    | dispatchTableColumnWidths
                                        : 'trailerNumber'
                                        : hasAdditionalFieldTrailer
                            "
                        >
                            <app-dispatch-table-info
                                [type]="'trailer'"
                                [count]="dispatchData.trailerCount"
                            ></app-dispatch-table-info>
                        </td>

                        <td
                            [ngStyle]="
                                resizedColumnsWidth
                                    | dispatchTableColumnWidths
                                        : 'firstName'
                                        : isDriverEndorsementActive
                            "
                        >
                            <app-dispatch-table-info
                                [type]="'driver'"
                                [count]="dispatchData.driverCount"
                            ></app-dispatch-table-info>
                        </td>

                        @for (field of shownFields; track $index) {
                            <td
                                [ngStyle]="
                                    field
                                        | dispatchTableFooterWidths
                                            : resizedColumnsWidth
                                "
                            ></td>
                        }

                        @if (!columnsToShow[15].hidden) {
                            <td
                                [ngStyle]="
                                    resizedColumnsWidth
                                        | dispatchTableColumnWidths
                                            : 'slotNumber'
                                "
                            >
                                <app-dispatch-table-info
                                    [type]="'parking'"
                                    [count]="parkingCount"
                                    [totalCount]="
                                        dispatchData.dispatches.length
                                    "
                                ></app-dispatch-table-info>
                            </td>
                        } @else {
                            <td></td>
                        }

                        <td colspan="3">
                            @if (isAllBoardsList) {
                                <app-dispatch-table-info
                                    [type]="'board'"
                                    [name]="
                                        dispatchData?.teamBoard
                                            ? 'Team Board'
                                            : dispatchData?.dispatcher?.fullName
                                    "
                                    [hasAlignRight]="true"
                                ></app-dispatch-table-info>
                            }
                        </td>
                    </tr>
                </tfoot>
            }
        </table>

        <!-- No Data -->

        @if (
            !dispatchData?.dispatches?.length &&
            !isAllBoardsList &&
            isDispatchBoardLocked
        ) {
            <div class="d-flex align-items-center justify-content-center">
                <div
                    class="no-data-container d-flex flex-column align-items-center"
                >
                    <svg-icon
                        [src]="dispatchTableSvgRoutes.noDispatchDataRoute"
                    >
                    </svg-icon>

                    <div
                        class="no-data-text-container d-flex flex-column align-items-center"
                    >
                        <div class="no-data-text ta-font-extra-bold">
                            No Data Found
                        </div>

                        <div
                            class="no-data-description ta-font-medium text-center"
                        >
                            There are no entries.

                            @if (dispatchData?.canUnlock) {
                                To manage your board, unlock the table and start
                                <br />
                                adding new records.
                            }
                        </div>
                    </div>

                    @if (dispatchData?.canUnlock) {
                        <div>
                            <button
                                type="button"
                                class="d-flex justify-content-center align-items-center unlock-table-button"
                                (click)="unlockTable()"
                            >
                                <p class="m-0 ta-font-bold">Unlock Table</p>
                            </button>
                        </div>
                    }
                </div>
            </div>
        }
    </div>
</div>
