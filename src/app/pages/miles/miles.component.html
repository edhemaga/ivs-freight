<app-new-table-toolbar
    [title]="'Miles'"
    [leftSide]="leftSide"
    [showPlusIcon]="false"
>
    <ng-template #leftSide>
        <app-toolbar-tabs-wrapper
            [data]="tableViewData$ | async"
            [selectedTab]="selectedTab$ | async"
            [viewMode]="activeViewMode$ | async"
            [shouldAddMap]="true"
            (onTabChange)="onToolBarAction($event)"
            class="d-flex align-items-center"
        ></app-toolbar-tabs-wrapper>

        <ng-container *ngTemplateOutlet="divider"></ng-container>

        <div class="d-flex gap-1 align-items-center">
            <app-ca-search-multiple-states
                [searchType]="'tabel'"
                [selectedTabData]="store?.activeTableData"
                [toolbarSearch]="true"
            ></app-ca-search-multiple-states>

            <ng-container *ngTemplateOutlet="divider"></ng-container>

            <!-- // TODO: -->
            <app-ca-filter
                [type]="'stateFilter'"
                [icon]="'state'"
                [filterTitle]="'State / Province Filter'"
                [leftSideIcon]="true"
                (setFilter)="onFilter($event)"
                (clearAll)="onFilter($event)"
                [usaStates]="(statesSelector$ | async)[0].states"
                [canadaStates]="(statesSelector$ | async)[1].states"
            >
            </app-ca-filter>

            <app-ca-filter-dropdown
                type="TimeFilter"
                subType="past"
                (setFilter)="setFilters($event)"
            >
            </app-ca-filter-dropdown>

            <app-ca-filter
                type="moneyFilter"
                icon="dollar"
                filterTitle="Money Filter"
                [isMoneyFilter]="true"
                [isMilesFilter]="false"
                [isFuelType]="false"
                [isLoadType]="false"
                [isRepairFilter]="true"
                (setFilter)="setFilters($event)"
                (clearAll)="setFilters($event)"
            >
            </app-ca-filter>
            @let selectedRows = selectedRowsSelector$ | async;
            @if (selectedRows) {
                <ng-container *ngTemplateOutlet="divider"></ng-container>
                <div
                    class="text-color-blue-18 background-blue-16 text-size-14 ta-font-bold br-2 p-x-8 p-y-4"
                >
                    {{ selectedRows }} Selected
                </div>
            }
        </div>
    </ng-template>

    <ng-template #divider>
        <div class="new-table--toolbar-divider">
            <div
                class="new-table--toolbar-divider-border background-light-grey-6"
            ></div>
        </div>
    </ng-template>
</app-new-table-toolbar>

<app-new-table
    [columns]="columns$ | async"
    [rows]="miles$ | async"
    [templates]="{
        select: loadSelectTemplate,
        unit: unitTemplate,
        truckType: truckTypeTemplate,
        stopsPickup: percentTemplate,
        stopsDelivery: percentTemplate,
        fuelCount: percentTemplate,
        parkingCount: percentTemplate,
        deadHeadCount: percentTemplate,
        repairCount: percentTemplate,
        towingCount: percentTemplate,
        revenue: revenueTemplate,
    }"
>
    <ng-template #loadSelectTemplate let-data="data">
        <input
            type="checkbox"
            [checked]="data.selected"
            (change)="selectRow(data)"
        />
    </ng-template>

    <ng-template #unitTemplate let-data="data">
        <div class="text-color-black ta-font-bold text-size-14">
            {{data.unit}}
        </div>
    </ng-template>

    <ng-template #truckTypeTemplate let-data="data">
        <app-ta-truck-trailer-icon
            iconType="truck"
            [inputData]="data.truckType"
        ></app-ta-truck-trailer-icon>
    </ng-template>

    <ng-template #percentTemplate let-data="data" let-key="key">
        <p class="text-size-14 text-color-black-2 ta-font-regular">
            {{ data[key]?.count }}
            <span class="text-color-muted text-size-11 ta-font-semi-bold">
                
                {{ data[key]?.percent }}%
            </span>
        </p>
    </ng-template>

    <ng-template #revenueTemplate let-data="data">
        <div class="text-color-black ta-font-semi-bold">
            {{data.revenue}}$
        </div>
    </ng-template>
</app-new-table>
