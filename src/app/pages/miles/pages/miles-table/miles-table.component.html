@let store =
    {
        columns: milesStoreService.columns$ | async,
        miles: milesStoreService.miles$ | async,
        tableSettings: milesStoreService.tableSettingsSelector$ | async,
        selectedTab: milesStoreService.selectedTab$ | async,
        tabResultsSelector: milesStoreService.tabResultsSelector$ | async,
        filter: milesStoreService.filter$ | async,
    };

@if (store) {
    @let headerTemplates =
        {
            revenue: revenueHeaderTemplate,
        };

    @let templates =
        {
            unit,
            truckType,
            stopsCount: thousandFormatterTemplate,
            stopsPickup: percentTemplate,
            stopsDelivery: percentTemplate,
            deadHeadCount: percentTemplate,
            parkingCount: percentTemplate,
            fuelCount: percentTemplate,
            repairCount: percentTemplate,
            towingCount: percentTemplate,
            loadCount: thousandFormatterTemplate,
            fuelGalons: thousandFormatterTemplate,
            fuelCost,
            milesLoaded: thousandFormatterDecimalTemplate,
            milesEmpty: thousandFormatterDecimalTemplate,
            milesTotal: thousandFormatterDecimalTemplate,
            revenue,
        };

    @let selectedTabTotalDataCount =
        store.selectedTab === eMileTabs?.ACTIVE
            ? store.tabResultsSelector.activeTruckCount
            : store.tabResultsSelector.inactiveTruckCount;

    @let isTableLocked = store.tableSettings.isTableLocked;

    <app-new-table
        [columns]="store.columns"
        [rows]="store.miles"
        [isTableLocked]="isTableLocked"
        [totalDataCount]="selectedTabTotalDataCount"
        [headerTemplates]="headerTemplates"
        [templates]="templates"
        (onColumnSort)="onColumnSort($event)"
        (onColumnPin)="onColumnPin($event)"
        (onColumnRemove)="onColumnRemove($event)"
        (onColumnResize)="onColumnResize($event)"
        (onColumnReorder)="onColumnReorder($event)"
        (onShowMore)="onShowMoreClick()"
    >
        <!-- Header Templates -->

        <!-- #region REVENUE HEADER COLUMN -->

        <ng-template
            #revenueHeaderTemplate
            let-data="data"
            let-tableColumnClass="tableColumnClass"
            let-tableColumnLabelWidth="tableColumnLabelWidth"
        >
            <div class="d-flex" [ngClass]="tableColumnClass">
                <span
                    class="text-size-11 ta-font-bold color-inherit text-uppercase text-truncate d-inline-block"
                    [ngStyle]="tableColumnLabelWidth"
                >
                    Revenue
                </span>
            </div>
        </ng-template>

        <!-- #endregion END OF REVENUE HEADER COLUMN -->

        <!-- Column Templates -->

        <!-- #region UNIT COLUMN -->

        <ng-template #unit let-data="data" let-column="column">
            <div class="d-flex align-items-center">
                <p
                    class="c-pointer text-color-black text-hover-blue-15 ta-font-bold text-size-14 d-inline-block text-truncate"
                    ngbTooltip
                    mainTooltip="Open Map"
                    [tooltipBackground]="eColor.BLACK"
                    [position]="ePosition.BOTTOM"
                    [innerHtml]="
                        data.unit
                            | tableHighlightSearchText
                                : store.filter?.searchQuery
                    "
                    (click)="navigateToMilesDetails(data.truckId)"
                ></p>
            </div>
        </ng-template>

        <!-- #endregion END OF UNIT COLUMN -->

        <!-- #region TRUCK TYPE COLUMN -->

        <ng-template #truckType let-data="data">
            <app-ta-truck-trailer-icon
                iconType="truck"
                [inputData]="data.truckType"
            ></app-ta-truck-trailer-icon>
        </ng-template>

        <!-- #endregion END OF TRUCK TYPE COLUMN -->

        <!-- #region PERCENT COLUMN -->

        <ng-template
            #percentTemplate
            let-data="data"
            let-key="key"
            let-cellColumnTextColorClass="cellColumnTextColorClass"
        >
            @let countValue =
                data[key]?.count
                    | number: eThousandSeparatorFormat.REGULAR_FORMAT;

            @let percentValue = data[key]?.percent + eUnit.PERCENTAGE_SIGN;

            <p class="text-size-14" [class]="cellColumnTextColorClass">
                {{ countValue }}

                <!--   <span class="text-color-muted text-size-11 ta-font-semi-bold">
                    {{ percentValue }}
                </span> -->
            </p>
        </ng-template>

        <!-- #endregion END OF PERCENT COLUMN -->

        <!-- #region THOUSAND FORMATTER COLUMN -->

        <ng-template
            #thousandFormatterTemplate
            let-data="data"
            let-key="key"
            let-cellColumnTextColorClass="cellColumnTextColorClass"
        >
            <p class="text-size-14" [class]="cellColumnTextColorClass">
                @let thousandFormatterTemplateValue =
                    data[key]?.value
                        | number: eThousandSeparatorFormat.REGULAR_FORMAT;

                {{ thousandFormatterTemplateValue }}
            </p>
        </ng-template>

        <ng-template
            #thousandFormatterDecimalTemplate
            let-data="data"
            let-key="key"
            let-cellColumnTextColorClass="cellColumnTextColorClass"
        >
            <p class="text-size-14" [class]="cellColumnTextColorClass">
                @let thousandFormatterDecimalTemplateValue =
                    data[key]?.value
                        | number: eThousandSeparatorFormat.DECIMAL_FORMAT;

                {{ thousandFormatterDecimalTemplateValue }}
            </p>
        </ng-template>

        <!-- #endregion END OF THOUSAND FORMATTER COLUMN -->

        <!-- #region FUEL COST COLUMN -->

        <ng-template
            #fuelCost
            let-data="data"
            let-cellColumnTextColorClass="cellColumnTextColorClass"
        >
            @let fuelCostTemplateValue = data.fuelCost | currency;

            <p class="text-size-14" [class]="cellColumnTextColorClass">
                {{ fuelCostTemplateValue }}
            </p>
        </ng-template>

        <!-- #endregion END OF FUEL COST COLUMN -->

        <!-- #region REVENUE COLUMN -->

        <ng-template
            #revenue
            let-data="data"
            let-key="key"
            let-cellColumnTextColorClass="cellColumnTextColorClass"
        >
            <div
                class="d-flex"
                [class]="
                    isTableLocked
                        ? 'justify-content-end'
                        : 'justify-content-start'
                "
            >
                @let revenueTemplateValue = data[key]?.value | currency;

                <p
                    class="text-size-14 ta-font-semi-bold"
                    [class]="cellColumnTextColorClass"
                >
                    {{ revenueTemplateValue }}
                </p>
            </div>
        </ng-template>

        <!-- #endregion END OF REVENUE COLUMN -->
    </app-new-table>
}
