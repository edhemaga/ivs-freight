@let store =
    {
        columns: milesStoreService.columns$ | async,
        miles: milesStoreService.miles$ | async,
        tableSettings: milesStoreService.tableSettingsSelector$ | async,
        selectedTab: milesStoreService.selectedTab$ | async,
        tabResultsSelector: milesStoreService.tabResultsSelector$ | async,
    };

@if (store) {
    @let headerTemplates =
        {
            revenue: revenueHeaderTemplate,
        };

    @let templates =
        {
            unit: unitTemplate,
            truckType: truckTypeTemplate,
            stopsPickup: percentTemplate,
            stopsDelivery: percentTemplate,
            fuelCount: percentTemplate,
            parkingCount: percentTemplate,
            deadHeadCount: percentTemplate,
            repairCount: percentTemplate,
            towingCount: percentTemplate,
            fuelCost: fuelCostTemplate,
            revenue: revenueTemplate,
        };

    @let selectedTabTotalDataCount =
        store.selectedTab === eMileTabs?.ACTIVE
            ? store.tabResultsSelector.activeTruckCount
            : store.tabResultsSelector.inactiveTruckCount;

    @let isTableLocked = store.tableSettings.isTableLocked;

    <app-new-table
        [columns]="store.columns"
        [rows]="store.miles"
        [isTableLocked]="isTableLocked"
        [totalDataCount]="selectedTabTotalDataCount"
        [headerTemplates]="headerTemplates"
        [templates]="templates"
        (onColumnPinned)="onColumnPinned($event)"
        (onSortingChange)="onSortingChange($event)"
        (onColumnResize)="onColumnResize($event)"
        (onHandleShowMoreClick)="onHandleShowMoreClick()"
    >
        <!-- Header Templates -->

        <ng-template #revenueHeaderTemplate let-data="data">
            @let isEmptyTable = !store.miles.length;

            <div
                class="d-flex justify-content-end w-100 m-l-4 order-2"
                [ngClass]="
                    {
                        column: data,
                        isTableLocked,
                        isGroup: true,
                        isEmptyTable,
                        isAlignedRight: true,
                    } | tableColumnClass
                "
            >
                <span
                    class="text-size-11 ta-font-bold color-inherit text-uppercase"
                >
                    Revenue
                </span>
            </div>
        </ng-template>

        <!-- Column Templates -->

        <!-- Unit Template -->

        <ng-template #unitTemplate let-data="data" let-column="column">
            @let unitTemplateStyle = { 'max-width': column.width + eUnit.PX };

            <div class="d-flex align-items-center">
                <p
                    class="text-color-black ta-font-bold text-size-14 d-inline-block text-truncate"
                    [ngStyle]="unitTemplateStyle"
                >
                    {{ data.unit }}
                </p>
            </div>
        </ng-template>

        <!-- Truck Type Template -->

        <ng-template #truckTypeTemplate let-data="data">
            <app-ta-truck-trailer-icon
                iconType="truck"
                [inputData]="data.truckType"
            ></app-ta-truck-trailer-icon>
        </ng-template>

        <!-- Percent Template -->

        <ng-template #percentTemplate let-data="data" let-key="key">
            @let percentTemplateClass =
                !!data[key]?.count ? 'text-color-black-2' : 'text-color-muted';

            @let percentValue = data[key]?.percent + eUnit.PERCENTAGE_SIGN;

            <p class="text-size-14" [class]="percentTemplateClass">
                {{ data[key]?.count }}

                <span class="text-color-muted text-size-11 ta-font-semi-bold">
                    {{ percentValue }}
                </span>
            </p>
        </ng-template>

        <!-- Fuel Cost Template -->

        <ng-template #fuelCostTemplate let-data="data">
            @let fuelCostTemplateClass =
                !!data.fuelCost ? 'text-color-black-2' : 'text-color-muted';

            <p class="text-size-14" [class]="fuelCostTemplateClass">
                ${{ data.fuelCost }}
            </p>
        </ng-template>

        <!-- Revenue Template -->

        <ng-template #revenueTemplate let-data="data">
            @let revenueTemplateColorClass =
                !!data.revenue ? 'text-color-black' : 'text-color-muted';

            <div class="d-flex justify-content-end">
                <p
                    class="text-size-14 ta-font-semi-bold"
                    [class]="revenueTemplateColorClass"
                >
                    ${{ (data.revenue | thousandSeparator) ?? 0 }}
                </p>
            </div>
        </ng-template>
    </app-new-table>
}
