@if (total) {
    <div class="background-white br-3 p-12 miles-map-total">
        <div class="text-size-11 ta-font-bold text-color-black m-b-2">
            Total Miles
        </div>
        <div class="text-size-18 ta-font-medium text-color-black m-b-8">
            {{ total.totalMiles }}
        </div>

        @if (total.totalMiles && total.stops.count) {
            <div class="d-flex gap-3">
                <ng-container
                    *ngTemplateOutlet="
                        loadedAndEmpty;
                        context: {
                            label: 'Loaded',
                            value: total.loadedMiles,
                            bgClass: 'background-muted',
                        }
                    "
                >
                </ng-container>

                <ng-container
                    *ngTemplateOutlet="
                        loadedAndEmpty;
                        context: {
                            label: 'Empty',
                            value: total.emptyMiles,
                            bgClass: 'background-dark-2',
                        }
                    "
                >
                </ng-container>
            </div>
            <div class="divider mt-3 mb-2"></div>

            <div class="d-flex align-items-center gap-1">
                <div class="text-color-black text-size-16 ta-font-extra-bold">
                    Stop
                </div>
                <div
                    class="d-flex align-items-center text-size-11 ta-font-bold text-color-white background-bw6-2 p-x-5 br-60 h-18"
                >
                    {{ total.stops.count }}
                </div>
            </div>
            <ng-container
                *ngTemplateOutlet="
                    milesProgressBar;
                    context: {
                        label: 'Pickup',
                        percent: total.pickupPercentage,
                        count: total.pickupCount,
                        icon: sharedSvgRoutes.PICKUP_ICON,
                        color: 'green',
                    }
                "
            >
            </ng-container>

            <ng-container
                *ngTemplateOutlet="
                    milesProgressBar;
                    context: {
                        label: 'Delivery',
                        percent: total.deliveryPercentage,
                        count: total.deliveryCount,
                        icon: sharedSvgRoutes.DELIVERY_ICON,
                        color: 'orange-4',
                    }
                "
            >
            </ng-container>

            <ng-container
                *ngTemplateOutlet="
                    milesProgressBar;
                    context: {
                        label: 'Fuel',
                        percent: total.fuelPercentage,
                        count: total.fuelCount,
                        icon: 'background-dark-2',
                    }
                "
            >
            </ng-container>

            <ng-container
                *ngTemplateOutlet="
                    milesProgressBar;
                    context: {
                        label: 'Deadhead',
                        percent: total.deadHeadPercentage,
                        count: total.deadHeadCount,
                        icon: 'background-dark-2',
                    }
                "
            >
            </ng-container>

            <ng-container
                *ngTemplateOutlet="
                    milesProgressBar;
                    context: {
                        label: 'Parking',
                        percent: total.parkingPercentage,
                        count: total.pickupCount,
                        icon: 'background-dark-2',
                    }
                "
            >
            </ng-container>

            <ng-container
                *ngTemplateOutlet="
                    milesProgressBar;
                    context: {
                        label: 'Repair',
                        percent: total.repairPercentage,
                        count: total.repairCount,
                        icon: 'background-dark-2',
                    }
                "
            >
            </ng-container>

            <ng-container
                *ngTemplateOutlet="
                    milesProgressBar;
                    context: {
                        label: 'Towing',
                        percent: total.towingPercentage,
                        count: total.towingCount,
                        icon: 'background-dark-2',
                    }
                "
            >
            </ng-container>
        }
    </div>
}

<ng-template
    #milesProgressBar
    let-icon="icon"
    let-label="label"
    let-percent="percent"
    let-count="count"
    let-color="color"
>
    @let svgClass = 'svg-fill-' + color;

    <div class="d-flex align-items-center justify-content-between">
        <svg-icon [src]="icon" [class]="svgClass"></svg-icon>
        <div class="text-size-14 text-color-black-2 m-l-4">{{ label }}</div>
        <div class="text-size-14 text-right text-muted w-58">
            {{ percent }}%
        </div>
        <div
            class="text-size-14 text-color-black ta-font-medium text-right w-50"
        >
            {{ count }}
        </div>
    </div>
</ng-template>

<ng-template
    #loadedAndEmpty
    let-label="label"
    let-value="value"
    let-bgClass="bgClass"
>
    <div class="col-6">
        <div
            class="text-size-11 ta-font-bold text-color-black m-b-2 d-flex align-items-center"
        >
            <span>{{ label }}</span>
            <span
                class="m-l-4 h-10 w-10 rounded-circle"
                [ngClass]="{ bgClass }"
            ></span>
        </div>
        <div class="text-size-14 text-color-black-2">{{ value }}</div>
    </div>
</ng-template>
