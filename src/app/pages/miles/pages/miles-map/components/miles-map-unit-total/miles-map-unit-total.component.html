@if (total) {
    <div class="background-white br-3 p-12 miles-map-total pb-0">
        <div class="text-size-11 ta-font-bold text-color-black m-b-2">
            Total Miles
        </div>
        <div class="text-size-18 ta-font-medium text-color-black m-b-8">
            {{ total.totalMiles }}
        </div>

        @if (total.totalMiles || total.stops.count) {
            @if (total.totalMiles) {
                @let totalUnitCount = total.loadedMiles + total.emptyMiles;
                @let percent = (total.loadedMiles / totalUnitCount) * 100;
                <ng-container
                    *ngTemplateOutlet="
                        milesProgressBar;
                        context: {
                            label: '',
                            percent: percent,
                            count: totalUnitCount,
                            color: 'muted',
                        }
                    "
                >
                </ng-container>
            }

            <div class="d-flex mb-1 gap-3">
                <ng-container
                    *ngTemplateOutlet="
                        columns;
                        context: {
                            label: 'Loaded',
                            value: total.loadedMiles,
                            bgClass: 'background-muted',
                            showCircle: true,
                        }
                    "
                >
                </ng-container>

                <ng-container
                    *ngTemplateOutlet="
                        columns;
                        context: {
                            label: 'Empty',
                            value: total.emptyMiles,
                            bgClass: 'background-dark-2',
                            showCircle: true,
                        }
                    "
                >
                </ng-container>
            </div>

            <app-ta-custom-card
                [cardName]="'Stop'"
                [isCardOpen]="true"
                [hasBodyData]="true"
                [hasArrow]="true"
                [hasDarkDivider]="true"
                [hasCounter]="total.stops.count"
                [hasSmallDivider]="true"
                [animationMarginParams]="{
                    marginTop: '0',
                    marginBottom: '0',
                }"
            >
                <ng-container
                    *ngTemplateOutlet="
                        milesProgressBar;
                        context: {
                            label: 'Pickup',
                            percent: total.pickupPercentage,
                            count: total.pickupCount,
                            icon: sharedSvgRoutes.PICKUP_ICON,
                            color: 'green',
                        }
                    "
                >
                </ng-container>

                <ng-container
                    *ngTemplateOutlet="
                        milesProgressBar;
                        context: {
                            label: 'Delivery',
                            percent: total.deliveryPercentage,
                            count: total.deliveryCount,
                            icon: sharedSvgRoutes.DELIVERY_ICON,
                            color: 'orange-4',
                        }
                    "
                >
                </ng-container>

                <ng-container
                    *ngTemplateOutlet="
                        milesProgressBar;
                        context: {
                            label: 'Fuel',
                            percent: total.fuelPercentage,
                            count: total.fuelCount,
                            icon: sharedSvgRoutes.FUEL_ICON,
                            color: 'blue-13',
                        }
                    "
                >
                </ng-container>

                <ng-container
                    *ngTemplateOutlet="
                        milesProgressBar;
                        context: {
                            label: 'Deadhead',
                            percent: total.deadHeadPercentage,
                            count: total.deadHeadCount,
                            icon: sharedSvgRoutes.MILEAGE_ICON,
                            color: 'light-grey-2',
                        }
                    "
                >
                </ng-container>

                <ng-container
                    *ngTemplateOutlet="
                        milesProgressBar;
                        context: {
                            label: 'Parking',
                            percent: total.parkingPercentage,
                            count: total.pickupCount,
                            icon: sharedSvgRoutes.PARKING_ICON,
                            color: 'blue-26',
                        }
                    "
                >
                </ng-container>

                <ng-container
                    *ngTemplateOutlet="
                        milesProgressBar;
                        context: {
                            label: 'Repair',
                            percent: total.repairPercentage,
                            count: total.repairCount,
                            icon: sharedSvgRoutes.REPAIR_ICON,
                            color: 'orange-5',
                        }
                    "
                >
                </ng-container>

                <ng-container
                    *ngTemplateOutlet="
                        milesProgressBar;
                        context: {
                            label: 'Towing',
                            percent: total.towingPercentage,
                            count: total.towingCount,
                            icon: sharedSvgRoutes.TOWING_ICON,
                            color: 'bw-9',
                        }
                    "
                >
                </ng-container>
            </app-ta-custom-card>

            <app-ta-custom-card
                [cardName]="'Additional'"
                [isCardOpen]="true"
                [hasBodyData]="true"
                [hasArrow]="true"
                [hasDarkDivider]="true"
                [hasSmallDivider]="true"
                [animationMarginParams]="{
                    marginTop: '0',
                    marginBottom: '0',
                }"
            >
                <div class="d-flex flex-wrap p-b-12">
                    <ng-container
                        *ngTemplateOutlet="
                            columns;
                            context: {
                                label: 'Fuel',
                                value: total.fuelTotalGalons,
                            }
                        "
                    >
                    </ng-container>
                    <ng-container
                        *ngTemplateOutlet="
                            columns;
                            context: {
                                label: 'MPG',
                                value: total.milesPerGalon,
                            }
                        "
                    >
                    </ng-container>
                    <ng-container
                        *ngTemplateOutlet="
                            columns;
                            context: {
                                label: 'Load',
                                value: total.loadCount,
                            }
                        "
                    >
                    </ng-container>
                    <ng-container
                        *ngTemplateOutlet="
                            columns;
                            context: {
                                label: 'Revenue',
                                value: '$' + total.revenue,
                            }
                        "
                    >
                    </ng-container>
                </div>
            </app-ta-custom-card>
        }
    </div>
}

<ng-template
    #milesProgressBar
    let-icon="icon"
    let-label="label"
    let-percent="percent"
    let-count="count"
    let-color="color"
>
    @if (label) {
        @let svgClass = percent ? 'svg-fill-' + color : 'svg-fill-bw-9';

        <div class="gap-3 m-t-3 d-grid stops-container align-items-center">
            <div class="d-flex align-items-center">
                <svg-icon
                    [src]="icon"
                    [ngClass]="svgClass"
                    class="svg-size-14 d-flex"
                ></svg-icon>
                <div
                    class="text-size-14 m-l-4 ta-font-medium"
                    [ngClass]="percent ? 'text-color-black-2' : 'text-muted'"
                >
                    {{ label }}
                </div>
            </div>
            <div
                class="text-size-14 text-right"
                [ngClass]="percent ? 'text-muted' : 'text-color-light-grey-6'"
            >
                {{ percent }}%
            </div>
            <div
                class="text-size-14 ta-font-medium text-right"
                [ngClass]="percent ? 'text-color-black' : 'text-color-muted'"
            >
                {{ count }}
            </div>
        </div>
    }

    <div
        class="stop-progress-bar h-8 w-100 d-inline-block br-2 background-dark-2 overflow-hidden m-b-6"
    >
        @let bgClass = percent ? 'background-' + color : 'background-muted';
        <div
            class="h-8"
            [ngStyle]="{ width: percent + '%' }"
            [ngClass]="bgClass"
        ></div>
    </div>
</ng-template>

<ng-template
    #columns
    let-label="label"
    let-value="value"
    let-bgClass="bgClass"
    let-showCircle="showCircle"
>
    <div class="col-6 h-42 d-flex justify-content-center flex-column">
        <div
            class="text-size-11 ta-font-bold text-color-black m-b-2 d-flex align-items-center"
        >
            <span>{{ label }}</span>
            @if (showCircle) {
                <span
                    class="m-l-4 h-10 w-10 rounded-circle d-block"
                    [ngClass]="bgClass"
                ></span>
            }
        </div>
        <div class="text-size-14 text-color-black-2">{{ value }}</div>
    </div>
</ng-template>
