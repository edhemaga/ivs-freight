<div class="table-container routing-container">
    <div class="table-toolbar-container toolbar-relative">
        <app-ta-map-toolbar
            #mapToolbar
            (toolBarAction)="onToolBarAction($event)"
            [options]="tableOptions"
            [tableData]="tableData"
            [selectedTab]="selectedTab"
            [stopPickerActive]="stopPickerActive"
            [isTollRoadsActive]="isTollRoadsActive"
            [isTimeZoneActive]="isTimeZoneActive"
            [isDopplerOn]="isDopplerOn"
            [trafficLayerShow]="trafficLayerShow"
        ></app-ta-map-toolbar>
    </div>

    <div class="customer-map-container">
        <div class="route-card-container">
            <div
                class="route-card-scroll"
                cdkDropList
                id="cdk-drop-list-0"
                #routeList="cdkDropList"
                [cdkDropListData]="tableData[selectedMapIndex]?.routes"
                [cdkDropListConnectedTo]="[routeFreeDrag]"
                (cdkDropListDropped)="dropRoutes($event)"
            >
                <ng-container
                    *ngFor="
                        let route of tableData[selectedMapIndex]?.routes;
                        let i = index
                    "
                >
                    <div
                        *ngIf="!route.freeMove"
                        cdkDrag
                        class="route-info-card"
                        [attr.data-id]="route.id"
                        (click)="
                            !route.hidden
                                ? focusRoute(i)
                                : showHideRoute($event, route)
                        "
                        (mouseenter)="hoverRoute(route)"
                        (mouseleave)="leaveRouteHover(route)"
                        (mousedown)="
                            off = {
                                x: $event.offsetX || 0,
                                y: $event.offsetY || 0
                            }
                        "
                        [cdkDragData]="route"
                        (cdkDragMoved)="moved($event)"
                        [ngClass]="{
                            'route-hidden': route.hidden,
                            'expanded-card': route.expanded,
                            'route-in-focus': route.isFocused
                        }"
                        [ngStyle]="{
                            width: route.width ? route.width : '312px',
                            'padding-right':
                                route.hover && !route.hidden ? '14px' : '4px'
                        }"
                    >
                        <div class="route-info-header">
                            <div class="header-content-container">
                                <div
                                    cdkDragHandle
                                    class="route-card-svg"
                                    [tooltipBackground]="'#616161'"
                                    ngbTooltip
                                    [mainTooltip]="'Route Reorder'"
                                    position="right"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="18"
                                        height="18"
                                        viewBox="0 0 18 18"
                                        *ngIf="!route.hidden"
                                    >
                                        <g
                                            id="Drag"
                                            transform="translate(-935.139 -1357)"
                                            opacity="0.7"
                                        >
                                            <rect
                                                id="Rectangle_63459"
                                                data-name="Rectangle 63459"
                                                width="18"
                                                height="18"
                                                rx="2"
                                                transform="translate(935.139 1357)"
                                                fill="#f27b8e"
                                                opacity="0"
                                            />
                                            <path
                                                id="grip-vertical"
                                                d="M3,0H1A1,1,0,0,0,0,1V3A1,1,0,0,0,1,4H3A1,1,0,0,0,4,3V1A1,1,0,0,0,3,0ZM3,5H1A1,1,0,0,0,0,6V8A1,1,0,0,0,1,9H3A1,1,0,0,0,4,8V6A1,1,0,0,0,3,5Zm0,5H1a1,1,0,0,0-1,1v2a1,1,0,0,0,1,1H3a1,1,0,0,0,1-1V11A1,1,0,0,0,3,10ZM9,0H7A1,1,0,0,0,6,1V3A1,1,0,0,0,7,4H9a1,1,0,0,0,1-1V1A1,1,0,0,0,9,0ZM9,5H7A1,1,0,0,0,6,6V8A1,1,0,0,0,7,9H9a1,1,0,0,0,1-1V6A1,1,0,0,0,9,5Zm0,5H7a1,1,0,0,0-1,1v2a1,1,0,0,0,1,1H9a1,1,0,0,0,1-1V11A1,1,0,0,0,9,10Z"
                                                transform="translate(951.139 1361) rotate(90)"
                                                [ngStyle]="{
                                                    fill: route.isFocused
                                                        ? '#fff'
                                                        : route.color
                                                }"
                                                stroke="rgba(0,0,0,0)"
                                                stroke-width="1"
                                            />
                                        </g>
                                    </svg>
                                    <svg-icon
                                        [ngClass]="{
                                            'svg-hover': route.nameHover
                                        }"
                                        [src]="
                                            !route.nameHover
                                                ? 'assets/svg/common/routing/ic_route_hidden.svg'
                                                : 'assets/svg/common/ic_eye-visible.svg'
                                        "
                                        [svgStyle]="{
                                            'width.px': 18,
                                            'height.px': 18
                                        }"
                                        *ngIf="route.hidden"
                                    ></svg-icon>
                                </div>
                                <div
                                    class="route-name marker-info-text marker-bold-text mg-left-8"
                                    [ngStyle]="{
                                        color: route.nameHover
                                            ? route.color
                                            : route.hidden
                                            ? '#B7B7B7'
                                            : '#3C3C3C'
                                    }"
                                    (click)="showHideRoute($event, route)"
                                    (mouseenter)="route.nameHover = true"
                                    (mouseleave)="route.nameHover = false"
                                >
                                    {{ route.name }}
                                </div>
                                <div class="header-properties-container">
                                    <div
                                        class="route-type-text mg-left-12"
                                        *ngIf="
                                            route.truckId &&
                                            route.expanded &&
                                            route.expandFinished &&
                                            !route.hidden
                                        "
                                    >
                                        Unit:
                                        <span class="marker-bold-text">{{
                                            route.truckId
                                        }}</span>
                                    </div>
                                    <div
                                        class="route-type-text"
                                        [ngClass]="{
                                            'mg-left-12':
                                                !route.truckId ||
                                                !route.expanded
                                        }"
                                        *ngIf="!route.hidden"
                                    >
                                        {{ route.routeType }}
                                    </div>
                                    <div
                                        class="route-type-text mg-left-12"
                                        *ngIf="route.hidden"
                                    >
                                        {{ route.stops.length }} Stops
                                    </div>
                                    <div
                                        class="route-type-text"
                                        *ngIf="
                                            route.hidden && route.stops.length
                                        "
                                    >
                                        {{
                                            route.stops[route.stops.length - 1]
                                                .total
                                        }}
                                        {{
                                            tableData[selectedMapIndex]
                                                .distanceUnit
                                        }}
                                    </div>
                                    <div
                                        class="route-type-text"
                                        *ngIf="
                                            route.stopTime &&
                                            route.expanded &&
                                            route.expandFinished &&
                                            !route.hidden
                                        "
                                    >
                                        Stop Time:
                                        <span class="marker-bold-text"
                                            >{{ route.stopTime }} min</span
                                        >
                                    </div>
                                    <div
                                        class="route-type-text"
                                        *ngIf="
                                            route.mpg &&
                                            route.expanded &&
                                            route.expandFinished &&
                                            !route.hidden
                                        "
                                    >
                                        MPG:
                                        <span class="marker-bold-text"
                                            >{{ route.mpg }} mi</span
                                        >
                                    </div>
                                    <div
                                        class="route-type-text"
                                        *ngIf="
                                            route.fuelPrice &&
                                            route.expanded &&
                                            route.expandFinished &&
                                            !route.hidden
                                        "
                                    >
                                        PPG:
                                        <span class="marker-bold-text"
                                            >${{ route.fuelPrice }}</span
                                        >
                                    </div>
                                    <div
                                        class="route-card-header-divider"
                                        *ngIf="
                                            route.stopTime &&
                                            !route.expanded &&
                                            !route.hidden
                                        "
                                    ></div>
                                    <svg-icon
                                        class="route-card-icon"
                                        src="assets/svg/common/ic_time.svg"
                                        [svgStyle]="{
                                            'width.px': 18,
                                            'height.px': 18
                                        }"
                                        *ngIf="
                                            route.stopTime &&
                                            !route.expanded &&
                                            !route.hidden
                                        "
                                    ></svg-icon>
                                    <div
                                        class="route-card-header-divider"
                                        *ngIf="
                                            route.fuelPrice &&
                                            !route.expanded &&
                                            !route.hidden
                                        "
                                    ></div>
                                    <svg-icon
                                        class="route-card-icon"
                                        src="assets/svg/common/ic_dollar.svg"
                                        [svgStyle]="{
                                            'width.px': 18,
                                            'height.px': 18
                                        }"
                                        *ngIf="
                                            route.fuelPrice &&
                                            !route.expanded &&
                                            !route.hidden
                                        "
                                    ></svg-icon>
                                </div>
                            </div>
                            <app-ta-details-page-dropdown
                                #dropdownElement
                                (click)="toggleDropdown($event, t2, route)"
                                [placement]="'right-top right-bottom'"
                                [hasVericalDots]="true"
                                [options]="dropdownActions"
                                [id]="route.id"
                                (dropDownActions)="callDropDownAction($event)"
                            >
                            </app-ta-details-page-dropdown>
                        </div>
                        <div
                            class="route-card-content"
                            cdkDropList
                            [cdkDropListDisabled]="route.stops.length < 2"
                            (cdkDropListDropped)="
                                dropStops($event, route.stops, route)
                            "
                        >
                            <div
                                class="route-card-row"
                                *ngFor="let stop of route.stops; let b = index"
                                cdkDrag
                                cdkDragBoundary=".route-card-content"
                                [ngClass]="{ 'focused-route': route.isFocused }"
                                [ngStyle]="{
                                    cursor:
                                        route.stops.length == 1 ||
                                        stop.showEditInput
                                            ? 'pointer'
                                            : '',
                                    order:
                                        insertBeforeActive > -1 &&
                                        insertBeforeActive >= b
                                            ? b + 2
                                            : b + 1,
                                    'padding-right': stop.showEditInput
                                        ? '0px'
                                        : '4px'
                                }"
                                (click)="stopClick($event, i, b)"
                                (dblclick)="stopDoubleClick($event, i, b)"
                                [formGroup]="editStopForm"
                            >
                                <div
                                    class="focused-route-number-background"
                                    [ngClass]="['route-color-' + (i + 1)]"
                                    [ngStyle]="{
                                        display: stop.deleteHover ? 'flex' : '',
                                        backgroundColor: stop.deleteHover
                                            ? '#00000033'
                                            : '#0000001A'
                                    }"
                                    *ngIf="route.isFocused"
                                ></div>
                                <svg-icon
                                    src="assets/svg/truckassist-table/dropdown/content/delete.svg"
                                    class="delete-button"
                                    [svgStyle]="{
                                        'width.px': 14,
                                        'height.px': 14
                                    }"
                                    (click)="deleteRouteStop($event, route, b)"
                                    (mouseenter)="stop.deleteHover = true"
                                    (mouseleave)="stop.deleteHover = false"
                                    [ngStyle]="{
                                        'margin-right':
                                            stop.showEditInput &&
                                            !stop.deleteHover
                                                ? '9px'
                                                : '16px'
                                    }"
                                ></svg-icon>
                                <div class="delete-button drag-arrows">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="14"
                                        height="14"
                                        viewBox="0 0 14 14"
                                    >
                                        <g
                                            id="Height"
                                            transform="translate(-648 761) rotate(-90)"
                                        >
                                            <rect
                                                id="Rectangle_62626"
                                                data-name="Rectangle 62626"
                                                width="14"
                                                height="14"
                                                transform="translate(747 648)"
                                                fill="#fff"
                                                opacity="0"
                                            />
                                            <path
                                                id="arrows-alt-h"
                                                d="M8.581,146.725v1.594H4.639v-1.594a.831.831,0,0,0-1.418-.587L.243,149.116a.831.831,0,0,0,0,1.175l2.979,2.979a.831.831,0,0,0,1.418-.587v-1.594H8.581v1.594A.831.831,0,0,0,10,153.27l2.979-2.979a.831.831,0,0,0,0-1.175L10,146.138a.831.831,0,0,0-1.418.587Z"
                                                transform="translate(747.39 505.296)"
                                                [ngStyle]="{
                                                    fill: route.isFocused
                                                        ? '#fff'
                                                        : route.color
                                                }"
                                            />
                                        </g>
                                    </svg>
                                </div>
                                <div
                                    class="route-row-number marker-like-text marker-bold-text"
                                    [ngStyle]="{
                                        color: route.isFocused
                                            ? '#fff'
                                            : route.color,
                                        'margin-right': stop.showEditInput
                                            ? '9px'
                                            : '16px'
                                    }"
                                >
                                    {{ b + 1 }}
                                </div>
                                <div
                                    class="delete-stop-text"
                                    [ngStyle]="{
                                        width: !stop.deleteHover
                                            ? '0px'
                                            : '50px',
                                        'min-width': !stop.deleteHover
                                            ? '0px'
                                            : '50px',
                                        padding: !stop.deleteHover
                                            ? '0px'
                                            : '2px 6px',
                                        opacity: stop.deleteHover ? '1' : '0'
                                    }"
                                >
                                    Delete
                                </div>
                                <ng-container *ngIf="!stop.showEditInput">
                                    <div
                                        class="route-row-location marker-like-text"
                                        [ngClass]="{
                                            'full-address':
                                                tableData[selectedMapIndex]
                                                    .addressType == 'address'
                                        }"
                                        [ngStyle]="{
                                            'font-weight': stop.isSelected
                                                ? '700'
                                                : '400',
                                            'min-width': stop.deleteHover
                                                ? '90px'
                                                : '',
                                            width: stop.deleteHover
                                                ? '90px'
                                                : ''
                                        }"
                                    >
                                        {{
                                            tableData[selectedMapIndex]
                                                .addressType == 'address' &&
                                            stop.address.address
                                                ? stop.address.address
                                                : stop.cityAddress
                                        }}
                                    </div>

                                    <div
                                        *ngFor="
                                            let item of routeProperties
                                                | keyvalue : sortKeys
                                        "
                                    >
                                        <div
                                            [class]="item.value.class"
                                            [ngClass]="{
                                                'marker-bold-text gray-text':
                                                    b === 0
                                            }"
                                            [ngStyle]="{
                                                width: item.value.width,
                                                'margin-right': '18px',
                                                color:
                                                    b ==
                                                        route.stops.length -
                                                            1 &&
                                                    item.value.boldValue
                                                        ? route.color
                                                        : '',
                                                'font-weight': item.value
                                                    .boldValue
                                                    ? '800'
                                                    : ''
                                            }"
                                            *ngIf="
                                                ((item.value.checkMainValue &&
                                                    route[
                                                        item.value
                                                            .checkMainValue
                                                    ]) ||
                                                    !item.value
                                                        .checkMainValue) &&
                                                stop[item.value.value] !=
                                                    null &&
                                                ((item.value.expandedOnly &&
                                                    route.expanded &&
                                                    route.expandFinished) ||
                                                    !item.value.expandedOnly)
                                            "
                                        >
                                            {{
                                                b === 0
                                                    ? route.expanded &&
                                                      route.expandFinished
                                                        ? item.value
                                                              .expandedText +
                                                          (item.value
                                                              .insertExpandedText &&
                                                          item.value
                                                              .insertExpandedText ==
                                                              'distanceUnit'
                                                              ? ' ' +
                                                                tableData[
                                                                    selectedMapIndex
                                                                ].distanceUnit
                                                              : '')
                                                        : item.value.text
                                                    : (stop[item.value.value]
                                                      | thousandSeparator)
                                            }}
                                        </div>
                                    </div>

                                    <div
                                        *ngIf="stop.showLoaded"
                                        class="loaded-stop-background"
                                        [ngStyle]="{
                                            height:
                                                b >= route.stops.length - 1 ||
                                                !route.stops[b + 1] ||
                                                route.stops[b + 1].empty
                                                    ? '18px'
                                                    : '24px',
                                            background: route.isFocused
                                                ? '#ffffff4d'
                                                : route.color + '33',
                                            'border-top-left-radius':
                                                b == 0 || stop.empty
                                                    ? '2px'
                                                    : '0px',
                                            'border-top-right-radius':
                                                b == 0 || stop.empty
                                                    ? '2px'
                                                    : '0px',
                                            'border-bottom-right-radius':
                                                !route.stops[b + 1] ||
                                                route.stops[b + 1].empty
                                                    ? '2px'
                                                    : '0px',
                                            'border-bottom-left-radius':
                                                !route.stops[b + 1] ||
                                                route.stops[b + 1].empty
                                                    ? '2px'
                                                    : '0px'
                                        }"
                                    ></div>
                                </ng-container>
                                <ng-container *ngIf="stop.showEditInput">
                                    <div
                                        class="route-row-location marker-like-text marker-bold-text gray-text add-new-stop"
                                        [ngClass]="{
                                            'full-address':
                                                tableData[selectedMapIndex]
                                                    .addressType == 'address'
                                        }"
                                    >
                                        <!-- Edit Stop -->
                                        <app-ta-input-address-dropdown
                                            #editAddressInput
                                            formControlName="address"
                                            [inputConfig]="{
                                                name: 'RoutingAddress',
                                                type: 'text',
                                                label: stop.cityAddress,
                                                placeholder: stop.cityAddress,
                                                textTransform: 'capitalize',
                                                dropdownWidthClass:
                                                    dropdownWidth,
                                                minLength: 6,
                                                maxLength: 256,
                                                blackInput: true,
                                                placeholderInsteadOfLabel: true,
                                                routingAddress: true,
                                                isDropdown: true
                                            }"
                                            [placeholderType]="
                                                this.tableData[
                                                    this.selectedMapIndex
                                                ].addressType == 'address'
                                                    ? 'longAddress'
                                                    : 'shortAddress'
                                            "
                                            [closedBorder]="
                                                this.tableData[
                                                    this.selectedMapIndex
                                                ].borderType == 'closed'
                                                    ? true
                                                    : false
                                            "
                                            [commandHandler]="{
                                                commands: {
                                                    active: true,
                                                    type: 'confirm-cancel',
                                                    firstCommand: {
                                                        popup: {
                                                            name: 'Confirm',
                                                            backgroundColor:
                                                                '#6C6C6C'
                                                        },
                                                        name: 'confirm',
                                                        svg: 'assets/svg/ic_spec-confirm.svg'
                                                    },
                                                    secondCommand: {
                                                        popup: {
                                                            name: 'Cancel',
                                                            backgroundColor:
                                                                '#6C6C6C'
                                                        },
                                                        name: 'cancel',
                                                        svg: 'assets/svg/ic_x.svg'
                                                    }
                                                }
                                            }"
                                            [isRouting]="true"
                                            [hideEmptyLoaded]="b == 0"
                                            (changeFlag)="
                                                $event === true
                                                    ? (stop.empty = false)
                                                    : (stop.empty = true)
                                            "
                                            (commandEvent)="
                                                handleAddressEdit(
                                                    $event,
                                                    route,
                                                    b
                                                )
                                            "
                                        ></app-ta-input-address-dropdown>
                                    </div>
                                </ng-container>
                            </div>

                            <div
                                class="route-card-row m-0"
                                [formGroup]="$any(addressInputs)"
                                [ngClass]="{
                                    'focused-route': route.isFocused,
                                    'disable-hover':
                                        inputAddress?.addressExpanded
                                }"
                                (click)="focusOnInput(i, false, $event)"
                                [attr.data-id]="'newStop' + route.id"
                                [ngStyle]="{
                                    order:
                                        insertBeforeActive > -1
                                            ? insertBeforeActive + 1
                                            : route.stops.length + 1
                                }"
                            >
                                <div
                                    class="focused-route-number-background"
                                    [ngStyle]="{ backgroundColor: '#0000001A' }"
                                ></div>
                                <svg-icon
                                    src="assets/svg/common/ic_plus.svg"
                                    class="delete-button plus-button"
                                    [ngClass]="['route-color-' + (i + 1)]"
                                    [svgStyle]="{
                                        'width.px': 14,
                                        'height.px': 14,
                                        fill: route.isFocused
                                            ? '#fff'
                                            : route.color,
                                        opacity: inputAddress?.addressExpanded
                                            ? '0'
                                            : '1'
                                    }"
                                ></svg-icon>
                                <div
                                    class="route-row-number marker-like-text marker-bold-text"
                                ></div>
                                <div
                                    class="route-row-location marker-like-text marker-bold-text gray-text add-new-stop"
                                    [formGroupName]="i"
                                    [ngClass]="{
                                        'full-address':
                                            tableData[selectedMapIndex]
                                                .addressType == 'address'
                                    }"
                                >
                                    <!-- Add New Stop -->
                                    <app-ta-input-address-dropdown
                                        #inputAddress
                                        formControlName="address"
                                        [inputConfig]="{
                                            name: 'RoutingAddress',
                                            type: 'text',
                                            label: 'Add New Stop',
                                            placeholder: 'Add New Stop',
                                            textTransform: 'capitalize',
                                            dropdownWidthClass: dropdownWidth,
                                            minLength: 6,
                                            maxLength: 256,
                                            blackInput: true,
                                            placeholderInsteadOfLabel: true,
                                            routingAddress: true,
                                            isDropdown: true
                                        }"
                                        [placeholderType]="
                                            this.tableData[
                                                this.selectedMapIndex
                                            ].addressType == 'address'
                                                ? 'longAddress'
                                                : 'shortAddress'
                                        "
                                        [closedBorder]="
                                            this.tableData[
                                                this.selectedMapIndex
                                            ].borderType == 'closed'
                                                ? true
                                                : false
                                        "
                                        [commandHandler]="{
                                            commands: {
                                                active: true,
                                                type: 'confirm-cancel',
                                                firstCommand: {
                                                    popup: {
                                                        name: 'Confirm',
                                                        backgroundColor:
                                                            '#6C6C6C'
                                                    },
                                                    name: 'confirm',
                                                    svg: 'assets/svg/ic_spec-confirm.svg'
                                                },
                                                secondCommand: {
                                                    popup: {
                                                        name: 'Cancel',
                                                        backgroundColor:
                                                            '#6C6C6C'
                                                    },
                                                    name: 'cancel',
                                                    svg: 'assets/svg/ic_x.svg'
                                                }
                                            }
                                        }"
                                        [isRouting]="true"
                                        [hideEmptyLoaded]="!route.stops.length"
                                        (changeFlag)="
                                            $event === true
                                                ? (addressFlag = 'Loaded')
                                                : (addressFlag = 'Empty')
                                        "
                                        (commandEvent)="
                                            onHandleAddress($event, route, i)
                                        "
                                    ></app-ta-input-address-dropdown>
                                </div>
                            </div>
                        </div>
                        <div
                            class="selected-route"
                            *ngIf="route.isFocused"
                            [ngStyle]="{ backgroundColor: route.color }"
                        ></div>
                        <div
                            class="route-card-resize-button"
                            (click)="resizeCard($event, route)"
                            *ngIf="
                                !route.hidden &&
                                route.hover &&
                                (route.stops.length ||
                                    route.truckId ||
                                    route.stopTime ||
                                    route.mpg ||
                                    route.fuelPrice)
                            "
                        >
                            <svg-icon
                                src="assets/svg/common/fill_arrow_down.svg"
                                class="map-list-resize-svg"
                                [ngClass]="{ rotate: route.expanded }"
                                [svgStyle]="{ 'width.px': 12, 'height.px': 12 }"
                            ></svg-icon>
                        </div>
                    </div>
                </ng-container>
            </div>
            <div
                class="route-free-drag-area"
                cdkDropList
                #routeFreeDrag="cdkDropList"
                [cdkDropListData]="tableData[selectedMapIndex]?.routes"
                [cdkDropListConnectedTo]="[routeList]"
                cdkDropListSortingDisabled="true"
                (cdkDropListDropped)="dropRoutes($event)"
            >
                <ng-container
                    *ngFor="
                        let route of tableData[selectedMapIndex]?.routes;
                        let i = index
                    "
                >
                    <div
                        *ngIf="route.freeMove"
                        cdkDrag
                        class="route-info-card"
                        [attr.data-id]="route.id"
                        (click)="
                            !route.hidden
                                ? focusRoute(i)
                                : showHideRoute($event, route)
                        "
                        (mouseenter)="hoverRoute(route)"
                        (mouseleave)="leaveRouteHover(route)"
                        (cdkDragStarted)="changeZIndex(route)"
                        (cdkDragDropped)="changePosition($event, route)"
                        [cdkDragData]="route"
                        [ngClass]="{
                            'route-hidden': route.hidden,
                            'expanded-card': route.expanded
                        }"
                        [ngStyle]="{
                            width: route.width ? route.width : '312px',
                            'padding-right':
                                route.hover && !route.hidden ? '14px' : '4px',
                            top: route.y + 'px',
                            left: route.x + 'px',
                            zIndex: route.z - i ? route.z - i : '0'
                        }"
                    >
                        <div class="route-info-header">
                            <div class="header-content-container">
                                <div
                                    cdkDragHandle
                                    class="route-card-svg"
                                    [tooltipBackground]="'#616161'"
                                    ngbTooltip
                                    [mainTooltip]="'Route Reorder'"
                                    position="right"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="18"
                                        height="18"
                                        viewBox="0 0 18 18"
                                        *ngIf="!route.hidden"
                                    >
                                        <g
                                            id="Drag"
                                            transform="translate(-935.139 -1357)"
                                            opacity="0.7"
                                        >
                                            <rect
                                                id="Rectangle_63459"
                                                data-name="Rectangle 63459"
                                                width="18"
                                                height="18"
                                                rx="2"
                                                transform="translate(935.139 1357)"
                                                fill="#f27b8e"
                                                opacity="0"
                                            />
                                            <path
                                                id="grip-vertical"
                                                d="M3,0H1A1,1,0,0,0,0,1V3A1,1,0,0,0,1,4H3A1,1,0,0,0,4,3V1A1,1,0,0,0,3,0ZM3,5H1A1,1,0,0,0,0,6V8A1,1,0,0,0,1,9H3A1,1,0,0,0,4,8V6A1,1,0,0,0,3,5Zm0,5H1a1,1,0,0,0-1,1v2a1,1,0,0,0,1,1H3a1,1,0,0,0,1-1V11A1,1,0,0,0,3,10ZM9,0H7A1,1,0,0,0,6,1V3A1,1,0,0,0,7,4H9a1,1,0,0,0,1-1V1A1,1,0,0,0,9,0ZM9,5H7A1,1,0,0,0,6,6V8A1,1,0,0,0,7,9H9a1,1,0,0,0,1-1V6A1,1,0,0,0,9,5Zm0,5H7a1,1,0,0,0-1,1v2a1,1,0,0,0,1,1H9a1,1,0,0,0,1-1V11A1,1,0,0,0,9,10Z"
                                                transform="translate(951.139 1361) rotate(90)"
                                                [ngStyle]="{
                                                    fill: route.isFocused
                                                        ? '#fff'
                                                        : route.color
                                                }"
                                                stroke="rgba(0,0,0,0)"
                                                stroke-width="1"
                                            />
                                        </g>
                                    </svg>
                                    <svg-icon
                                        [ngClass]="{
                                            'svg-hover': route.nameHover
                                        }"
                                        [src]="
                                            !route.nameHover
                                                ? 'assets/svg/common/routing/ic_route_hidden.svg'
                                                : 'assets/svg/common/ic_eye-visible.svg'
                                        "
                                        [svgStyle]="{
                                            'width.px': 18,
                                            'height.px': 18
                                        }"
                                        *ngIf="route.hidden"
                                    ></svg-icon>
                                </div>
                                <div
                                    class="route-name marker-info-text marker-bold-text mg-left-8"
                                    [ngStyle]="{
                                        color: route.nameHover
                                            ? route.color
                                            : route.hidden
                                            ? '#B7B7B7'
                                            : '#3C3C3C'
                                    }"
                                    (click)="showHideRoute($event, route)"
                                    (mouseenter)="route.nameHover = true"
                                    (mouseleave)="route.nameHover = false"
                                >
                                    {{ route.name }}
                                </div>
                                <div class="header-properties-container">
                                    <div
                                        class="route-type-text mg-left-12"
                                        *ngIf="
                                            route.truckId &&
                                            route.expanded &&
                                            route.expandFinished &&
                                            !route.hidden
                                        "
                                    >
                                        Unit:
                                        <span class="marker-bold-text">{{
                                            route.truckId
                                        }}</span>
                                    </div>
                                    <div
                                        class="route-type-text"
                                        [ngClass]="{
                                            'mg-left-12':
                                                !route.truckId ||
                                                !route.expanded
                                        }"
                                        *ngIf="!route.hidden"
                                    >
                                        {{ route.routeType }}
                                    </div>
                                    <div
                                        class="route-type-text mg-left-12"
                                        *ngIf="route.hidden"
                                    >
                                        {{ route.stops.length }} Stops
                                    </div>
                                    <div
                                        class="route-type-text"
                                        *ngIf="
                                            route.hidden && route.stops.length
                                        "
                                    >
                                        {{
                                            route.stops[route.stops.length - 1]
                                                .total
                                        }}
                                        {{
                                            tableData[selectedMapIndex]
                                                .distanceUnit
                                        }}
                                    </div>
                                    <div
                                        class="route-type-text"
                                        *ngIf="
                                            route.stopTime &&
                                            route.expanded &&
                                            route.expandFinished &&
                                            !route.hidden
                                        "
                                    >
                                        Stop Time:
                                        <span class="marker-bold-text"
                                            >{{ route.stopTime }} min</span
                                        >
                                    </div>
                                    <div
                                        class="route-type-text"
                                        *ngIf="
                                            route.mpg &&
                                            route.expanded &&
                                            route.expandFinished &&
                                            !route.hidden
                                        "
                                    >
                                        MPG:
                                        <span class="marker-bold-text"
                                            >{{ route.mpg }} mi</span
                                        >
                                    </div>
                                    <div
                                        class="route-type-text"
                                        *ngIf="
                                            route.fuelPrice &&
                                            route.expanded &&
                                            route.expandFinished &&
                                            !route.hidden
                                        "
                                    >
                                        PPG:
                                        <span class="marker-bold-text"
                                            >${{ route.fuelPrice }}</span
                                        >
                                    </div>
                                    <div
                                        class="route-card-header-divider"
                                        *ngIf="
                                            route.stopTime &&
                                            !route.expanded &&
                                            !route.hidden
                                        "
                                    ></div>
                                    <svg-icon
                                        class="route-card-icon"
                                        src="assets/svg/common/ic_time.svg"
                                        [svgStyle]="{
                                            'width.px': 18,
                                            'height.px': 18
                                        }"
                                        *ngIf="
                                            route.stopTime &&
                                            !route.expanded &&
                                            !route.hidden
                                        "
                                    ></svg-icon>
                                    <div
                                        class="route-card-header-divider"
                                        *ngIf="
                                            route.fuelPrice &&
                                            !route.expanded &&
                                            !route.hidden
                                        "
                                    ></div>
                                    <svg-icon
                                        class="route-card-icon"
                                        src="assets/svg/common/ic_dollar.svg"
                                        [svgStyle]="{
                                            'width.px': 18,
                                            'height.px': 18
                                        }"
                                        *ngIf="
                                            route.fuelPrice &&
                                            !route.expanded &&
                                            !route.hidden
                                        "
                                    ></svg-icon>
                                </div>
                            </div>
                            <app-ta-details-page-dropdown
                                #dropdownElement
                                (click)="toggleDropdown($event, t2, route)"
                                [placement]="'right-top right-bottom'"
                                [hasVericalDots]="true"
                                [options]="dropdownActions"
                                [id]="route.id"
                                (dropDownActions)="callDropDownAction($event)"
                            >
                            </app-ta-details-page-dropdown>
                        </div>
                        <div
                            class="route-card-content"
                            cdkDropList
                            [cdkDropListDisabled]="route.stops.length < 2"
                            (cdkDropListDropped)="
                                dropStops($event, route.stops, route)
                            "
                        >
                            <div
                                class="route-card-row"
                                *ngFor="let stop of route.stops; let b = index"
                                cdkDrag
                                cdkDragBoundary=".route-card-content"
                                [ngClass]="{ 'focused-route': route.isFocused }"
                                [ngStyle]="{
                                    cursor:
                                        route.stops.length == 1 ||
                                        stop.showEditInput
                                            ? 'pointer'
                                            : '',
                                    order:
                                        insertBeforeActive > -1 &&
                                        insertBeforeActive >= b
                                            ? b + 2
                                            : b + 1,
                                    'padding-right': stop.showEditInput
                                        ? '0px'
                                        : '4px'
                                }"
                                (click)="stopClick($event, i, b)"
                                (dblclick)="stopDoubleClick($event, i, b)"
                                [formGroup]="editStopForm"
                            >
                                <div
                                    class="focused-route-number-background"
                                    [ngClass]="['route-color-' + (i + 1)]"
                                    [ngStyle]="{
                                        display: stop.deleteHover ? 'flex' : '',
                                        backgroundColor: stop.deleteHover
                                            ? '#00000033'
                                            : '#0000001A'
                                    }"
                                    *ngIf="route.isFocused"
                                ></div>
                                <svg-icon
                                    src="assets/svg/truckassist-table/dropdown/content/delete.svg"
                                    class="delete-button"
                                    [svgStyle]="{
                                        'width.px': 14,
                                        'height.px': 14
                                    }"
                                    (click)="deleteRouteStop($event, route, b)"
                                    (mouseenter)="stop.deleteHover = true"
                                    (mouseleave)="stop.deleteHover = false"
                                    [ngStyle]="{
                                        'margin-right':
                                            stop.showEditInput &&
                                            !stop.deleteHover
                                                ? '9px'
                                                : '16px'
                                    }"
                                ></svg-icon>
                                <div class="delete-button drag-arrows">
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        width="14"
                                        height="14"
                                        viewBox="0 0 14 14"
                                    >
                                        <g
                                            id="Height"
                                            transform="translate(-648 761) rotate(-90)"
                                        >
                                            <rect
                                                id="Rectangle_62626"
                                                data-name="Rectangle 62626"
                                                width="14"
                                                height="14"
                                                transform="translate(747 648)"
                                                fill="#fff"
                                                opacity="0"
                                            />
                                            <path
                                                id="arrows-alt-h"
                                                d="M8.581,146.725v1.594H4.639v-1.594a.831.831,0,0,0-1.418-.587L.243,149.116a.831.831,0,0,0,0,1.175l2.979,2.979a.831.831,0,0,0,1.418-.587v-1.594H8.581v1.594A.831.831,0,0,0,10,153.27l2.979-2.979a.831.831,0,0,0,0-1.175L10,146.138a.831.831,0,0,0-1.418.587Z"
                                                transform="translate(747.39 505.296)"
                                                [ngStyle]="{
                                                    fill: route.isFocused
                                                        ? '#fff'
                                                        : route.color
                                                }"
                                            />
                                        </g>
                                    </svg>
                                </div>
                                <div
                                    class="route-row-number marker-like-text marker-bold-text"
                                    [ngStyle]="{
                                        color: route.isFocused
                                            ? '#fff'
                                            : route.color,
                                        'margin-right': stop.showEditInput
                                            ? '9px'
                                            : '16px'
                                    }"
                                >
                                    {{ b + 1 }}
                                </div>
                                <div
                                    class="delete-stop-text"
                                    [ngStyle]="{
                                        width: !stop.deleteHover
                                            ? '0px'
                                            : '50px',
                                        'min-width': !stop.deleteHover
                                            ? '0px'
                                            : '50px',
                                        padding: !stop.deleteHover
                                            ? '0px'
                                            : '2px 6px',
                                        opacity: stop.deleteHover ? '1' : '0'
                                    }"
                                >
                                    Delete
                                </div>
                                <ng-container *ngIf="!stop.showEditInput">
                                    <div
                                        class="route-row-location marker-like-text"
                                        [ngClass]="{
                                            'full-address':
                                                tableData[selectedMapIndex]
                                                    .addressType == 'address'
                                        }"
                                        [ngStyle]="{
                                            'font-weight': stop.isSelected
                                                ? '700'
                                                : '400',
                                            'min-width': stop.deleteHover
                                                ? '90px'
                                                : '',
                                            width: stop.deleteHover
                                                ? '90px'
                                                : ''
                                        }"
                                    >
                                        {{
                                            tableData[selectedMapIndex]
                                                .addressType == 'address' &&
                                            stop.address.address
                                                ? stop.address.address
                                                : stop.cityAddress
                                        }}
                                    </div>

                                    <div
                                        *ngFor="
                                            let item of routeProperties
                                                | keyvalue : sortKeys
                                        "
                                    >
                                        <div
                                            [class]="item.value.class"
                                            [ngClass]="{
                                                'marker-bold-text gray-text':
                                                    b === 0
                                            }"
                                            [ngStyle]="{
                                                width: item.value.width,
                                                'margin-right': '18px',
                                                color:
                                                    b ==
                                                        route.stops.length -
                                                            1 &&
                                                    item.value.boldValue
                                                        ? route.color
                                                        : '',
                                                'font-weight': item.value
                                                    .boldValue
                                                    ? '800'
                                                    : ''
                                            }"
                                            *ngIf="
                                                ((item.value.checkMainValue &&
                                                    route[
                                                        item.value
                                                            .checkMainValue
                                                    ]) ||
                                                    !item.value
                                                        .checkMainValue) &&
                                                stop[item.value.value] !=
                                                    null &&
                                                ((item.value.expandedOnly &&
                                                    route.expanded &&
                                                    route.expandFinished) ||
                                                    !item.value.expandedOnly)
                                            "
                                        >
                                            {{
                                                b === 0
                                                    ? route.expanded &&
                                                      route.expandFinished
                                                        ? item.value
                                                              .expandedText +
                                                          (item.value
                                                              .insertExpandedText &&
                                                          item.value
                                                              .insertExpandedText ==
                                                              'distanceUnit'
                                                              ? ' ' +
                                                                tableData[
                                                                    selectedMapIndex
                                                                ].distanceUnit
                                                              : '')
                                                        : item.value.text
                                                    : (stop[item.value.value]
                                                      | thousandSeparator)
                                            }}
                                        </div>
                                    </div>

                                    <div
                                        *ngIf="stop.showLoaded"
                                        class="loaded-stop-background"
                                        [ngStyle]="{
                                            height:
                                                b >= route.stops.length - 1 ||
                                                !route.stops[b + 1] ||
                                                route.stops[b + 1].empty
                                                    ? '18px'
                                                    : '24px',
                                            background: route.isFocused
                                                ? '#ffffff4d'
                                                : route.color + '33',
                                            'border-top-left-radius':
                                                b == 0 || stop.empty
                                                    ? '2px'
                                                    : '0px',
                                            'border-top-right-radius':
                                                b == 0 || stop.empty
                                                    ? '2px'
                                                    : '0px',
                                            'border-bottom-right-radius':
                                                !route.stops[b + 1] ||
                                                route.stops[b + 1].empty
                                                    ? '2px'
                                                    : '0px',
                                            'border-bottom-left-radius':
                                                !route.stops[b + 1] ||
                                                route.stops[b + 1].empty
                                                    ? '2px'
                                                    : '0px'
                                        }"
                                    ></div>
                                </ng-container>
                                <ng-container *ngIf="stop.showEditInput">
                                    <div
                                        class="route-row-location marker-like-text marker-bold-text gray-text add-new-stop"
                                        [ngClass]="{
                                            'full-address':
                                                tableData[selectedMapIndex]
                                                    .addressType == 'address'
                                        }"
                                    >
                                        <!-- Edit Stop -->
                                        <app-ta-input-address-dropdown
                                            #editAddressInput
                                            formControlName="address"
                                            [inputConfig]="{
                                                name: 'RoutingAddress',
                                                type: 'text',
                                                label: stop.cityAddress,
                                                placeholder: stop.cityAddress,
                                                textTransform: 'capitalize',
                                                dropdownWidthClass:
                                                    dropdownWidth,
                                                minLength: 6,
                                                maxLength: 256,
                                                blackInput: true,
                                                placeholderInsteadOfLabel: true,
                                                routingAddress: true,
                                                isDropdown: true
                                            }"
                                            [placeholderType]="
                                                this.tableData[
                                                    this.selectedMapIndex
                                                ].addressType == 'address'
                                                    ? 'longAddress'
                                                    : 'shortAddress'
                                            "
                                            [closedBorder]="
                                                this.tableData[
                                                    this.selectedMapIndex
                                                ].borderType == 'closed'
                                                    ? true
                                                    : false
                                            "
                                            [commandHandler]="{
                                                commands: {
                                                    active: true,
                                                    type: 'confirm-cancel',
                                                    firstCommand: {
                                                        popup: {
                                                            name: 'Confirm',
                                                            backgroundColor:
                                                                '#6C6C6C'
                                                        },
                                                        name: 'confirm',
                                                        svg: 'assets/svg/ic_spec-confirm.svg'
                                                    },
                                                    secondCommand: {
                                                        popup: {
                                                            name: 'Cancel',
                                                            backgroundColor:
                                                                '#6C6C6C'
                                                        },
                                                        name: 'cancel',
                                                        svg: 'assets/svg/ic_x.svg'
                                                    }
                                                }
                                            }"
                                            [isRouting]="true"
                                            [hideEmptyLoaded]="b == 0"
                                            (changeFlag)="
                                                $event === true
                                                    ? (stop.empty = false)
                                                    : (stop.empty = true)
                                            "
                                            (commandEvent)="
                                                handleAddressEdit(
                                                    $event,
                                                    route,
                                                    b
                                                )
                                            "
                                        ></app-ta-input-address-dropdown>
                                    </div>
                                </ng-container>
                            </div>

                            <div
                                class="route-card-row m-0"
                                [formGroup]="$any(addressInputs)"
                                [ngClass]="{
                                    'focused-route': route.isFocused,
                                    'disable-hover':
                                        inputAddress?.addressExpanded
                                }"
                                (click)="focusOnInput(i, false, $event)"
                                [attr.data-id]="'newStop' + route.id"
                                [ngStyle]="{
                                    order:
                                        insertBeforeActive > -1
                                            ? insertBeforeActive + 1
                                            : route.stops.length + 1
                                }"
                            >
                                <div
                                    class="focused-route-number-background"
                                    [ngStyle]="{ backgroundColor: '#0000001A' }"
                                ></div>
                                <svg-icon
                                    src="assets/svg/common/ic_plus.svg"
                                    class="delete-button plus-button"
                                    [ngClass]="['route-color-' + (i + 1)]"
                                    [svgStyle]="{
                                        'width.px': 14,
                                        'height.px': 14,
                                        fill: route.isFocused
                                            ? '#fff'
                                            : route.color,
                                        opacity: inputAddress?.addressExpanded
                                            ? '0'
                                            : '1'
                                    }"
                                ></svg-icon>
                                <div
                                    class="route-row-number marker-like-text marker-bold-text"
                                ></div>
                                <div
                                    class="route-row-location marker-like-text marker-bold-text gray-text add-new-stop"
                                    [formGroupName]="i"
                                    [ngClass]="{
                                        'full-address':
                                            tableData[selectedMapIndex]
                                                .addressType == 'address'
                                    }"
                                >
                                    <!-- Add New Stop -->
                                    <app-ta-input-address-dropdown
                                        #inputAddress
                                        formControlName="address"
                                        [inputConfig]="{
                                            name: 'RoutingAddress',
                                            type: 'text',
                                            label: 'Add New Stop',
                                            placeholder: 'Add New Stop',
                                            textTransform: 'capitalize',
                                            dropdownWidthClass: dropdownWidth,
                                            minLength: 6,
                                            maxLength: 256,
                                            blackInput: true,
                                            placeholderInsteadOfLabel: true,
                                            routingAddress: true,
                                            isDropdown: true
                                        }"
                                        [placeholderType]="
                                            this.tableData[
                                                this.selectedMapIndex
                                            ].addressType == 'address'
                                                ? 'longAddress'
                                                : 'shortAddress'
                                        "
                                        [closedBorder]="
                                            this.tableData[
                                                this.selectedMapIndex
                                            ].borderType == 'closed'
                                                ? true
                                                : false
                                        "
                                        [commandHandler]="{
                                            commands: {
                                                active: true,
                                                type: 'confirm-cancel',
                                                firstCommand: {
                                                    popup: {
                                                        name: 'Confirm',
                                                        backgroundColor:
                                                            '#6C6C6C'
                                                    },
                                                    name: 'confirm',
                                                    svg: 'assets/svg/ic_spec-confirm.svg'
                                                },
                                                secondCommand: {
                                                    popup: {
                                                        name: 'Cancel',
                                                        backgroundColor:
                                                            '#6C6C6C'
                                                    },
                                                    name: 'cancel',
                                                    svg: 'assets/svg/ic_x.svg'
                                                }
                                            }
                                        }"
                                        [isRouting]="true"
                                        [hideEmptyLoaded]="!route.stops.length"
                                        (changeFlag)="
                                            $event === true
                                                ? (addressFlag = 'Loaded')
                                                : (addressFlag = 'Empty')
                                        "
                                        (commandEvent)="
                                            onHandleAddress($event, route, i)
                                        "
                                    ></app-ta-input-address-dropdown>
                                </div>
                            </div>
                        </div>
                        <div
                            class="selected-route"
                            *ngIf="route.isFocused"
                            [ngStyle]="{ backgroundColor: route.color }"
                        ></div>
                        <div
                            class="route-card-resize-button"
                            (click)="resizeCard($event, route)"
                            *ngIf="
                                !route.hidden &&
                                route.hover &&
                                (route.stops.length ||
                                    route.truckId ||
                                    route.stopTime ||
                                    route.mpg ||
                                    route.fuelPrice)
                            "
                        >
                            <svg-icon
                                src="assets/svg/common/fill_arrow_down.svg"
                                class="map-list-resize-svg"
                                [ngClass]="{ rotate: route.expanded }"
                                [svgStyle]="{ 'width.px': 12, 'height.px': 12 }"
                            ></svg-icon>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>

        <agm-map
            [latitude]="mapLatitude"
            [longitude]="mapLongitude"
            [restriction]="mapRestrictions"
            [streetViewControl]="false"
            [styles]="styles"
            [zoom]="mapZoom"
            [usePanning]="true"
            [keyboardShortcuts]="false"
            [zoomControl]="false"
            [clickableIcons]="false"
            (zoomChange)="zoomChange($event)"
            (mapReady)="getMapInstance($event)"
            (mouseover)="mapHover = true"
            (mouseleave)="mapHover = false"
        >
            <div
                *ngFor="
                    let route of tableData[selectedMapIndex]?.routes;
                    let i = index
                "
            >
                <div *ngIf="route.stops?.length">
                    <div
                        *ngFor="
                            let e of [].constructor(route.stops.length);
                            let j = index
                        "
                    >
                        <agm-marker
                            [agmFitBounds]="true"
                            [latitude]="route.stops[j].lat"
                            [longitude]="route.stops[j].long"
                            [visible]="false"
                        >
                            <agm-snazzy-info-window
                                [closeOnMapClick]="false"
                                [closeWhenOthersOpen]="false"
                                [isOpen]="route.hidden ? false : true"
                                [latitude]="route.stops[j].lat"
                                [longitude]="route.stops[j].long"
                                [maxHeight]="32"
                                [maxWidth]="26"
                                [openOnMarkerClick]="false"
                                placement="bottom"
                                [showCloseButton]="false"
                                [pointer]="false"
                                [panOnOpen]="false"
                            >
                                <ng-template>
                                    <div
                                        (mouseenter)="
                                            hoverStop(
                                                route,
                                                route.stops[j],
                                                true
                                            )
                                        "
                                        (mouseleave)="
                                            hoverStop(
                                                route,
                                                route.stops[j],
                                                false
                                            )
                                        "
                                        class="marker-container marker-icon"
                                        *ngIf="route.isFocused"
                                        (click)="stopMarkerClick($event, i, j)"
                                        (mousewheel)="
                                            markerZoom($event, route.stops[j])
                                        "
                                    >
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            xmlns:xlink="http://www.w3.org/1999/xlink"
                                            width="34"
                                            height="37"
                                            viewBox="0 0 34 37"
                                        >
                                            <defs>
                                                <filter
                                                    id="Path_33651"
                                                    x="0"
                                                    y="0"
                                                    width="34"
                                                    height="37"
                                                    filterUnits="userSpaceOnUse"
                                                >
                                                    <feOffset
                                                        input="SourceAlpha"
                                                    />
                                                    <feGaussianBlur
                                                        stdDeviation="2"
                                                        result="blur"
                                                    />
                                                    <feFlood
                                                        flood-opacity="0.149"
                                                    />
                                                    <feComposite
                                                        operator="in"
                                                        in2="blur"
                                                    />
                                                    <feComposite
                                                        in="SourceGraphic"
                                                    />
                                                </filter>
                                            </defs>
                                            <g
                                                id="Group_98568"
                                                data-name="Group 98568"
                                                transform="translate(-1100 -955.999)"
                                            >
                                                <circle
                                                    id="Ellipse_6245"
                                                    data-name="Ellipse 6245"
                                                    cx="4"
                                                    cy="4"
                                                    r="6"
                                                    transform="translate(1113 983)"
                                                    [ngStyle]="{
                                                        fill: route.color
                                                    }"
                                                />
                                                <circle
                                                    id="Ellipse_6246"
                                                    data-name="Ellipse 6246"
                                                    cx="2"
                                                    cy="2"
                                                    r="2"
                                                    transform="translate(1115 985)"
                                                    fill="#fff"
                                                    *ngIf="
                                                        j > 0 &&
                                                        j <
                                                            route.stops.length -
                                                                1
                                                    "
                                                />
                                            </g>
                                            <g
                                                id="Group_98569"
                                                data-name="Group 98569"
                                                transform="translate(-630 -2283.999)"
                                            >
                                                <g
                                                    [ngStyle]="{
                                                        filter: 'drop-shadow(0px 0px 4px #00000026)'
                                                    }"
                                                    transform="matrix(1, 0, 0, 1, 630, 2284)"
                                                >
                                                    <path
                                                        id="Path_33651-2"
                                                        data-name="Path 33651"
                                                        d="M22,10.974a10.97,10.97,0,0,1-4.852,9.1c-.024.018-.379.237-.519.329-3.367,2.14-4.718,3.585-5.262,4.4a.441.441,0,0,1-.609.124.457.457,0,0,1-.124-.124c-.544-.811-1.9-2.256-5.262-4.4-.153-.095-.494-.311-.519-.329A10.983,10.983,0,1,1,22,10.974"
                                                        transform="translate(6 6)"
                                                        fill="#fff"
                                                    />
                                                </g>
                                                <circle
                                                    id="Ellipse_6005"
                                                    data-name="Ellipse 6005"
                                                    cx="9"
                                                    cy="9"
                                                    r="9"
                                                    transform="translate(638 2292)"
                                                    [ngStyle]="{
                                                        fill: route.color
                                                    }"
                                                />
                                                <text
                                                    y="-3,315px"
                                                    dominant-baseline="middle"
                                                    text-anchor="middle"
                                                    id="_1"
                                                    data-name="1"
                                                    transform="translate(647 2305)"
                                                    fill="#fff"
                                                    font-size="10"
                                                    font-family="Montserrat-Bold, Montserrat"
                                                    font-weight="700"
                                                >
                                                    <tspan>{{ j + 1 }}</tspan>
                                                </text>
                                            </g>
                                        </svg>
                                    </div>
                                    <div
                                        class="marker-container circle-marker"
                                        [ngClass]="
                                            route.isFocused || route.lineHover
                                                ? 'route-zIndex-998'
                                                : 'route-zIndex-' +
                                                  (tableData[selectedMapIndex]
                                                      ?.routes.length -
                                                      i)
                                        "
                                        (click)="stopMarkerClick($event, i, j)"
                                        (mousewheel)="
                                            markerZoom($event, route.stops[j])
                                        "
                                    >
                                        <svg
                                            *ngIf="
                                                j > 0 &&
                                                j < route.stops.length - 1
                                            "
                                            (mouseenter)="
                                                hoverStop(
                                                    route,
                                                    route.stops[j],
                                                    true
                                                )
                                            "
                                            (mouseleave)="
                                                hoverStop(
                                                    route,
                                                    route.stops[j],
                                                    false
                                                )
                                            "
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="12"
                                            height="12"
                                            viewBox="0 0 12 12"
                                            [ngClass]="{
                                                'smaller-circle':
                                                    !route.lineHover &&
                                                    !route.isFocused
                                            }"
                                        >
                                            <circle
                                                id="Ellipse_6245"
                                                data-name="Ellipse 6245"
                                                cx="6"
                                                cy="6"
                                                r="6"
                                                [ngStyle]="{
                                                    fill: route.color
                                                }"
                                            />
                                            <circle
                                                id="Ellipse_6246"
                                                data-name="Ellipse 6246"
                                                cx="2"
                                                cy="2"
                                                r="2"
                                                transform="translate(4 4)"
                                                fill="#fff"
                                            />
                                        </svg>
                                        <svg
                                            *ngIf="
                                                j == 0 ||
                                                j == route.stops.length - 1
                                            "
                                            (mouseenter)="
                                                hoverStop(
                                                    route,
                                                    route.stops[j],
                                                    true
                                                )
                                            "
                                            (mouseleave)="
                                                hoverStop(
                                                    route,
                                                    route.stops[j],
                                                    false
                                                )
                                            "
                                            xmlns="http://www.w3.org/2000/svg"
                                            width="12"
                                            height="12"
                                            viewBox="0 0 12 12"
                                            [ngClass]="{
                                                'smaller-circle':
                                                    !route.lineHover &&
                                                    !route.isFocused
                                            }"
                                        >
                                            <g
                                                id="Group_98622"
                                                data-name="Group 98622"
                                                transform="translate(-1111 -981)"
                                            >
                                                <circle
                                                    id="Ellipse_6245"
                                                    data-name="Ellipse 6245"
                                                    cx="6"
                                                    cy="6"
                                                    r="6"
                                                    transform="translate(1111 981)"
                                                    [ngStyle]="{
                                                        fill: route.color
                                                    }"
                                                />
                                                <circle
                                                    id="Ellipse_6246"
                                                    data-name="Ellipse 6246"
                                                    cx="4"
                                                    cy="4"
                                                    r="4"
                                                    transform="translate(1113 983)"
                                                    fill="#fff"
                                                />
                                            </g>
                                        </svg>
                                    </div>
                                    <div
                                        class="stop-picker-address smaller-marker-address route-zIndex-999"
                                        [ngClass]="{
                                            'small-marker-tooltip':
                                                !route.isFocused
                                        }"
                                        [ngStyle]="{
                                            background:
                                                'linear-gradient(0deg, ' +
                                                route.color +
                                                '33' +
                                                ', ' +
                                                route.color +
                                                '33)' +
                                                ', #FFFFFF'
                                        }"
                                        *ngIf="
                                            route.stops[j].isSelected ||
                                            route.stops[j].hovered
                                        "
                                    >
                                        <div
                                            class="stop-picker-address-text"
                                            [ngStyle]="{
                                                color: route.color
                                            }"
                                        >
                                            {{
                                                tableData[selectedMapIndex]
                                                    .addressType == 'address' &&
                                                route.stops[j].address.address
                                                    ? route.stops[j].address
                                                          .address
                                                    : route.stops[j].cityAddress
                                            }}
                                        </div>
                                    </div>
                                </ng-template>
                            </agm-snazzy-info-window>
                        </agm-marker>
                    </div>
                </div>
            </div>

            <agm-marker
                *ngIf="focusedRouteIndex != null && stopPickerLocation.lat"
                [agmFitBounds]="true"
                [latitude]="stopPickerLocation.lat"
                [longitude]="stopPickerLocation.long"
                [visible]="false"
            >
                <agm-snazzy-info-window
                    [closeOnMapClick]="false"
                    [closeWhenOthersOpen]="false"
                    [isOpen]="true"
                    [latitude]="stopPickerLocation.lat"
                    [longitude]="stopPickerLocation.long"
                    [maxHeight]="32"
                    [maxWidth]="26"
                    [openOnMarkerClick]="false"
                    placement="bottom"
                    [showCloseButton]="false"
                    [pointer]="false"
                >
                    <ng-template>
                        <div
                            (mouseenter)="stopPickerLocation.hover = true"
                            (mouseleave)="stopPickerLocation.hover = false"
                        >
                            <div
                                class="marker-container marker-icon stop-picker-icon stop-picker-marker-animation"
                                (click)="addNewStop($event)"
                                (mousewheel)="
                                    markerZoom($event, stopPickerLocation)
                                "
                            >
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    xmlns:xlink="http://www.w3.org/1999/xlink"
                                    width="44"
                                    height="48.364"
                                    viewBox="0 0 44 48.364"
                                >
                                    <defs>
                                        <filter
                                            id="Path_41824"
                                            x="0"
                                            y="0"
                                            width="44"
                                            height="48.364"
                                            filterUnits="userSpaceOnUse"
                                        >
                                            <feOffset input="SourceAlpha" />
                                            <feGaussianBlur
                                                stdDeviation="2"
                                                result="blur"
                                            />
                                            <feFlood flood-opacity="0.149" />
                                            <feComposite
                                                operator="in"
                                                in2="blur"
                                            />
                                            <feComposite in="SourceGraphic" />
                                        </filter>
                                    </defs>
                                    <g
                                        id="Group_103737"
                                        data-name="Group 103737"
                                        transform="translate(-1095 -945)"
                                    >
                                        <circle
                                            id="Ellipse_9165"
                                            data-name="Ellipse 9165"
                                            cx="4"
                                            cy="4"
                                            r="6"
                                            transform="translate(1113 983)"
                                            [ngStyle]="{
                                                fill: tableData[
                                                    selectedMapIndex
                                                ]?.routes[focusedRouteIndex]
                                                    .color
                                            }"
                                        />
                                        <circle
                                            id="Ellipse_9166"
                                            data-name="Ellipse 9166"
                                            cx="2"
                                            cy="2"
                                            r="2"
                                            transform="translate(1115 985.5)"
                                            [ngStyle]="{
                                                fill: '#fff'
                                            }"
                                        />
                                    </g>
                                    <g
                                        transform="matrix(1, 0, 0, 1, 0, 0)"
                                        filter="url(#Path_41824)"
                                        [ngStyle]="{
                                            filter: 'drop-shadow(0px 0px 4px #00000026)'
                                        }"
                                    >
                                        <path
                                            id="Path_41824-2"
                                            data-name="Path 41824"
                                            d="M32,15.962A15.956,15.956,0,0,1,24.942,29.2c-.035.026-.551.345-.755.479-4.9,3.113-6.863,5.215-7.654,6.394a.641.641,0,0,1-.886.18.665.665,0,0,1-.18-.18c-.791-1.18-2.762-3.281-7.654-6.394-.223-.138-.719-.452-.755-.479A15.975,15.975,0,1,1,32,15.962"
                                            transform="translate(6 6)"
                                            fill="#fff"
                                        />
                                    </g>
                                    <circle
                                        id="Ellipse_9255"
                                        data-name="Ellipse 9255"
                                        cx="13"
                                        cy="13"
                                        r="13"
                                        transform="translate(9 9.001)"
                                        [ngStyle]="{
                                            fill: tableData[selectedMapIndex]
                                                ?.routes[focusedRouteIndex]
                                                .color
                                        }"
                                    />

                                    <text
                                        dominant-baseline="middle"
                                        text-anchor="middle"
                                        id="_1"
                                        data-name="1"
                                        transform="translate(22 27.001)"
                                        fill="#fff"
                                        font-size="14"
                                        font-family="Montserrat-Bold, Montserrat"
                                        font-weight="700"
                                    >
                                        <tspan y="-3">
                                            {{
                                                stopPickerLocation.editIndex !=
                                                null
                                                    ? stopPickerLocation.editIndex +
                                                      1
                                                    : stopPickerLocation.animation
                                                    ? stopPickerLocation.animation
                                                    : focusedStopIndex != null
                                                    ? focusedStopIndex + 2
                                                    : tableData[
                                                          selectedMapIndex
                                                      ]?.routes[
                                                          focusedRouteIndex
                                                      ].stops.length + 1
                                            }}
                                        </tspan>
                                    </text>
                                </svg>
                            </div>
                            <div
                                *ngIf="
                                    tableData[selectedMapIndex]?.routes[
                                        focusedRouteIndex
                                    ].stops.length &&
                                    (stopPickerLocation.editIndex == null ||
                                        stopPickerLocation.editIndex > 0)
                                "
                                class="stop-picker-window"
                            >
                                <div
                                    class="stop-picker-button"
                                    (click)="changeEmptyLoaded($event)"
                                >
                                    <div class="stop-picker-button-text">
                                        {{
                                            stopPickerLocation.empty
                                                ? 'Empty'
                                                : 'Loaded'
                                        }}
                                    </div>
                                </div>
                            </div>
                            <div
                                class="stop-picker-address"
                                [ngStyle]="{
                                    background:
                                        'linear-gradient(0deg, ' +
                                        tableData[selectedMapIndex]?.routes[
                                            focusedRouteIndex
                                        ].color +
                                        '33' +
                                        ', ' +
                                        tableData[selectedMapIndex]?.routes[
                                            focusedRouteIndex
                                        ].color +
                                        '33)' +
                                        ', #FFFFFF',
                                    'padding-right': '0px'
                                }"
                            >
                                <div
                                    class="stop-picker-address-text"
                                    [ngStyle]="{
                                        color: tableData[selectedMapIndex]
                                            ?.routes[focusedRouteIndex].color
                                    }"
                                >
                                    {{
                                        tableData[selectedMapIndex]
                                            .addressType == 'address'
                                            ? stopPickerLocation.address.address
                                            : stopPickerLocation.cityAddress
                                    }}
                                </div>

                                <span
                                    class="delete-button"
                                    (click)="deleteStopPickerLocation($event)"
                                    (mouseover)="
                                        stopPickerLocation.deleteHover = true
                                    "
                                    (mouseleave)="
                                        stopPickerLocation.deleteHover = false
                                    "
                                >
                                    <svg
                                        height="16"
                                        viewBox="0 0 14.005 16"
                                        width="14.005"
                                        xmlns="http://www.w3.org/2000/svg"
                                        [ngStyle]="{
                                            width: '14px',
                                            height: '14px'
                                        }"
                                    >
                                        <g transform="translate(0 0)">
                                            <path
                                                d="M32.663,106.988,32,96H44l-.663,10.988a1.469,1.469,0,0,1-1.5,1.333H34.16a1.469,1.469,0,0,1-1.5-1.333Z"
                                                transform="translate(-31 -92.321)"
                                                [ngStyle]="{
                                                    fill: tableData[
                                                        selectedMapIndex
                                                    ]?.routes[focusedRouteIndex]
                                                        .color
                                                }"
                                            />
                                            <path
                                                d="M0,2.5v-1A.5.5,0,0,1,.5,1H4.251L4.545.416A.741.741,0,0,1,5.214,0H8.787a.75.75,0,0,1,.672.416L9.753,1H13.5a.5.5,0,0,1,.5.5v1a.5.5,0,0,1-.5.5H.5A.5.5,0,0,1,0,2.5Z"
                                                transform="translate(0 0)"
                                                [ngStyle]="{
                                                    fill: tableData[
                                                        selectedMapIndex
                                                    ]?.routes[focusedRouteIndex]
                                                        .color
                                                }"
                                            />
                                        </g>
                                    </svg>
                                </span>

                                <div
                                    class="stop-picker-address stop-picker-delete"
                                    [ngStyle]="{
                                        width: stopPickerLocation.deleteHover
                                            ? '50px'
                                            : '0px',
                                        padding: stopPickerLocation.deleteHover
                                            ? '2px 6px'
                                            : '0px'
                                    }"
                                >
                                    <div class="stop-picker-address-text">
                                        Delete
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </agm-snazzy-info-window>
            </agm-marker>
        </agm-map>

        <div
            id="stopPickerCursor"
            class="stop-picker-cursor"
            *ngIf="stopPickerActive && focusedRouteIndex != null && mapHover"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                width="34"
                height="34"
                viewBox="0 0 34 34"
            >
                <defs>
                    <filter
                        id="Ellipse_9150"
                        x="0"
                        y="0"
                        width="34"
                        height="34"
                        filterUnits="userSpaceOnUse"
                    >
                        <feOffset input="SourceAlpha" />
                        <feGaussianBlur stdDeviation="2" result="blur" />
                        <feFlood flood-opacity="0.149" />
                        <feComposite operator="in" in2="blur" />
                        <feComposite in="SourceGraphic" />
                    </filter>
                </defs>
                <g
                    transform="matrix(1, 0, 0, 1, 0, 0)"
                    filter="url(#Ellipse_9150)"
                >
                    <circle
                        id="Ellipse_9150-2"
                        data-name="Ellipse 9150"
                        cx="11"
                        cy="11"
                        r="11"
                        transform="translate(6 6)"
                        fill="#fff"
                    />
                </g>
                <circle
                    id="Ellipse_9149"
                    data-name="Ellipse 9149"
                    cx="9"
                    cy="9"
                    r="9"
                    transform="translate(8 8)"
                    [ngStyle]="{
                        fill: tableData[selectedMapIndex]?.routes[
                            focusedRouteIndex
                        ].color
                    }"
                />
                <text
                    dominant-baseline="middle"
                    text-anchor="middle"
                    id="_6"
                    data-name="6"
                    transform="translate(17 21.5)"
                    fill="#fff"
                    font-size="12"
                    font-family="Montserrat-Bold, Montserrat"
                    font-weight="700"
                >
                    <tspan y="-3">
                        {{
                            focusedStopIndex != null
                                ? focusedStopIndex + 2
                                : tableData[selectedMapIndex]?.routes[
                                      focusedRouteIndex
                                  ].stops.length + 1
                        }}
                    </tspan>
                </text>
            </svg>
        </div>
    </div>
</div>

<ng-template #dropdownPopover let-data="data">
    <div class="table-dropdown">
        <div
            (click)="
                action.disabled
                    ? stopDropdownClick($event)
                    : callDropDownAction($event, action)
            "
            *ngFor="let action of data"
            class="table-dropdown-content"
            [class]="action.class"
            [ngClass]="{ 'disabled-dropdown-option': action.disabled }"
            [tooltipBackground]="'#424242'"
            ngbTooltip
            [mainTooltip]="action.disabledTooltip ? action.disabledTooltip : ''"
            position="right"
            [disableTooltip]="
                action.disabled == true && action.disabledTooltip ? false : true
            "
        >
            <svg-icon
                [ngClass]="{
                    'activate-header': action.activate,
                    'deactivate-header': action.deactivate
                }"
                class="action-svg"
                src="{{ action.svg }}"
                [svgStyle]="{ 'width.px': 18, 'height.px': 18 }"
            ></svg-icon>
            <div class="dropdown-content-text">{{ action.title }}</div>
        </div>
    </div>
</ng-template>
