<div class="cards-item-wrapper-1">
    <app-ta-details-header-card
        [ngClass]="{
            disabedPreviousArrow: !brokerIndex,
            disableNextArrow: brokerIndex === brokerList.length - 1
        }"
        [cardDetailsDate]="broker?.createdAt | formatDateP"
        [tooltipNext]="
            brokerIndex === brokerList.length - 1 ? '' : 'Next Broker'
        "
        [tooltipPrevious]="!brokerIndex ? '' : 'Previous Broker'"
        [searchInputName]="'Search Broker'"
        [dateChecked]="'5 days ago'"
        [options]="brokerDropdowns"
        [currentName]="broker.businessName"
        (selectValue)="onSelectBroker($event)"
        (changeEvent)="onChangeBroker($event)"
    >
        <div class="repair-information-wrapper">
            <div class="repair-information-item">
                <span class="header-bottom">{{ broker?.dbaName }}</span>
            </div>
            <ng-container *ngIf="broker?.phone">
                <div class="repair-information-item">
                    <span
                        tooltipBackground="#6c6c6c"
                        ngbTooltip
                        mainTooltip="Call"
                        position="top"
                        class="semi-tooltip"
                    >
                        <svg-icon
                            class="repair-icon"
                            src="assets/svg/common/ic_phone.svg"
                        ></svg-icon>
                    </span>
                    <app-ta-copy
                        [copyValue]="broker?.phone"
                        [textColor]="'#2f2f2f'"
                    ></app-ta-copy>
                </div>
            </ng-container>
            <ng-container *ngIf="broker.email">
                <div class="repair-information-item">
                    <span
                        tooltipBackground="#6c6c6c"
                        ngbTooltip
                        mainTooltip="Send Email"
                        position="top"
                        class="semi-tooltip"
                    >
                        <svg-icon
                            class="repair-icon"
                            src="assets/svg/common/ic_email.svg"
                        ></svg-icon>
                    </span>
                    <app-ta-copy
                        [copyValue]="broker?.email"
                        [textColor]="'#2f2f2f'"
                    ></app-ta-copy>
                </div>
            </ng-container>
            <div class="repair-information-item address-cont">
                <svg-icon
                    class="repair-icon"
                    src="assets/svg/common/ic_address.svg"
                ></svg-icon>
                <app-ta-copy
                    [copyValue]="
                        broker?.mainAddress?.address
                            ? broker.mainAddress.address
                            : broker?.billingAddress?.address
                    "
                    [textColor]="'#2f2f2f'"
                ></app-ta-copy>
            </div>
        </div>
    </app-ta-details-header-card>
    <div
        class="wrapper-additional-cards"
        [ngClass]="{ 'bind-heigth': !templateCard }"
    >
        <div class="repair-cards">
            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="false"
                [cardName]="'Additional Info'"
                [isCardOpen]="true"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <div class="additional-template-broker-data">
                    <div class="addition-template-item">
                        <span class="header">EIN</span>
                        <span class="value">{{
                            broker?.ein | formatEinP
                        }}</span>
                    </div>
                    <div class="addition-template-item">
                        <span class="header">MC</span>
                        <span class="value">{{ broker?.mcNumber }}</span>
                    </div>
                </div>
            </app-ta-custom-card>
            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="true"
                [hasCounter]="20"
                [cardName]="'Paid Invoice'"
                [isCardOpen]="true"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <div
                    class="charts-template perfomance"
                    [class.p-0]="invoiceChart.hoveringStatus"
                >
                    <div [class.d-none]="invoiceChart.hoveringStatus">
                        <app-ta-tab-switch
                            [type]="'type2-modal-popup'"
                            (switchClicked)="changeInvoiceTab($event)"
                            [tabs]="tabsBroker"
                        >
                        </app-ta-tab-switch>
                    </div>
                    <app-ta-chart
                        #invoiceChart
                        [chartConfig]="invoiceChartConfig"
                        [axesProperties]="invoiceAxes"
                        [legendAttributes]="invoiceChartLegend"
                    >
                    </app-ta-chart>
                </div>
            </app-ta-custom-card>
            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="true"
                [cardName]="'Mileage Rate History'"
                [isCardOpen]="false"
                [tooltipName]="'View in Modal'"
                [hasHeaderSvg]="'assets/svg/common/arrow_top_right.svg'"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <div
                    class="charts-template perfomance"
                    [class.p-0]="mileageChart.hoveringStatus"
                >
                    <ng-container *ngIf="!mileageChart.hoveringStatus">
                        <div>
                            <app-ta-tab-switch
                                [type]="'type2-modal-popup'"
                                [tabs]="tabsBroker"
                                (switchClicked)="changeMileageTab($event)"
                            >
                            </app-ta-tab-switch>
                        </div>
                    </ng-container>
                    <app-ta-chart
                        #mileageChart
                        [chartConfig]="mileageChartConfig"
                        [axesProperties]="mileageBarAxes"
                        [legendAttributes]="mileageBarChartLegend"
                    >
                    </app-ta-chart>
                </div>
            </app-ta-custom-card>
            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="true"
                [hasCounter]="
                    invoiceAgeingCounter
                        ? invoiceAgeingCounter
                        : broker?.brokerUnpaidInvoiceAgeing?.invoiceAgeingGroup
                              ?.countInvoice
                "
                [cardName]="'Invoice Ageing'"
                [isCardOpen]="true"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <div class="invoice-ageing-template">
                    <div class="invoice-ageing-template-item">
                        <span class="header-name">Total Debt</span>
                        <span class="value-ageing">{{
                            broker?.totalDebt | formatCurrency
                        }}</span>
                    </div>
                    <ng-container *ngIf="broker?.payTerm?.name === 'Unlimited'">
                        <div class="invoice-agein-unlimited">
                            Avg.
                            <span class="avg-days-invoice"
                                >{{
                                    broker?.invoiceAgeingGroup?.averageDays
                                }}
                                Days</span
                            >
                        </div>
                    </ng-container>
                </div>
                <ng-container
                    *ngIf="
                        broker?.payTerm?.name !== 'Unlimited' &&
                        broker?.brokerPaidInvoiceAgeing?.invoiceAgeingGroupOne
                    "
                >
                    <app-ta-progress-invoices
                        [invoiceDays]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupOne?.periodOfDays
                        "
                        [invoiceCounter]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupOne?.countInvoice
                        "
                        [invoiceTotal]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupOne?.totalSum
                        "
                        [template]="'light-blue'"
                    >
                    </app-ta-progress-invoices>
                </ng-container>

                <ng-container
                    *ngIf="
                        broker?.payTerm?.name !== 'Unlimited' &&
                        broker?.brokerPaidInvoiceAgeing?.invoiceAgeingGroupTwo
                    "
                >
                    <app-ta-progress-invoices
                        [invoiceDays]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupTwo?.periodOfDays
                        "
                        [invoiceCounter]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupTwo?.countInvoice
                        "
                        [invoiceTotal]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupTwo?.totalSum
                        "
                        [template]="'mid-blue'"
                    >
                    </app-ta-progress-invoices>
                </ng-container>
                <ng-container
                    *ngIf="
                        broker?.payTerm?.name !== 'Unlimited' &&
                        broker?.brokerPaidInvoiceAgeing?.invoiceAgeingGroupThree
                    "
                >
                    <app-ta-progress-invoices
                        [invoiceDays]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupThree?.periodOfDays
                        "
                        [invoiceCounter]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupThree?.countInvoice
                        "
                        [invoiceTotal]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupThree?.totalSum
                        "
                        [template]="'dark-blue'"
                    >
                    </app-ta-progress-invoices>
                </ng-container>
                <ng-container
                    *ngIf="
                        broker?.payTerm?.name !== 'Unlimited' &&
                        broker?.brokerPaidInvoiceAgeing?.invoiceAgeingGroupFour
                    "
                >
                    <app-ta-progress-invoices
                        [invoiceDays]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupFour?.periodOfDays
                        "
                        [invoiceCounter]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupFour?.countInvoice
                        "
                        [invoiceTotal]="
                            broker?.brokerPaidInvoiceAgeing
                                ?.invoiceAgeingGroupFour?.totalSum
                        "
                        [template]="'danger'"
                    >
                    </app-ta-progress-invoices>
                </ng-container>
            </app-ta-custom-card>

            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="true"
                [cardName]="'Terms and Credit'"
                [isCardOpen]="true"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <ng-container *ngIf="broker?.availableCredit">
                    <div class="invoice-ageing-template">
                        <div class="invoice-ageing-template-item">
                            <span class="header-name">Available Credit</span>
                            <div class="credit-perctange">
                                <span class="value-ageing">{{
                                    broker?.availableCredit | formatCurrency
                                }}</span>
                                <div class="percntage-broker">
                                    {{ getPercntageOfPaid.toFixed(0) }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <ng-container *ngIf="broker.availableCredit">
                    <div class="progress-container">
                        <app-ta-currency-progress-bar
                            [template]="'broker-credit'"
                            [totalAmount]="broker.creditLimit"
                            [paidSoFarAmount]="broker.totalDebt"
                        >
                        </app-ta-currency-progress-bar>
                    </div>
                </ng-container>
                <div class="additional-template-broker-data">
                    <div class="addition-template-item">
                        <span class="header">Credit</span>
                        <span class="value charts-value">{{
                            broker.creditType.name === 'Unlimited'
                                ? 'Unlimited'
                                : (broker?.creditLimit | formatCurrency)
                        }}</span>
                    </div>
                    <div class="addition-template-item">
                        <span class="header">Pay Term</span>
                        <span class="value charts-value">{{
                            broker?.payTerm?.name
                        }}</span>
                    </div>
                </div>
            </app-ta-custom-card>

            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="true"
                [cardName]="'Payment History'"
                [isCardOpen]="false"
                [hasHeaderSvg]="'assets/svg/common/arrow_top_right.svg'"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <div
                    class="charts-template perfomance"
                    [class.p-0]="paymentChart.hoveringStatus"
                >
                    <ng-container *ngIf="!paymentChart.hoveringStatus">
                        <div>
                            <app-ta-tab-switch
                                [tabs]="tabsBroker"
                                [type]="'type2-modal-popup'"
                                (switchClicked)="changePaymentTab($event)"
                            >
                            </app-ta-tab-switch>
                        </div>
                    </ng-container>
                    <app-ta-chart
                        #paymentChart
                        [chartConfig]="paymentChartConfig"
                        [axesProperties]="paymentAxes"
                        [legendAttributes]="paymentChartLegend"
                    >
                    </app-ta-chart>
                </div>
            </app-ta-custom-card>

            <div class="divider"></div>
            <div class="note-cards">
                <app-ta-input-note
                    [formControl]="note"
                    [isVisibleArrow]="true"
                    [isVisibleNote]="true"
                    [minRows]="1"
                    [isVisibleDivider]="false"
                    [placeholder]="'Write something.'"
                    [customClass]="'note-small'"
                    [note]="broker.note"
                    [noteType]="'details-card'"
                    [entityId]="broker.id"
                    [entityType]="'Broker'"
                ></app-ta-input-note>
            </div>
        </div>
    </div>
</div>
