<div class="cards-item-wrapper-1">
    <app-ta-details-header-card
        [ngClass]="{
            disabedPreviousArrow: !brokerIndex,
            disableNextArrow: brokerIndex === brokerList.length - 1
        }"
        [cardDetailsDate]="broker?.createdAt | formatDateP"
        [tooltipNext]="
            brokerIndex === brokerList.length - 1 ? '' : 'Next Broker'
        "
        [tooltipPrevious]="!brokerIndex ? '' : 'Previous Broker'"
        [searchInputName]="'Search Broker'"
        [dateChecked]="broker?.updatedAt | formatDateP"
        [options]="brokerDropdowns"
        [currentName]="broker.businessName"
        (selectValue)="onSelectBroker($event)"
        (changeEvent)="onChangeBroker($event)"
    >
        <div class="repair-information-wrapper">
            <div class="repair-information-item">
                <span class="header-bottom">{{ broker?.dbaName }}</span>
            </div>
            <ng-container *ngIf="broker?.phone">
                <div class="repair-information-item">
                    <span
                        tooltipBackground="#6c6c6c"
                        ngbTooltip
                        mainTooltip="Call"
                        position="top"
                        class="semi-tooltip"
                    >
                        <svg-icon
                            class="repair-icon"
                            [src]="brokerDetailsSvgRoutes.phoneIcon"
                        ></svg-icon>
                    </span>
                    <app-ta-copy
                        [copyValue]="broker?.phone"
                        [textColor]="'#2f2f2f'"
                    ></app-ta-copy>
                </div>
            </ng-container>
            <ng-container *ngIf="broker.email">
                <div class="repair-information-item">
                    <span
                        tooltipBackground="#6c6c6c"
                        ngbTooltip
                        mainTooltip="Send Email"
                        position="top"
                        class="semi-tooltip"
                    >
                        <svg-icon
                            class="repair-icon"
                            [src]="brokerDetailsSvgRoutes.emailIcon"
                        ></svg-icon>
                    </span>
                    <app-ta-copy
                        [copyValue]="broker?.email"
                        [textColor]="'#2f2f2f'"
                    ></app-ta-copy>
                </div>
            </ng-container>
            <div class="repair-information-item address-cont">
                <svg-icon
                    class="repair-icon"
                    [src]="brokerDetailsSvgRoutes.addressIcon"
                ></svg-icon>
                <app-ta-copy
                    [copyValue]="
                        broker?.mainAddress?.address
                            ? broker.mainAddress.address
                            : broker?.billingAddress?.address
                    "
                    [textColor]="'#2f2f2f'"
                ></app-ta-copy>
            </div>
        </div>
    </app-ta-details-header-card>
    <div
        class="wrapper-additional-cards"
        [ngClass]="{ 'bind-heigth': !templateCard }"
    >
        <div class="repair-cards">
            <ng-container *ngIf="broker?.ein || broker?.mcNumber">
                <app-ta-custom-card
                    [bodyTemplate]="'card'"
                    [hasDivider]="false"
                    [cardName]="'Additional Info'"
                    [isCardOpen]="true"
                    [animationMarginParams]="{
                        marginTop: '0px',
                        marginBottom: '10px'
                    }"
                    [customClass]="'detailsPadding'"
                >
                    <div class="additional-template-broker-data">
                        <div class="addition-template-item">
                            <span class="header ta-font-bold">EIN</span>
                            <span class="value">{{
                                broker?.ein | formatEinP
                            }}</span>
                        </div>
                        <div class="addition-template-item">
                            <span class="header ta-font-bold">MC</span>
                            <span class="value">{{ broker?.mcNumber }}</span>
                        </div>
                    </div>
                </app-ta-custom-card>
            </ng-container>

            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="broker?.ein || broker?.mcNumber"
                [hasCounter]="invoiceChartCount"
                [cardName]="'Invoice'"
                [isCardOpen]="true"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <!-- <div
                    class="charts-template perfomance"
                    [class.p-0]="invoiceChart?.hoveringStatus"
                >
                    <div [class.d-none]="invoiceChart?.hoveringStatus">
                        <app-ta-tab-switch
                            [type]="'type2-modal-popup'"
                            (switchClicked)="changeInvoiceTab($event)"
                            [tabs]="tabsBroker"
                        >
                        </app-ta-tab-switch>
                    </div>
                    <app-ta-chart
                        #invoiceChart
                        [chartConfig]="invoiceChartConfig"
                        [axesProperties]="invoiceAxes"
                        [legendAttributes]="invoiceChartLegend"
                    >
                    </app-ta-chart>
                </div> -->
            </app-ta-custom-card>
            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="true"
                [cardName]="'Mileage Rate History'"
                [isCardOpen]="false"
                [tooltipName]="'View in Modal'"
                [hasHeaderSvg]="brokerDetailsSvgRoutes.rightArrowIcon"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <!-- <div
                    class="charts-template perfomance"
                    [class.p-0]="mileageChart?.hoveringStatus"
                >
                    <ng-container *ngIf="!mileageChart?.hoveringStatus">
                        <div>
                            <app-ta-tab-switch
                                [type]="'type2-modal-popup'"
                                [tabs]="tabsBroker"
                                (switchClicked)="changeMileageTab($event)"
                            >
                            </app-ta-tab-switch>
                        </div>
                    </ng-container>
                    <app-ta-chart
                        #mileageChart
                        [chartConfig]="mileageChartConfig"
                        [axesProperties]="mileageBarAxes"
                        [legendAttributes]="mileageBarChartLegend"
                    >
                    </app-ta-chart>
                </div> -->
            </app-ta-custom-card>

            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="true"
                [cardName]="'Terms and Credit'"
                [isCardOpen]="true"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <ng-container *ngIf="broker?.availableCredit">
                    <div class="invoice-ageing-template">
                        <div class="invoice-ageing-template-item">
                            <span class="header-name ta-font-bold mb-1"
                                >Available Credit</span
                            >
                            <div class="credit-perctange">
                                <span class="value-ageing ta-font-medium">{{
                                    broker?.availableCredit | formatCurrency
                                }}</span>
                                <div class="percntage-broker ta-font-medium">
                                    {{ getPercntageOfPaid }}%
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-container>
                <ng-container *ngIf="broker.availableCredit">
                    <div
                        class="table-progress-bar-container my-2"
                        [ngClass]="
                            getPercntageOfPaid | progressBarColors : false
                        "
                    >
                        <div
                            class="table-progress-bar"
                            [ngClass]="
                                getPercntageOfPaid | progressBarColors : true
                            "
                            [ngStyle]="{
                                width: getPercntageOfPaid + '%'
                            }"
                        ></div>
                    </div>
                </ng-container>
                <div class="additional-template-broker-data">
                    <div class="addition-template-item">
                        <span class="header ta-font-bold mb-1"
                            >Total Credit</span
                        >
                        <span class="value">{{
                            broker.creditType.name === 'Unlimited'
                                ? 'Unlimited'
                                : (broker?.creditLimit | formatCurrency)
                        }}</span>
                    </div>
                    <div class="addition-template-item">
                        <span class="header ta-font-bold mb-1">Pay Term</span>
                        <span class="value">{{ broker?.payTerm?.name }}</span>
                    </div>
                </div>
            </app-ta-custom-card>

            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="true"
                [hasCounter]="
                    invoiceAgeingCounter
                        ? invoiceAgeingCounter
                        : broker?.brokerUnpaidInvoiceAgeing?.invoiceAgeingGroup
                              ?.countInvoice
                "
                [cardName]="'Invoice Ageing'"
                [isCardOpen]="true"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <app-ta-tab-switch
                    [tabs]="invoiceAgingTabs"
                    (switchClicked)="changeInvoiceAgingTab($event)"
                    [type]="'type2-modal-popup'"
                >
                </app-ta-tab-switch>

                <div class="invoice-ageing-template my-2">
                    <div class="invoice-ageing-template-item">
                        <span class="header-name ta-font-bold">{{
                            invoiceAgingSelectedTab === 1
                                ? 'Total Debt'
                                : 'Total Paid'
                        }}</span>
                        <span class="value-ageing ta-font-medium">{{
                            (invoiceAgingSelectedTab === 1
                                ? inoviceAgingData?.totalPaid
                                : inoviceAgingData?.totalDebt
                            ) | formatCurrency
                        }}</span>
                    </div>
                    <ng-container *ngIf="broker?.payTerm?.name === 'Unlimited'">
                        <div class="invoice-agein-unlimited">
                            Avg.
                            <span class="avg-days-invoice"
                                >{{
                                    inoviceAgingData?.invoiceAgeingGroup
                                        ?.averageDays ?? 0
                                }}
                                Days</span
                            >
                        </div>
                    </ng-container>
                </div>

                <div class="w-100 d-flex flex-column gap-2">
                    <ng-container
                        *ngIf="
                            broker?.payTerm?.name !== 'Unlimited' &&
                            inoviceAgingData?.invoiceAgeingGroupOne
                        "
                    >
                        <app-ta-progress-invoices
                            [invoiceDays]="
                                inoviceAgingData?.invoiceAgeingGroupOne
                                    ?.periodOfDays
                            "
                            [invoiceCounter]="
                                inoviceAgingData?.invoiceAgeingGroupOne
                                    ?.countInvoice
                            "
                            [invoiceTotal]="
                                inoviceAgingData?.invoiceAgeingGroupOne
                                    ?.totalSum
                            "
                            [invoicePercentage]="
                                inoviceAgingData?.invoiceAgeingGroupOne
                                    ?.percentage
                            "
                            [template]="'light-blue'"
                            [type]="
                                invoiceAgingSelectedTab === 1
                                    ? 'unpaid'
                                    : 'paid'
                            "
                        >
                        </app-ta-progress-invoices>
                    </ng-container>

                    <ng-container
                        *ngIf="
                            broker?.payTerm?.name !== 'Unlimited' &&
                            inoviceAgingData?.invoiceAgeingGroupTwo
                        "
                    >
                        <app-ta-progress-invoices
                            [invoiceDays]="
                                inoviceAgingData?.invoiceAgeingGroupTwo
                                    ?.periodOfDays
                            "
                            [invoiceCounter]="
                                inoviceAgingData?.invoiceAgeingGroupTwo
                                    ?.countInvoice
                            "
                            [invoiceTotal]="
                                inoviceAgingData?.invoiceAgeingGroupTwo
                                    ?.totalSum
                            "
                            [invoicePercentage]="
                                inoviceAgingData?.invoiceAgeingGroupTwo
                                    ?.percentage
                            "
                            [template]="'mid-blue'"
                            [type]="
                                invoiceAgingSelectedTab === 1
                                    ? 'unpaid'
                                    : 'paid'
                            "
                        >
                        </app-ta-progress-invoices>
                    </ng-container>
                    <ng-container
                        *ngIf="
                            broker?.payTerm?.name !== 'Unlimited' &&
                            inoviceAgingData?.invoiceAgeingGroupThree
                        "
                    >
                        <app-ta-progress-invoices
                            [invoiceDays]="
                                inoviceAgingData?.invoiceAgeingGroupThree
                                    ?.periodOfDays
                            "
                            [invoiceCounter]="
                                inoviceAgingData?.invoiceAgeingGroupThree
                                    ?.countInvoice
                            "
                            [invoiceTotal]="
                                inoviceAgingData?.invoiceAgeingGroupThree
                                    ?.totalSum
                            "
                            [invoicePercentage]="
                                inoviceAgingData?.invoiceAgeingGroupThree
                                    ?.percentage
                            "
                            [template]="'dark-blue'"
                            [type]="
                                invoiceAgingSelectedTab === 1
                                    ? 'unpaid'
                                    : 'paid'
                            "
                        >
                        </app-ta-progress-invoices>
                    </ng-container>
                    <ng-container
                        *ngIf="
                            broker?.payTerm?.name !== 'Unlimited' &&
                            inoviceAgingData?.invoiceAgeingGroupFour
                        "
                    >
                        <app-ta-progress-invoices
                            [invoiceDays]="
                                inoviceAgingData?.invoiceAgeingGroupFour
                                    ?.periodOfDays
                            "
                            [invoiceCounter]="
                                inoviceAgingData?.invoiceAgeingGroupFour
                                    ?.countInvoice
                            "
                            [invoiceTotal]="
                                inoviceAgingData?.invoiceAgeingGroupFour
                                    ?.totalSum
                            "
                            [invoicePercentage]="
                                inoviceAgingData?.invoiceAgeingGroupFour
                                    ?.percentage
                            "
                            [template]="'danger'"
                            [type]="
                                invoiceAgingSelectedTab === 1
                                    ? 'unpaid'
                                    : 'paid'
                            "
                        >
                        </app-ta-progress-invoices>
                    </ng-container>
                </div>
            </app-ta-custom-card>

            <app-ta-custom-card
                [bodyTemplate]="'card'"
                [hasDivider]="true"
                [cardName]="'Payment History'"
                [isCardOpen]="false"
                [hasHeaderSvg]="brokerDetailsSvgRoutes.rightArrowIcon"
                [animationMarginParams]="{
                    marginTop: '0px',
                    marginBottom: '10px'
                }"
                [customClass]="'detailsPadding'"
            >
                <!-- <div
                    class="charts-template perfomance"
                    [class.p-0]="paymentChart?.hoveringStatus"
                >
                    <ng-container *ngIf="!paymentChart?.hoveringStatus">
                        <div>
                            <app-ta-tab-switch
                                [tabs]="tabsBroker"
                                [type]="'type2-modal-popup'"
                                (switchClicked)="changePaymentTab($event)"
                            >
                            </app-ta-tab-switch>
                        </div>
                    </ng-container>
                    <app-ta-chart
                        #paymentChart
                        [chartConfig]="paymentChartConfig"
                        [axesProperties]="paymentAxes"
                        [legendAttributes]="paymentChartLegend"
                    >
                    </app-ta-chart>
                </div> -->
            </app-ta-custom-card>

            <div class="divider"></div>
            <div class="note-cards">
                <app-ta-input-note
                    [formControl]="note"
                    [isVisibleArrow]="true"
                    [isVisibleNote]="true"
                    [minRows]="1"
                    [isVisibleDivider]="false"
                    [placeholder]="'Write something.'"
                    [customClass]="'note-small'"
                    [note]="broker.note"
                    [noteType]="'details-card'"
                    [entityId]="broker.id"
                    [entityType]="'Broker'"
                ></app-ta-input-note>
            </div>
        </div>
    </div>
</div>
