<app-ta-modal
    [modalTitle]="
        !editData?.type?.includes('edit') ? 'Add Shipper' : 'Edit Shipper'
    "
    [editData]="editData"
    [editName]="shipperName"
    [isModalValid]="isModalValidToSubmit"
    [saveAndAddNew]="editData?.type !== 'edit'"
    [customClass]="'modal-container-M'"
    [isClickEnabledWhileFormInvalid]="true"
    [topDivider]="false"
    (action)="onModalAction($event)"
>
    <div origin>
        <app-ta-tab-switch
            [tabs]="tabs"
            [type]="'type1-modal-popup'"
            [isMarginTopDisabled]="true"
            (switchClicked)="tabChange($event)"
        >
        </app-ta-tab-switch>

        <form
            [formGroup]="shipperForm"
            class="form-container"
            [ngClass]="{
                'tab-2': selectedTab !== 1,
                'form-container-with-card-2': selectedTab === 2
            }"
        >
            <div
                class="{{
                    editData ? 'animation-three-tabs' : 'animation-two-tabs'
                }}"
                [@animationTabsModal]="animationObject"
            >
                <!-------------------------------- Details Tab -------------------------------->

                <div class="m-tab" [hidden]="selectedTab !== 1">
                    <div class="row">
                        <div class="col-12">
                            <app-ta-input
                                formControlName="businessName"
                                [inputConfig]="{
                                    name: 'Business Name',
                                    type: 'text',
                                    label: 'Business Name',
                                    isRequired: true,
                                    textTransform: 'uppercase',
                                    autoFocus: editData?.type !== 'edit',
                                    minLength: 2,
                                    maxLength: 64
                                }"
                            ></app-ta-input>
                        </div>
                    </div>
                    <div class="phone-extension-medium-modal">
                        <div
                            [ngClass]="{ 'active-phone-ext': isPhoneExtExist }"
                        >
                            <div class="phone-field">
                                <app-ta-input
                                    formControlName="phone"
                                    [inputConfig]="{
                                        name: 'Phone',
                                        type: 'text',
                                        label: 'Phone',
                                        placeholderIcon: 'phone',
                                        mask: '(000) 000-0000',
                                        maxLength: 14
                                    }"
                                ></app-ta-input>
                            </div>
                        </div>
                        <div class="email-field">
                            <app-ta-input
                                formControlName="email"
                                [inputConfig]="{
                                    name: 'Email',
                                    type: 'text',
                                    label: 'Email',
                                    placeholderIcon: 'email',
                                    minLength: 5,
                                    maxLength: 64,
                                    textTransform: 'lowercase'
                                }"
                            ></app-ta-input>
                        </div>
                    </div>

                    <app-ta-tab-switch
                        [tabs]="physicalAddressTabs"
                        (switchClicked)="tabPhysicalAddressChange($event)"
                        [type]="'type2-modal-popup'"
                    ></app-ta-tab-switch>

                    <div class="row first-row last-row">
                        <ng-container
                            *ngIf="
                                selectedPhysicalAddressTab === 1;
                                else coordinatesContainer
                            "
                        >
                            <div class="col-10">
                                <app-ta-input-address-dropdown
                                    formControlName="address"
                                    [inputConfig]="getAddressInputConfig"
                                    [placeholderType]="'longAddress'"
                                    [activeAddress]="selectedAddress"
                                    (selectedAddress)="onHandleAddress($event)"
                                ></app-ta-input-address-dropdown>
                            </div>
                            <div class="col-2">
                                <app-ta-input
                                    formControlName="addressUnit"
                                    [inputConfig]="getAddressUnitInputConfig"
                                ></app-ta-input>
                            </div>
                        </ng-container>

                        <ng-template #coordinatesContainer>
                            <div class="col-3">
                                <app-ta-input
                                    formControlName="latitude"
                                    [inputConfig]="getLatitudeInputConfig"
                                ></app-ta-input>
                            </div>
                            <div class="col-3">
                                <app-ta-input
                                    formControlName="longitude"
                                    [inputConfig]="getLongitudeInputConfig"
                                ></app-ta-input>
                            </div>
                            <div class="col-6">
                                <app-ta-input
                                    formControlName="countryStateAddress"
                                    [inputConfig]="getCountryStateInputConfig"
                                    [placeholderType]="'shortAddress'"
                                ></app-ta-input>
                            </div>
                        </ng-template>
                    </div>
                    <app-ta-custom-card
                        [cardName]="'Receiving Work Hours'"
                        [isCardOpen]="true"
                        [disableAnimation]="isCardAnimationDisabled"
                        [animationMarginParams]="{
                            marginTop: '22px',
                            marginBottom: '22px'
                        }"
                    >
                        <div class="shipper-work-hours">
                            <div class="shipper-work-hours-field">
                                <app-ta-checkbox
                                    formControlName="receivingAppointment"
                                    [name]="'receivingAppointment'"
                                    [customClass]="'medium'"
                                    [label]="'Appointment'"
                                ></app-ta-checkbox>
                            </div>
                            <div class="shipper-work-hours-field">
                                <app-ta-checkbox
                                    formControlName="receivingOpenTwentyFourHours"
                                    [name]="'receivingOpenTwentyFourHours'"
                                    [customClass]="'medium'"
                                    [label]="'Open 24h'"
                                ></app-ta-checkbox>
                            </div>
                            <div class="shipper-work-hours-field">
                                <!-- Time Picker -->
                                <app-ta-input
                                    formControlName="receivingFrom"
                                    [inputConfig]="{
                                        name: 'timepicker',
                                        type: 'text',
                                        label: 'From',
                                        placeholderIcon: 'time',
                                        isDropdown: true,
                                        isDisabled:
                                            shipperForm.get(
                                                'receivingOpenTwentyFourHours'
                                            ).value &&
                                            shipperForm.get(
                                                'receivingAppointment'
                                            ).value,
                                        customClass: 'datetimeclass'
                                    }"
                                ></app-ta-input>
                            </div>
                            <div class="shipper-work-hours-field">
                                <!-- Time Picker -->
                                <app-ta-input
                                    formControlName="receivingTo"
                                    [inputConfig]="{
                                        name: 'timepicker',
                                        type: 'text',
                                        label: 'To',
                                        placeholderIcon: 'time',
                                        isDropdown: true,
                                        isDisabled:
                                            shipperForm.get(
                                                'receivingOpenTwentyFourHours'
                                            ).value &&
                                            shipperForm.get(
                                                'receivingAppointment'
                                            ).value,
                                        customClass: 'datetimeclass'
                                    }"
                                ></app-ta-input>
                            </div>
                        </div>
                    </app-ta-custom-card>

                    <app-ta-checkbox
                        formControlName="shippingHoursSameReceiving"
                        [customClass]="'medium shipper-hours'"
                        [label]="'Shipping hours are same as receiving hours'"
                    ></app-ta-checkbox>

                    <app-ta-custom-card
                        *ngIf="
                            !shipperForm.get('shippingHoursSameReceiving').value
                        "
                        [cardName]="'Shipping Hours'"
                        [isCardOpen]="
                            !shipperForm.get('shippingHoursSameReceiving').value
                        "
                        [disableAnimation]="isCardAnimationDisabled"
                        [animationMarginParams]="{
                            marginTop: '18px',
                            marginBottom: '22px'
                        }"
                    >
                        <div class="shipper-work-hours">
                            <div class="shipper-work-hours-field">
                                <app-ta-checkbox
                                    formControlName="shippingAppointment"
                                    [name]="'shippingAppointment'"
                                    [customClass]="'medium'"
                                    [label]="'Appointment'"
                                ></app-ta-checkbox>
                            </div>
                            <div class="shipper-work-hours-field">
                                <app-ta-checkbox
                                    formControlName="shippingOpenTwentyFourHours"
                                    [name]="'shippingOpenTwentyFourHours'"
                                    [customClass]="'medium'"
                                    [label]="'Open 24h'"
                                ></app-ta-checkbox>
                            </div>
                            <div class="shipper-work-hours-field">
                                <!-- Time Picker -->
                                <app-ta-input
                                    formControlName="shippingFrom"
                                    [inputConfig]="{
                                        name: 'timepicker',
                                        type: 'text',
                                        label: 'From',
                                        placeholderIcon: 'time',
                                        isDropdown: true,
                                        isDisabled:
                                            shipperForm.get(
                                                'shippingOpenTwentyFourHours'
                                            ).value &&
                                            shipperForm.get(
                                                'shippingAppointment'
                                            ).value,
                                        customClass: 'datetimeclass'
                                    }"
                                ></app-ta-input>
                            </div>
                            <div class="shipper-work-hours-field">
                                <!-- Time Picker -->
                                <app-ta-input
                                    formControlName="shippingTo"
                                    [inputConfig]="{
                                        name: 'timepicker',
                                        type: 'text',
                                        label: 'To',
                                        placeholderIcon: 'time',
                                        isDropdown: true,
                                        isDisabled:
                                            shipperForm.get(
                                                'shippingOpenTwentyFourHours'
                                            ).value &&
                                            shipperForm.get(
                                                'shippingAppointment'
                                            ).value,
                                        customClass: 'datetimeclass'
                                    }"
                                ></app-ta-input>
                            </div>
                        </div>
                    </app-ta-custom-card>
                    <div class="ta-card-body-overflow-none">
                        <app-ta-custom-card
                            [hasCounter]="documents?.length ?? 0"
                            [cardName]="'Document'"
                            [disableAnimation]="isCardAnimationDisabled"
                            [isCardOpen]="!!documents.length"
                        >
                            <app-ta-upload-files
                                [files]="documents"
                                [size]="'medium'"
                                [showDropzone]="true"
                                (onFileEvent)="onFilesEvent($event)"
                                [customClassName]="'modals'"
                            ></app-ta-upload-files>
                        </app-ta-custom-card>
                    </div>
                    <app-ta-input-note
                        formControlName="note"
                        [isVisibleNote]="
                            shipperForm.get('note').value &&
                            shipperForm.get('note').value != 'null'
                                ? shipperForm.get('note').value
                                : false
                        "
                        [note]="
                            shipperForm.get('note').value &&
                            shipperForm.get('note').value != 'null'
                                ? shipperForm.get('note').value
                                : ''
                        "
                    ></app-ta-input-note>
                </div>

                <!-------------------------------- Contact Tab -------------------------------->

                <div class="m-tab" [hidden]="selectedTab !== 2">
                    <app-ta-custom-card
                        [cardName]="'Contact'"
                        [hasCounter]="shipperContacts?.length"
                        [hasActionSvg]="true"
                        [hasArrow]="false"
                        [isCardOpen]="shipperContacts?.length"
                        [hasScrollBody]="shipperContacts?.length > 10"
                        [disabledCard]="!shipperContacts?.length"
                        [disableAnimation]="isCardAnimationDisabled"
                        [hasScrollBodyXAxis]="true"
                        [animationMarginParams]="{
                            marginTop: '10px',
                            marginBottom: '5px'
                        }"
                        (onActionEvent)="addContact()"
                    >
                        <app-ta-modal-table
                            [tableType]="modalTableTypeEnum.CONTACT"
                            [modalTableData]="updatedShipperContacts"
                            [dropdownData]="departmentOptions"
                            [isNewRowCreated]="isNewContactAdded"
                            (modalTableValueEmitter)="
                                handleModalTableValueEmit($event)
                            "
                            (modalTableValidStatusEmitter)="
                                handleModalTableValidStatusEmit($event)
                            "
                        >
                        </app-ta-modal-table>
                    </app-ta-custom-card>

                    <ng-container *ngIf="!shipperContacts?.length">
                        <div class="no-review-shipper">
                            <svg-icon
                                class="no-review-svg"
                                [src]="brokerModalSvgRoutes.noContactIcon"
                            ></svg-icon>
                        </div>
                    </ng-container>
                </div>

                <!-------------------------------- Review Tab -------------------------------->

                <div class="m-tab" [hidden]="selectedTab !== 3">
                    <app-ta-custom-card
                        [cardName]="'Review'"
                        [hasCounter]="reviews?.length"
                        [hasActionSvg]="true"
                        [hasArrow]="false"
                        [hasLikeDislike]="false"
                        [isCardOpen]="true"
                        [hasBodyData]="reviews?.length"
                        [hasScrollBody]="reviews?.length > 6"
                        [disableMultipleReviews]="isOneMoreReviewDisabled"
                        [disableAnimation]="isCardAnimationDisabled"
                        (onActionEvent)="createReview()"
                    >
                        <app-ta-user-review
                            [reviewData]="reviews"
                            [isNewReview]="reviews[0]?.isNewReview"
                            (changeReviewsEvent)="changeReviewsEvent($event)"
                        ></app-ta-user-review>
                    </app-ta-custom-card>

                    <ng-container *ngIf="!reviews?.length">
                        <div class="no-review-shipper">
                            <svg-icon
                                class="no-review-svg"
                                [src]="brokerModalSvgRoutes.noReviewsIcon"
                            ></svg-icon>
                        </div>
                    </ng-container>
                </div>
            </div>
        </form>
    </div>
</app-ta-modal>
