<app-ca-modal
    [modalTitle]="editData?.type !== 'edit' ? 'Add Driver' : 'Edit Driver'"
    [rightHeaderTemplate]="rightModalContent"
    [leftHeaderTemplate]="leftModalContent"
    [footerTemplate]="footerTemplate"
    [customClass]="'modal-container-M'"
>
    <div class="new-modal" origin>
        <!-- Tabs -->

        <app-ta-tab-switch
            [tabs]="mainTabs"
            customClass="mt-0"
            [type]="'type1-modal-popup'"
            (switchClicked)="onTabChange($event)"
        >
        </app-ta-tab-switch>

        <!-- Form -->

        <form
            class="form-container"
            [ngClass]="{
                'tab-2': selectedTabId === 2,
                'form-container-without-mb': selectedTabId === 2,
            }"
            [formGroup]="driverForm"
        >
            <div
                class="animation-two-tabs"
                [@animationTabsModal]="animationObject"
            >
                <!-- Basic Tab -->

                <ng-container *ngIf="selectedTabId === 1; else selectedTabTwo">
                    <div class="m-tab">
                        <!-- First Name, Last Name, DOB -->

                        <div class="driver-modal-first-row">
                            <app-ca-input
                                formControlName="firstName"
                                [inputConfig]="{
                                    name: 'First Name',
                                    type: 'text',
                                    label: 'First Name',
                                    isRequired: true,
                                    textTransform: 'capitalize',
                                    minLength: 2,
                                    maxLength: 26,
                                    autoFocus: editData?.type !== 'edit',
                                }"
                            ></app-ca-input>

                            <app-ca-input
                                formControlName="lastName"
                                [inputConfig]="{
                                    name: 'Last name',
                                    type: 'text',
                                    label: 'Last Name',
                                    textTransform: 'capitalize',
                                    isRequired: true,
                                    minLength: 2,
                                    maxLength: 26,
                                }"
                            ></app-ca-input>

                            <app-ca-input
                                formControlName="dateOfBirth"
                                [inputConfig]="{
                                    name: 'datepicker',
                                    type: 'text',
                                    label: 'DOB',
                                    isDropdown: true,
                                    placeholderIcon: 'date',
                                    isRequired: true,
                                    customClass: 'datetimeclass',
                                }"
                            ></app-ca-input>
                        </div>

                        <!-- Phone, Email, SSN -->

                        <div class="driver-modal-second-row">
                            <app-ca-input
                                formControlName="phone"
                                [inputConfig]="{
                                    name: 'Phone',
                                    type: 'text',
                                    label: 'Phone',
                                    isRequired: true,
                                    placeholderIcon: 'phone',
                                    mask: '(000) 000-0000',
                                    maxLength: 14,
                                }"
                            ></app-ca-input>

                            <app-ca-input
                                formControlName="email"
                                [inputConfig]="{
                                    name: 'Email',
                                    type: 'text',
                                    label: 'Email',
                                    isRequired: true,
                                    placeholderIcon: 'email',
                                    minLength: 5,
                                    maxLength: 64,
                                    textTransform: 'lowercase',
                                }"
                                (blurInput)="validateEmail()"
                            ></app-ca-input>

                            <app-ca-input
                                formControlName="ssn"
                                [inputConfig]="{
                                    name: 'SSN',
                                    type: 'text',
                                    label: 'SSN',
                                    isRequired: true,
                                    mask: '000-00-0000',
                                    maxLength: 11,
                                }"
                                (blurInput)="validateSsn()"
                                (clear)="validateSsn($event, true)"
                            ></app-ca-input>
                        </div>

                        <!-- Address, Unit -->

                        <div class="row last-row">
                            <div class="col-10">
                                <app-ca-input-address-dropdown
                                    formControlName="address"
                                    [inputConfig]="{
                                        name: 'Address',
                                        type: 'text',
                                        label: 'Address, City, State Zip',
                                        isRequired: true,
                                        placeholderIcon: 'address',
                                        textTransform: 'capitalize',
                                        dropdownWidthClass: 'w-col-510',
                                        minLength: 6,
                                        maxLength: 256,
                                    }"
                                    [placeholderType]="'longAddress'"
                                    [activeAddress]="selectedAddress"
                                    [receivedAddressList]="addressList"
                                    [receivedAddressData]="addressData"
                                    (selectedAddress)="onHandleAddress($event)"
                                    (sentAddressData)="
                                        onAddressChange($event, addressService)
                                    "
                                    (sentAddressValue)="
                                        getAddressData($event, addressService)
                                    "
                                ></app-ca-input-address-dropdown>
                            </div>

                            <div class="col-2">
                                <app-ca-input
                                    formControlName="addressUnit"
                                    [inputConfig]="{
                                        name: 'address-unit',
                                        type: 'text',
                                        label: 'Unit #',
                                        textTransform: 'uppercase',
                                        minLength: 1,
                                        maxLength: 10,
                                    }"
                                ></app-ca-input>
                            </div>
                        </div>

                        <!-- Owner -->

                        <app-ta-checkbox-card
                            formControlName="isOwner"
                            [label]="'Owner'"
                            [name]="'owner'"
                            [hasArrow]="false"
                            [disabledCard]="true"
                            [subText]="
                                isOwnerAlreadyAddedAsSoleProprietor &&
                                'Already added as sole proprietor in owner list'
                            "
                            [isCheckboxDisabled]="
                                isOwnerAlreadyAddedAsSoleProprietor
                            "
                            [isCardOpen]="driverForm.get('isOwner').value"
                        >
                            <ng-container body>
                                <app-ta-tab-switch
                                    [tabs]="ownerTabs"
                                    [type]="'type2-modal-popup'"
                                    (switchClicked)="onOwnerTabChange($event)"
                                ></app-ta-tab-switch>

                                <div
                                    class="animation-checkbox-card-tabs"
                                    [ngClass]="{
                                        'fade-checkbox-inputs':
                                            driverForm.get('ownerType')
                                                .value === 'Company',
                                    }"
                                >
                                    <div class="row">
                                        <app-ca-input-dropdown
                                            formControlName="owner"
                                            [template]="
                                                'double-column-template'
                                            "
                                            [inputConfig]="{
                                                name: 'Input Dropdown',
                                                type: 'text',
                                                isDropdown: true,
                                                multipleLabel: {
                                                    labels: [
                                                        'Ein',
                                                        'Company Name',
                                                    ],
                                                    customClass:
                                                        'dropdown-double-column',
                                                },
                                                dropdownWidthClass: 'w-col-616',
                                            }"
                                            [options]="ownersDropdownList"
                                            [activeItem]="selectedOwner"
                                            [canOpenModal]="true"
                                            [canAddNew]="true"
                                            (selectedItem)="
                                                onSelectDropdown(
                                                    $event,
                                                    'owner'
                                                )
                                            "
                                        ></app-ca-input-dropdown>
                                    </div>
                                </div>
                            </ng-container>
                        </app-ta-checkbox-card>

                        <!-- Payroll -->

                        <app-ta-custom-card
                            [cardName]="'Payroll'"
                            [hasArrow]="false"
                            [disabledCard]="true"
                            [isCardOpen]="true"
                            [subText]="
                                driverForm.get('isOwner').value &&
                                'Owner is paid by truck commission; these settings apply when assigned on company unit'
                            "
                        >
                            <ng-container
                                *ngIf="!driverForm.get('isOwner').value"
                            >
                                <app-ta-tab-switch
                                    [tabs]="payrollTabs"
                                    [type]="'type2-modal-popup'"
                                    (switchClicked)="
                                        onPayrolltTabChange($event)
                                    "
                                >
                                </app-ta-tab-switch>
                            </ng-container>

                            <div
                                class="align-items-center custom-row-paytype-driver"
                                [ngClass]="{
                                    'not-combined': fleetType !== 'Combined',
                                }"
                            >
                                <app-ta-checkbox
                                    formControlName="useCarrieraAch"
                                    [customClass]="'medium'"
                                    [name]="'truckassistACH'"
                                    [isUseCarrieraACHCheckBox]="true"
                                ></app-ta-checkbox>

                                <app-ca-input-dropdown
                                    formControlName="payType"
                                    [inputConfig]="{
                                        name: 'Input Dropdown',
                                        type: 'text',
                                        label: 'Pay type',
                                        isRequired: true,
                                        isDropdown: true,
                                        dropdownWidthClass:
                                            driverForm.get('isOwner').value &&
                                            selectedPayType?.name !==
                                                'Commission'
                                                ? 'w-col-450'
                                                : 'w-col-210',
                                    }"
                                    [options]="payTypeDropdownList"
                                    [activeItem]="selectedPayType"
                                    (selectedItem)="
                                        onSelectDropdown($event, 'paytype')
                                    "
                                ></app-ca-input-dropdown>

                                <ng-container *ngIf="fleetType === 'Combined'">
                                    <app-ta-checkbox
                                        formControlName="soloDriver"
                                        [customClass]="'medium'"
                                        [name]="'soloDriver'"
                                        [label]="'Solo Driver'"
                                        [isDisabledBlue]="
                                            !driverForm.get('teamDriver').value
                                        "
                                    ></app-ta-checkbox>

                                    <app-ta-checkbox
                                        formControlName="teamDriver"
                                        [customClass]="'medium'"
                                        [name]="'teamDriver'"
                                        [label]="'Team Driver'"
                                        [isDisabledBlue]="
                                            !driverForm.get('soloDriver').value
                                        "
                                    ></app-ta-checkbox>
                                </ng-container>
                            </div>

                            <!-- Pay Type Per Mile -->

                            <ng-container
                                *ngIf="
                                    selectedPayType?.name === 'Per Mile';
                                    else commission
                                "
                            >
                                <div
                                    class="paytype-permile"
                                    [class.active]="
                                        selectedPayType?.name === 'Per Mile'
                                    "
                                >
                                    <!-- Per Mile Solo -->

                                    <ng-container
                                        *ngIf="
                                            ['Solo', 'Combined'].includes(
                                                fleetType
                                            )
                                        "
                                    >
                                        <div
                                            class="align-items-center permile-fields"
                                            [ngClass]="{
                                                disabled:
                                                    !driverForm.get(
                                                        'soloDriver'
                                                    ).value,
                                                'solo-or-team':
                                                    fleetType === 'Solo',
                                                'permile-fields-same-rate':
                                                    fleetType !== 'Combined' &&
                                                    hasMilesSameRate,
                                                'permile-fields-same-rate-combined':
                                                    fleetType === 'Combined' &&
                                                    hasMilesSameRate,
                                            }"
                                        >
                                            <ng-container
                                                *ngIf="fleetType === 'Combined'"
                                            >
                                                <p class="m-0 ta-font-medium">
                                                    SOLO
                                                </p>
                                            </ng-container>

                                            <ng-container
                                                *ngIf="
                                                    !hasMilesSameRate;
                                                    else perMileSolo
                                                "
                                            >
                                                <app-ca-input
                                                    formControlName="soloEmptyMile"
                                                    [inputConfig]="{
                                                        name: 'Per Mile',
                                                        type: 'text',
                                                        label: 'Empty Mi',
                                                        placeholderIcon:
                                                            'dollar',
                                                        isRequired: true,
                                                        isDisabled:
                                                            fleetType ===
                                                                'Combined' &&
                                                            !driverForm.get(
                                                                'soloDriver'
                                                            ).value,
                                                        min: 0,
                                                        max: 10,
                                                        maxLength: 4,
                                                    }"
                                                ></app-ca-input>

                                                <app-ca-input
                                                    formControlName="soloLoadedMile"
                                                    [inputConfig]="{
                                                        name: 'Per Mile',
                                                        type: 'text',
                                                        label: 'Loaded Mi',
                                                        placeholderIcon:
                                                            'dollar',
                                                        isRequired: true,
                                                        isDisabled:
                                                            fleetType ===
                                                                'Combined' &&
                                                            !driverForm.get(
                                                                'soloDriver'
                                                            ).value,
                                                        min: 0,
                                                        max: 10,
                                                        maxLength: 4,
                                                    }"
                                                ></app-ca-input>
                                            </ng-container>

                                            <ng-template #perMileSolo>
                                                <app-ca-input
                                                    formControlName="perMileSolo"
                                                    [inputConfig]="{
                                                        name: 'Per Mile',
                                                        type: 'text',
                                                        label: 'Per Mile',
                                                        isRequired: true,
                                                        placeholderIcon:
                                                            'dollar',
                                                        isDisabled:
                                                            fleetType ===
                                                                'Combined' &&
                                                            !driverForm.get(
                                                                'soloDriver'
                                                            ).value,
                                                        min: 0,
                                                        max: 10,
                                                        maxLength: 4,
                                                    }"
                                                >
                                                </app-ca-input>
                                            </ng-template>

                                            <app-ca-input
                                                formControlName="soloPerStop"
                                                [inputConfig]="{
                                                    name: 'Per Stop',
                                                    label: 'Per Stop',
                                                    type: 'text',
                                                    placeholderIcon: 'dollar',
                                                    thousandSeparator: true,
                                                    isDisabled:
                                                        fleetType ===
                                                            'Combined' &&
                                                        !driverForm.get(
                                                            'soloDriver'
                                                        ).value,
                                                    min: 0,
                                                    max: 5000,
                                                }"
                                            ></app-ca-input>
                                        </div>
                                    </ng-container>

                                    <!-- Per Mile Team -->

                                    <ng-container
                                        *ngIf="
                                            ['Team', 'Combined'].includes(
                                                fleetType
                                            )
                                        "
                                    >
                                        <div
                                            class="align-items-center permile-fields"
                                            [ngClass]="{
                                                disabled:
                                                    !driverForm.get(
                                                        'teamDriver'
                                                    ).value,
                                                'solo-or-team':
                                                    fleetType === 'Team',
                                                'permile-fields-same-rate':
                                                    fleetType !== 'Combined' &&
                                                    hasMilesSameRate,
                                                'permile-fields-same-rate-combined':
                                                    fleetType === 'Combined' &&
                                                    hasMilesSameRate,
                                            }"
                                        >
                                            <ng-container
                                                *ngIf="fleetType === 'Combined'"
                                            >
                                                <p class="m-0 ta-font-medium">
                                                    TEAM
                                                </p>
                                            </ng-container>

                                            <ng-container
                                                *ngIf="
                                                    !hasMilesSameRate;
                                                    else perMileTeam
                                                "
                                            >
                                                <app-ca-input
                                                    formControlName="teamEmptyMile"
                                                    [inputConfig]="{
                                                        name: 'Per Mile',
                                                        type: 'text',
                                                        label: 'Empty Mi',
                                                        placeholderIcon:
                                                            'dollar',
                                                        isRequired: true,
                                                        isDisabled:
                                                            fleetType ===
                                                                'Combined' &&
                                                            !driverForm.get(
                                                                'teamDriver'
                                                            ).value,
                                                        min: 0,
                                                        max: 10,
                                                        maxLength: 4,
                                                    }"
                                                ></app-ca-input>

                                                <app-ca-input
                                                    formControlName="teamLoadedMile"
                                                    [inputConfig]="{
                                                        name: 'Per Mile',
                                                        type: 'text',
                                                        label: 'Loaded Mi',
                                                        placeholderIcon:
                                                            'dollar',
                                                        isRequired: true,
                                                        isDisabled:
                                                            fleetType ===
                                                                'Combined' &&
                                                            !driverForm.get(
                                                                'teamDriver'
                                                            ).value,
                                                        min: 0,
                                                        max: 10,
                                                        maxLength: 4,
                                                    }"
                                                ></app-ca-input>
                                            </ng-container>

                                            <ng-template #perMileTeam>
                                                <app-ca-input
                                                    formControlName="perMileTeam"
                                                    [inputConfig]="{
                                                        name: 'Per Mile',
                                                        type: 'text',
                                                        label: 'Per Mile',
                                                        isRequired: true,
                                                        placeholderIcon:
                                                            'dollar',
                                                        isDisabled:
                                                            fleetType ===
                                                                'Combined' &&
                                                            !driverForm.get(
                                                                'teamDriver'
                                                            ).value,
                                                        min: 0,
                                                        max: 10,
                                                        maxLength: 4,
                                                    }"
                                                >
                                                </app-ca-input>
                                            </ng-template>

                                            <app-ca-input
                                                formControlName="teamPerStop"
                                                [inputConfig]="{
                                                    name: 'Per Stop',
                                                    label: 'Per Stop',
                                                    type: 'text',
                                                    placeholderIcon: 'dollar',
                                                    thousandSeparator: true,
                                                    isDisabled:
                                                        fleetType ===
                                                            'Combined' &&
                                                        !driverForm.get(
                                                            'teamDriver'
                                                        ).value,
                                                    min: 0,
                                                    max: 5000,
                                                }"
                                            ></app-ca-input>
                                        </div>
                                    </ng-container>
                                </div>
                            </ng-container>

                            <!-- Pay Type Commission -->

                            <ng-template #commission>
                                <ng-container
                                    *ngIf="
                                        selectedPayType?.name === 'Commission';
                                        else flatRate
                                    "
                                >
                                    <ng-container
                                        *ngIf="
                                            fleetType === 'Combined';
                                            else singleCommission
                                        "
                                    >
                                        <div class="paytype-commission">
                                            <!-- Commission Solo -->

                                            <div class="paytype-field">
                                                <app-ta-ngx-slider
                                                    [sliderName]="
                                                        'Solo Driver Commission'
                                                    "
                                                    [sliderOptions]="
                                                        soloSliderOptions
                                                    "
                                                    [startedValue]="
                                                        driverForm.get(
                                                            'commissionSolo'
                                                        )?.value
                                                    "
                                                    [customClass]="
                                                        'custom-slider-with-percentage custom-driver-modal'
                                                    "
                                                    [isDisabled]="
                                                        !driverForm.get(
                                                            'commissionSolo'
                                                        )?.value
                                                    "
                                                    (onUserValueChange)="
                                                        handleSliderValueChange(
                                                            $event,
                                                            'commissionSolo'
                                                        )
                                                    "
                                                ></app-ta-ngx-slider>
                                            </div>

                                            <!-- Commission Team -->

                                            <div class="paytype-field">
                                                <app-ta-ngx-slider
                                                    [sliderName]="
                                                        'Team Driver Commission'
                                                    "
                                                    [sliderOptions]="
                                                        teamSliderOptions
                                                    "
                                                    [startedValue]="
                                                        driverForm.get(
                                                            'commissionTeam'
                                                        )?.value
                                                    "
                                                    [customClass]="
                                                        'custom-slider-with-percentage custom-driver-modal'
                                                    "
                                                    [isDisabled]="
                                                        !driverForm.get(
                                                            'commissionTeam'
                                                        )?.value
                                                    "
                                                    (onUserValueChange)="
                                                        handleSliderValueChange(
                                                            $event,
                                                            'commissionTeam'
                                                        )
                                                    "
                                                ></app-ta-ngx-slider>
                                            </div>
                                        </div>
                                    </ng-container>

                                    <ng-template #singleCommission>
                                        <div
                                            class="paytype-commission paytype-commission-single"
                                        >
                                            <app-ta-ngx-slider
                                                [sliderName]="
                                                    'Driver Commission'
                                                "
                                                [sliderOptions]="
                                                    driverSliderOptions
                                                "
                                                [startedValue]="
                                                    driverForm.get(
                                                        'driverCommission'
                                                    )?.value
                                                "
                                                [customClass]="
                                                    'custom-slider-with-percentage custom-driver-modal custom-driver-modal-single'
                                                "
                                                (onUserValueChange)="
                                                    handleSliderValueChange(
                                                        $event,
                                                        'driverCommission'
                                                    )
                                                "
                                            ></app-ta-ngx-slider>
                                        </div>
                                    </ng-template>
                                </ng-container>
                            </ng-template>

                            <!--Flat Rate -->

                            <ng-template #flatRate>
                                <ng-container
                                    *ngIf="
                                        selectedPayType?.name === 'Flat Rate'
                                    "
                                >
                                    <div class="row">
                                        <!-- Flat Rate Solo -->

                                        <ng-container
                                            *ngIf="
                                                ['Solo', 'Combined'].includes(
                                                    fleetType
                                                )
                                            "
                                        >
                                            <div
                                                [ngClass]="{
                                                    'col-6':
                                                        fleetType ===
                                                        'Combined',
                                                }"
                                            >
                                                <app-ca-input
                                                    formControlName="flatRateSolo"
                                                    [inputConfig]="{
                                                        name: 'Flat Rate',
                                                        label:
                                                            fleetType ===
                                                            'Combined'
                                                                ? 'Solo Rate'
                                                                : 'Rate',
                                                        type: 'text',
                                                        placeholderIcon:
                                                            'dollar',
                                                        thousandSeparator: true,
                                                        isRequired: true,
                                                        isDisabled:
                                                            fleetType ===
                                                                'Combined' &&
                                                            !driverForm.get(
                                                                'soloDriver'
                                                            ).value,
                                                        min: 0,
                                                        max: 5000,
                                                    }"
                                                ></app-ca-input>
                                            </div>
                                        </ng-container>

                                        <!-- Flat Rate Team -->

                                        <ng-container
                                            *ngIf="
                                                ['Team', 'Combined'].includes(
                                                    fleetType
                                                )
                                            "
                                        >
                                            <div
                                                [ngClass]="{
                                                    'col-6':
                                                        fleetType ===
                                                        'Combined',
                                                }"
                                            >
                                                <app-ca-input
                                                    formControlName="flatRateTeam"
                                                    [inputConfig]="{
                                                        name: 'Flat Rate',
                                                        label:
                                                            fleetType ===
                                                            'Combined'
                                                                ? 'Team Rate'
                                                                : 'Rate',
                                                        type: 'text',
                                                        placeholderIcon:
                                                            'dollar',
                                                        thousandSeparator: true,
                                                        isRequired: true,
                                                        isDisabled:
                                                            fleetType ===
                                                                'Combined' &&
                                                            !driverForm.get(
                                                                'teamDriver'
                                                            ).value,
                                                        min: 0,
                                                        max: 5000,
                                                    }"
                                                ></app-ca-input>
                                            </div>
                                        </ng-container>
                                    </div>
                                </ng-container>
                            </ng-template>

                            <!-- Bank -->

                            <div class="custom-bank-row custom-bank-row-driver">
                                <div class="bank-field">
                                    <app-ca-input-dropdown
                                        formControlName="bankId"
                                        [template]="'svg-template'"
                                        [inputConfig]="{
                                            name: 'Input Dropdown Bank Name',
                                            type: 'text',
                                            label: 'Bank Name',
                                            minLength: 2,
                                            maxLength: 64,
                                            textTransform: 'uppercase',
                                            isDropdown: true,
                                            isRequired:
                                                driverForm.get('useCarrieraAch')
                                                    .value,
                                            dropdownWidthClass: 'w-col-184',
                                        }"
                                        [canAddNew]="true"
                                        [options]="banksDropdownList"
                                        [activeItem]="selectedBank"
                                        (selectedItem)="
                                            onSelectDropdown($event, 'bank')
                                        "
                                        (saveItem)="onSaveNewBank($event)"
                                    ></app-ca-input-dropdown>
                                </div>

                                <div class="bank-field">
                                    <app-ca-input
                                        formControlName="routing"
                                        [inputConfig]="{
                                            name: 'routing-bank',
                                            type: 'text',
                                            label: 'Routing',
                                            isDisabled: !isBankSelected,
                                            isRequired: isBankSelected,
                                            minLength: 9,
                                            maxLength: 9,
                                        }"
                                    ></app-ca-input>
                                </div>

                                <div class="bank-field">
                                    <app-ca-input
                                        formControlName="account"
                                        [inputConfig]="{
                                            name: 'account-bank',
                                            type: 'text',
                                            label: 'Account',
                                            isDisabled: !isBankSelected,
                                            isRequired: isBankSelected,
                                            maxLength: 17,
                                            minLength: 5,
                                        }"
                                    ></app-ca-input>
                                </div>
                            </div>

                            <!-- Share Open Payroll | Calculate Payroll  -->

                            <ng-container
                                *ngIf="
                                    !driverForm.get('isOwner').value &&
                                        driverForm.get('payrollType').value ===
                                            'Company Driver';
                                    else calculatePayroll
                                "
                            >
                                <app-ta-checkbox
                                    formControlName="isOpenPayrollShared"
                                    [customClass]="'medium'"
                                    [name]="'shareOpenPayroll'"
                                    [label]="'Share open payroll with driver'"
                                ></app-ta-checkbox>
                            </ng-container>

                            <ng-template #calculatePayroll>
                                <ng-container
                                    *ngIf="
                                        !driverForm.get('isOwner').value &&
                                        driverForm.get('payrollType').value ===
                                            '3rd Party Driver'
                                    "
                                >
                                    <app-ta-checkbox
                                        formControlName="isPayrollCalculated"
                                        [customClass]="'medium'"
                                        [name]="'calculatePayroll'"
                                        [label]="
                                            'Calculate payroll for 3rd party driver'
                                        "
                                    ></app-ta-checkbox>
                                </ng-container>
                            </ng-template>
                        </app-ta-custom-card>

                        <!-- Off Duty Location -->

                        <app-ta-custom-card
                            [hasCounter]="offDutyLocationItems?.length"
                            [cardName]="'Off duty Location'"
                            [headerSvgEnabled]="true"
                            [hasActionSvg]="true"
                            [subText]="
                                'Driver can disable GPS tracking. Parking location included.'
                            "
                            [isCardOpen]="offDutyLocationItems?.length"
                            [disabledCard]="!offDutyLocationItems?.length"
                            [disableAnimation]="isCardAnimationDisabled"
                            [animationMarginParams]="{
                                marginTop: '10px',
                                marginBottom: '12px',
                            }"
                            (onActionEvent)="addOffDutyLocation($event)"
                        >
                            <app-ta-modal-table
                                [tableType]="
                                    modalTableTypeEnum.OFF_DUTY_LOCATION
                                "
                                [isNewRowCreated]="isOffDutyLocationRowCreated"
                                [modalTableData]="updatedOffDutyLocationItems"
                                (modalTableValueEmitter)="
                                    handleModalTableValueEmit(
                                        $event,
                                        'off-duty-location'
                                    )
                                "
                                (modalTableValidStatusEmitter)="
                                    handleModalTableValidStatusEmit(
                                        $event,
                                        'off-duty-location'
                                    )
                                "
                            ></app-ta-modal-table>
                        </app-ta-custom-card>

                        <!-- Emergency Contact -->

                        <app-ta-custom-card
                            [cardName]="'Emergency Contact'"
                            [isCardOpen]="true"
                            [disableAnimation]="isCardAnimationDisabled"
                            [animationMarginParams]="{
                                marginTop: '18px',
                                marginBottom: '22px',
                            }"
                        >
                            <div class="emergency-contact">
                                <app-ca-input
                                    formControlName="emergencyContactName"
                                    [inputConfig]="{
                                        name: 'Emergency Name',
                                        type: 'text',
                                        label: 'Name',
                                        textTransform: 'capitalize',
                                        minLength: 2,
                                        maxLength: 24,
                                    }"
                                ></app-ca-input>

                                <app-ca-input
                                    formControlName="emergencyContactPhone"
                                    [inputConfig]="{
                                        name: 'Phone',
                                        type: 'text',
                                        label: 'Phone',
                                        placeholderIcon: 'phone',
                                        mask: '(000) 000-0000',
                                        maxLength: 14,
                                    }"
                                ></app-ca-input>

                                <app-ca-input
                                    formControlName="emergencyContactRelationship"
                                    [inputConfig]="{
                                        name: 'Relationship',
                                        type: 'text',
                                        label: 'Relationship',
                                        textTransform: 'capitalize',
                                        minLength: 2,
                                        maxLength: 24,
                                    }"
                                ></app-ca-input>
                            </div>
                        </app-ta-custom-card>

                        <!-- Documents -->

                        <div class="ta-card-body-overflow-none">
                            <app-ta-custom-card
                                [hasCounter]="documents?.length"
                                [cardName]="'Document'"
                                [disableAnimation]="isCardAnimationDisabled"
                                [isCardOpen]="!!documents.length"
                            >
                                <app-ca-upload-files
                                    [files]="documents"
                                    [slider]="{
                                        dontUseSlider: false,
                                        hasCarouselBottomTabs: true,
                                    }"
                                    [carouselConfig]="{
                                        files: documents,
                                        customClass: 'medium',
                                        customDetailsPageClass: 'modals',
                                        hasCarouselBottomTabs: true,
                                    }"
                                    [hasCrop]="false"
                                    [dropzoneConf]="[
                                        {
                                            template: 'documentsTemplate',
                                            config: {
                                                dropzone: {
                                                    dropZoneType: 'files',
                                                    multiple: true,
                                                    globalDropZone: false,
                                                    dropZonePages: 'tools_todo',
                                                },
                                                dropzoneOption: {
                                                    customClassName:
                                                        'documents-dropzone',
                                                    size: 'medium',
                                                    modalSize: 'lg',
                                                    showDropzone: true,
                                                    filesLength: 2,
                                                    isRequired: true,
                                                    dropzoneClose: false,
                                                },
                                            },
                                        },
                                    ]"
                                    [dropzoneCustomWidth]="'603px'"
                                    [isVisibleCropAndDrop]="true"
                                    [review]="{
                                        isReview: false,
                                        reviewMode: 'FEEDBACK_MODE',
                                        feedbackText: 'Sample feedback text',
                                        categoryTag: 'General',
                                    }"
                                    [configFile]="{
                                        id: 111,
                                        customClassName: 'modals',
                                        file: {
                                            url: '',
                                            incorrect: false,
                                            lastHovered: false,
                                            fileSize: 1200,
                                            fileName: '',
                                        },
                                        hasTagsDropdown: true,
                                        hasNumberOfPages: true,
                                        activePage: 1,
                                        type: 'modal',
                                        hasLandscapeOption: false,
                                        tagsOptions: [
                                            {
                                                tagName: 'HOS Agreement',
                                                checked: false,
                                            },
                                            {
                                                tagName: 'Unsafe Driving AGT',
                                                checked: false,
                                            },
                                        ],
                                    }"
                                    [size]="'medium'"
                                    [slideWidth]="180"
                                    (onFileEvent)="onFilesEvent($event)"
                                ></app-ca-upload-files>
                            </app-ta-custom-card>
                        </div>

                        <!-- Note -->

                        <app-ca-input-note
                            formControlName="note"
                            [isVisibleNote]="
                                driverForm.get('note').value &&
                                driverForm.get('note').value != 'null'
                                    ? driverForm.get('note').value
                                    : false
                            "
                            [note]="
                                driverForm.get('note').value &&
                                driverForm.get('note').value != 'null'
                                    ? driverForm.get('note').value
                                    : ''
                            "
                        ></app-ca-input-note>
                    </div>
                </ng-container>

                <!-- Additional Tab -->

                <ng-template #selectedTabTwo>
                    <div class="m-tab" *ngIf="selectedTabId === 2">
                        <!-- Profile Picture -->

                        <app-ta-custom-card
                            [cardName]="'Profile Picture'"
                            [isCardOpen]="!!this.driverForm.get('avatar').value"
                            [disableAnimation]="isCardAnimationDisabled"
                        >
                            <app-ca-upload-files
                                [isVisibleCropAndDrop]="
                                    uploadOptionsConstants.isVisibleCropAndDrop
                                "
                                [files]="uploadOptionsConstants.files"
                                [slider]="uploadOptionsConstants.slider"
                                [carouselConfig]="
                                    uploadOptionsConstants.carouselConfig
                                "
                                [hasCrop]="uploadOptionsConstants.hasCrop"
                                [isRoundCrop]="
                                    uploadOptionsConstants.isRoundCrop
                                "
                                [containWithinAspectRatio]="
                                    uploadOptionsConstants.containWithinAspectRatio
                                "
                                [aspectRatio]="
                                    uploadOptionsConstants.aspectRatio
                                "
                                [initialCropperPosition]="
                                    uploadOptionsConstants.initialCropperPosition
                                "
                                [dropzoneCustomWidth]="
                                    uploadOptionsConstants.dropzoneCustomWidth
                                "
                                [dropzoneConf]="
                                    uploadOptionsConstants.dropzoneConf
                                "
                                [review]="uploadOptionsConstants.review"
                                [configFile]="uploadOptionsConstants.configFile"
                                [size]="uploadOptionsConstants.size"
                                [slideWidth]="uploadOptionsConstants.slideWidth"
                                (onFileEvent)="onUploadImage($event)"
                            ></app-ca-upload-files>
                        </app-ta-custom-card>

                        <!-- Cards & MVR Exp. -->

                        <div class="driver-cards-mvr">
                            <app-ta-custom-card
                                [hasCounter]="fuelCardItems?.length"
                                [cardName]="'Fuel Card'"
                                [headerSvgEnabled]="true"
                                [hasActionSvg]="true"
                                [isCardOpen]="fuelCardItems?.length"
                                [disabledCard]="!fuelCardItems?.length"
                                [disableAnimation]="isCardAnimationDisabled"
                                [animationMarginParams]="{
                                    marginTop: '10px',
                                    marginBottom: '12px',
                                }"
                                (onActionEvent)="addFuelCard($event)"
                            >
                                <app-ta-modal-table
                                    [tableType]="modalTableTypeEnum.FUEL_CARD"
                                    [isNewRowCreated]="isFuelCardRowCreated"
                                    [modalTableData]="updatedFuelCardItems"
                                    (modalTableValueEmitter)="
                                        handleModalTableValueEmit(
                                            $event,
                                            'fuel card'
                                        )
                                    "
                                    (modalTableValidStatusEmitter)="
                                        handleModalTableValidStatusEmit(
                                            $event,
                                            'fuel card'
                                        )
                                    "
                                ></app-ta-modal-table>
                            </app-ta-custom-card>

                            <!-- Twic Card -->

                            <app-ta-custom-card
                                [cardName]="'Twic Card & MVR Exp.'"
                                [hasArrow]="false"
                                [disabledCard]="true"
                                [isCardOpen]="true"
                            >
                                <div
                                    class="align-items-center driver-twic-mvr-row"
                                >
                                    <app-ta-checkbox
                                        formControlName="twic"
                                        [label]="'TWIC Card'"
                                        [customClass]="'medium'"
                                    ></app-ta-checkbox>

                                    <app-ca-input
                                        formControlName="twicExpDate"
                                        [inputConfig]="{
                                            name: 'datepicker',
                                            type: 'text',
                                            isDropdown: true,
                                            label: 'TWIC Exp.',
                                            placeholderIcon: 'date',
                                            isRequired:
                                                driverForm.get('twic').value,
                                            isDisabled:
                                                !driverForm.get('twic').value,
                                            customClass: 'datetimeclass',
                                        }"
                                    ></app-ca-input>

                                    <app-ca-input
                                        formControlName="mvrExpiration"
                                        [inputConfig]="{
                                            name: 'months',
                                            type: 'text',
                                            placeholderText: 'months',
                                            label: 'MVR Renewal.',
                                            isRequired: true,
                                            hideClear: true,
                                            commands: {
                                                active: true,
                                                type: 'months',
                                                firstCommand: {
                                                    name: 'minus',
                                                    svg: driverModalSvgRoutes.decrementSvgRoute,
                                                },
                                                secondCommand: {
                                                    name: 'plus',
                                                    svg: driverModalSvgRoutes.incrementSvgRoute,
                                                },
                                            },
                                        }"
                                    ></app-ca-input>
                                </div>
                            </app-ta-custom-card>
                        </div>

                        <!-- Notification -->

                        <app-ta-custom-card
                            [cardName]="'Notification'"
                            [hasArrow]="false"
                            [disabledCard]="true"
                            [isCardOpen]="true"
                        >
                            <div class="align-items-center driver-notification">
                                <p class="m-0 ta-font-medium">GENERAL</p>

                                <app-ta-checkbox
                                    formControlName="mailNotificationGeneral"
                                    [customClass]="'medium'"
                                    [name]="'Email General'"
                                    [label]="'Email'"
                                ></app-ta-checkbox>

                                <app-ta-checkbox
                                    formControlName="pushNotificationGeneral"
                                    [customClass]="'medium'"
                                    [name]="'Push General'"
                                    [label]="'Push Notification'"
                                ></app-ta-checkbox>

                                <app-ta-checkbox
                                    formControlName="smsNotificationGeneral"
                                    [customClass]="'medium'"
                                    [name]="'SMS General'"
                                    [label]="'SMS'"
                                ></app-ta-checkbox>
                            </div>

                            <div
                                class="align-items-center driver-notification driver-notification-payroll"
                            >
                                <p class="m-0 ta-font-medium">PAYROLL</p>

                                <app-ta-checkbox
                                    formControlName="mailNotificationPayroll"
                                    [name]="'Email Payroll'"
                                    [label]="'Email'"
                                    [isDisabledBlue]="true"
                                ></app-ta-checkbox>

                                <app-ta-checkbox
                                    formControlName="pushNotificationPayroll"
                                    [customClass]="'medium'"
                                    [name]="'Push Payroll'"
                                    [label]="'Push Notification'"
                                ></app-ta-checkbox>

                                <app-ta-checkbox
                                    formControlName="smsNotificationPayroll"
                                    [customClass]="'medium'"
                                    [name]="'SMS Payroll'"
                                    [label]="'SMS'"
                                ></app-ta-checkbox>
                            </div>
                        </app-ta-custom-card>
                    </div>
                </ng-template>
            </div>
        </form>
    </div>
</app-ca-modal>

<ng-template #rightModalContent>
    @if (editData?.type === 'edit') {
        <div
            ngbTooltip
            mainTooltip="Added    {{
                editData?.data?.createdAt | formatDateP
            }} <br> Edited    {{ editData?.data?.updatedAt | formatDateP }}"
            tooltipBackground="#424242"
            position="bottom"
            class="modal-date-logo"
        >
            <svg-icon
                [src]="svgRoutes.DATE_ICON"
                class="modal-buttons"
            ></svg-icon>
        </div>
        <div class="modal-date-border"></div>
    }
    <div
        class="d-flex justify-content-center align-items-center modal-close-container"
        ngbTooltip
        mainTooltip="Cancel"
        tooltipBackground="#424242"
        position="bottom"
        (click)="onModalAction(taModalActionEnum.CLOSE)"
    >
        <svg-icon
            class="modal-close svg-size-14 svg-fill-muted modal-buttons"
            [src]="svgRoutes.CLOSE_ICON"
        ></svg-icon>
    </div>
</ng-template>

<ng-template #leftModalContent>
    @if (driverFullName) {
        <div class="payroll-number text-color-white text-size-14 ta-font-bold">
            {{ driverFullName }}
        </div>
    }
</ng-template>

<ng-template #footerTemplate>
    <div class="modal-footer modal-footer-payroll">
        <div class="divider"></div>
        @if (editData?.type === 'edit') {
            <div class="d-flex justify-content-between w-full">
                <div>
                    <button
                        class="modal-delete-btn ta-font-bold mr-12 valid"
                        (click)="onModalAction(taModalActionEnum.DELETE)"
                    >
                        Delete
                    </button>
                    <button
                        class="modal-convert-to-template-btn ta-font-bold"
                        (click)="onModalAction(taModalActionEnum.DEACTIVATE)"
                    >
                        Deactivate
                    </button>
                </div>
                <button
                    class="modal-save-btn ta-font-bold"
                    (click)="onModalAction(taModalActionEnum.SAVE)"
                    [class.valid]="
                        driverForm.valid &&
                        isFormDirty &&
                        isEachOffDutyLocationRowValid
                    "
                >
                    Save Changes
                </button>
            </div>
        } @else {
            <button
                class="ta-font-bold modal-save-btn modal-save-btn-add-new mr-12"
                [class.valid]="
                    driverForm.valid &&
                    isFormDirty &&
                    isEachOffDutyLocationRowValid
                "
                (click)="onModalAction(taModalActionEnum.SAVE_AND_ADD_NEW)"
            >
                Save and Add New
            </button>
            <button
                class="modal-save-btn ta-font-bold"
                (click)="onModalAction(taModalActionEnum.SAVE)"
                [class.valid]="
                    driverForm.valid &&
                    isFormDirty &&
                    isEachOffDutyLocationRowValid
                "
            >
                Save
            </button>
        }
    </div>
</ng-template>
