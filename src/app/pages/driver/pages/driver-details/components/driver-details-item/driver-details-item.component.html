<div class="details-component driver-details-item-container">
    <ng-container
        *ngFor="let driverItem of detailsConfig; trackBy: trackByIdentity"
    >
        <ng-container [ngSwitch]="driverItem.template">
            <!-- General -->

            <ng-container *ngSwitchCase="'general'">
                <app-driver-details-card
                    [driver]="driverItem.data"
                ></app-driver-details-card>
            </ng-container>

            <!-- Cdl -->

            <ng-container *ngSwitchCase="'cdl'">
                <div class="card-width">
                    <app-ta-common-card
                        *ngFor="
                            let cdl of cdlData;
                            let i = index;
                            trackBy: trackByIdentity
                        "
                        [cardNameCurrent]="'cdl'"
                        [cardNameCommon]="cdl?.cdlNumber"
                        [expDateClose]="
                            cdl?.isExpired
                                ? 'Expired ' + formatDate(cdl?.expDate)
                                : formatDate(cdl?.expDate)
                        "
                        [voidedDate]="formatDate(cdl?.dateDeactivated)"
                        [cardDocumentCounter]="cdl?.files?.length"
                        [statusActive]="cdl?.status"
                        [isCardOpen]="!!cdl?.status"
                        [hasCopyIcon]="true"
                        [forcedOpen]="
                            cdl?.issueDate > currentDate ? true : false
                        "
                        [isDeactivated]="cdl?.dateDeactivated"
                        [weeklyWidth]="'28'"
                        [stateTooltipName]="cdl?.state?.stateName"
                        [shortName]="cdl?.state?.stateShortName"
                        [mainData]="cdl"
                        [options]="dataDropDown"
                        [optionsId]="cdl?.id"
                        [noteIcons]="
                            (cdl.note &&
                                cdl.note != null &&
                                cdl.note != 'null') ||
                            cdlNote?.value
                                ? 'assets/svg/truckassist-table/note/Note.svg'
                                : 'assets/svg/truckassist-table/note/Note - Empty.svg'
                        "
                        (dataDropDopwn)="getCdlById(cdl.id)"
                        (preloadData)="preloadData(cdl, 'cdl')"
                        (resizePage)="toggleResizePage(i, 'cdl')"
                        (clickedCard)="getNameForDrop($event, cdl.id)"
                        (dropActions)="optionsEvent($event, 'cdl')"
                    >
                        <div class="cards-container">
                            <div
                                class="d-flex flex-column justify-content-center cdl-card-container"
                            >
                                <!-- Class, Issued -->

                                <div
                                    class="align-items-center cdl-card-inner-container"
                                >
                                    <div
                                        class="d-flex flex-column jusitfy-content-center cdl-card-box"
                                    >
                                        <p class="m-0 ta-font-bold">Class</p>

                                        <span> {{ cdl?.classType.name }}</span>
                                    </div>

                                    <div
                                        class="d-flex flex-column jusitfy-content-center cdl-card-box"
                                    >
                                        <p class="m-0 ta-font-bold">Issued</p>

                                        <span>
                                            {{
                                                formatDate(cdl?.issueDate)
                                            }}</span
                                        >
                                    </div>
                                </div>

                                <!-- Restrictions, Endorsements -->

                                <div
                                    class="align-items-center cdl-card-inner-container"
                                >
                                    <div
                                        class="d-flex flex-column jusitfy-content-center cdl-card-box"
                                    >
                                        <p class="m-0 ta-font-bold">
                                            Restrictions
                                        </p>

                                        <span>
                                            <ng-container
                                                *ngFor="
                                                    let restriction of cdl?.cdlRestrictions;
                                                    let i = index;
                                                    trackBy: trackByIdentity
                                                "
                                            >
                                                {{ restriction.code }}
                                                {{
                                                    i !==
                                                    cdl?.cdlRestrictions
                                                        .length -
                                                        1
                                                        ? ','
                                                        : ''
                                                }}
                                            </ng-container>
                                        </span>
                                    </div>

                                    <div
                                        class="d-flex flex-column jusitfy-content-center cdl-card-box"
                                    >
                                        <p class="m-0 ta-font-bold">
                                            Endorsements
                                        </p>

                                        <span>
                                            <ng-container
                                                *ngFor="
                                                    let endorsement of cdl?.cdlEndorsements;
                                                    let i = index;
                                                    trackBy: trackByIdentity
                                                "
                                            >
                                                {{ endorsement.code }}
                                                {{
                                                    i !==
                                                    cdl?.cdlEndorsements
                                                        .length -
                                                        1
                                                        ? ','
                                                        : ''
                                                }}
                                            </ng-container>
                                        </span>
                                    </div>
                                </div>

                                <!-- Progress Bar -->

                                <div
                                    class="d-flex flex-column justify-content-center progress-bar-container"
                                >
                                    <app-ta-progress-expiration
                                        [expireDate]="formatDate(cdl?.expDate)"
                                        [startDate]="formatDate(cdl?.issueDate)"
                                        [expiresSettings]="'details'"
                                        [darkText]="true"
                                    >
                                    </app-ta-progress-expiration>

                                    <ng-container *ngIf="cdl?.dateDeactivated">
                                        <div
                                            (click)="
                                                openCommand(
                                                    cdl,
                                                    'activate-licence'
                                                )
                                            "
                                            class="d-flex align-items-center justify-content-center ta-font-bold activate-button"
                                        >
                                            Activate
                                        </div>
                                    </ng-container>

                                    <ng-container
                                        *ngIf="
                                            cdl?.showButton &&
                                            !cdl?.dateDeactivated &&
                                            cdl?.issueDate < currentDate
                                        "
                                    >
                                        <div
                                            (click)="
                                                openCommand(
                                                    cdl,
                                                    'renew-licence'
                                                )
                                            "
                                            class="d-flex align-items-center justify-content-center ta-font-bold activate-button"
                                        >
                                            RENEW
                                        </div>
                                    </ng-container>
                                </div>

                                <!-- Note, Documents -->

                                <div class="note-documents-container">
                                    <div
                                        [@showHideCardBody]="
                                            toggler[i + 'cdl']
                                                ? 'true'
                                                : 'false'
                                        "
                                    >
                                        <ng-container
                                            *ngIf="cdl?.files?.length"
                                        >
                                            <div class="divider"></div>

                                            <app-ta-custom-card
                                                [cardName]="'Document'"
                                                [hasCounter]="
                                                    cdl?.files?.length
                                                "
                                                [isCardOpen]="true"
                                                [hasArrow]="false"
                                                [hasDownload]="
                                                    'assets/svg/common/ic_download.svg
'
                                                "
                                                (onActionEvent)="
                                                    onFileAction($event, 'cdl')
                                                "
                                            >
                                                <app-ta-upload-files
                                                    [files]="cdl?.files"
                                                    [customClassName]="
                                                        'driver-details-pdf'
                                                    "
                                                    [hasCarouselBottomTabs]="
                                                        true
                                                    "
                                                    [type]="'details'"
                                                    [slideWidth]="324"
                                                    [hasLandscapeOption]="true"
                                                ></app-ta-upload-files>
                                            </app-ta-custom-card>
                                        </ng-container>

                                        <div class="divider"></div>

                                        <div class="card-note">
                                            <app-ta-input-note
                                                [formControl]="cdlNote"
                                                [isVisibleDivider]="false"
                                                [isVisibleNote]="true"
                                                [isVisibleArrow]="false"
                                                [minRows]="1"
                                                [placeholder]="
                                                    'Write something.'
                                                "
                                                [customClass]="'note-small'"
                                                [noteType]="'details-card'"
                                                [note]="
                                                    cdl.note &&
                                                    cdl.note != 'null'
                                                        ? cdl.note
                                                        : ''
                                                "
                                                [entityId]="cdl.id"
                                                [entityType]="'Cdl'"
                                            >
                                            </app-ta-input-note>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </app-ta-common-card>
                </div>
            </ng-container>

            <!-- Test -->

            <ng-container *ngSwitchCase="'drug-alcohol'">
                <div class="card-width">
                    <div>
                        <app-ta-common-card
                            *ngFor="
                                let test of driverItem?.data;
                                let i = index;
                                trackBy: trackByIdentity
                            "
                            [hasToggler]="true"
                            [options]="dataDropDownMvr"
                            [cardNameCommon]="formatDate(test?.testingDate)"
                            [expDateClose]="formatDate(test?.testingDate)"
                            (resizePage)="toggleResizePage(i, 'test')"
                            [optionsId]="test.id"
                            [testDate]="formatDate(test?.testingDate)"
                            (dataDropDopwn)="getTestById(test.id)"
                            (preloadData)="preloadData(test, 'test')"
                            (clickedCard)="getNameForDrop($event)"
                            [cardDocumentCounter]="
                                test?.files?.length ? test.files.length : 0
                            "
                            [weeklyWidth]="'18'"
                            [cardNameCurrent]="'test'"
                            [noteIcons]="
                                test.note &&
                                test.note != null &&
                                test.note != 'null'
                                    ? 'assets/svg/truckassist-table/note/Note.svg'
                                    : 'assets/svg/truckassist-table/note/Note - Empty.svg'
                            "
                            [cardSecondResult]="test?.result.name"
                            [cardSecondName]="test?.testReason.name"
                            [shortName]="test.testType.name[0]"
                            [stateTooltipName]="test.testType.name + ' Test'"
                            (dropActions)="optionsEvent($event, 'test')"
                        >
                            <div class="cards-container">
                                <div class="card-body-cdl">
                                    <div
                                        class="card-restriction-endorsment card-restriction-class"
                                    >
                                        <div class="card-restriction">
                                            <div class="restriction-name">
                                                Type
                                            </div>
                                            <div class="restriction-item-value">
                                                {{
                                                    test.testType.name + ' Test'
                                                }}
                                            </div>
                                        </div>
                                        <div class="card-restriction">
                                            <div class="restriction-name">
                                                Reason
                                            </div>
                                            <div class="restriction-item-value">
                                                {{ test?.testReason.name }}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="second-progress"></div>
                            <div class="cards-container">
                                <div
                                    [@showHideCardBody]="
                                        toggler[i + 'test'] ? 'true' : 'false'
                                    "
                                >
                                    <div
                                        class="divider"
                                        *ngIf="test?.files?.length"
                                    ></div>
                                    <div
                                        class="details-document-container"
                                        [class.disabled]="!test?.files?.length"
                                        *ngIf="test?.files?.length"
                                    >
                                        <div class="icon-counter-wrapper">
                                            <div
                                                class="counter-text-wrapper"
                                                [class.disabled]="
                                                    !test?.files?.length
                                                "
                                            >
                                                <p
                                                    class="details-document-name"
                                                >
                                                    Document
                                                </p>
                                                <app-ta-counter
                                                    [countBackground]="
                                                        '#424242'
                                                    "
                                                    [customClass]="
                                                        'circle_counter'
                                                    "
                                                    [countHeight]="'22px'"
                                                    [countWidth]="'22px'"
                                                    [count]="
                                                        test?.files?.length
                                                            ? test.files.length
                                                            : 0
                                                    "
                                                >
                                                </app-ta-counter>
                                            </div>
                                            <svg-icon
                                                *ngIf="test?.files?.length"
                                                (click)="
                                                    onFileAction('download')
                                                "
                                                src="assets/svg/common/ic_download.svg"
                                            >
                                            </svg-icon>
                                        </div>
                                    </div>
                                    <div
                                        class="card-pdf"
                                        [class.extended]="
                                            test?.files?.length > 1
                                        "
                                        [class.disabled]="!test?.files?.length"
                                    >
                                        <app-ta-upload-files
                                            [files]="
                                                test.files ? test.files : []
                                            "
                                            [customClassName]="
                                                'driver-details-pdf'
                                            "
                                            [hasCarouselBottomTabs]="true"
                                            [type]="'details'"
                                            [slideWidth]="324"
                                        ></app-ta-upload-files>
                                    </div>
                                    <div class="divider"></div>
                                    <div class="card-note">
                                        <app-ta-input-note
                                            [formControl]="testNote"
                                            [isVisibleDivider]="false"
                                            [isVisibleNote]="true"
                                            [isVisibleArrow]="false"
                                            [minRows]="1"
                                            [placeholder]="'Write something.'"
                                            [customClass]="'note-small'"
                                            [noteType]="'details-card'"
                                            [note]="
                                                test.note && test.note != 'null'
                                                    ? test.note
                                                    : ''
                                            "
                                            [entityId]="test.id"
                                            [entityType]="'Test'"
                                        >
                                        </app-ta-input-note>
                                    </div>
                                </div>
                            </div>
                        </app-ta-common-card>
                    </div>
                </div>
            </ng-container>

            <!-- Medical -->

            <ng-container *ngSwitchCase="'medical'">
                <div class="card-width">
                    <div>
                        <app-ta-common-card
                            *ngFor="
                                let med of driverItem?.data;
                                let i = index;
                                trackBy: trackByIdentity
                            "
                            [options]="dataDropDownMvr"
                            [cardNameCommon]="formatDate(med?.issueDate)"
                            [cardDocumentCounter]="
                                med?.files?.length ? med.files.length : 0
                            "
                            [expDateClose]="formatDate(med?.expDate)"
                            [optionsId]="med.id"
                            (dataDropDopwn)="getMedicalById(med.id)"
                            (preloadData)="preloadData(med, 'med')"
                            (clickedCard)="getNameForDrop($event)"
                            [cardNameCurrent]="'medical'"
                            [noteIcons]="
                                med.note &&
                                med.note != null &&
                                med.note != 'null'
                                    ? 'assets/svg/truckassist-table/note/Note.svg'
                                    : 'assets/svg/truckassist-table/note/Note - Empty.svg'
                            "
                            (resizePage)="toggleResizePage(i, 'medical')"
                            (dropActions)="optionsEvent($event, 'medical')"
                        >
                            <div class="cards-container">
                                <div class="card-body-cdl">
                                    <div
                                        class="card-row-progress second-progress"
                                    >
                                        <div
                                            class="card-details-progress-container"
                                        >
                                            <app-ta-progress-expiration
                                                [expireDate]="
                                                    formatDate(med?.expDate)
                                                "
                                                [startDate]="
                                                    formatDate(med?.issueDate)
                                                "
                                                [expiresSettings]="'details'"
                                                [darkText]="true"
                                            >
                                            </app-ta-progress-expiration>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    [@showHideCardBody]="
                                        toggler[i + 'medical']
                                            ? 'true'
                                            : 'false'
                                    "
                                >
                                    <div
                                        class="divider"
                                        *ngIf="med?.files?.length"
                                    ></div>
                                    <div
                                        class="details-document-container"
                                        [class.disabled]="!med?.files?.length"
                                        *ngIf="med?.files?.length"
                                    >
                                        <div class="icon-counter-wrapper">
                                            <div
                                                class="counter-text-wrapper"
                                                [class.disabled]="
                                                    !med?.files?.length
                                                "
                                            >
                                                <p
                                                    class="details-document-name"
                                                >
                                                    Document
                                                </p>
                                                <app-ta-counter
                                                    [countBackground]="
                                                        '#424242'
                                                    "
                                                    [customClass]="
                                                        'circle_counter'
                                                    "
                                                    [countHeight]="'22px'"
                                                    [countWidth]="'22px'"
                                                    [count]="
                                                        med?.files?.length
                                                            ? med.files.length
                                                            : 0
                                                    "
                                                >
                                                </app-ta-counter>
                                            </div>
                                            <svg-icon
                                                *ngIf="med?.files?.length"
                                                (click)="
                                                    onFileAction('download')
                                                "
                                                src="assets/svg/common/ic_download.svg"
                                            >
                                            </svg-icon>
                                        </div>
                                    </div>
                                    <div
                                        class="card-pdf"
                                        [class.extended]="
                                            med?.files?.length > 1
                                        "
                                        [class.disabled]="!med?.files?.length"
                                    >
                                        <app-ta-upload-files
                                            [files]="med.files ? med.files : []"
                                            [customClassName]="
                                                'driver-details-pdf'
                                            "
                                            [hasCarouselBottomTabs]="true"
                                            [type]="'details'"
                                            [slideWidth]="324"
                                        ></app-ta-upload-files>
                                    </div>
                                    <div class="divider"></div>
                                    <div class="card-note">
                                        <app-ta-input-note
                                            [formControl]="medNote"
                                            [isVisibleDivider]="false"
                                            [isVisibleNote]="true"
                                            [isVisibleArrow]="false"
                                            [minRows]="1"
                                            [placeholder]="'Write something.'"
                                            [customClass]="'note-small'"
                                            [noteType]="'details-card'"
                                            [note]="
                                                med.note && med.note != 'null'
                                                    ? med.note
                                                    : ''
                                            "
                                            [entityId]="med.id"
                                            [entityType]="'Medical'"
                                        >
                                        </app-ta-input-note>
                                    </div>
                                </div>
                            </div>
                        </app-ta-common-card>
                    </div>
                </div>
            </ng-container>

            <!-- MVR -->

            <ng-container *ngSwitchCase="'mvr'">
                <div class="card-width">
                    <div>
                        <app-ta-common-card
                            *ngFor="
                                let mvr of driverItem?.data;
                                let i = index;
                                trackBy: trackByIdentity
                            "
                            [options]="dataDropDownMvr"
                            [cardNameCurrent]="'mvr'"
                            (clickedCard)="getNameForDrop($event)"
                            (dataDropDopwn)="getMvrById(mvr.id)"
                            (preloadData)="preloadData(mvr, 'mvr')"
                            [cardDocumentCounter]="
                                mvr?.files?.length ? mvr.files.length : 0
                            "
                            [noteIcons]="
                                mvr.note &&
                                mvr.note != null &&
                                mvr.note != 'null'
                                    ? 'assets/svg/truckassist-table/note/Note.svg'
                                    : 'assets/svg/truckassist-table/note/Note - Empty.svg'
                            "
                            (resizePage)="toggleResizePage(i, 'mvr')"
                            [cardNameCommon]="formatDate(mvr?.issueDate)"
                            [expDateClose]="formatDate(mvr?.expDate)"
                            [optionsId]="mvr.id"
                            [setPositionDrop]="true"
                            [mvrPositionDrop]="true"
                            [mainData]="mvr"
                            (dropActions)="optionsEvent($event, 'mvr')"
                        >
                            <div class="cards-container">
                                <div class="card-body-cdl">
                                    <div
                                        class="card-row-progress second-progress"
                                    >
                                        <div
                                            class="card-details-progress-container"
                                        >
                                            <app-ta-progress-expiration
                                                [startDate]="
                                                    formatDate(mvr?.issueDate)
                                                "
                                                [expireDate]="
                                                    formatDate(mvr?.expDate)
                                                "
                                                [expiresSettings]="'details'"
                                                [darkText]="true"
                                            >
                                            </app-ta-progress-expiration>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    [@showHideCardBody]="
                                        toggler[i + 'mvr'] ? 'true' : 'false'
                                    "
                                >
                                    <div
                                        class="divider"
                                        *ngIf="mvr?.files?.length"
                                    ></div>
                                    <div
                                        class="details-document-container"
                                        [class.disabled]="!mvr?.files?.length"
                                        *ngIf="mvr?.files?.length"
                                    >
                                        <div
                                            class="icon-counter-wrapper"
                                            [class.disabled]="
                                                !mvr?.files?.length
                                            "
                                        >
                                            <div class="counter-text-wrapper">
                                                <p
                                                    class="details-document-name"
                                                >
                                                    Document
                                                </p>
                                                <app-ta-counter
                                                    [countBackground]="
                                                        '#424242'
                                                    "
                                                    [customClass]="
                                                        'circle_counter'
                                                    "
                                                    [countHeight]="'22px'"
                                                    [countWidth]="'22px'"
                                                    [count]="
                                                        mvr?.files?.length
                                                            ? mvr.files.length
                                                            : 0
                                                    "
                                                >
                                                </app-ta-counter>
                                            </div>
                                            <svg-icon
                                                *ngIf="mvr?.files?.length"
                                                (click)="
                                                    onFileAction('download')
                                                "
                                                src="assets/svg/common/ic_download.svg"
                                            >
                                            </svg-icon>
                                        </div>
                                    </div>
                                    <div
                                        class="card-pdf"
                                        [class.extended]="
                                            mvr?.files?.length > 1
                                        "
                                        [class.disabled]="!mvr?.files?.length"
                                    >
                                        <app-ta-upload-files
                                            [files]="mvr.files ? mvr.files : []"
                                            [customClassName]="
                                                'driver-details-pdf'
                                            "
                                            [hasCarouselBottomTabs]="true"
                                            [type]="'details'"
                                            [slideWidth]="324"
                                        ></app-ta-upload-files>
                                    </div>
                                    <div class="divider"></div>
                                    <div class="card-note">
                                        <app-ta-input-note
                                            [formControl]="mvrNote"
                                            [isVisibleDivider]="false"
                                            [isVisibleNote]="true"
                                            [isVisibleArrow]="false"
                                            [minRows]="1"
                                            [placeholder]="'Write something.'"
                                            [customClass]="'note-small'"
                                            [noteType]="'details-card'"
                                            [note]="
                                                mvr.note && mvr.note != 'null'
                                                    ? mvr.note
                                                    : ''
                                            "
                                            [entityId]="mvr.id"
                                            [entityType]="'Mvr'"
                                        >
                                        </app-ta-input-note>
                                    </div>
                                </div>
                            </div>
                        </app-ta-common-card>
                    </div>
                </div>
            </ng-container>
        </ng-container>
    </ng-container>
</div>
